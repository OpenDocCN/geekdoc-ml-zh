<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Artificial Neural Networks Test</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Artificial Neural Networks Test</h1>
<blockquote>ÂéüÊñáÔºö<a href="https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_ANN.html">https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_ANN.html</a></blockquote>

<p>Michael J. Pyrcz, Professor, The University of Texas at Austin</p>
<p><a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
<p>Chapter of e-book ‚ÄúApplied Machine Learning in Python: a Hands-on Guide with Code‚Äù.</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite this e-Book as:</p>
<p>Pyrcz, M.J., 2024, <em>Applied Machine Learning in Python: A Hands-on Guide with Code</em> [e-book]. Zenodo. doi:10.5281/zenodo.15169138 <a class="reference external" href="https://doi.org/10.5281/zenodo.15169138"><img alt="DOI" src="../Images/7e4ea662f44af1eae87e87ecbb962ff4.png" data-original-src="https://zenodo.org/badge/863274676.svg"/></a></p>
</div>
<p>The workflows in this book and more are available here:</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite the MachineLearningDemos GitHub Repository as:</p>
<p>Pyrcz, M.J., 2024, <em>MachineLearningDemos: Python Machine Learning Demonstration Workflows Repository</em> (0.0.3) [Software]. Zenodo. DOI: 10.5281/zenodo.13835312. GitHub repository: <a class="github reference external" href="https://github.com/GeostatsGuy/MachineLearningDemos">GeostatsGuy/MachineLearningDemos</a> <a class="reference external" href="https://zenodo.org/doi/10.5281/zenodo.13835312"><img alt="DOI" src="../Images/4e3a59c17d684b06a170c4af84e0f631.png" data-original-src="https://zenodo.org/badge/862519860.svg"/></a></p>
</div>
<p>By Michael J. Pyrcz <br/>
¬© Copyright 2024.</p>
<p>This chapter is a tutorial for / demonstration of <strong>Artificial Neural Networks</strong>.</p>
<p><strong>YouTube Lecture</strong>: check out my lectures on:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://youtu.be/A9PiCMY_6nM?si=NxWSU_5RgQ4w55EL">Artificial Neural Networks</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/za2my_XDoOs?si=LeHU6p2_fc9dX4Yt">Convolutional Neural Networks</a></p></li>
</ul>
<p>These lectures are all part of my <a class="reference external" href="https://youtube.com/playlist?list=PLG19vXLQHvSC2ZKFIkgVpI9fCjkN38kwf&amp;si=XonjO2wHdXffMpeI">Machine Learning Course</a> on YouTube with linked well-documented Python workflows and interactive dashboards. My goal is to share accessible, actionable, and repeatable educational content. If you want to know about my motivation, check out <a class="reference external" href="https://michaelpyrcz.com/my-story">Michael‚Äôs Story</a>.</p>
<section id="motivation">
<h2>Motivation</h2>
<p>Artificial neural networks are very powerful, nature inspired computing based on an analogy of brain</p>
<ul class="simple">
<li><p>I suggest that they are like a reptilian brain, without planning and higher order reasoning</p></li>
</ul>
<p>In addition, artificial neural networks are a building block of many other deep learning methods, for example,</p>
<ul class="simple">
<li><p>convolutional neural networks</p></li>
<li><p>recurrent neural networks</p></li>
<li><p>generative adversarial networks</p></li>
<li><p>autoencoders</p></li>
</ul>
<p>Nature inspired computing is looking to nature for inspiration to develop novel problem-solving methods,</p>
<ul class="simple">
<li><p><strong>artificial neural networks</strong> are inspired by biological neural networks</p></li>
<li><p><strong>nodes</strong> -  in our model are artificial neurons, simple processors</p></li>
<li><p><strong>connections</strong> between nodes are artificial synapses</p></li>
</ul>
<p>intelligence emerges from many connected simple processors. For the remainder of this chapter, I will used the terms nodes and connections to describe our artificial neural network.</p>
</section>
<section id="neural-network-concepts">
<h2>Neural Network Concepts</h2>
<p>Here are some key aspects of artificial neural networks,</p>
<p><strong>Basic Design</strong> - <em>‚Äú‚Ä¶a computing system made up of a number of simple, highly interconnected processing elements, which process information by their dynamic state response to external inputs.‚Äù</em> Caudill (1989).</p>
<p><strong>Still a Prediction Model</strong> - while these models may be quite complicated with even millions of trainable model parameters, weights and biases, they are still a function that maps from predictor features to response features,</p>
<div class="math notranslate nohighlight">
\[
Y=f(X)+\epsilon
\]</div>
<p><strong>Supervised learning</strong> ‚Äì we provide training data with predictor features, <span class="math notranslate nohighlight">\(X_1,\ldots,ùëã_ùëö\)</span> and response feature(s), <span class="math notranslate nohighlight">\(ùëå_1,\ldots,ùëå_K\)</span>, with the expectation of some model prediction error, <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p>
<p><strong>Nonlinearity</strong> - nonlinearity is imparted to the system through the application of nonlinear activation functions to model nonlinear relationships</p>
<p><strong>Universal Function Approximator (Universal Approximation Theorem)</strong> - ANNs have the ability to learn any possible function shape of <span class="math notranslate nohighlight">\(f\)</span> over an interval, for an arbitrary wide (single hidden layer) by Cybenko (1989) and arbitrary depth by Lu and others (2017)</p>
</section>
<section id="a-simple-network">
<h2>A Simple Network</h2>
<p>To get started, let‚Äôs build a neural net, single hidden layer, fully connected, feed-forward neural network,</p>
<figure style="text-align: center;">
  <img src="../Images/832ee38f2f09d395115eb31b95358103.png" style="display: block; margin: 0 auto; width: 60%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann.png"/>
  <figcaption style="text-align: center;"> Simple demonstration artificial neural network.
</figcaption>
</figure>
<p>We use this example artificial neural network in the descriptions below and as an actual example that we will train and predict with by-hand!</p>
<p>Now let‚Äôs label the parts of our network,</p>
<figure style="text-align: center;">
  <img src="../Images/0be0dcf09e698cf22dc0881c818c0dbc.png" style="display: block; margin: 0 auto; width: 75%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_parts.png"/>
  <figcaption style="text-align: center;"> Simple demonstration artificial neural network with the parts labeled, including 3 inputs nodes, 2 hidden nodes and 1 output node fully connected.
</figcaption>
</figure>
<p>Our artificial neural network has,</p>
<ul class="simple">
<li><p>3 predictor features, <span class="math notranslate nohighlight">\(X_1\)</span>, <span class="math notranslate nohighlight">\(X_2\)</span> and <span class="math notranslate nohighlight">\(X_3\)</span></p></li>
<li><p>3 input nodes, <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(I_2\)</span> and <span class="math notranslate nohighlight">\(I_3\)</span></p></li>
<li><p>2 hidden layer nodes, <span class="math notranslate nohighlight">\(H_4\)</span> and <span class="math notranslate nohighlight">\(H_5\)</span></p></li>
<li><p>1 output node, <span class="math notranslate nohighlight">\(O_6\)</span></p></li>
<li><p>1 response feature, <span class="math notranslate nohighlight">\(Y_1\)</span></p></li>
</ul>
<p>where all nodes fully connected. Note, deep learning is a neural network with more than 1 hidden layer, but for brevity let‚Äôs continue with our non-deep learning artificial neural network.</p>
</section>
<section id="comments-on-network-nomenclature">
<h2>Comments on Network Nomenclature</h2>
<p>Just a couple more comments about my network nomenclature. My goal is to maximize simplicity and clarity,</p>
<ul class="simple">
<li><p><strong>Network Nodes and Connections</strong> - I choose to use unique numbers for all nodes, <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(I_2\)</span>, <span class="math notranslate nohighlight">\(I_3\)</span>, <span class="math notranslate nohighlight">\(H_4\)</span>, <span class="math notranslate nohighlight">\(H_5\)</span> and <span class="math notranslate nohighlight">\(O_6\)</span>, instead of repeating numbers over each layer, <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(I_2\)</span>, <span class="math notranslate nohighlight">\(I_3\)</span>, <span class="math notranslate nohighlight">\(H_1\)</span>, <span class="math notranslate nohighlight">\(H_2\)</span>, and <span class="math notranslate nohighlight">\(O_1\)</span> to simplify the notation for the weights; therefore, when I say <span class="math notranslate nohighlight">\(\lambda_{1,4}\)</span> you know exactly where this weight is applied in the network, from node <span class="math notranslate nohighlight">\(I_1\)</span> to node <span class="math notranslate nohighlight">\(H_4\)</span>.</p></li>
<li><p><strong>Node Outputs</strong> - I use the node label to also describe the output from the node, for example <span class="math notranslate nohighlight">\(O_6\)</span> is the output node, <span class="math notranslate nohighlight">\(O_6\)</span>, and also the signal or value output from node <span class="math notranslate nohighlight">\(O_6\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 \right) 
\]</div>
<ul class="simple">
<li><p><strong>Pre- and Post-activation</strong> - at our nodes <span class="math notranslate nohighlight">\(H_4\)</span>, <span class="math notranslate nohighlight">\(H_5\)</span>, and <span class="math notranslate nohighlight">\(O_6\)</span>, we have the node input before activation and the node output after activation, I use the notation <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, <span class="math notranslate nohighlight">\(H_{5_{in}}\)</span>, and <span class="math notranslate nohighlight">\(O_{6_{in}}\)</span> for the pre-activation input,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
H_{4_{in}} = \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5_{in}} = \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{2,5} \cdot I_3 
\]</div>
<div class="math notranslate nohighlight">
\[
O_{6_{in}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 
\]</div>
<p><span class="math notranslate nohighlight">\(\quad\)</span> and <span class="math notranslate nohighlight">\(H_4\)</span>, <span class="math notranslate nohighlight">\(H_5\)</span>, and <span class="math notranslate nohighlight">\(O_6\)</span> for the post-activation node output.</p>
<div class="math notranslate nohighlight">
\[
H_{4} = \sigma \left( H_{4_{in}} \right) = \sigma \left( \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 \right) 
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5} = \sigma \left( H_{5_{in}} \right) = \sigma \left( \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{2,5} \cdot I_3 \right) 
\]</div>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma \left( O_{6_{in}} \right) = \sigma \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 \right)
\]</div>
<p>It is important to have clean, clear notation because with back propagation we have to step through the nodes, going from post-activation to pre-activation.</p>
<ul class="simple">
<li><p>often variables like <span class="math notranslate nohighlight">\(z\)</span> are applied for pre-activation in neural network literature, but I feel this is ambiguous and may cause confusion as we provide a nuts and bolts approach, explicitly describing every equation, to describe exactly how neural networks are trained and predict</p></li>
</ul>
</section>
<section id="description-of-the-network-approach">
<h2>Description of the Network Approach</h2>
<p>Let‚Äôs talk about the network, the parts and how information flows through the network.</p>
<p><strong>Feed-forward</strong> ‚Äì all information flows from left to right. Each node sends the same signal along the connections to all the nodes in the next layer,</p>
<figure style="text-align: center;">
  <img src="../Images/02be26cd4d5476666cd2e1a72c3005fe.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_flow.png"/>
  <figcaption style="text-align: center;"> Feed forward, fully connected, with each node sending the same signal to all the nodes in the next layer.
</figcaption>
</figure>
<p><strong>Input Layer</strong> - the input features are passed directly to the input nodes, in the case of continuous predictor features, there is one input node per feature and the features are,</p>
<ul class="simple">
<li><p>min / max normalization to a range <span class="math notranslate nohighlight">\(\left[ ‚àí1,1 \right]\)</span> or <span class="math notranslate nohighlight">\(\left[ 0,1 \right]\)</span> to improve activation function sensitivity and to remove the influence of scale differences in predictor features and to improve solution stability, i.e., smooth reduction in the training loss while training</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/cb20e85861a55df55677b55ce737bbd5.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_input.png"/>
  <figcaption style="text-align: center;"> Highlighting the input layer, the first layer that receives the normalized predictor features.
</figcaption>
</figure>
<p>In the case of categorical predictor features, we have one input node per each category for each predictor feature, i.e., after one-hot-encoding of the feature where each encoding is passed to a separate input node.</p>
<ul class="simple">
<li><p>recall one-hot-encoding, 1 if the specific category, 0 otherwise, replaces the categorical feature with a binary vector with length as the number of categories.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/51d695aaaa36c3450f3997691fb0090f.png" style="display: block; margin: 0 auto; width: 90%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_input_cat.png"/>
  <figcaption style="text-align: center;"> The input layer of our artificial neural network highlighted. The first layer that receives one-hot-encoding of a single categorical predictor feature.
</figcaption>
</figure>
<ul class="simple">
<li><p>we could also use a single input node per categorical predictor and assign thresholds to each categories, for example <span class="math notranslate nohighlight">\(\left[ 0.0, 0.5, 1.0 \right]\)</span> for 3 categories, but this assumes an ordinal categorical feature</p></li>
</ul>
<p><strong>Hidden Layer</strong> -  the input layer values <span class="math notranslate nohighlight">\(I_1, I_2, I_2\)</span> are weighted with learnable weights,</p>
<div class="math notranslate nohighlight">
\[
\lambda_{1,4}, \lambda_{2,4}, \lambda_{3,4}, \lambda_{1,5}, \lambda_{2,5}, \lambda_{3,5}
\]</div>
<ul class="simple">
<li><p>in the hidden layer nodes, the weighted input layer values, <span class="math notranslate nohighlight">\(\lambda_{1,4} \cdot I_1, \lambda_{2,4} \cdot I_2 \cdot I_2, \ldots, \lambda_{3,5} \cdot I_3\)</span> are summed with the addition of a trainable bias term in each node, <span class="math notranslate nohighlight">\(b_4\)</span> and <span class="math notranslate nohighlight">\(b_5\)</span>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
H_{4_{in}} = \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5_{in}} = \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{3,5} \cdot I_3 + b_5
\]</div>
<p>the nonlinear activation is applied,</p>
<div class="math notranslate nohighlight">
\[
H_{4} = \sigma  \bigl( \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4 \bigr)
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5} = \sigma \bigl( \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{3,5} \cdot I_3 + b_5 \bigr)
\]</div>
<ul class="simple">
<li><p>the output from the input layer nodes to all hidden layer nodes is contant (again, each node sends the same value to all nodes in the next layer)</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/e2342c26953974528579d98e504c15c8.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_hidden.png"/>
  <figcaption style="text-align: center;"> The hidden layer of our artificial neural network highlighted. The input layer nodes' outputs are weighted and passed into the hidden layer nodes. The output from the hidden layer nodes to all output layer nodes is constant.
</figcaption>
</figure>
<p><strong>Output Layer</strong> - for continuous response features there is one output node per normalized response feature. Once again the weighted linear combination of inputs plus a node bias are calculated,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{in}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>and then activation is applied, but for a continuous response feature, typically identity (linear) transform is applied,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \alpha \bigl( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \bigr) = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 = O_{6_{in}} 
\]</div>
<ul class="simple">
<li><p>backtransformation from normalized to original response feature(s) are then applied to recover the ultimate prediction</p></li>
<li><p>as with continuous predictor features, min / max normalization is applied to continuous response features to a range [‚àí1,1] or [0,1] to improve activation function sensitivity</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/87d8ca10f44d6d5d97c7e6ced2d415e5.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_output.png"/>
  <figcaption style="text-align: center;"> The output layer of our artificial neural network highlighted. The hidden layer nodes' outputs are weighted and passed into the output layer nodes. The output from the hidden layer nodes is constant, but the weights vary over the hidden layer node to output layer node connections.
</figcaption>
</figure>
<p>In the case of a categorical response feature, once again one-hot-encoding is applied, therefore, there is one output node per category.</p>
<ul class="simple">
<li><p>the prediction is the probability of each category</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/11c0969ef52f11e6929df9ff8e4d92c2.png" style="display: block; margin: 0 auto; width: 80%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_output_cat.png"/>
  <figcaption style="text-align: center;"> Highlighting the input layer, the first layer that receives one-hot-encoding of a single categorical predictor feature.
</figcaption>
</figure></section>
<section id="walkthrough-the-network">
<h2>Walkthrough the Network</h2>
<p>Now we are ready to walkthough the artificial neural network.</p>
<ul class="simple">
<li><p>we follow a single path to illustrate the precise calculations associated with making a prediction with an artificial neural network</p></li>
</ul>
<p>The full forward pass is explained next.</p>
<p><strong>Inside an Input Layer Node</strong> - input layer nodes just pass the predictor features,</p>
<ul class="simple">
<li><p>normalized continuous predictor feature value</p></li>
<li><p>a single one-hot-encoding value [0 or 1] for categorical prediction features</p></li>
</ul>
<p>into the hidden layer nodes, with general vector notation,</p>
<div class="math notranslate nohighlight">
\[
I = X
\]</div>
<figure style="text-align: center;">
  <img src="../Images/4e1c6258eff75f9d4ce767b39cd522fb.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_input.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the input layer node receives one-hot-encoding of a single categorical predictor feature and passes it to all of the hidden layer nodes.
</figcaption>
</figure>
<p>We can generalize over all input layer nodes with,</p>
<div class="math notranslate nohighlight">
\[
H_j = H_{j_{in}} = X_j
\]</div>
<p><strong>Inside an Hidden Layer Node</strong></p>
<p>The hidden layer nodes are simple processors. The take linearly weighted combinations of inputs, add a node bias term and then nonlinearly transform the result, this transform is call the activation function, <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<ul class="simple">
<li><p>indeed, a very simple processor!</p></li>
<li><p>through many interconnected nodes we gain a very flexible predictor, emergent ability to characterize complicated, nonlinear patterns.</p></li>
</ul>
<p>Prior to activation we have,</p>
<div class="math notranslate nohighlight">
\[
H_{4_{in}} = \sum_{i=1}^{3} \left( \lambda_{i,4} \cdot I_i \right) + b_4
\]</div>
<p>and after activation we have,</p>
<div class="math notranslate nohighlight">
\[
H_4 = \alpha \left(H_{4_{in}} \right)
\]</div>
<p>We can express the simple processor in the node with general vector notation as,</p>
<div class="math notranslate nohighlight">
\[
H_4 = \alpha \left(b_4 + \lambda_{j,4}^T I \right)
\]</div>
<figure style="text-align: center;">
  <img src="../Images/b2f8e46ea497049f4b95c03b8812eea7.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_hidden.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the hidden layer linearly weights the input from each input layer node, adds a node bias term and then applies an activation function and passes this to all nodes in the next layer, i.e., the output layer for our example artificial neural network.
</figcaption>
</figure>
<p>We can generalize over all hidden layer nodes with,</p>
<div class="math notranslate nohighlight">
\[
H_{j_{in}} = \sum_{i=1}^{|I|} \left( \lambda_{i,j} \cdot I_i \right) + b_j
\]</div>
<p>and after activation, the node output is,</p>
<div class="math notranslate nohighlight">
\[
H_{j_{in}} = \sigma \bigl( \sum_{i=1}^{|I|} \left( \lambda_{i,j} \cdot I_i \right) + b_j \bigr)
\]</div>
<p><strong>Inside an Output Layer Node</strong></p>
<p>The output layer nodes take linearly weighted combinations of nodes‚Äô inputs, adds a node bias term and then transforms the result with an activation function, <span class="math notranslate nohighlight">\(\alpha\)</span>, same as the hidden layer nodes,</p>
<p>Prior to activation we have,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{in}} = \sum_{i=4}^{5} \left( \lambda_{i,6} \cdot H_i \right) + b_6
\]</div>
<p>and after activation, assuming identity activation we have,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \alpha \left(O_{6_{in}} \right)
\]</div>
<p>We can express the simple processor in the node with general vector notation as,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \alpha\left(b_6 + \lambda_{j,6}^T H\right)
\]</div>
<figure style="text-align: center;">
  <img src="../Images/22c5dd7e545497f42cf0b949f0b92954.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_output.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the output layer linearly weights the input from each hidden layer node, adds a node bias term and then applies an activation function, typically linear for continuous response features and passes this as an output.
</figcaption>
</figure>
<p>and for categorical response features, softmax activation is commonly applied,</p>
<div class="math notranslate nohighlight">
\[
O_j = \alpha(O_{j_{in}}) = \frac{e^{O_{j_{in}}}}{\sum_{\iota=1}^{K} e^{O_{\iota_{in}}}}
\]</div>
<figure style="text-align: center;">
  <img src="../Images/ff80ab0dac26f531ce5cc5ce3cd9cf5d.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_output_cat.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the output layer linearly weights the input from each hidden layer node, adds a node bias term and then applies an activation function, typically linear for continuous response features and passes this as an output.
</figcaption>
</figure>
<p>softmax activation ensures that the output over all the output layer nodes are valid probabilities including,</p>
<ul class="simple">
<li><p><strong>nonnegativity</strong> - through the exponentiation</p></li>
<li><p><strong>closure</strong> - probabilities sum to 1.0 through the denominator normalizing the result</p></li>
</ul>
<p>Note, for all future discussions and demonstrations, I assume a standardized continuous responce feature.</p>
</section>
<section id="network-forward-pass">
<h2>Network Forward Pass</h2>
<p>Now that we have completed a walk-through of our network on a single path, let‚Äôs combine all the paths through our network to demonstrate a complete forward pass through our artificial neural network.</p>
<ul class="simple">
<li><p>this is the calculation required to make a prediction with out,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma_{O_6} \bigl( 
    \lambda_{4,6} \cdot \sigma_{H_4} \left( \lambda_{1,4} I_1 + \lambda_{2,4} I_2 + \lambda_{3,4} I_3 + b_4 \right) 
  + \lambda_{5,6} \cdot \sigma_{H_5} \left( \lambda_{1,5} I_1 + \lambda_{2,5} I_2 + \lambda_{3,5} I_3 + b_5 \right)
  + b_6 \bigr)
\]</div>
<p>where the activation functions <span class="math notranslate nohighlight">\(\sigma_{H_4}\)</span> = <span class="math notranslate nohighlight">\(\sigma_{H_5}\)</span> = <span class="math notranslate nohighlight">\(\sigma\)</span> are sigmoid, and <span class="math notranslate nohighlight">\(\sigma_{O_6}\)</span> is linear (identity), so we could simplify the forward pass to,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \lambda_{4,6} \cdot \sigma \left( \lambda_{1,4} I_1 + \lambda_{2,4} I_2 + \lambda_{3,4} I_3 + b_4 \right) 
  + \lambda_{5,6} \cdot \sigma \left( \lambda_{1,5} I_1 + \lambda_{2,5} I_2 + \lambda_{3,5} I_3 + b_5 \right)
  + b_6
\]</div>
<p>This emphasizes that our neural network is a nested set of activated linear systems, i.e., linearly weighted averages plus bias terms applied to activation functions.</p>
</section>
<section id="number-of-model-parameters">
<h2>Number of Model Parameters</h2>
<p>In general, there are many model parameters, <span class="math notranslate nohighlight">\(theta\)</span>, in an artificial neural network. First, let‚Äôs clarify these definitions to describe our artificial neural network,</p>
<ul class="simple">
<li><p><strong>neural network width</strong> - the number of nodes in the layers of the neural network</p></li>
<li><p><strong>neural network depth</strong> - the number of layers in the neural network, typically the input layer is not included in this calculation</p></li>
</ul>
<p>Now, let‚Äôs assume the following compact notation for a 3 layer artificial neural network, input, output and 1 hidden layer, with the width of each layer as,</p>
<ul class="simple">
<li><p>number of input nodes, <span class="math notranslate nohighlight">\(p\)</span></p></li>
<li><p>number of hidden layer nodes, <span class="math notranslate nohighlight">\(m\)</span></p></li>
<li><p>and number of output nodes, <span class="math notranslate nohighlight">\(k\)</span></p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/1b5b7051a7f760fb3b71c71560ca7613.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/parameters.png"/>
  <figcaption style="text-align: center;"> Notation for artificial neural network width, number of input nodes, \(p\), number of hidden layer nodes, \(m\), and number of output nodes, \(k\). 
</figcaption>
</figure>
<p>fully connected, so for every connection there is a weight,</p>
<div class="math notranslate nohighlight">
\[
\lambda_{ùêº_{1,\ldots,ùëù},ùêª_{1,\ldots,ùëö} } \quad \text{and} \quad \lambda_{ùêª_{1,\ldots,ùëö},ùëÇ_{1,\ldots,ùëò} }
\]</div>
<p>with full connectivity the number of weights is</p>
<div class="math notranslate nohighlight">
\[
ùëù \times ùëö \quad \text{and} \quad ùëö \times ùëò
\]</div>
<p>and at each hidden layer node there is a bias term,</p>
<div class="math notranslate nohighlight">
\[
ùëè_{H_{1,\ldots,m} }
\]</div>
<p>and at every output node there is a bias term,</p>
<div class="math notranslate nohighlight">
\[
ùëè_{O_{1,\ldots,k} }
\]</div>
<p>Therefore, the number of model parameters is,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = ùëù \times ùëö + ùëö \times ùëò + ùëö + ùëò 
\]</div>
<p>this assumes an unique bias term at each hidden layer node and output layer node, but in some case the same bias term may be applied over the entire layer.</p>
<p>For our example, with <span class="math notranslate nohighlight">\(p = 3\)</span>, <span class="math notranslate nohighlight">\(m = 2\)</span> and <span class="math notranslate nohighlight">\(k = 1\)</span>, then the number of model parameters are,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = ùëù \times ùëö + ùëö \times ùëò + ùëö + ùëò 
\]</div>
<p>after substitution we have,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = 3 \times 2 + 2 \times 1 + 2 + 1 = 11
\]</div>
<p>I select this as a manageable number of parameters, so we can train and visualize our model, but consider a more typical model size by increasing our artificial neural network‚Äôs width, with <span class="math notranslate nohighlight">\(p = 10\)</span>, <span class="math notranslate nohighlight">\(m = 20\)</span> and <span class="math notranslate nohighlight">\(k = 3\)</span>, then we have many more model parameters,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = 10 \times 20 + 20 \times 3 + 20 + 3 = 283
\]</div>
<p>If we add hidden layers, increase our artificial neural network‚Äôs depth, the number of model parameters will grow very quickly.</p>
<ul class="simple">
<li><p>we can generalize this calculation for any fully connected, feed forward neural network, given a <span class="math notranslate nohighlight">\(W\)</span> vector with the number of nodes, i.e., the width of each layer,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\mathbf{L} = [l_0, l_1, l_2, \dots, l_n]
\]</div>
<p>where,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(l_0\)</span> is the number of input neurons</p></li>
<li><p><span class="math notranslate nohighlight">\(l_1, \dots, l_{n-1}\)</span> are the widths of the hidden layers</p></li>
<li><p><span class="math notranslate nohighlight">\(l_n\)</span> is the number of output neurons</p></li>
</ul>
<p>The total number of connection weights is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{weights}| = \sum_{i=1}^{n} l_i \cdot l_{i-1}
\]</div>
<p>the total number of node biases (there are not bias parameters in the input layer nodes, <span class="math notranslate nohighlight">\(l_0\)</span>) is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{biases}| = \sum_{i=1}^{n} l_i
\]</div>
<p>the total number of trainable model parameters, connectioned weights and node biases, is,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = \sum_{i=1}^{n} \left( l_i \cdot l_{i-1} + l_i \right) = \sum_{i=1}^{n} l_i \cdot (l_{i-1} + 1)
\]</div>
<p>Let‚Äôs take an example of artificial neural network with 4 hidden layers, with network width by-layer vector of,</p>
<div class="math notranslate nohighlight">
\[
\mathbf{L} = [10, 8, 6, 4, 2, 1]
\]</div>
<p>The total number of connection weights is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{L_{weights}}| = \sum_{i=1}^{5} l_i \cdot l_{i-1}
= (8 \cdot 10) + (6 \cdot 8) + (4 \cdot 6) + (2 \cdot 4) + (1 \cdot 2)
= 80 + 48 + 24 + 8 + 2 = 162
\]</div>
<p>and the total number of node biases is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{L_{biases}}|  = \sum_{i=1}^{5} l_i = 8 + 6 + 4 + 2 + 1 = 21
\]</div>
<p>and finally the total nuber of trainable parameters is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_L| = \sum_{i=1}^{5} l_i \cdot (l_{i-1} + 1)
= (8 \cdot 11) + (6 \cdot 9) + (4 \cdot 7) + (2 \cdot 5) + (1 \cdot 3)
= 88 + 54 + 28 + 10 + 3 = 183
\]</div>
</section>
<section id="activation-functions">
<h2>Activation Functions</h2>
<p>The activation function is a transformation of the linear combination of the weighted node inputs plus the node bias term. Nonlinear activation,</p>
<ul class="simple">
<li><p>introduces non-linear properties, and complexity to the network</p></li>
<li><p>prevents the network from collapsing</p></li>
</ul>
<p>Without the nonlinear activation function we would have linear regression, the entire system collapses.</p>
<p>For more information about activation functions and a demonstration of the collapse without nonlinear activation to multilinear regression see the associated chapter in this e-book, <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_activation_functions.html">Neural Network Activation Functions</a>.</p>
</section>
<section id="training-networks-steps">
<h2>Training Networks Steps</h2>
<p>Training an artificial neural network proceeds iteratively by these steps,</p>
<ol class="arabic simple" start="0">
<li><p>initialized the model parameters</p></li>
<li><p>forward pass to make a prediction</p></li>
<li><p>calculate the error derivative based on the prediction and truth over training data</p></li>
<li><p>backpropagate the error derivative back through the artificial neural network to calculate the derivatives of the error over all the model weights and biases parameters</p></li>
<li><p>update the model parameters based on the derivatives and learning rates</p></li>
<li><p>repeat until convergence.</p></li>
</ol>
<figure style="text-align: center;">
  <img src="../Images/c3a5bc8956f8ceda05ddf9b582cd141d.png" style="display: block; margin: 0 auto; width: 90%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/training_cycle.png"/>
  <figcaption style="text-align: center;"> The iterative steps for training an artificial neural network. 
</figcaption>
</figure>
<p>Here‚Äôs some details on each step,</p>
<ol class="arabic simple" start="0">
<li><p><strong>Initializing the Model Parameters</strong> - initialize all model parameters with typically small (near zero) random values. Here‚Äôs a couple common methods,</p></li>
</ol>
<ul class="simple">
<li><p><strong>Xavier Weight Initialization</strong> - random realizations from uniform distributions specified by <span class="math notranslate nohighlight">\(U[\text{min}, \text{max}]\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{i,j} = F_U^{-1} \left[ \frac{-1}{\sqrt{p}}, \frac{1}{\sqrt{p}} \right] (p^\ell)
\]</div>
<p>¬†¬†¬†¬† where <span class="math notranslate nohighlight">\(F^{-1}_U\)</span> is the inverse of the CDF, <span class="math notranslate nohighlight">\(p\)</span> is the number of inputs, and <span class="math notranslate nohighlight">\(p^{\ell}\)</span> is a random cumulative probability value drawn from the uniform distribution, <span class="math notranslate nohighlight">\(U[0,1]\)</span>.</p>
<ul class="simple">
<li><p><strong>Normalized Xavier Weight Initialization</strong> - random realizations from uniform distributions specified by <span class="math notranslate nohighlight">\(U[\text{min}, \text{max}]\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{i,j} = F_U^{-1} \left[ \frac{-1}{\sqrt{p}+k}, \frac{1}{\sqrt{p}+k} \right] (p^\ell)
\]</div>
<p>¬†¬†¬†¬† where <span class="math notranslate nohighlight">\(F^{-1}_U\)</span> is the inverse of the CDF, <span class="math notranslate nohighlight">\(p\)</span> is the number of inputs, <span class="math notranslate nohighlight">\(k\)</span> is the number of outputs, and <span class="math notranslate nohighlight">\(p^{\ell}\)</span> is a random cumulative probability value drawn from the uniform distribution, <span class="math notranslate nohighlight">\(U[0,1]\)</span>.</p>
<p>¬†¬†¬†¬† For example, if we return to our first hidden layer node,</p>
<figure style="text-align: center;">
  <img src="../Images/b2f8e46ea497049f4b95c03b8812eea7.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_hidden.png"/>
  <figcaption style="text-align: center;"> First hidden layer node with 3 inputs, and 1 output.
</figcaption>
</figure>
<p>¬†¬†¬†¬† we have <span class="math notranslate nohighlight">\(p = 3\)</span> and <span class="math notranslate nohighlight">\(k = 1\)</span>, and we draw from the uniform distribution,</p>
<div class="math notranslate nohighlight">
\[
U \left[ \frac{-1}{\sqrt{p}+k}, \frac{1}{\sqrt{p}+k} \right] = U \left[ \frac{-1}{\sqrt{3}+1}, \frac{1}{\sqrt{3}+1} \right]
\]</div>
<ol class="arabic simple">
<li><p><strong>Forward Pass</strong> - to make a prediction, <span class="math notranslate nohighlight">\(\hat{y}\)</span>. Initial predictions will be random for the first iteration, but will improve over iterations. Once again for our model the forward pass is,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
O_6 = \lambda_{4,6} \cdot \sigma \left( \lambda_{1,4} I_1 + \lambda_{2,4} I_2 + \lambda_{3,4} I_3 + b_4 \right) 
  + \lambda_{5,6} \cdot \sigma \left( \lambda_{1,5} I_1 + \lambda_{2,5} I_2 + \lambda_{3,5} I_3 + b_5 \right)
  + b_6
\]</div>
<figure style="text-align: center;">
  <img src="../Images/08556ecbd47d143019d0163dc95761cf.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/first_prediction.png"/>
  <figcaption style="text-align: center;"> Prediction with our artificial neural network initialized with random model parameters, weights and biases.
</figcaption>
</figure>
<ol class="arabic simple" start="2">
<li><p><strong>Calculate the Error Derivative</strong> - given a loss of,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
L = \frac{1}{2} \left(\hat{y} - y \right)^2
\]</div>
<p>¬†¬†¬†¬† and the error derivative, i.e., rate of change of in error given a change in model estimate is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \hat{y}} = \hat{Y} - Y
\]</div>
<p>¬†¬†¬†¬† For now, let‚Äôs only consider a single estimate, and we will address more than 1 training data later.</p>
<ol class="arabic simple" start="3">
<li><p><strong>Backpropagate the Error Derivative</strong> - we shift back through the artificial neural network to calculate the derivatives of the error over all the model weights and biases parameters, with the chain rule, for example the loss derivative backpropagated to the output of node <span class="math notranslate nohighlight">\(H_4\)</span>,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial H_4} 
= \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial L}{\partial O_6} 
= \lambda_{4,6} \cdot \bigl( (1 - O_6) \cdot O_6 \bigr) \cdot (O_6 - y)
\]</div>
<ol class="arabic simple" start="4">
<li><p><strong>Update the Model Parameters</strong> - based on the derivatives, <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial \lambda_{i,j}}\)</span> and learning rates, <span class="math notranslate nohighlight">\(\eta\)</span>, like this,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\lambda_{i,j}^{\ell} = \lambda_{i,j}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{i,j}}
\]</div>
<ol class="arabic simple" start="5">
<li><p><strong>Repeat Until Convergence</strong> - return to step 1, until the error, <span class="math notranslate nohighlight">\(L\)</span>, is reduced to an acceptable level, i.e., model convergence is the condition to stop the iterations</p></li>
</ol>
<p>These are the steps, now let‚Äôs dive into the details for each, but first let‚Äôs start with the mathematical framework for backpropagation - the chain rule.</p>
</section>
<section id="the-chain-rule">
<h2>The Chain Rule</h2>
<p>Upon reflection, it is clear that the forward pass through our artificial neural network involves a sequence of nested operations that progressively transform the input signals as they propagate from the input nodes, through each layer, to the output nodes.</p>
<p>So we can represent this as a sequence of nested operations,</p>
<div class="math notranslate nohighlight">
\[
f = f(x) \quad g = g(f) \quad y = h(g)
\]</div>
<p>and now in this form to emphasize the nesting of operations,</p>
<div class="math notranslate nohighlight">
\[
y = h \bigl( g(f(x)) \bigr)
\]</div>
<p>By applying the chain rule to the nested functions <span class="math notranslate nohighlight">\(y = h \bigl( g(f(x)) \bigr)\)</span>, we can solve for <span class="math notranslate nohighlight">\(\frac{\partial y}{\partial x}\)</span> as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial y}{\partial x} = \frac{\partial h}{\partial g} \cdot \frac{\partial g}{\partial f} \cdot \frac{\partial f}{\partial x}
\]</div>
<p>where we chain together the partial derivatives for all the operators to solve derivative of the output, <span class="math notranslate nohighlight">\(y\)</span>, given the input, <span class="math notranslate nohighlight">\(x\)</span>.</p>
<ul class="simple">
<li><p>we can compute derivatives at any intermediate point in the nested functions, for example, stepping backwards one step,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\frac{\partial f}{\partial x}
\]</div>
<p>and now two steps,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial g}{\partial x} = \frac{\partial g}{\partial f} \cdot \frac{\partial f}{\partial x}
\]</div>
<p>and all the way with three steps,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial y}{\partial x} = \frac{\partial h}{\partial g} \cdot \frac{\partial g}{\partial f} \cdot \frac{\partial f}{\partial x}
\]</div>
<p>This is what we do with backpropagation, but this may be too abstract! Let‚Äôs move to a very simple feed forward neural network with only these three nodes,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(I_1\)</span> - input node</p></li>
<li><p><span class="math notranslate nohighlight">\(H_2 = h(I_1)\)</span> - hidden layer node, a function of <span class="math notranslate nohighlight">\(I_1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(O_3 = o(H_2)\)</span> - output node, a function of <span class="math notranslate nohighlight">\(H_2\)</span></p></li>
<li><p>this is still intentionally abstract, i.e., without mention of weights and biases, to help you develop a mental framework of backpropagation with neural netowrks by the chain rule, we will dive into the details immediately after this discussion.</p></li>
</ul>
<p>The output <span class="math notranslate nohighlight">\(O_3\)</span> depends on the input <span class="math notranslate nohighlight">\(I_1\)</span> through these nested functions:</p>
<div class="math notranslate nohighlight">
\[
O_3 = o \bigl( h(I_1) \bigr)
\]</div>
<p>Using the <strong>chain rule</strong>, the gradient of the output with respect to backpropagating one step,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_3}{\partial H_2}
\]</div>
<p>and with respect to backpropagating two steps,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_3}{\partial I_1} = \frac{\partial H_2}{\partial I_1} \cdot \frac{\partial O_3}{\partial H_2}
\]</div>
<p>This shows how the gradient <strong>backpropagates</strong> through the network,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{\partial O_3}{\partial I_1}\)</span> - is the local gradient at the hidden node</p></li>
<li><p><span class="math notranslate nohighlight">\(\frac{\partial O_3}{\partial H_2}\)</span> - is the local gradient at the output node</p></li>
</ul>
<p>By backpropagation we can calculate the deriviates with respect to all parts of the network, how the input node signal <span class="math notranslate nohighlight">\(I_1\)</span>, or hidden nodel signal <span class="math notranslate nohighlight">\(H_2\)</span> affect the output <span class="math notranslate nohighlight">\(O_3\)</span>, <span class="math notranslate nohighlight">\(\frac{\partial O_3}{\partial I_1}\)</span> and <span class="math notranslate nohighlight">\(frac{\partial O_3}{\partial H_2}\)</span> respsectively.</p>
<ul class="simple">
<li><p>and more importantly, how changes in the input <span class="math notranslate nohighlight">\(I_1\)</span>, or <span class="math notranslate nohighlight">\(H_2\)</span> affect the change in model loss, <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial I_1}\)</span> and <span class="math notranslate nohighlight">\(frac{\partial L}{\partial H_2}\)</span> respsectively.</p></li>
</ul>
<p>This chain of partial derivatives, move backwards step by step through the neural network layers, is the fundamental mechanism behind <strong>backpropagation</strong>. Next we will derive and demonstrate each of the parts of backpropagation and then finally put this together to show backpropagation over our entire network.</p>
</section>
<section id="neural-networks-backpropagation-building-blocks">
<h2>Neural Networks Backpropagation Building Blocks</h2>
<p>Let‚Äôs cover the numerical building blocks for backpropagation. Once you understand these backpropagation building blocks, you will be able to backpropagate our simple network and even any complicated artificial neural networks by hand,</p>
<ol class="arabic simple">
<li><p>calculating the loss derivative</p></li>
<li><p>backpropagation through nodes</p></li>
<li><p>backpropagation along connections</p></li>
<li><p>accounting for multiple paths</p></li>
<li><p>loss derivatives with respect to weights and biases</p></li>
</ol>
<p>For now I demonstrate backpropagation of this loss derivative for a single training data sample, <span class="math notranslate nohighlight">\(y\)</span>.</p>
<ul class="simple">
<li><p>I address multiple samples later, <span class="math notranslate nohighlight">\(y_i, i=1, \ldots, n\)</span></p></li>
</ul>
<p>Let‚Äôs start with calculating the loss derivative.</p>
<section id="calculating-the-loss-derivative">
<h3>Calculating the Loss Derivative</h3>
<p>Backpropagation is based on the concept of allocating or propagating the loss derivative backwards through the neural network,</p>
<ul class="simple">
<li><p>we calculate the loss derivative and then distribute it sequentially, in reverse direction, from network output back towards the network input</p></li>
<li><p>it is important to know that we are working with derivatives, and that backpropagation is NOT distributing error, although as you will see it may look that way!</p></li>
</ul>
<p>We start by defining the loss, given the truth, <span class="math notranslate nohighlight">\(ùë¶\)</span>, and our prediction, <span class="math notranslate nohighlight">\(\hat{y} = O_6\)</span>, we calculate our <span class="math notranslate nohighlight">\(L^2\)</span> loss as,</p>
<div class="math notranslate nohighlight">
\[
L = \frac{1}{2} \left( \hat{y} - y \right)^2
\]</div>
<p>our choice of loss function allows us to use the prediction error as the loss derivative! We calculate the loss derivative as the partial derivative of the loss with respect to the estimate, <span class="math notranslate nohighlight">\(\frac{\partial ùêø}{\partial \hat{y}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \hat{y}} = \frac{\partial \frac{1}{2} \left( \hat{y} - y \right)^2 }{\partial \hat{y}} = \hat{y} - y
\]</div>
<p>You see what I mean, we are backpropagating the loss derivative, but due to our formulation of the <span class="math notranslate nohighlight">\(L^2\)</span> loss, we only have to calculate the error at our output node output, but once again - it is the loss derivative.</p>
<figure style="text-align: center;">
  <img src="../Images/6abf780fa4544caa6735a8f4ad075bd2.png" style="display: block; margin: 0 auto; width: 40%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_loss.png"/>
  <figcaption style="text-align: center;"> Calculation of the loss derivative at the output of an output layer node, $O_6$.
</figcaption>
</figure>
<p>For the example of our simple artificial neural network with the output at node, <span class="math notranslate nohighlight">\(O_6\)</span>, our loss derivative is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial O_6} = \frac{\partial \mathcal{L}}{\hat{y}} = \hat{y} - y = O_6 - y
\]</div>
<p>So this is our loss derivative backpropagated to the output our output node, and we are now we are ready to backpropagate this loss derivative through our artificial neural network, let‚Äôs talk about how we step through nodes and along connections.</p>
</section>
<section id="backpropagation-through-output-node-with-identity-activation">
<h3>Backpropagation through Output Node with Identity Activation</h3>
<p>Let‚Äôs backpropagate through our output node, <span class="math notranslate nohighlight">\(O_6\)</span>, from post-activation to pre-activation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>since this is an output node with a regression artificial neural network I have selected the identity or linear activation function.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/1141c4e67c550f275e9079501fe522b2.png" style="display: block; margin: 0 auto; width: 45%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $O_6$, from $O_6$ post-activation output to $O_{6_{in}}$ pre-activation input.
</figcaption>
</figure>
<p>The identity activation at output node <span class="math notranslate nohighlight">\(O_6\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma(O_{6_{in}}) = O_6
\]</div>
<p>The derivative of the identity activation at node <span class="math notranslate nohighlight">\(O_6\)</span> with respect to its input <span class="math notranslate nohighlight">\(O_{6_{in}}\)</span>, i.e., crossing node <span class="math notranslate nohighlight">\(O_6\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_6}{\partial O_{6_{in}}} = \frac{\partial \left(O_{6_{in}} \right)}{\partial O_{6_{in}}} = 1.0
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(O_6\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative with respect to the node output, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_6}\)</span>, and to the loss derivative with respect to the node input, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} 
= \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= 1.0 \cdot (O_6 - y)
\]</div>
<p>Now that we have backpropagated through an output node, let‚Äôs backpropagation along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from the hidden layer.</p>
</section>
<section id="backpropagation-along-connections">
<h3>Backpropagation along Connections</h3>
<p>Now let‚Äôs backpropagate along the connection between nodes <span class="math notranslate nohighlight">\(O_6\)</span> and <span class="math notranslate nohighlight">\(H_4\)</span>.</p>
<figure style="text-align: center;">
  <img src="../Images/1c686c4b3a6fe96317a79c7333542353.png" style="display: block; margin: 0 auto; width: 50%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_weight.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through node \(O_6\), from \(O_6\) post-activation output to $O_{6_{in}}$ pre-activation input and then along the connection to the output from node \(H_4\).
</figcaption>
</figure>
<p>Preactivation, the input to node <span class="math notranslate nohighlight">\(ùëÇ_6\)</span> is calculated as,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative along the connection as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial H_4} 
= \frac{\partial}{\partial H_4} \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right) 
= \lambda_{4,6}
\]</div>
<p>by resolving the above partial derivative, we see that backpropagation along a connection by applying the connection weight.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial H_4} = \lambda_{4,6}
\]</div>
<p>Note, we just need the current connection weight <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span>. Now we can add this to our chain rule to backpropagate along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from loss derivative with respect to the output layer node input <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>, to the loss derivative with respect to the hidden layer node output <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial H_4}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial H_4} 
= \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \lambda_{4,6} \bigl( \cdot (1 - O_6) \cdot O_6 \bigr) \cdot (O_6 - y)
\]</div>
</section>
<section id="backpropagation-through-nodes-with-sigmoid-activation">
<h3>Backpropagation through Nodes with Sigmoid Activation</h3>
<p>Let‚Äôs backpropagate through a hidden layer node, <span class="math notranslate nohighlight">\(H_4\)</span>, from postactivation to preactivation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>we are assuming sigmoid activation for all hidden layer nodes</p></li>
<li><p>for super clean logic, everyone resolves the activation derivative as a function of the output rather than as typical the input,</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/10ef488402716c36aa45b497ea54f6bb.png" style="display: block; margin: 0 auto; width: 55%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_hidden.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $H_4$, from $H_4$ postactivation output to $H_{4_{in}}$ preactivation input.
</figcaption>
</figure>
<p>The sigmoid activation at output node <span class="math notranslate nohighlight">\(H_4\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
H_4 = \sigma(H_{4_{in}}) = \frac{1}{1 + e^{-H_{4_{in}}}}
\]</div>
<p>The derivative of the sigmoid activation at node <span class="math notranslate nohighlight">\(H_4\)</span> with respect to its input <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, i.e., crossing node <span class="math notranslate nohighlight">\(H_4\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + e^{-H_{4_{in}}}} \right)
\]</div>
<p>Now, for compact notation let‚Äôs set,</p>
<div class="math notranslate nohighlight">
\[
u = e^{-H_{4_{in}}}
\]</div>
<p>and substituting we have,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + u} \right)
\]</div>
<p>and by the chain rule we can extend it to,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}}
= \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + u} \right)
= -\frac{u}{(1 + u)^2} \cdot \frac{\partial u}{\partial H_{4_{in}}}
\]</div>
<p>The derivative of <span class="math notranslate nohighlight">\(u = e^{-H_{4_{in}}}\)</span> with respect to <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial u}{\partial H_{4_{in}}} = -e^{-H_{4_{in}}} = -u
\]</div>
<p>now we can substitute,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = -\frac{1}{(1+u)^2} \cdot (-u) = \frac{u}{(1+u)^2}
\]</div>
<p>Express in terms of node <span class="math notranslate nohighlight">\(H_4\)</span> output, <span class="math notranslate nohighlight">\(H_4 = \frac{1}{1 + u}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{\text{in}}}} 
= \frac{\left(1 - H_4\right)/H_4}{\left(1/H_4\right)^2} 
= \frac{1 - H_4}{H_4} \cdot H_4^2 
= \left(1 - H_4\right) \cdot H_4
\]</div>
<p>So we can backpropagate through our node, <span class="math notranslate nohighlight">\(H_4\)</span>, from node post-activation output, <span class="math notranslate nohighlight">\(H_4\)</span> to node pre-activation input, <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, by,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{\text{in}}}} = \left(1 - H_4\right) \cdot H_4
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(H_4\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative to the output of node <span class="math notranslate nohighlight">\(H_4\)</span> and to the input of node <span class="math notranslate nohighlight">\(H_4\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} 
= \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>Now we can handle all cases of backpropagation through the nodes in our network.</p>
</section>
<section id="backpropagation-along-another-connection">
<h3>Backpropagation Along Another Connection</h3>
<p>For continuity and completeness, let‚Äôs repeat the previously described method to backpropagate along the connection <span class="math notranslate nohighlight">\(I_1\)</span> to <span class="math notranslate nohighlight">\(H_4\)</span>.</p>
<figure style="text-align: center;">
  <img src="../Images/76f408b8ed852b03a168e6069bb716db.png" style="display: block; margin: 0 auto; width: 75%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_weight_input.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative along the connection from $H_4$ to $I_1$.
</figcaption>
</figure>
<p>Once again, preactivation the input to node <span class="math notranslate nohighlight">\(H_4\)</span> is calculated as,</p>
<div class="math notranslate nohighlight">
\[
H_{4_{\text{in}}} = \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4
\]</div>
<p>We calculate the derivative along the connection as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_{4_{\text{in}}}}{\partial I_1} 
= \frac{\partial \left(\lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4 \right)}{\partial I_1} = \lambda_{1,4}
\]</div>
<p>by resolving the above partial derivative, we see that backpropagation along a connection by applying the connection weight.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_{4_{\text{in}}}}{\partial I_1} = \lambda_{4,6}
\]</div>
<p>Note, we just need the current connection weight <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span>. Now we can add this to our chain rule to backpropagate along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from loss derivative with respect to the output layer node input <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>, to the loss derivative with respect to the hidden layer node output <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial H_4}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
</section>
<section id="accounting-for-multiple-paths">
<h3>Accounting for Multiple Paths</h3>
<p>Our loss derivative with respect to the node output <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_1}\)</span> is not correct!</p>
<ul class="simple">
<li><p>we accounted for the <span class="math notranslate nohighlight">\(O_6\)</span> to <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(I_1\)</span> path, but we did not acccount for the <span class="math notranslate nohighlight">\(O_6\)</span> to <span class="math notranslate nohighlight">\(H_5\)</span> to <span class="math notranslate nohighlight">\(I_1\)</span> path</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/6a68404e4b3d2589dcfe15beb5175c60.png" style="display: block; margin: 0 auto; width: 85%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/multiple_paths.png"/>
  <figcaption style="text-align: center;"> Multiple paths for backpropagation to input node, $I_1$, from output node $O_6$.
</figcaption>
</figure>
<p>To account for multiple paths we just need to sum over all the paths.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>we can evaluate this as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} = \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y) + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>and then simplify by removing the 1.0 values and grouping terms as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} = \left[ \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
</section>
<section id="backpropagation-through-input-nodes-with-identity-activation">
<h3>Backpropagation through Input Nodes with Identity Activation</h3>
<p>Let‚Äôs backpropagate through our input node, <span class="math notranslate nohighlight">\(I_1\)</span>, from postactivation to preactivation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>since this is an input node I have selected the identity or linear activation function.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/bd05208edfb4ac5d5cc0f8cfe808ae50.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $I_1$, from $I_1$ postactivation output to $I_{1_{in}}$ preactivation input.
</figcaption>
</figure>
<p>The identity activation at output node <span class="math notranslate nohighlight">\(I_1\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
I_1 = \sigma(I_{1_{in}}) = I_1
\]</div>
<p>The derivative of the identity activation at node <span class="math notranslate nohighlight">\(I_1\)</span> with respect to its input <span class="math notranslate nohighlight">\(I_{1_{in}}\)</span>, i.e., passing through node <span class="math notranslate nohighlight">\(I_1\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial I_1}{\partial I_{1_{in}}} = \frac{\partial \left(I_{1_{in}} \right)}{\partial I_{1_{in}}} = 1.0
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(I_1\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative with respect to the node output, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_1}\)</span>, and to the loss derivative with respect to the node input, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{1_{\text{in}}}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} 
= \frac{\partial I_1}{\partial I_{1_{in}}} \cdot \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} + 
\frac{\partial I_1}{\partial I_{1_{in}}} \cdot \frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>we can evaluate this as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} = 1.0 \cdot \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y) + 1.0 \cdot \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>For fun I designed this notation for maximum clarity,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial I_{1_{\text{in}}}} = 
\overbrace{1.0}^{\textstyle \frac{\partial I_{1}}{\partial I_{1_{in}}}} \left[
\overbrace{\lambda_{1,4}}^{\textstyle \frac{\partial H_{4_{\text{in}}}}{\partial I_1}} \cdot
\overbrace{(1 - H_4) \cdot H_4}^{\textstyle \frac{\partial H_4}{\partial H_{4_{\text{in}}}}} \cdot
\overbrace{\lambda_{4,6}}^{\textstyle \frac{\partial O_{6_{\text{in}}}}{\partial H_4}} \cdot
\overbrace{1.0}^{\textstyle \frac{\partial O_{6}}{\partial O_{6_{in}}}} \cdot
\overbrace{(O_6 - Y_1^N)}^{\textstyle \frac{\partial L}{\partial O_{6}}} + 
\overbrace{\lambda_{1,5}}^{\textstyle \frac{\partial H_{5_{\text{in}}}}{\partial I_1}} \cdot
\overbrace{(1 - H_5) \cdot H_5}^{\textstyle \frac{\partial H_5}{\partial H_{5_{\text{in}}}}} \cdot
\overbrace{\lambda_{5,6}}^{\textstyle \frac{\partial O_{6_{\text{in}}}}{\partial H_5}} \cdot
\overbrace{1.0}^{\textstyle \frac{\partial O_{6}}{\partial O_{6_{in}}}} \cdot
\overbrace{(O_6 - Y_1^N)}^{\textstyle \frac{\partial L}{\partial O_{6}}} \right]
\]</div>
<p>But this can be simplified by removing the 1.0 values and grouping terms as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} = \left[ \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
<p>For completeness here is the backpropagation for the other input nodes, here‚Äôs <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{2_{in}}}\)</span>,</p>
<figure style="text-align: center;">
  <img src="../Images/9b186fef88b4e0ad1fa6191394b0e0dd.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input_I2.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative for input node 2.
</figcaption>
</figure>
<p>For brevity I have remove the 1.0s and grouped like terms,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{2_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_2} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_2} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{2_{in}}} = \left[ \lambda_{2,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{2,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
<p>and here is <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{3_{in}}}\)</span>,</p>
<figure style="text-align: center;">
  <img src="../Images/90c6a46319d78ae1b9d4f8cdc131fd2a.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input_I3.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative for input node 3.
</figcaption>
</figure>
<p>For brevity I have remove the 1.0s and grouped like terms,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{3_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_3} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_3} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{3_{in}}} = \left[ \lambda_{3,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{3,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
</section>
<section id="loss-derivatives-with-respect-to-weights-and-biases">
<h3>Loss Derivatives with Respect to Weights and Biases</h3>
<p>Now we have back propagated the loss derivative through our network.</p>
<figure style="text-align: center;">
  <img src="../Images/97de6228871f7910de4d7a8fa86e0bd8.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_all_nodes.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to all network nodes inputs and outputs.
</figcaption>
</figure>
<p>and we have the loss derivative with respect to the input and output of each node in our network,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_1},\quad
\frac{\partial \mathcal{L}}{\partial I_{2_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_2},\quad
\frac{\partial \mathcal{L}}{\partial I_{3_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_3},\quad
\frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial H_4},\quad
\frac{\partial \mathcal{L}}{\partial H_5},\quad
\frac{\partial \mathcal{L}}{\partial H_5},\quad
\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>But what we actually need is the loss derivative with respect to each connection weights,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{2,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{3,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{1,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{2,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{3,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{5,6}}
\]</div>
<p>and node biases,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_4},\quad
\frac{\partial \mathcal{L}}{\partial b_5},\quad
\frac{\partial \mathcal{L}}{\partial b_6}
\]</div>
<p>How do we backpropagate the loss derivative to a connection weight? Let‚Äôs start with the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection.</p>
<figure style="text-align: center;">
  <img src="../Images/bf1e650cd4b0613fa09aa5d5c0e72e26.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_connection_weight.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to a connection weight.
</figcaption>
</figure>
<p>Preactivation, input to node <span class="math notranslate nohighlight">\(O_6\)</span> we have,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative with respect to the connection weight as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} =
\frac{\partial \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right)}{\partial \lambda_{4,6}} = H_4
\]</div>
<p>We need the output of the node in the previous layer passed along the connection to backpropagate to the loss derivative with respect to the connection weight from the input to the next node,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_4 \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>Now, for completeness, here are the equations for all of our network‚Äôs connection weights.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{1,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_1 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{2,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{2,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_2 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{3,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{3,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_3 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{1,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_1 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{2,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{2,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_2 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{3,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{3,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_3 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_4 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{5,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{5,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_5 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<p>See the pattern, the loss derivatives with respect to connection weights are,</p>
<div class="math notranslate nohighlight">
\[
\text{Connection Signal} \times \text{Loss Derivative of Next Node Input}
\]</div>
<p>Now how do we backpropagate the loss derivative to a node bias? Let‚Äôs start with the <span class="math notranslate nohighlight">\(O_6\)</span> node.</p>
<figure style="text-align: center;">
  <img src="../Images/646997a228f8c1e8a3b2743ac13e388a.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_bias.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to a node bias.
</figcaption>
</figure>
<p>Once again, the preactivation, input to node <span class="math notranslate nohighlight">\(O_6\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative of a connection weight as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial b_6} =
\frac{\partial \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right)}{\partial b_6} = 1.0
\]</div>
<p>so our bias loss derivative is equal to the node input loss derivative,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_6} =
\frac{\partial O_{6_{\text{in}}}}{\partial b_6} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
1.0 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<p>For completeness here are all the loss derivatives with respect to node biases,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_6} = \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_4} = \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_5} = \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<p>See the pattern, the loss derivatives with respect to node biases are,</p>
<div class="math notranslate nohighlight">
\[
\text{Loss Derivative of the Node Input}
\]</div>
</section>
</section>
<section id="backpropagation-example">
<h2>Backpropagation Example</h2>
<p>Let‚Äôs take the backpropagation method explained above and apply them to my interactive neural network.</p>
<ul class="simple">
<li><p>Here‚Äôs the result for our first training epoch with only 1 sample,</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/b8b7d56b334d9728490cb2bc1408535e.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/backpropagate_node.png"/>
  <figcaption style="text-align: center;"> Backpropagation result for the first iteration.
</figcaption>
</figure>
<p>My interactive dashboard provides all the loss derivatives with respect to the input for each node and the output signals from each node, so for example we can calculate <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial \lambda_{4,6}}\)</span> as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{4,6}} = \frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = H_4 \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = 0.42 \cdot 1.00 = 0.42
\]</div>
<p>Here‚Äôs the loss derivatives with respect to connection weights for the other hidden layer to output node connection,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{5,6}} = \frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{5,6}} \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = H_5 \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = 0.60 \cdot 1.00 = 0.60
\]</div>
<p>and now let‚Äôs get all the input to hidden layer connections,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{1,4}} = \frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{1,4}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_1 \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 0.50 \cdot (-0.13) = -0.07
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{1,5}} = \frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{1,5}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_1 \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 0.50 \cdot (-0.10) = -0.05
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{2,4}} = \frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{2,4}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_2 \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 0.20 \cdot (-0.13) = -0.03
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{2,5}} = \frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{2,5}} \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = I_2 \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 0.20 \cdot (-0.10) = -0.02
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{3,4}} = \frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{3,4}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_3 \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 0.70 \cdot (-0.13) = -0.09
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{3,5}} = \frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{3,5}} \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = I_3 \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 0.70 \cdot (-0.10) = -0.07
\]</div>
<p>This takes care of all of the connection weight error derivatives, now lets take care of the node bias error derivatives.</p>
<ul class="simple">
<li><p>the node bias error derivatives are the same as the node peractivation error derivatives. Now let‚Äôs calculate the bias terms in the hidden layer,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial b_4} =  \frac{\partial H_{4_{\text{in}}}}{\partial b_4}  \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 1.0 \cdot (-0.13) = -0.13
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial b_5} =  \frac{\partial H_{5_{\text{in}}}}{\partial b_5}  \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 1.0 \cdot (-0.1) = -0.10
\]</div>
</section>
<section id="updating-model-parameters">
<h2>Updating Model Parameters</h2>
<p>The loss derivatives with respect to each of the model parameters are the gradients, so we are ready to use gradient descent optimization with the addition of,</p>
<ul class="simple">
<li><p><strong>learning rate</strong> -  to scale the rate of change of the model updates we assign a learning rate, <span class="math notranslate nohighlight">\(\eta\)</span>. For our model parameter examples from above,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
<div class="math notranslate nohighlight">
\[
\lambda_{1,4}^{\ell} = \lambda_{1,4}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{1,4}}
\]</div>
<div class="math notranslate nohighlight">
\[
b_j^{\ell} = b_j^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial b_j}
\]</div>
<ul class="simple">
<li><p>recall, this process of gradient calculation and model parameters, weights and biases, updating is iterated and is known as gradient descent optimization.</p></li>
<li><p>the goal is to explore the loss hypersurface, avoiding and escaping local minimums and ultimately finding the global minimum.</p></li>
<li><p>learning rate, also known as step size is commonly set between 0.0 and 1.0, note 0.01 is the default in Keras module of TensorFlow</p></li>
<li><p><strong>Low Learning Rate</strong> ‚Äì more stable, but a slower solution, may get stuck in a local minimum</p></li>
<li><p><strong>High Learning Rate</strong> ‚Äì may be unstable, but perhaps a faster solution, may diverge out of the global minimum</p></li>
</ul>
<p>One strategy is to start with a high learning rate and then to decrease the learning rate over the iterations</p>
<ul class="simple">
<li><p><strong>Learning Rate Decay</strong> - set as &gt; 0 to avoid mitigate oscillations,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\eta^{\ell} = \eta^{\ell - 1} \cdot \left( \frac{1}{1 + \text{decay} \cdot \ell} \right)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\ell\)</span> is the model training epoch</p>
<p>Notice that the model parameter updates are for a single training data case? Consider this single model parameter,</p>
<p>we calculate the update over all samples in the batch and apply the average of the updates.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{4,6}} = H_4 \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = 0.42 \cdot 1.00 = 0.42
\]</div>
<p>is applied to update the <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span> parameter as,</p>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
<p>is dependent on <span class="math notranslate nohighlight">\(H_4\)</span> node output, and <span class="math notranslate nohighlight">\(L\)</span> error that are for a single sample, <span class="math notranslate nohighlight">\(ùë•_1,\ldots,ùë•_ùëö\)</span> and <span class="math notranslate nohighlight">\(ùë¶\)</span>; therefore, we cannot calculate a single parameter update over all our <span class="math notranslate nohighlight">\(1,\ldots,n\)</span> training data samples.</p>
<ul class="simple">
<li><p>instead we can calculate <span class="math notranslate nohighlight">\(1,\ldots,n\)</span> updates and then apply the average of all the updates to our model parameters,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \frac{1}{n_{batch}} \sum_{i=1}^{n_{batch}} \eta \cdot \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
<ul class="simple">
<li><p>since the learning rate is a constant, we can move it out of the sum and now we are averaging the gradients,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \eta \frac{1}{n_{batch}} \sum_{i=1}^{n_{batch}} \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
</section>
<section id="training-epochs">
<h2>Training Epochs</h2>
<p>This is a good time to talk about stochastic gradient descent optimization, first let‚Äôs define some common terms,</p>
<ul class="simple">
<li><p><strong>Batch Gradient Descent</strong> - updates the model parameters after passing through all of the data</p></li>
<li><p><strong>Stochastic Gradient Descent</strong> - updates the model parameters over each sample data</p></li>
<li><p><strong>Mini-batch Gradient Descent</strong> - updates the model parameter after passing through a single batch</p></li>
</ul>
<p>With mini-batch gradient descent stochasticity is introduced through the use of subsets of the data, known as batches,</p>
<ul class="simple">
<li><p>for example, if we divide our 100 samples into 4 batches, then we iterate over each batch separately</p></li>
<li><p>we speed up the individual updates, fewer data are faster to calculate, but we introduce more error</p></li>
<li><p>this often helps the training explore for the global minimum and avoid getting stuck in local minimums and along ridges in the loss hypersurface</p></li>
</ul>
<p>Finally our last definition here,</p>
<ul class="simple">
<li><p><strong>epoch</strong> - is one pass over all of the data, so that would be 4 iterations of updating the model parameters if we have 4 mini-batches</p></li>
</ul>
<p>There are many other considerations that I will add later including,</p>
<ul class="simple">
<li><p>momentum</p></li>
<li><p>adaptive optimization</p></li>
</ul>
<p>Now let‚Äôs build the above artificial neural network by-hand and visualize the solution!</p>
<ul class="simple">
<li><p>this is by-hand so that you can see every calculation. I intentionally avoided using TensorFlow or PyTorch.</p></li>
</ul>
</section>
<section id="interactive-dashboard">
<h2>Interactive Dashboard</h2>
<p>I built out an interactive Python dashboard with the code below for training an artificial neural network. You can step through the training iteration and observe over the training epochs,</p>
<ul class="simple">
<li><p>model parameters</p></li>
<li><p>forward pass predictions</p></li>
<li><p>backpropagation of error derivatives</p></li>
</ul>
<p>If you would like to see artificial neural networks in action, check out my <a class="reference external" href="https://github.com/GeostatsGuy/DataScienceInteractivePython/blob/main/Interactive_ANN.ipynb">ANN interactive Python dashboard</a>,</p>
<figure style="text-align: center;">
  <img src="../Images/ab7e3b58fcfdbf8f7a2c19b5d78c7736.png" style="display: block; margin: 0 auto; width: 90%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/interactive_ann.png"/>
  <figcaption style="text-align: center;"> Interactive artificial neural network training Python dashboard.
</figcaption>
</figure> 
</section>
<section id="import-required-packages">
<h2>Import Required Packages</h2>
<p>We will also need some standard packages. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span><span class="p">,</span> <span class="n">AutoLocator</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                            <span class="c1"># set axes and grids in the background for all plots</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">13</span>
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‚Äòpython -m pip install [package-name]‚Äô. More assistance is available with the respective package docs.</p>
</section>
<section id="declare-functions">
<h2>Declare Functions</h2>
<p>Here‚Äôs the functions to make, train and visualize our artificial neural network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks   </span>

<span class="k">def</span> <span class="nf">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>     <span class="c1"># Calculate the differences</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>    <span class="c1"># Calculate the angle in radians</span>
    <span class="c1">#angle_degrees = math.degrees(angle_radians)    # Convert the angle to degrees</span>
    <span class="k">return</span> <span class="n">angle_rads</span>
    
<span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="n">pto</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">pto</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">pto</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offsetx</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xo</span><span class="p">,</span> <span class="n">x_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offset_arrx</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">,</span><span class="n">size</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">x_arr</span> <span class="o">=</span> <span class="n">x_new</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_new</span><span class="p">,</span> <span class="n">x_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offsety</span><span class="p">(</span><span class="n">yo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">yo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">yo</span><span class="p">,</span> <span class="n">y_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offset_arry</span><span class="p">(</span><span class="n">yo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">,</span><span class="n">size</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">yo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">y_arr</span> <span class="o">=</span> <span class="n">y_new</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">y_new</span><span class="p">,</span> <span class="n">y_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lintx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">linty</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">lint_intx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xs</span><span class="p">,</span><span class="n">xe</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_inty</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">ys</span><span class="p">,</span><span class="n">ye</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_int_arrx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">line_angle_rads</span> <span class="o">=</span> <span class="n">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">x_arr</span> <span class="o">=</span> <span class="n">xe</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">line_angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xe</span><span class="p">,</span><span class="n">x_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_int_arry</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="n">line_angle_rads</span> <span class="o">=</span> <span class="n">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">y_arr</span> <span class="o">=</span> <span class="n">ye</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">line_angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">ye</span><span class="p">,</span><span class="n">y_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">as_si</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndp</span><span class="p">):</span> <span class="c1"># from xnx on StackOverflow https://stackoverflow.com/questions/31453422/displaying-numbers-with-x-instead-of-e-scientific-notation-in-matplotlib </span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">'{x:0.</span><span class="si">{ndp:d}</span><span class="s1">e}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ndp</span><span class="o">=</span><span class="n">ndp</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'e'</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">'</span><span class="si">{m:s}</span><span class="s1">\times 10^{{</span><span class="si">{e:d}</span><span class="s1">}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-simple-ann">
<h2>The Simple ANN</h2>
<p>I wrote this code to specify a simple ANN:</p>
<ul class="simple">
<li><p>three input nodes, 2 hidden nodes and 1 output node</p></li>
</ul>
<p>and to train the ANN by iteratively performing the forward calculation and backpropagation. I calculate:</p>
<ul class="simple">
<li><p>the error and then propagate it to each node</p></li>
<li><p>solve for the partial derivatives of the error with respect to each weight and bias</p></li>
</ul>
<p>all weights, biases and partial derivatives for all epoch are recorded in vectors for plotting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">x1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="n">x2</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="n">x3</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># training data</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># learning rate</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">nepoch</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">y4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">w14</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w24</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w34</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">w15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w35</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">w46</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w56</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">dw14</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw24</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw34</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dw15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw35</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dw46</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw56</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">db4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">db5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">db6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">b4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">b5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">b6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">y4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">d4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="c1"># initialize the weights - Xavier Weight Initialization </span>
<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">))</span> <span class="c1"># lower and upper bound for the weights, uses inputs to node</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(3.0 + 2.0)), (sqrt(6.0) / sqrt(3.0 + 2.0)) # Normalized Xavier weights, integrates ouputs also</span>
<span class="n">w14</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w24</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w34</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>
<span class="n">w15</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w25</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w35</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>

<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(2.0 + 1.0)), (sqrt(6.0) / sqrt(2.0 + 1.0)) # Normalized Xavier weights, integrates ouputs also</span>

<span class="n">w46</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w56</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>     

<span class="c1">#b4[0] = np.random.random(); b5[0] = np.random.random(); b6[0] = np.random.random()</span>
<span class="n">b4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="n">b5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="n">b6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="c1"># small random value    </span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nepoch</span><span class="p">):</span>

<span class="c1"># forward pass of model</span>
    <span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w14</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w24</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">b4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
    <span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    
    <span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w15</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">b5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    
    <span class="n">y6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="c1">#    y6[i] = 1.0/(1 + math.exp(-1*y6[i])) # sgimoid / logistic activation at o6 </span>

<span class="c1"># back propagate the error through the nodes</span>
<span class="c1">#    d6[i] = y6[i]*(1-y6[i])*(y-y6[i]) # sgimoid / logistic activation at o6 </span>
    <span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y6</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># identity activation o at o6</span>
    <span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># calculate the change in weights</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nepoch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dw14</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span><span class="p">;</span> <span class="n">dw24</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span><span class="p">;</span> <span class="n">dw34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span>
        <span class="n">dw15</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span><span class="p">;</span> <span class="n">dw25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span><span class="p">;</span> <span class="n">dw35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span>
        <span class="n">dw46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        
        <span class="n">db4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">db5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">db6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="n">w14</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w14</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw14</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w24</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w24</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw24</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w34</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">w15</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w15</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw15</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w25</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw25</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w35</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw46</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">b4</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">db4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">b5</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">db5</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">b6</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">db6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
</section>
<section id="now-visualize-the-network-for-a-specific-epoch">
<h2>Now Visualize the Network for a Specific Epoch</h2>
<p>I wrote a custom network visualization below, select iepoch and visualize the artificial neural network for a specific epoch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">iepoch</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.19</span><span class="p">;</span> <span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.09</span><span class="p">;</span> <span class="n">edge</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">o6x</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span> <span class="n">o6y</span> <span class="o">=</span><span class="mi">5</span><span class="p">;</span> <span class="n">h5x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">h5y</span> <span class="o">=</span> <span class="mf">3.5</span><span class="p">;</span> <span class="n">h4x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">h4y</span> <span class="o">=</span> <span class="mf">6.5</span>
<span class="n">i1x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i1y</span> <span class="o">=</span> <span class="mf">9.0</span><span class="p">;</span> <span class="n">i2x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i2y</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i3x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i3y</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="n">buffer</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">circle_i1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">' $I_1$'</span><span class="p">,(</span><span class="n">i1x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">i1y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_i1b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1b</span><span class="p">)</span>

<span class="n">circle_i2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">' $I_2$'</span><span class="p">,(</span><span class="n">i2x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">i2y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_i2b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i2b</span><span class="p">)</span>

<span class="n">circle_i3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">' $I_3$'</span><span class="p">,(</span><span class="n">i3x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">i3y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_i3b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i3b</span><span class="p">)</span>

<span class="n">circle_h4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_4$'</span><span class="p">,(</span><span class="n">h4x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">h4y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_h4b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h4</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h4b</span><span class="p">)</span>

<span class="n">circle_h5</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_5$'</span><span class="p">,(</span><span class="n">h5x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">h5y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_h5b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h5b</span><span class="p">)</span>

<span class="n">circle_o6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$O_6$'</span><span class="p">,(</span><span class="n">o6x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">o6y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_o6b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_o6</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_o6b</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i1x</span><span class="o">-</span><span class="n">edge</span><span class="p">,</span><span class="n">i1x</span><span class="p">],[</span><span class="n">i1y</span><span class="p">,</span><span class="n">i1y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i2x</span><span class="o">-</span><span class="n">edge</span><span class="p">,</span><span class="n">i2x</span><span class="p">],[</span><span class="n">i2y</span><span class="p">,</span><span class="n">i2y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i3x</span><span class="o">-</span><span class="n">edge</span><span class="p">,</span><span class="n">i3x</span><span class="p">],[</span><span class="n">i3y</span><span class="p">,</span><span class="n">i3y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$x_1$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">i1x</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span><span class="n">i1y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$x_2$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">i2x</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span><span class="n">i2y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$x_3$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">i3x</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span><span class="n">i3y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i1x</span><span class="p">,</span><span class="n">h4x</span><span class="p">],[</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i2x</span><span class="p">,</span><span class="n">h4x</span><span class="p">],[</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i3x</span><span class="p">,</span><span class="n">h4x</span><span class="p">],[</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i1x</span><span class="p">,</span><span class="n">h5x</span><span class="p">],[</span><span class="n">i1y</span><span class="p">,</span><span class="n">h5y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i2x</span><span class="p">,</span><span class="n">h5x</span><span class="p">],[</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i3x</span><span class="p">,</span><span class="n">h5x</span><span class="p">],[</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h4x</span><span class="p">,</span><span class="n">o6x</span><span class="p">],[</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h5x</span><span class="p">,</span><span class="n">o6x</span><span class="p">],[</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">o6x</span><span class="o">+</span><span class="n">edge</span><span class="p">,</span><span class="n">o6x</span><span class="p">],[</span><span class="n">o6y</span><span class="p">,</span><span class="n">o6y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">o6x</span><span class="o">+</span><span class="n">buffer</span><span class="o">+</span><span class="mf">0.7</span><span class="p">,</span><span class="n">o6y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">h4y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">h4y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_</span><span class="si">{4}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y4</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">)</span><span class="o">-</span><span class="mf">0.0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">h5y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">h5y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_</span><span class="si">{5}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y5</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.07</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.07</span><span class="p">)</span><span class="o">+</span><span class="mf">0.25</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial O_{6_</span><span class="si">{in}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">o6x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">o6y</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{4_</span><span class="si">{in}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d4</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h4x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">h4y</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{5_</span><span class="si">{in}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d5</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h5x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">h5y</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \hat</span><span class="si">{y}</span><span class="s1">}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="o">-</span><span class="mf">1.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{4_</span><span class="si">{out}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w46</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="o">-</span><span class="mf">1.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{5_</span><span class="si">{out}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w56</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="o">-</span><span class="mf">1.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span> <span class="n">o6x</span><span class="p">,</span> <span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{4,6}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dw46</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">4</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.72</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">11</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span> <span class="n">o6x</span><span class="p">,</span> <span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{5,6}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dw56</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">4</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">i1y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">i1y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$I_</span><span class="si">{1}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">i2y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">i2y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$I_</span><span class="si">{2}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.22</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">i3y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">i3y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$I_</span><span class="si">{3}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">)</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{1,4}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w14</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i1x</span><span class="o">+</span><span class="n">h4x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.45</span><span class="p">,(</span><span class="n">i1y</span><span class="o">+</span><span class="n">h4y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">18</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{2,4}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w24</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i2x</span><span class="o">+</span><span class="n">h4x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.45</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,(</span><span class="n">i2y</span><span class="o">+</span><span class="n">h4y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.03</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{3,4}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w34</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i3x</span><span class="o">+</span><span class="n">h4x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.45</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,(</span><span class="n">i3y</span><span class="o">+</span><span class="n">h4y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">1.1</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{1,5}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w15</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i1x</span><span class="o">+</span><span class="n">h5x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.55</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,(</span><span class="n">i1y</span><span class="o">+</span><span class="n">h5y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.9</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">36</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{2,5}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w25</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i2x</span><span class="o">+</span><span class="n">h5x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.55</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,(</span><span class="n">i2y</span><span class="o">+</span><span class="n">h5y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{3,5}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w35</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i3x</span><span class="o">+</span><span class="n">h5x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.55</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,(</span><span class="n">i3y</span><span class="o">+</span><span class="n">h5y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.1</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{4,6}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w46</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">h4x</span><span class="o">+</span><span class="n">o6x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="p">,(</span><span class="n">h4y</span><span class="o">+</span><span class="n">o6y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="o">+</span><span class="mf">0.39</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{5,6}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w56</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">h5x</span><span class="o">+</span><span class="n">o6x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="p">,(</span><span class="n">h5y</span><span class="o">+</span><span class="n">o6y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="o">+</span><span class="mf">0.26</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span> <span class="n">i1y</span><span class="p">,</span> <span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{1,4}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw14</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span> <span class="n">i2y</span><span class="p">,</span> <span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{2,4}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw24</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span> <span class="n">i3y</span><span class="p">,</span> <span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{3,4}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw34</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.7</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span> <span class="n">i3y</span><span class="p">,</span> <span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{3,5}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw35</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span> <span class="n">i2y</span><span class="p">,</span> <span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{2,5}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw25</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.65</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span> <span class="n">i1y</span><span class="p">,</span> <span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{1,5}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw15</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">2.2</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.5</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">36</span><span class="p">,</span><span class="n">xycoords</span> <span class="o">=</span> <span class="s1">'data'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f1c2dc9fc05ec8a3d07b5642c59c42dd91a2b2ed35c547faa409371a1e776270.png" src="../Images/6c1b34f06ebf3ebfafbbd206fc1033ca.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/f1c2dc9fc05ec8a3d07b5642c59c42dd91a2b2ed35c547faa409371a1e776270.png"/>
</div>
</div>
</section>
<section id="check-the-ann-convergence">
<h2>Check the ANN Convergence</h2>
<p>Now we plot the weights, biases and prediction over the epochs to check the training convergence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">y6</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epochs'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Simple Artificial Neural Network Prediction'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w14</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{1,4}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w24</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{2,4}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w34</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{3,4}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w15</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{1,5}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{2,5}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w35</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{3,5}$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w46</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{4,6}$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w56</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{5,6}$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epochs'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Simple Artificial Neural Network Weights'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w14</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightgreen'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\phi_</span><span class="si">{4}</span><span class="s1">$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w24</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\phi_</span><span class="si">{5}</span><span class="s1">$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w34</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkgreen'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\phi_</span><span class="si">{6}</span><span class="s1">$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epochs'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Simple Artificial Neural Network Biases'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/96a2f9a7007123700054af340b223a0c9017cbf262afe43f97c8f1b445ec44a6.png" src="../Images/41e5da630bdb6e70068ef584a2fc3d47.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/96a2f9a7007123700054af340b223a0c9017cbf262afe43f97c8f1b445ec44a6.png"/>
</div>
</div>
</section>
<section id="comments">
<h2>Comments</h2>
<p>This was a basic treatment of artificial neural networks. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos‚Äô descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
</section>
<section id="about-the-author">
<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael‚Äôs university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael‚Äôs work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
</section>
<section id="want-to-work-together">
<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I‚Äôd be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I‚Äôm always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
</section>
&#13;

<h2>Motivation</h2>
<p>Artificial neural networks are very powerful, nature inspired computing based on an analogy of brain</p>
<ul class="simple">
<li><p>I suggest that they are like a reptilian brain, without planning and higher order reasoning</p></li>
</ul>
<p>In addition, artificial neural networks are a building block of many other deep learning methods, for example,</p>
<ul class="simple">
<li><p>convolutional neural networks</p></li>
<li><p>recurrent neural networks</p></li>
<li><p>generative adversarial networks</p></li>
<li><p>autoencoders</p></li>
</ul>
<p>Nature inspired computing is looking to nature for inspiration to develop novel problem-solving methods,</p>
<ul class="simple">
<li><p><strong>artificial neural networks</strong> are inspired by biological neural networks</p></li>
<li><p><strong>nodes</strong> -  in our model are artificial neurons, simple processors</p></li>
<li><p><strong>connections</strong> between nodes are artificial synapses</p></li>
</ul>
<p>intelligence emerges from many connected simple processors. For the remainder of this chapter, I will used the terms nodes and connections to describe our artificial neural network.</p>
&#13;

<h2>Neural Network Concepts</h2>
<p>Here are some key aspects of artificial neural networks,</p>
<p><strong>Basic Design</strong> - <em>‚Äú‚Ä¶a computing system made up of a number of simple, highly interconnected processing elements, which process information by their dynamic state response to external inputs.‚Äù</em> Caudill (1989).</p>
<p><strong>Still a Prediction Model</strong> - while these models may be quite complicated with even millions of trainable model parameters, weights and biases, they are still a function that maps from predictor features to response features,</p>
<div class="math notranslate nohighlight">
\[
Y=f(X)+\epsilon
\]</div>
<p><strong>Supervised learning</strong> ‚Äì we provide training data with predictor features, <span class="math notranslate nohighlight">\(X_1,\ldots,ùëã_ùëö\)</span> and response feature(s), <span class="math notranslate nohighlight">\(ùëå_1,\ldots,ùëå_K\)</span>, with the expectation of some model prediction error, <span class="math notranslate nohighlight">\(\epsilon\)</span>.</p>
<p><strong>Nonlinearity</strong> - nonlinearity is imparted to the system through the application of nonlinear activation functions to model nonlinear relationships</p>
<p><strong>Universal Function Approximator (Universal Approximation Theorem)</strong> - ANNs have the ability to learn any possible function shape of <span class="math notranslate nohighlight">\(f\)</span> over an interval, for an arbitrary wide (single hidden layer) by Cybenko (1989) and arbitrary depth by Lu and others (2017)</p>
&#13;

<h2>A Simple Network</h2>
<p>To get started, let‚Äôs build a neural net, single hidden layer, fully connected, feed-forward neural network,</p>
<figure style="text-align: center;">
  <img src="../Images/832ee38f2f09d395115eb31b95358103.png" style="display: block; margin: 0 auto; width: 60%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann.png"/>
  <figcaption style="text-align: center;"> Simple demonstration artificial neural network.
</figcaption>
</figure>
<p>We use this example artificial neural network in the descriptions below and as an actual example that we will train and predict with by-hand!</p>
<p>Now let‚Äôs label the parts of our network,</p>
<figure style="text-align: center;">
  <img src="../Images/0be0dcf09e698cf22dc0881c818c0dbc.png" style="display: block; margin: 0 auto; width: 75%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_parts.png"/>
  <figcaption style="text-align: center;"> Simple demonstration artificial neural network with the parts labeled, including 3 inputs nodes, 2 hidden nodes and 1 output node fully connected.
</figcaption>
</figure>
<p>Our artificial neural network has,</p>
<ul class="simple">
<li><p>3 predictor features, <span class="math notranslate nohighlight">\(X_1\)</span>, <span class="math notranslate nohighlight">\(X_2\)</span> and <span class="math notranslate nohighlight">\(X_3\)</span></p></li>
<li><p>3 input nodes, <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(I_2\)</span> and <span class="math notranslate nohighlight">\(I_3\)</span></p></li>
<li><p>2 hidden layer nodes, <span class="math notranslate nohighlight">\(H_4\)</span> and <span class="math notranslate nohighlight">\(H_5\)</span></p></li>
<li><p>1 output node, <span class="math notranslate nohighlight">\(O_6\)</span></p></li>
<li><p>1 response feature, <span class="math notranslate nohighlight">\(Y_1\)</span></p></li>
</ul>
<p>where all nodes fully connected. Note, deep learning is a neural network with more than 1 hidden layer, but for brevity let‚Äôs continue with our non-deep learning artificial neural network.</p>
&#13;

<h2>Comments on Network Nomenclature</h2>
<p>Just a couple more comments about my network nomenclature. My goal is to maximize simplicity and clarity,</p>
<ul class="simple">
<li><p><strong>Network Nodes and Connections</strong> - I choose to use unique numbers for all nodes, <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(I_2\)</span>, <span class="math notranslate nohighlight">\(I_3\)</span>, <span class="math notranslate nohighlight">\(H_4\)</span>, <span class="math notranslate nohighlight">\(H_5\)</span> and <span class="math notranslate nohighlight">\(O_6\)</span>, instead of repeating numbers over each layer, <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(I_2\)</span>, <span class="math notranslate nohighlight">\(I_3\)</span>, <span class="math notranslate nohighlight">\(H_1\)</span>, <span class="math notranslate nohighlight">\(H_2\)</span>, and <span class="math notranslate nohighlight">\(O_1\)</span> to simplify the notation for the weights; therefore, when I say <span class="math notranslate nohighlight">\(\lambda_{1,4}\)</span> you know exactly where this weight is applied in the network, from node <span class="math notranslate nohighlight">\(I_1\)</span> to node <span class="math notranslate nohighlight">\(H_4\)</span>.</p></li>
<li><p><strong>Node Outputs</strong> - I use the node label to also describe the output from the node, for example <span class="math notranslate nohighlight">\(O_6\)</span> is the output node, <span class="math notranslate nohighlight">\(O_6\)</span>, and also the signal or value output from node <span class="math notranslate nohighlight">\(O_6\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 \right) 
\]</div>
<ul class="simple">
<li><p><strong>Pre- and Post-activation</strong> - at our nodes <span class="math notranslate nohighlight">\(H_4\)</span>, <span class="math notranslate nohighlight">\(H_5\)</span>, and <span class="math notranslate nohighlight">\(O_6\)</span>, we have the node input before activation and the node output after activation, I use the notation <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, <span class="math notranslate nohighlight">\(H_{5_{in}}\)</span>, and <span class="math notranslate nohighlight">\(O_{6_{in}}\)</span> for the pre-activation input,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
H_{4_{in}} = \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5_{in}} = \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{2,5} \cdot I_3 
\]</div>
<div class="math notranslate nohighlight">
\[
O_{6_{in}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 
\]</div>
<p><span class="math notranslate nohighlight">\(\quad\)</span> and <span class="math notranslate nohighlight">\(H_4\)</span>, <span class="math notranslate nohighlight">\(H_5\)</span>, and <span class="math notranslate nohighlight">\(O_6\)</span> for the post-activation node output.</p>
<div class="math notranslate nohighlight">
\[
H_{4} = \sigma \left( H_{4_{in}} \right) = \sigma \left( \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 \right) 
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5} = \sigma \left( H_{5_{in}} \right) = \sigma \left( \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{2,5} \cdot I_3 \right) 
\]</div>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma \left( O_{6_{in}} \right) = \sigma \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 \right)
\]</div>
<p>It is important to have clean, clear notation because with back propagation we have to step through the nodes, going from post-activation to pre-activation.</p>
<ul class="simple">
<li><p>often variables like <span class="math notranslate nohighlight">\(z\)</span> are applied for pre-activation in neural network literature, but I feel this is ambiguous and may cause confusion as we provide a nuts and bolts approach, explicitly describing every equation, to describe exactly how neural networks are trained and predict</p></li>
</ul>
&#13;

<h2>Description of the Network Approach</h2>
<p>Let‚Äôs talk about the network, the parts and how information flows through the network.</p>
<p><strong>Feed-forward</strong> ‚Äì all information flows from left to right. Each node sends the same signal along the connections to all the nodes in the next layer,</p>
<figure style="text-align: center;">
  <img src="../Images/02be26cd4d5476666cd2e1a72c3005fe.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_flow.png"/>
  <figcaption style="text-align: center;"> Feed forward, fully connected, with each node sending the same signal to all the nodes in the next layer.
</figcaption>
</figure>
<p><strong>Input Layer</strong> - the input features are passed directly to the input nodes, in the case of continuous predictor features, there is one input node per feature and the features are,</p>
<ul class="simple">
<li><p>min / max normalization to a range <span class="math notranslate nohighlight">\(\left[ ‚àí1,1 \right]\)</span> or <span class="math notranslate nohighlight">\(\left[ 0,1 \right]\)</span> to improve activation function sensitivity and to remove the influence of scale differences in predictor features and to improve solution stability, i.e., smooth reduction in the training loss while training</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/cb20e85861a55df55677b55ce737bbd5.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_input.png"/>
  <figcaption style="text-align: center;"> Highlighting the input layer, the first layer that receives the normalized predictor features.
</figcaption>
</figure>
<p>In the case of categorical predictor features, we have one input node per each category for each predictor feature, i.e., after one-hot-encoding of the feature where each encoding is passed to a separate input node.</p>
<ul class="simple">
<li><p>recall one-hot-encoding, 1 if the specific category, 0 otherwise, replaces the categorical feature with a binary vector with length as the number of categories.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/51d695aaaa36c3450f3997691fb0090f.png" style="display: block; margin: 0 auto; width: 90%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_input_cat.png"/>
  <figcaption style="text-align: center;"> The input layer of our artificial neural network highlighted. The first layer that receives one-hot-encoding of a single categorical predictor feature.
</figcaption>
</figure>
<ul class="simple">
<li><p>we could also use a single input node per categorical predictor and assign thresholds to each categories, for example <span class="math notranslate nohighlight">\(\left[ 0.0, 0.5, 1.0 \right]\)</span> for 3 categories, but this assumes an ordinal categorical feature</p></li>
</ul>
<p><strong>Hidden Layer</strong> -  the input layer values <span class="math notranslate nohighlight">\(I_1, I_2, I_2\)</span> are weighted with learnable weights,</p>
<div class="math notranslate nohighlight">
\[
\lambda_{1,4}, \lambda_{2,4}, \lambda_{3,4}, \lambda_{1,5}, \lambda_{2,5}, \lambda_{3,5}
\]</div>
<ul class="simple">
<li><p>in the hidden layer nodes, the weighted input layer values, <span class="math notranslate nohighlight">\(\lambda_{1,4} \cdot I_1, \lambda_{2,4} \cdot I_2 \cdot I_2, \ldots, \lambda_{3,5} \cdot I_3\)</span> are summed with the addition of a trainable bias term in each node, <span class="math notranslate nohighlight">\(b_4\)</span> and <span class="math notranslate nohighlight">\(b_5\)</span>.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
H_{4_{in}} = \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5_{in}} = \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{3,5} \cdot I_3 + b_5
\]</div>
<p>the nonlinear activation is applied,</p>
<div class="math notranslate nohighlight">
\[
H_{4} = \sigma  \bigl( \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4 \bigr)
\]</div>
<div class="math notranslate nohighlight">
\[
H_{5} = \sigma \bigl( \lambda_{1,5} \cdot I_1 + \lambda_{2,5} \cdot I_2 + \lambda_{3,5} \cdot I_3 + b_5 \bigr)
\]</div>
<ul class="simple">
<li><p>the output from the input layer nodes to all hidden layer nodes is contant (again, each node sends the same value to all nodes in the next layer)</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/e2342c26953974528579d98e504c15c8.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_hidden.png"/>
  <figcaption style="text-align: center;"> The hidden layer of our artificial neural network highlighted. The input layer nodes' outputs are weighted and passed into the hidden layer nodes. The output from the hidden layer nodes to all output layer nodes is constant.
</figcaption>
</figure>
<p><strong>Output Layer</strong> - for continuous response features there is one output node per normalized response feature. Once again the weighted linear combination of inputs plus a node bias are calculated,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{in}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>and then activation is applied, but for a continuous response feature, typically identity (linear) transform is applied,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \alpha \bigl( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \bigr) = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 = O_{6_{in}} 
\]</div>
<ul class="simple">
<li><p>backtransformation from normalized to original response feature(s) are then applied to recover the ultimate prediction</p></li>
<li><p>as with continuous predictor features, min / max normalization is applied to continuous response features to a range [‚àí1,1] or [0,1] to improve activation function sensitivity</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/87d8ca10f44d6d5d97c7e6ced2d415e5.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_output.png"/>
  <figcaption style="text-align: center;"> The output layer of our artificial neural network highlighted. The hidden layer nodes' outputs are weighted and passed into the output layer nodes. The output from the hidden layer nodes is constant, but the weights vary over the hidden layer node to output layer node connections.
</figcaption>
</figure>
<p>In the case of a categorical response feature, once again one-hot-encoding is applied, therefore, there is one output node per category.</p>
<ul class="simple">
<li><p>the prediction is the probability of each category</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/11c0969ef52f11e6929df9ff8e4d92c2.png" style="display: block; margin: 0 auto; width: 80%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_output_cat.png"/>
  <figcaption style="text-align: center;"> Highlighting the input layer, the first layer that receives one-hot-encoding of a single categorical predictor feature.
</figcaption>
</figure>&#13;

<h2>Walkthrough the Network</h2>
<p>Now we are ready to walkthough the artificial neural network.</p>
<ul class="simple">
<li><p>we follow a single path to illustrate the precise calculations associated with making a prediction with an artificial neural network</p></li>
</ul>
<p>The full forward pass is explained next.</p>
<p><strong>Inside an Input Layer Node</strong> - input layer nodes just pass the predictor features,</p>
<ul class="simple">
<li><p>normalized continuous predictor feature value</p></li>
<li><p>a single one-hot-encoding value [0 or 1] for categorical prediction features</p></li>
</ul>
<p>into the hidden layer nodes, with general vector notation,</p>
<div class="math notranslate nohighlight">
\[
I = X
\]</div>
<figure style="text-align: center;">
  <img src="../Images/4e1c6258eff75f9d4ce767b39cd522fb.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_input.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the input layer node receives one-hot-encoding of a single categorical predictor feature and passes it to all of the hidden layer nodes.
</figcaption>
</figure>
<p>We can generalize over all input layer nodes with,</p>
<div class="math notranslate nohighlight">
\[
H_j = H_{j_{in}} = X_j
\]</div>
<p><strong>Inside an Hidden Layer Node</strong></p>
<p>The hidden layer nodes are simple processors. The take linearly weighted combinations of inputs, add a node bias term and then nonlinearly transform the result, this transform is call the activation function, <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<ul class="simple">
<li><p>indeed, a very simple processor!</p></li>
<li><p>through many interconnected nodes we gain a very flexible predictor, emergent ability to characterize complicated, nonlinear patterns.</p></li>
</ul>
<p>Prior to activation we have,</p>
<div class="math notranslate nohighlight">
\[
H_{4_{in}} = \sum_{i=1}^{3} \left( \lambda_{i,4} \cdot I_i \right) + b_4
\]</div>
<p>and after activation we have,</p>
<div class="math notranslate nohighlight">
\[
H_4 = \alpha \left(H_{4_{in}} \right)
\]</div>
<p>We can express the simple processor in the node with general vector notation as,</p>
<div class="math notranslate nohighlight">
\[
H_4 = \alpha \left(b_4 + \lambda_{j,4}^T I \right)
\]</div>
<figure style="text-align: center;">
  <img src="../Images/b2f8e46ea497049f4b95c03b8812eea7.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_hidden.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the hidden layer linearly weights the input from each input layer node, adds a node bias term and then applies an activation function and passes this to all nodes in the next layer, i.e., the output layer for our example artificial neural network.
</figcaption>
</figure>
<p>We can generalize over all hidden layer nodes with,</p>
<div class="math notranslate nohighlight">
\[
H_{j_{in}} = \sum_{i=1}^{|I|} \left( \lambda_{i,j} \cdot I_i \right) + b_j
\]</div>
<p>and after activation, the node output is,</p>
<div class="math notranslate nohighlight">
\[
H_{j_{in}} = \sigma \bigl( \sum_{i=1}^{|I|} \left( \lambda_{i,j} \cdot I_i \right) + b_j \bigr)
\]</div>
<p><strong>Inside an Output Layer Node</strong></p>
<p>The output layer nodes take linearly weighted combinations of nodes‚Äô inputs, adds a node bias term and then transforms the result with an activation function, <span class="math notranslate nohighlight">\(\alpha\)</span>, same as the hidden layer nodes,</p>
<p>Prior to activation we have,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{in}} = \sum_{i=4}^{5} \left( \lambda_{i,6} \cdot H_i \right) + b_6
\]</div>
<p>and after activation, assuming identity activation we have,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \alpha \left(O_{6_{in}} \right)
\]</div>
<p>We can express the simple processor in the node with general vector notation as,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \alpha\left(b_6 + \lambda_{j,6}^T H\right)
\]</div>
<figure style="text-align: center;">
  <img src="../Images/22c5dd7e545497f42cf0b949f0b92954.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_output.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the output layer linearly weights the input from each hidden layer node, adds a node bias term and then applies an activation function, typically linear for continuous response features and passes this as an output.
</figcaption>
</figure>
<p>and for categorical response features, softmax activation is commonly applied,</p>
<div class="math notranslate nohighlight">
\[
O_j = \alpha(O_{j_{in}}) = \frac{e^{O_{j_{in}}}}{\sum_{\iota=1}^{K} e^{O_{\iota_{in}}}}
\]</div>
<figure style="text-align: center;">
  <img src="../Images/ff80ab0dac26f531ce5cc5ce3cd9cf5d.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_output_cat.png"/>
  <figcaption style="text-align: center;"> Walkthrough of an artificial neural network, the output layer linearly weights the input from each hidden layer node, adds a node bias term and then applies an activation function, typically linear for continuous response features and passes this as an output.
</figcaption>
</figure>
<p>softmax activation ensures that the output over all the output layer nodes are valid probabilities including,</p>
<ul class="simple">
<li><p><strong>nonnegativity</strong> - through the exponentiation</p></li>
<li><p><strong>closure</strong> - probabilities sum to 1.0 through the denominator normalizing the result</p></li>
</ul>
<p>Note, for all future discussions and demonstrations, I assume a standardized continuous responce feature.</p>
&#13;

<h2>Network Forward Pass</h2>
<p>Now that we have completed a walk-through of our network on a single path, let‚Äôs combine all the paths through our network to demonstrate a complete forward pass through our artificial neural network.</p>
<ul class="simple">
<li><p>this is the calculation required to make a prediction with out,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma_{O_6} \bigl( 
    \lambda_{4,6} \cdot \sigma_{H_4} \left( \lambda_{1,4} I_1 + \lambda_{2,4} I_2 + \lambda_{3,4} I_3 + b_4 \right) 
  + \lambda_{5,6} \cdot \sigma_{H_5} \left( \lambda_{1,5} I_1 + \lambda_{2,5} I_2 + \lambda_{3,5} I_3 + b_5 \right)
  + b_6 \bigr)
\]</div>
<p>where the activation functions <span class="math notranslate nohighlight">\(\sigma_{H_4}\)</span> = <span class="math notranslate nohighlight">\(\sigma_{H_5}\)</span> = <span class="math notranslate nohighlight">\(\sigma\)</span> are sigmoid, and <span class="math notranslate nohighlight">\(\sigma_{O_6}\)</span> is linear (identity), so we could simplify the forward pass to,</p>
<div class="math notranslate nohighlight">
\[
O_6 = \lambda_{4,6} \cdot \sigma \left( \lambda_{1,4} I_1 + \lambda_{2,4} I_2 + \lambda_{3,4} I_3 + b_4 \right) 
  + \lambda_{5,6} \cdot \sigma \left( \lambda_{1,5} I_1 + \lambda_{2,5} I_2 + \lambda_{3,5} I_3 + b_5 \right)
  + b_6
\]</div>
<p>This emphasizes that our neural network is a nested set of activated linear systems, i.e., linearly weighted averages plus bias terms applied to activation functions.</p>
&#13;

<h2>Number of Model Parameters</h2>
<p>In general, there are many model parameters, <span class="math notranslate nohighlight">\(theta\)</span>, in an artificial neural network. First, let‚Äôs clarify these definitions to describe our artificial neural network,</p>
<ul class="simple">
<li><p><strong>neural network width</strong> - the number of nodes in the layers of the neural network</p></li>
<li><p><strong>neural network depth</strong> - the number of layers in the neural network, typically the input layer is not included in this calculation</p></li>
</ul>
<p>Now, let‚Äôs assume the following compact notation for a 3 layer artificial neural network, input, output and 1 hidden layer, with the width of each layer as,</p>
<ul class="simple">
<li><p>number of input nodes, <span class="math notranslate nohighlight">\(p\)</span></p></li>
<li><p>number of hidden layer nodes, <span class="math notranslate nohighlight">\(m\)</span></p></li>
<li><p>and number of output nodes, <span class="math notranslate nohighlight">\(k\)</span></p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/1b5b7051a7f760fb3b71c71560ca7613.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/parameters.png"/>
  <figcaption style="text-align: center;"> Notation for artificial neural network width, number of input nodes, \(p\), number of hidden layer nodes, \(m\), and number of output nodes, \(k\). 
</figcaption>
</figure>
<p>fully connected, so for every connection there is a weight,</p>
<div class="math notranslate nohighlight">
\[
\lambda_{ùêº_{1,\ldots,ùëù},ùêª_{1,\ldots,ùëö} } \quad \text{and} \quad \lambda_{ùêª_{1,\ldots,ùëö},ùëÇ_{1,\ldots,ùëò} }
\]</div>
<p>with full connectivity the number of weights is</p>
<div class="math notranslate nohighlight">
\[
ùëù \times ùëö \quad \text{and} \quad ùëö \times ùëò
\]</div>
<p>and at each hidden layer node there is a bias term,</p>
<div class="math notranslate nohighlight">
\[
ùëè_{H_{1,\ldots,m} }
\]</div>
<p>and at every output node there is a bias term,</p>
<div class="math notranslate nohighlight">
\[
ùëè_{O_{1,\ldots,k} }
\]</div>
<p>Therefore, the number of model parameters is,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = ùëù \times ùëö + ùëö \times ùëò + ùëö + ùëò 
\]</div>
<p>this assumes an unique bias term at each hidden layer node and output layer node, but in some case the same bias term may be applied over the entire layer.</p>
<p>For our example, with <span class="math notranslate nohighlight">\(p = 3\)</span>, <span class="math notranslate nohighlight">\(m = 2\)</span> and <span class="math notranslate nohighlight">\(k = 1\)</span>, then the number of model parameters are,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = ùëù \times ùëö + ùëö \times ùëò + ùëö + ùëò 
\]</div>
<p>after substitution we have,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = 3 \times 2 + 2 \times 1 + 2 + 1 = 11
\]</div>
<p>I select this as a manageable number of parameters, so we can train and visualize our model, but consider a more typical model size by increasing our artificial neural network‚Äôs width, with <span class="math notranslate nohighlight">\(p = 10\)</span>, <span class="math notranslate nohighlight">\(m = 20\)</span> and <span class="math notranslate nohighlight">\(k = 3\)</span>, then we have many more model parameters,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = 10 \times 20 + 20 \times 3 + 20 + 3 = 283
\]</div>
<p>If we add hidden layers, increase our artificial neural network‚Äôs depth, the number of model parameters will grow very quickly.</p>
<ul class="simple">
<li><p>we can generalize this calculation for any fully connected, feed forward neural network, given a <span class="math notranslate nohighlight">\(W\)</span> vector with the number of nodes, i.e., the width of each layer,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\mathbf{L} = [l_0, l_1, l_2, \dots, l_n]
\]</div>
<p>where,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(l_0\)</span> is the number of input neurons</p></li>
<li><p><span class="math notranslate nohighlight">\(l_1, \dots, l_{n-1}\)</span> are the widths of the hidden layers</p></li>
<li><p><span class="math notranslate nohighlight">\(l_n\)</span> is the number of output neurons</p></li>
</ul>
<p>The total number of connection weights is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{weights}| = \sum_{i=1}^{n} l_i \cdot l_{i-1}
\]</div>
<p>the total number of node biases (there are not bias parameters in the input layer nodes, <span class="math notranslate nohighlight">\(l_0\)</span>) is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{biases}| = \sum_{i=1}^{n} l_i
\]</div>
<p>the total number of trainable model parameters, connectioned weights and node biases, is,</p>
<div class="math notranslate nohighlight">
\[
|\theta| = \sum_{i=1}^{n} \left( l_i \cdot l_{i-1} + l_i \right) = \sum_{i=1}^{n} l_i \cdot (l_{i-1} + 1)
\]</div>
<p>Let‚Äôs take an example of artificial neural network with 4 hidden layers, with network width by-layer vector of,</p>
<div class="math notranslate nohighlight">
\[
\mathbf{L} = [10, 8, 6, 4, 2, 1]
\]</div>
<p>The total number of connection weights is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{L_{weights}}| = \sum_{i=1}^{5} l_i \cdot l_{i-1}
= (8 \cdot 10) + (6 \cdot 8) + (4 \cdot 6) + (2 \cdot 4) + (1 \cdot 2)
= 80 + 48 + 24 + 8 + 2 = 162
\]</div>
<p>and the total number of node biases is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_{L_{biases}}|  = \sum_{i=1}^{5} l_i = 8 + 6 + 4 + 2 + 1 = 21
\]</div>
<p>and finally the total nuber of trainable parameters is,</p>
<div class="math notranslate nohighlight">
\[
|\theta_L| = \sum_{i=1}^{5} l_i \cdot (l_{i-1} + 1)
= (8 \cdot 11) + (6 \cdot 9) + (4 \cdot 7) + (2 \cdot 5) + (1 \cdot 3)
= 88 + 54 + 28 + 10 + 3 = 183
\]</div>
&#13;

<h2>Activation Functions</h2>
<p>The activation function is a transformation of the linear combination of the weighted node inputs plus the node bias term. Nonlinear activation,</p>
<ul class="simple">
<li><p>introduces non-linear properties, and complexity to the network</p></li>
<li><p>prevents the network from collapsing</p></li>
</ul>
<p>Without the nonlinear activation function we would have linear regression, the entire system collapses.</p>
<p>For more information about activation functions and a demonstration of the collapse without nonlinear activation to multilinear regression see the associated chapter in this e-book, <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_activation_functions.html">Neural Network Activation Functions</a>.</p>
&#13;

<h2>Training Networks Steps</h2>
<p>Training an artificial neural network proceeds iteratively by these steps,</p>
<ol class="arabic simple" start="0">
<li><p>initialized the model parameters</p></li>
<li><p>forward pass to make a prediction</p></li>
<li><p>calculate the error derivative based on the prediction and truth over training data</p></li>
<li><p>backpropagate the error derivative back through the artificial neural network to calculate the derivatives of the error over all the model weights and biases parameters</p></li>
<li><p>update the model parameters based on the derivatives and learning rates</p></li>
<li><p>repeat until convergence.</p></li>
</ol>
<figure style="text-align: center;">
  <img src="../Images/c3a5bc8956f8ceda05ddf9b582cd141d.png" style="display: block; margin: 0 auto; width: 90%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/training_cycle.png"/>
  <figcaption style="text-align: center;"> The iterative steps for training an artificial neural network. 
</figcaption>
</figure>
<p>Here‚Äôs some details on each step,</p>
<ol class="arabic simple" start="0">
<li><p><strong>Initializing the Model Parameters</strong> - initialize all model parameters with typically small (near zero) random values. Here‚Äôs a couple common methods,</p></li>
</ol>
<ul class="simple">
<li><p><strong>Xavier Weight Initialization</strong> - random realizations from uniform distributions specified by <span class="math notranslate nohighlight">\(U[\text{min}, \text{max}]\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{i,j} = F_U^{-1} \left[ \frac{-1}{\sqrt{p}}, \frac{1}{\sqrt{p}} \right] (p^\ell)
\]</div>
<p>¬†¬†¬†¬† where <span class="math notranslate nohighlight">\(F^{-1}_U\)</span> is the inverse of the CDF, <span class="math notranslate nohighlight">\(p\)</span> is the number of inputs, and <span class="math notranslate nohighlight">\(p^{\ell}\)</span> is a random cumulative probability value drawn from the uniform distribution, <span class="math notranslate nohighlight">\(U[0,1]\)</span>.</p>
<ul class="simple">
<li><p><strong>Normalized Xavier Weight Initialization</strong> - random realizations from uniform distributions specified by <span class="math notranslate nohighlight">\(U[\text{min}, \text{max}]\)</span>,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{i,j} = F_U^{-1} \left[ \frac{-1}{\sqrt{p}+k}, \frac{1}{\sqrt{p}+k} \right] (p^\ell)
\]</div>
<p>¬†¬†¬†¬† where <span class="math notranslate nohighlight">\(F^{-1}_U\)</span> is the inverse of the CDF, <span class="math notranslate nohighlight">\(p\)</span> is the number of inputs, <span class="math notranslate nohighlight">\(k\)</span> is the number of outputs, and <span class="math notranslate nohighlight">\(p^{\ell}\)</span> is a random cumulative probability value drawn from the uniform distribution, <span class="math notranslate nohighlight">\(U[0,1]\)</span>.</p>
<p>¬†¬†¬†¬† For example, if we return to our first hidden layer node,</p>
<figure style="text-align: center;">
  <img src="../Images/b2f8e46ea497049f4b95c03b8812eea7.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/ann_walkthrough_hidden.png"/>
  <figcaption style="text-align: center;"> First hidden layer node with 3 inputs, and 1 output.
</figcaption>
</figure>
<p>¬†¬†¬†¬† we have <span class="math notranslate nohighlight">\(p = 3\)</span> and <span class="math notranslate nohighlight">\(k = 1\)</span>, and we draw from the uniform distribution,</p>
<div class="math notranslate nohighlight">
\[
U \left[ \frac{-1}{\sqrt{p}+k}, \frac{1}{\sqrt{p}+k} \right] = U \left[ \frac{-1}{\sqrt{3}+1}, \frac{1}{\sqrt{3}+1} \right]
\]</div>
<ol class="arabic simple">
<li><p><strong>Forward Pass</strong> - to make a prediction, <span class="math notranslate nohighlight">\(\hat{y}\)</span>. Initial predictions will be random for the first iteration, but will improve over iterations. Once again for our model the forward pass is,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
O_6 = \lambda_{4,6} \cdot \sigma \left( \lambda_{1,4} I_1 + \lambda_{2,4} I_2 + \lambda_{3,4} I_3 + b_4 \right) 
  + \lambda_{5,6} \cdot \sigma \left( \lambda_{1,5} I_1 + \lambda_{2,5} I_2 + \lambda_{3,5} I_3 + b_5 \right)
  + b_6
\]</div>
<figure style="text-align: center;">
  <img src="../Images/08556ecbd47d143019d0163dc95761cf.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/first_prediction.png"/>
  <figcaption style="text-align: center;"> Prediction with our artificial neural network initialized with random model parameters, weights and biases.
</figcaption>
</figure>
<ol class="arabic simple" start="2">
<li><p><strong>Calculate the Error Derivative</strong> - given a loss of,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
L = \frac{1}{2} \left(\hat{y} - y \right)^2
\]</div>
<p>¬†¬†¬†¬† and the error derivative, i.e., rate of change of in error given a change in model estimate is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \hat{y}} = \hat{Y} - Y
\]</div>
<p>¬†¬†¬†¬† For now, let‚Äôs only consider a single estimate, and we will address more than 1 training data later.</p>
<ol class="arabic simple" start="3">
<li><p><strong>Backpropagate the Error Derivative</strong> - we shift back through the artificial neural network to calculate the derivatives of the error over all the model weights and biases parameters, with the chain rule, for example the loss derivative backpropagated to the output of node <span class="math notranslate nohighlight">\(H_4\)</span>,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial H_4} 
= \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial L}{\partial O_6} 
= \lambda_{4,6} \cdot \bigl( (1 - O_6) \cdot O_6 \bigr) \cdot (O_6 - y)
\]</div>
<ol class="arabic simple" start="4">
<li><p><strong>Update the Model Parameters</strong> - based on the derivatives, <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial \lambda_{i,j}}\)</span> and learning rates, <span class="math notranslate nohighlight">\(\eta\)</span>, like this,</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\lambda_{i,j}^{\ell} = \lambda_{i,j}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{i,j}}
\]</div>
<ol class="arabic simple" start="5">
<li><p><strong>Repeat Until Convergence</strong> - return to step 1, until the error, <span class="math notranslate nohighlight">\(L\)</span>, is reduced to an acceptable level, i.e., model convergence is the condition to stop the iterations</p></li>
</ol>
<p>These are the steps, now let‚Äôs dive into the details for each, but first let‚Äôs start with the mathematical framework for backpropagation - the chain rule.</p>
&#13;

<h2>The Chain Rule</h2>
<p>Upon reflection, it is clear that the forward pass through our artificial neural network involves a sequence of nested operations that progressively transform the input signals as they propagate from the input nodes, through each layer, to the output nodes.</p>
<p>So we can represent this as a sequence of nested operations,</p>
<div class="math notranslate nohighlight">
\[
f = f(x) \quad g = g(f) \quad y = h(g)
\]</div>
<p>and now in this form to emphasize the nesting of operations,</p>
<div class="math notranslate nohighlight">
\[
y = h \bigl( g(f(x)) \bigr)
\]</div>
<p>By applying the chain rule to the nested functions <span class="math notranslate nohighlight">\(y = h \bigl( g(f(x)) \bigr)\)</span>, we can solve for <span class="math notranslate nohighlight">\(\frac{\partial y}{\partial x}\)</span> as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial y}{\partial x} = \frac{\partial h}{\partial g} \cdot \frac{\partial g}{\partial f} \cdot \frac{\partial f}{\partial x}
\]</div>
<p>where we chain together the partial derivatives for all the operators to solve derivative of the output, <span class="math notranslate nohighlight">\(y\)</span>, given the input, <span class="math notranslate nohighlight">\(x\)</span>.</p>
<ul class="simple">
<li><p>we can compute derivatives at any intermediate point in the nested functions, for example, stepping backwards one step,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\frac{\partial f}{\partial x}
\]</div>
<p>and now two steps,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial g}{\partial x} = \frac{\partial g}{\partial f} \cdot \frac{\partial f}{\partial x}
\]</div>
<p>and all the way with three steps,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial y}{\partial x} = \frac{\partial h}{\partial g} \cdot \frac{\partial g}{\partial f} \cdot \frac{\partial f}{\partial x}
\]</div>
<p>This is what we do with backpropagation, but this may be too abstract! Let‚Äôs move to a very simple feed forward neural network with only these three nodes,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(I_1\)</span> - input node</p></li>
<li><p><span class="math notranslate nohighlight">\(H_2 = h(I_1)\)</span> - hidden layer node, a function of <span class="math notranslate nohighlight">\(I_1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(O_3 = o(H_2)\)</span> - output node, a function of <span class="math notranslate nohighlight">\(H_2\)</span></p></li>
<li><p>this is still intentionally abstract, i.e., without mention of weights and biases, to help you develop a mental framework of backpropagation with neural netowrks by the chain rule, we will dive into the details immediately after this discussion.</p></li>
</ul>
<p>The output <span class="math notranslate nohighlight">\(O_3\)</span> depends on the input <span class="math notranslate nohighlight">\(I_1\)</span> through these nested functions:</p>
<div class="math notranslate nohighlight">
\[
O_3 = o \bigl( h(I_1) \bigr)
\]</div>
<p>Using the <strong>chain rule</strong>, the gradient of the output with respect to backpropagating one step,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_3}{\partial H_2}
\]</div>
<p>and with respect to backpropagating two steps,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_3}{\partial I_1} = \frac{\partial H_2}{\partial I_1} \cdot \frac{\partial O_3}{\partial H_2}
\]</div>
<p>This shows how the gradient <strong>backpropagates</strong> through the network,</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{\partial O_3}{\partial I_1}\)</span> - is the local gradient at the hidden node</p></li>
<li><p><span class="math notranslate nohighlight">\(\frac{\partial O_3}{\partial H_2}\)</span> - is the local gradient at the output node</p></li>
</ul>
<p>By backpropagation we can calculate the deriviates with respect to all parts of the network, how the input node signal <span class="math notranslate nohighlight">\(I_1\)</span>, or hidden nodel signal <span class="math notranslate nohighlight">\(H_2\)</span> affect the output <span class="math notranslate nohighlight">\(O_3\)</span>, <span class="math notranslate nohighlight">\(\frac{\partial O_3}{\partial I_1}\)</span> and <span class="math notranslate nohighlight">\(frac{\partial O_3}{\partial H_2}\)</span> respsectively.</p>
<ul class="simple">
<li><p>and more importantly, how changes in the input <span class="math notranslate nohighlight">\(I_1\)</span>, or <span class="math notranslate nohighlight">\(H_2\)</span> affect the change in model loss, <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial I_1}\)</span> and <span class="math notranslate nohighlight">\(frac{\partial L}{\partial H_2}\)</span> respsectively.</p></li>
</ul>
<p>This chain of partial derivatives, move backwards step by step through the neural network layers, is the fundamental mechanism behind <strong>backpropagation</strong>. Next we will derive and demonstrate each of the parts of backpropagation and then finally put this together to show backpropagation over our entire network.</p>
&#13;

<h2>Neural Networks Backpropagation Building Blocks</h2>
<p>Let‚Äôs cover the numerical building blocks for backpropagation. Once you understand these backpropagation building blocks, you will be able to backpropagate our simple network and even any complicated artificial neural networks by hand,</p>
<ol class="arabic simple">
<li><p>calculating the loss derivative</p></li>
<li><p>backpropagation through nodes</p></li>
<li><p>backpropagation along connections</p></li>
<li><p>accounting for multiple paths</p></li>
<li><p>loss derivatives with respect to weights and biases</p></li>
</ol>
<p>For now I demonstrate backpropagation of this loss derivative for a single training data sample, <span class="math notranslate nohighlight">\(y\)</span>.</p>
<ul class="simple">
<li><p>I address multiple samples later, <span class="math notranslate nohighlight">\(y_i, i=1, \ldots, n\)</span></p></li>
</ul>
<p>Let‚Äôs start with calculating the loss derivative.</p>
<section id="calculating-the-loss-derivative">
<h3>Calculating the Loss Derivative</h3>
<p>Backpropagation is based on the concept of allocating or propagating the loss derivative backwards through the neural network,</p>
<ul class="simple">
<li><p>we calculate the loss derivative and then distribute it sequentially, in reverse direction, from network output back towards the network input</p></li>
<li><p>it is important to know that we are working with derivatives, and that backpropagation is NOT distributing error, although as you will see it may look that way!</p></li>
</ul>
<p>We start by defining the loss, given the truth, <span class="math notranslate nohighlight">\(ùë¶\)</span>, and our prediction, <span class="math notranslate nohighlight">\(\hat{y} = O_6\)</span>, we calculate our <span class="math notranslate nohighlight">\(L^2\)</span> loss as,</p>
<div class="math notranslate nohighlight">
\[
L = \frac{1}{2} \left( \hat{y} - y \right)^2
\]</div>
<p>our choice of loss function allows us to use the prediction error as the loss derivative! We calculate the loss derivative as the partial derivative of the loss with respect to the estimate, <span class="math notranslate nohighlight">\(\frac{\partial ùêø}{\partial \hat{y}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \hat{y}} = \frac{\partial \frac{1}{2} \left( \hat{y} - y \right)^2 }{\partial \hat{y}} = \hat{y} - y
\]</div>
<p>You see what I mean, we are backpropagating the loss derivative, but due to our formulation of the <span class="math notranslate nohighlight">\(L^2\)</span> loss, we only have to calculate the error at our output node output, but once again - it is the loss derivative.</p>
<figure style="text-align: center;">
  <img src="../Images/6abf780fa4544caa6735a8f4ad075bd2.png" style="display: block; margin: 0 auto; width: 40%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_loss.png"/>
  <figcaption style="text-align: center;"> Calculation of the loss derivative at the output of an output layer node, $O_6$.
</figcaption>
</figure>
<p>For the example of our simple artificial neural network with the output at node, <span class="math notranslate nohighlight">\(O_6\)</span>, our loss derivative is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial O_6} = \frac{\partial \mathcal{L}}{\hat{y}} = \hat{y} - y = O_6 - y
\]</div>
<p>So this is our loss derivative backpropagated to the output our output node, and we are now we are ready to backpropagate this loss derivative through our artificial neural network, let‚Äôs talk about how we step through nodes and along connections.</p>
</section>
<section id="backpropagation-through-output-node-with-identity-activation">
<h3>Backpropagation through Output Node with Identity Activation</h3>
<p>Let‚Äôs backpropagate through our output node, <span class="math notranslate nohighlight">\(O_6\)</span>, from post-activation to pre-activation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>since this is an output node with a regression artificial neural network I have selected the identity or linear activation function.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/1141c4e67c550f275e9079501fe522b2.png" style="display: block; margin: 0 auto; width: 45%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $O_6$, from $O_6$ post-activation output to $O_{6_{in}}$ pre-activation input.
</figcaption>
</figure>
<p>The identity activation at output node <span class="math notranslate nohighlight">\(O_6\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma(O_{6_{in}}) = O_6
\]</div>
<p>The derivative of the identity activation at node <span class="math notranslate nohighlight">\(O_6\)</span> with respect to its input <span class="math notranslate nohighlight">\(O_{6_{in}}\)</span>, i.e., crossing node <span class="math notranslate nohighlight">\(O_6\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_6}{\partial O_{6_{in}}} = \frac{\partial \left(O_{6_{in}} \right)}{\partial O_{6_{in}}} = 1.0
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(O_6\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative with respect to the node output, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_6}\)</span>, and to the loss derivative with respect to the node input, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} 
= \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= 1.0 \cdot (O_6 - y)
\]</div>
<p>Now that we have backpropagated through an output node, let‚Äôs backpropagation along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from the hidden layer.</p>
</section>
<section id="backpropagation-along-connections">
<h3>Backpropagation along Connections</h3>
<p>Now let‚Äôs backpropagate along the connection between nodes <span class="math notranslate nohighlight">\(O_6\)</span> and <span class="math notranslate nohighlight">\(H_4\)</span>.</p>
<figure style="text-align: center;">
  <img src="../Images/1c686c4b3a6fe96317a79c7333542353.png" style="display: block; margin: 0 auto; width: 50%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_weight.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through node \(O_6\), from \(O_6\) post-activation output to $O_{6_{in}}$ pre-activation input and then along the connection to the output from node \(H_4\).
</figcaption>
</figure>
<p>Preactivation, the input to node <span class="math notranslate nohighlight">\(ùëÇ_6\)</span> is calculated as,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative along the connection as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial H_4} 
= \frac{\partial}{\partial H_4} \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right) 
= \lambda_{4,6}
\]</div>
<p>by resolving the above partial derivative, we see that backpropagation along a connection by applying the connection weight.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial H_4} = \lambda_{4,6}
\]</div>
<p>Note, we just need the current connection weight <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span>. Now we can add this to our chain rule to backpropagate along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from loss derivative with respect to the output layer node input <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>, to the loss derivative with respect to the hidden layer node output <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial H_4}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial H_4} 
= \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \lambda_{4,6} \bigl( \cdot (1 - O_6) \cdot O_6 \bigr) \cdot (O_6 - y)
\]</div>
</section>
<section id="backpropagation-through-nodes-with-sigmoid-activation">
<h3>Backpropagation through Nodes with Sigmoid Activation</h3>
<p>Let‚Äôs backpropagate through a hidden layer node, <span class="math notranslate nohighlight">\(H_4\)</span>, from postactivation to preactivation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>we are assuming sigmoid activation for all hidden layer nodes</p></li>
<li><p>for super clean logic, everyone resolves the activation derivative as a function of the output rather than as typical the input,</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/10ef488402716c36aa45b497ea54f6bb.png" style="display: block; margin: 0 auto; width: 55%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_hidden.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $H_4$, from $H_4$ postactivation output to $H_{4_{in}}$ preactivation input.
</figcaption>
</figure>
<p>The sigmoid activation at output node <span class="math notranslate nohighlight">\(H_4\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
H_4 = \sigma(H_{4_{in}}) = \frac{1}{1 + e^{-H_{4_{in}}}}
\]</div>
<p>The derivative of the sigmoid activation at node <span class="math notranslate nohighlight">\(H_4\)</span> with respect to its input <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, i.e., crossing node <span class="math notranslate nohighlight">\(H_4\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + e^{-H_{4_{in}}}} \right)
\]</div>
<p>Now, for compact notation let‚Äôs set,</p>
<div class="math notranslate nohighlight">
\[
u = e^{-H_{4_{in}}}
\]</div>
<p>and substituting we have,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + u} \right)
\]</div>
<p>and by the chain rule we can extend it to,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}}
= \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + u} \right)
= -\frac{u}{(1 + u)^2} \cdot \frac{\partial u}{\partial H_{4_{in}}}
\]</div>
<p>The derivative of <span class="math notranslate nohighlight">\(u = e^{-H_{4_{in}}}\)</span> with respect to <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial u}{\partial H_{4_{in}}} = -e^{-H_{4_{in}}} = -u
\]</div>
<p>now we can substitute,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = -\frac{1}{(1+u)^2} \cdot (-u) = \frac{u}{(1+u)^2}
\]</div>
<p>Express in terms of node <span class="math notranslate nohighlight">\(H_4\)</span> output, <span class="math notranslate nohighlight">\(H_4 = \frac{1}{1 + u}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{\text{in}}}} 
= \frac{\left(1 - H_4\right)/H_4}{\left(1/H_4\right)^2} 
= \frac{1 - H_4}{H_4} \cdot H_4^2 
= \left(1 - H_4\right) \cdot H_4
\]</div>
<p>So we can backpropagate through our node, <span class="math notranslate nohighlight">\(H_4\)</span>, from node post-activation output, <span class="math notranslate nohighlight">\(H_4\)</span> to node pre-activation input, <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, by,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{\text{in}}}} = \left(1 - H_4\right) \cdot H_4
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(H_4\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative to the output of node <span class="math notranslate nohighlight">\(H_4\)</span> and to the input of node <span class="math notranslate nohighlight">\(H_4\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} 
= \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>Now we can handle all cases of backpropagation through the nodes in our network.</p>
</section>
<section id="backpropagation-along-another-connection">
<h3>Backpropagation Along Another Connection</h3>
<p>For continuity and completeness, let‚Äôs repeat the previously described method to backpropagate along the connection <span class="math notranslate nohighlight">\(I_1\)</span> to <span class="math notranslate nohighlight">\(H_4\)</span>.</p>
<figure style="text-align: center;">
  <img src="../Images/76f408b8ed852b03a168e6069bb716db.png" style="display: block; margin: 0 auto; width: 75%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_weight_input.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative along the connection from $H_4$ to $I_1$.
</figcaption>
</figure>
<p>Once again, preactivation the input to node <span class="math notranslate nohighlight">\(H_4\)</span> is calculated as,</p>
<div class="math notranslate nohighlight">
\[
H_{4_{\text{in}}} = \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4
\]</div>
<p>We calculate the derivative along the connection as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_{4_{\text{in}}}}{\partial I_1} 
= \frac{\partial \left(\lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4 \right)}{\partial I_1} = \lambda_{1,4}
\]</div>
<p>by resolving the above partial derivative, we see that backpropagation along a connection by applying the connection weight.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_{4_{\text{in}}}}{\partial I_1} = \lambda_{4,6}
\]</div>
<p>Note, we just need the current connection weight <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span>. Now we can add this to our chain rule to backpropagate along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from loss derivative with respect to the output layer node input <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>, to the loss derivative with respect to the hidden layer node output <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial H_4}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
</section>
<section id="accounting-for-multiple-paths">
<h3>Accounting for Multiple Paths</h3>
<p>Our loss derivative with respect to the node output <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_1}\)</span> is not correct!</p>
<ul class="simple">
<li><p>we accounted for the <span class="math notranslate nohighlight">\(O_6\)</span> to <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(I_1\)</span> path, but we did not acccount for the <span class="math notranslate nohighlight">\(O_6\)</span> to <span class="math notranslate nohighlight">\(H_5\)</span> to <span class="math notranslate nohighlight">\(I_1\)</span> path</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/6a68404e4b3d2589dcfe15beb5175c60.png" style="display: block; margin: 0 auto; width: 85%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/multiple_paths.png"/>
  <figcaption style="text-align: center;"> Multiple paths for backpropagation to input node, $I_1$, from output node $O_6$.
</figcaption>
</figure>
<p>To account for multiple paths we just need to sum over all the paths.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>we can evaluate this as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} = \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y) + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>and then simplify by removing the 1.0 values and grouping terms as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} = \left[ \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
</section>
<section id="backpropagation-through-input-nodes-with-identity-activation">
<h3>Backpropagation through Input Nodes with Identity Activation</h3>
<p>Let‚Äôs backpropagate through our input node, <span class="math notranslate nohighlight">\(I_1\)</span>, from postactivation to preactivation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>since this is an input node I have selected the identity or linear activation function.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/bd05208edfb4ac5d5cc0f8cfe808ae50.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $I_1$, from $I_1$ postactivation output to $I_{1_{in}}$ preactivation input.
</figcaption>
</figure>
<p>The identity activation at output node <span class="math notranslate nohighlight">\(I_1\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
I_1 = \sigma(I_{1_{in}}) = I_1
\]</div>
<p>The derivative of the identity activation at node <span class="math notranslate nohighlight">\(I_1\)</span> with respect to its input <span class="math notranslate nohighlight">\(I_{1_{in}}\)</span>, i.e., passing through node <span class="math notranslate nohighlight">\(I_1\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial I_1}{\partial I_{1_{in}}} = \frac{\partial \left(I_{1_{in}} \right)}{\partial I_{1_{in}}} = 1.0
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(I_1\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative with respect to the node output, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_1}\)</span>, and to the loss derivative with respect to the node input, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{1_{\text{in}}}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} 
= \frac{\partial I_1}{\partial I_{1_{in}}} \cdot \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} + 
\frac{\partial I_1}{\partial I_{1_{in}}} \cdot \frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>we can evaluate this as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} = 1.0 \cdot \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y) + 1.0 \cdot \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>For fun I designed this notation for maximum clarity,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial I_{1_{\text{in}}}} = 
\overbrace{1.0}^{\textstyle \frac{\partial I_{1}}{\partial I_{1_{in}}}} \left[
\overbrace{\lambda_{1,4}}^{\textstyle \frac{\partial H_{4_{\text{in}}}}{\partial I_1}} \cdot
\overbrace{(1 - H_4) \cdot H_4}^{\textstyle \frac{\partial H_4}{\partial H_{4_{\text{in}}}}} \cdot
\overbrace{\lambda_{4,6}}^{\textstyle \frac{\partial O_{6_{\text{in}}}}{\partial H_4}} \cdot
\overbrace{1.0}^{\textstyle \frac{\partial O_{6}}{\partial O_{6_{in}}}} \cdot
\overbrace{(O_6 - Y_1^N)}^{\textstyle \frac{\partial L}{\partial O_{6}}} + 
\overbrace{\lambda_{1,5}}^{\textstyle \frac{\partial H_{5_{\text{in}}}}{\partial I_1}} \cdot
\overbrace{(1 - H_5) \cdot H_5}^{\textstyle \frac{\partial H_5}{\partial H_{5_{\text{in}}}}} \cdot
\overbrace{\lambda_{5,6}}^{\textstyle \frac{\partial O_{6_{\text{in}}}}{\partial H_5}} \cdot
\overbrace{1.0}^{\textstyle \frac{\partial O_{6}}{\partial O_{6_{in}}}} \cdot
\overbrace{(O_6 - Y_1^N)}^{\textstyle \frac{\partial L}{\partial O_{6}}} \right]
\]</div>
<p>But this can be simplified by removing the 1.0 values and grouping terms as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} = \left[ \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
<p>For completeness here is the backpropagation for the other input nodes, here‚Äôs <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{2_{in}}}\)</span>,</p>
<figure style="text-align: center;">
  <img src="../Images/9b186fef88b4e0ad1fa6191394b0e0dd.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input_I2.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative for input node 2.
</figcaption>
</figure>
<p>For brevity I have remove the 1.0s and grouped like terms,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{2_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_2} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_2} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{2_{in}}} = \left[ \lambda_{2,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{2,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
<p>and here is <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{3_{in}}}\)</span>,</p>
<figure style="text-align: center;">
  <img src="../Images/90c6a46319d78ae1b9d4f8cdc131fd2a.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input_I3.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative for input node 3.
</figcaption>
</figure>
<p>For brevity I have remove the 1.0s and grouped like terms,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{3_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_3} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_3} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{3_{in}}} = \left[ \lambda_{3,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{3,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
</section>
<section id="loss-derivatives-with-respect-to-weights-and-biases">
<h3>Loss Derivatives with Respect to Weights and Biases</h3>
<p>Now we have back propagated the loss derivative through our network.</p>
<figure style="text-align: center;">
  <img src="../Images/97de6228871f7910de4d7a8fa86e0bd8.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_all_nodes.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to all network nodes inputs and outputs.
</figcaption>
</figure>
<p>and we have the loss derivative with respect to the input and output of each node in our network,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_1},\quad
\frac{\partial \mathcal{L}}{\partial I_{2_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_2},\quad
\frac{\partial \mathcal{L}}{\partial I_{3_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_3},\quad
\frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial H_4},\quad
\frac{\partial \mathcal{L}}{\partial H_5},\quad
\frac{\partial \mathcal{L}}{\partial H_5},\quad
\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>But what we actually need is the loss derivative with respect to each connection weights,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{2,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{3,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{1,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{2,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{3,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{5,6}}
\]</div>
<p>and node biases,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_4},\quad
\frac{\partial \mathcal{L}}{\partial b_5},\quad
\frac{\partial \mathcal{L}}{\partial b_6}
\]</div>
<p>How do we backpropagate the loss derivative to a connection weight? Let‚Äôs start with the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection.</p>
<figure style="text-align: center;">
  <img src="../Images/bf1e650cd4b0613fa09aa5d5c0e72e26.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_connection_weight.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to a connection weight.
</figcaption>
</figure>
<p>Preactivation, input to node <span class="math notranslate nohighlight">\(O_6\)</span> we have,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative with respect to the connection weight as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} =
\frac{\partial \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right)}{\partial \lambda_{4,6}} = H_4
\]</div>
<p>We need the output of the node in the previous layer passed along the connection to backpropagate to the loss derivative with respect to the connection weight from the input to the next node,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_4 \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>Now, for completeness, here are the equations for all of our network‚Äôs connection weights.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{1,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_1 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{2,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{2,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_2 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{3,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{3,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_3 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{1,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_1 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{2,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{2,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_2 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{3,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{3,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_3 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_4 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{5,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{5,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_5 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<p>See the pattern, the loss derivatives with respect to connection weights are,</p>
<div class="math notranslate nohighlight">
\[
\text{Connection Signal} \times \text{Loss Derivative of Next Node Input}
\]</div>
<p>Now how do we backpropagate the loss derivative to a node bias? Let‚Äôs start with the <span class="math notranslate nohighlight">\(O_6\)</span> node.</p>
<figure style="text-align: center;">
  <img src="../Images/646997a228f8c1e8a3b2743ac13e388a.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_bias.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to a node bias.
</figcaption>
</figure>
<p>Once again, the preactivation, input to node <span class="math notranslate nohighlight">\(O_6\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative of a connection weight as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial b_6} =
\frac{\partial \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right)}{\partial b_6} = 1.0
\]</div>
<p>so our bias loss derivative is equal to the node input loss derivative,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_6} =
\frac{\partial O_{6_{\text{in}}}}{\partial b_6} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
1.0 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<p>For completeness here are all the loss derivatives with respect to node biases,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_6} = \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_4} = \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_5} = \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<p>See the pattern, the loss derivatives with respect to node biases are,</p>
<div class="math notranslate nohighlight">
\[
\text{Loss Derivative of the Node Input}
\]</div>
</section>
&#13;

<h3>Calculating the Loss Derivative</h3>
<p>Backpropagation is based on the concept of allocating or propagating the loss derivative backwards through the neural network,</p>
<ul class="simple">
<li><p>we calculate the loss derivative and then distribute it sequentially, in reverse direction, from network output back towards the network input</p></li>
<li><p>it is important to know that we are working with derivatives, and that backpropagation is NOT distributing error, although as you will see it may look that way!</p></li>
</ul>
<p>We start by defining the loss, given the truth, <span class="math notranslate nohighlight">\(ùë¶\)</span>, and our prediction, <span class="math notranslate nohighlight">\(\hat{y} = O_6\)</span>, we calculate our <span class="math notranslate nohighlight">\(L^2\)</span> loss as,</p>
<div class="math notranslate nohighlight">
\[
L = \frac{1}{2} \left( \hat{y} - y \right)^2
\]</div>
<p>our choice of loss function allows us to use the prediction error as the loss derivative! We calculate the loss derivative as the partial derivative of the loss with respect to the estimate, <span class="math notranslate nohighlight">\(\frac{\partial ùêø}{\partial \hat{y}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \hat{y}} = \frac{\partial \frac{1}{2} \left( \hat{y} - y \right)^2 }{\partial \hat{y}} = \hat{y} - y
\]</div>
<p>You see what I mean, we are backpropagating the loss derivative, but due to our formulation of the <span class="math notranslate nohighlight">\(L^2\)</span> loss, we only have to calculate the error at our output node output, but once again - it is the loss derivative.</p>
<figure style="text-align: center;">
  <img src="../Images/6abf780fa4544caa6735a8f4ad075bd2.png" style="display: block; margin: 0 auto; width: 40%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_loss.png"/>
  <figcaption style="text-align: center;"> Calculation of the loss derivative at the output of an output layer node, $O_6$.
</figcaption>
</figure>
<p>For the example of our simple artificial neural network with the output at node, <span class="math notranslate nohighlight">\(O_6\)</span>, our loss derivative is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial O_6} = \frac{\partial \mathcal{L}}{\hat{y}} = \hat{y} - y = O_6 - y
\]</div>
<p>So this is our loss derivative backpropagated to the output our output node, and we are now we are ready to backpropagate this loss derivative through our artificial neural network, let‚Äôs talk about how we step through nodes and along connections.</p>
&#13;

<h3>Backpropagation through Output Node with Identity Activation</h3>
<p>Let‚Äôs backpropagate through our output node, <span class="math notranslate nohighlight">\(O_6\)</span>, from post-activation to pre-activation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>since this is an output node with a regression artificial neural network I have selected the identity or linear activation function.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/1141c4e67c550f275e9079501fe522b2.png" style="display: block; margin: 0 auto; width: 45%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $O_6$, from $O_6$ post-activation output to $O_{6_{in}}$ pre-activation input.
</figcaption>
</figure>
<p>The identity activation at output node <span class="math notranslate nohighlight">\(O_6\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
O_6 = \sigma(O_{6_{in}}) = O_6
\]</div>
<p>The derivative of the identity activation at node <span class="math notranslate nohighlight">\(O_6\)</span> with respect to its input <span class="math notranslate nohighlight">\(O_{6_{in}}\)</span>, i.e., crossing node <span class="math notranslate nohighlight">\(O_6\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_6}{\partial O_{6_{in}}} = \frac{\partial \left(O_{6_{in}} \right)}{\partial O_{6_{in}}} = 1.0
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(O_6\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative with respect to the node output, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_6}\)</span>, and to the loss derivative with respect to the node input, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} 
= \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= 1.0 \cdot (O_6 - y)
\]</div>
<p>Now that we have backpropagated through an output node, let‚Äôs backpropagation along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from the hidden layer.</p>
&#13;

<h3>Backpropagation along Connections</h3>
<p>Now let‚Äôs backpropagate along the connection between nodes <span class="math notranslate nohighlight">\(O_6\)</span> and <span class="math notranslate nohighlight">\(H_4\)</span>.</p>
<figure style="text-align: center;">
  <img src="../Images/1c686c4b3a6fe96317a79c7333542353.png" style="display: block; margin: 0 auto; width: 50%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_weight.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through node \(O_6\), from \(O_6\) post-activation output to $O_{6_{in}}$ pre-activation input and then along the connection to the output from node \(H_4\).
</figcaption>
</figure>
<p>Preactivation, the input to node <span class="math notranslate nohighlight">\(ùëÇ_6\)</span> is calculated as,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative along the connection as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial H_4} 
= \frac{\partial}{\partial H_4} \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right) 
= \lambda_{4,6}
\]</div>
<p>by resolving the above partial derivative, we see that backpropagation along a connection by applying the connection weight.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial H_4} = \lambda_{4,6}
\]</div>
<p>Note, we just need the current connection weight <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span>. Now we can add this to our chain rule to backpropagate along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from loss derivative with respect to the output layer node input <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>, to the loss derivative with respect to the hidden layer node output <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial H_4}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial H_4} 
= \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \lambda_{4,6} \bigl( \cdot (1 - O_6) \cdot O_6 \bigr) \cdot (O_6 - y)
\]</div>
&#13;

<h3>Backpropagation through Nodes with Sigmoid Activation</h3>
<p>Let‚Äôs backpropagate through a hidden layer node, <span class="math notranslate nohighlight">\(H_4\)</span>, from postactivation to preactivation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>we are assuming sigmoid activation for all hidden layer nodes</p></li>
<li><p>for super clean logic, everyone resolves the activation derivative as a function of the output rather than as typical the input,</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/10ef488402716c36aa45b497ea54f6bb.png" style="display: block; margin: 0 auto; width: 55%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_hidden.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $H_4$, from $H_4$ postactivation output to $H_{4_{in}}$ preactivation input.
</figcaption>
</figure>
<p>The sigmoid activation at output node <span class="math notranslate nohighlight">\(H_4\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
H_4 = \sigma(H_{4_{in}}) = \frac{1}{1 + e^{-H_{4_{in}}}}
\]</div>
<p>The derivative of the sigmoid activation at node <span class="math notranslate nohighlight">\(H_4\)</span> with respect to its input <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, i.e., crossing node <span class="math notranslate nohighlight">\(H_4\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + e^{-H_{4_{in}}}} \right)
\]</div>
<p>Now, for compact notation let‚Äôs set,</p>
<div class="math notranslate nohighlight">
\[
u = e^{-H_{4_{in}}}
\]</div>
<p>and substituting we have,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + u} \right)
\]</div>
<p>and by the chain rule we can extend it to,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}}
= \frac{\partial}{\partial H_{4_{in}}} \left( \frac{1}{1 + u} \right)
= -\frac{u}{(1 + u)^2} \cdot \frac{\partial u}{\partial H_{4_{in}}}
\]</div>
<p>The derivative of <span class="math notranslate nohighlight">\(u = e^{-H_{4_{in}}}\)</span> with respect to <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span> is:</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial u}{\partial H_{4_{in}}} = -e^{-H_{4_{in}}} = -u
\]</div>
<p>now we can substitute,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{in}}} = -\frac{1}{(1+u)^2} \cdot (-u) = \frac{u}{(1+u)^2}
\]</div>
<p>Express in terms of node <span class="math notranslate nohighlight">\(H_4\)</span> output, <span class="math notranslate nohighlight">\(H_4 = \frac{1}{1 + u}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{\text{in}}}} 
= \frac{\left(1 - H_4\right)/H_4}{\left(1/H_4\right)^2} 
= \frac{1 - H_4}{H_4} \cdot H_4^2 
= \left(1 - H_4\right) \cdot H_4
\]</div>
<p>So we can backpropagate through our node, <span class="math notranslate nohighlight">\(H_4\)</span>, from node post-activation output, <span class="math notranslate nohighlight">\(H_4\)</span> to node pre-activation input, <span class="math notranslate nohighlight">\(H_{4_{in}}\)</span>, by,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_4}{\partial H_{4_{\text{in}}}} = \left(1 - H_4\right) \cdot H_4
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(H_4\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative to the output of node <span class="math notranslate nohighlight">\(H_4\)</span> and to the input of node <span class="math notranslate nohighlight">\(H_4\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} 
= \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>Now we can handle all cases of backpropagation through the nodes in our network.</p>
&#13;

<h3>Backpropagation Along Another Connection</h3>
<p>For continuity and completeness, let‚Äôs repeat the previously described method to backpropagate along the connection <span class="math notranslate nohighlight">\(I_1\)</span> to <span class="math notranslate nohighlight">\(H_4\)</span>.</p>
<figure style="text-align: center;">
  <img src="../Images/76f408b8ed852b03a168e6069bb716db.png" style="display: block; margin: 0 auto; width: 75%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_weight_input.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative along the connection from $H_4$ to $I_1$.
</figcaption>
</figure>
<p>Once again, preactivation the input to node <span class="math notranslate nohighlight">\(H_4\)</span> is calculated as,</p>
<div class="math notranslate nohighlight">
\[
H_{4_{\text{in}}} = \lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4
\]</div>
<p>We calculate the derivative along the connection as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_{4_{\text{in}}}}{\partial I_1} 
= \frac{\partial \left(\lambda_{1,4} \cdot I_1 + \lambda_{2,4} \cdot I_2 + \lambda_{3,4} \cdot I_3 + b_4 \right)}{\partial I_1} = \lambda_{1,4}
\]</div>
<p>by resolving the above partial derivative, we see that backpropagation along a connection by applying the connection weight.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial H_{4_{\text{in}}}}{\partial I_1} = \lambda_{4,6}
\]</div>
<p>Note, we just need the current connection weight <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span>. Now we can add this to our chain rule to backpropagate along the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection from loss derivative with respect to the output layer node input <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}\)</span>, to the loss derivative with respect to the hidden layer node output <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial H_4}\)</span>.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} 
= \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
&#13;

<h3>Accounting for Multiple Paths</h3>
<p>Our loss derivative with respect to the node output <span class="math notranslate nohighlight">\(I_1\)</span>, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_1}\)</span> is not correct!</p>
<ul class="simple">
<li><p>we accounted for the <span class="math notranslate nohighlight">\(O_6\)</span> to <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(I_1\)</span> path, but we did not acccount for the <span class="math notranslate nohighlight">\(O_6\)</span> to <span class="math notranslate nohighlight">\(H_5\)</span> to <span class="math notranslate nohighlight">\(I_1\)</span> path</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/6a68404e4b3d2589dcfe15beb5175c60.png" style="display: block; margin: 0 auto; width: 85%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/multiple_paths.png"/>
  <figcaption style="text-align: center;"> Multiple paths for backpropagation to input node, $I_1$, from output node $O_6$.
</figcaption>
</figure>
<p>To account for multiple paths we just need to sum over all the paths.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>we can evaluate this as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} = \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y) + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>and then simplify by removing the 1.0 values and grouping terms as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_1} = \left[ \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
&#13;

<h3>Backpropagation through Input Nodes with Identity Activation</h3>
<p>Let‚Äôs backpropagate through our input node, <span class="math notranslate nohighlight">\(I_1\)</span>, from postactivation to preactivation. To do this we need the partial derivative our activation function.</p>
<ul class="simple">
<li><p>since this is an input node I have selected the identity or linear activation function.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/bd05208edfb4ac5d5cc0f8cfe808ae50.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative through the node, $I_1$, from $I_1$ postactivation output to $I_{1_{in}}$ preactivation input.
</figcaption>
</figure>
<p>The identity activation at output node <span class="math notranslate nohighlight">\(I_1\)</span> is defined as:</p>
<div class="math notranslate nohighlight">
\[
I_1 = \sigma(I_{1_{in}}) = I_1
\]</div>
<p>The derivative of the identity activation at node <span class="math notranslate nohighlight">\(I_1\)</span> with respect to its input <span class="math notranslate nohighlight">\(I_{1_{in}}\)</span>, i.e., passing through node <span class="math notranslate nohighlight">\(I_1\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial I_1}{\partial I_{1_{in}}} = \frac{\partial \left(I_{1_{in}} \right)}{\partial I_{1_{in}}} = 1.0
\]</div>
<p>Note, we just need <span class="math notranslate nohighlight">\(I_1\)</span> the output signal from the node. Now we can add this to our chain rule to backpropagate from loss derivative with respect to the node output, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_1}\)</span>, and to the loss derivative with respect to the node input, <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{1_{\text{in}}}}\)</span>,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} 
= \frac{\partial I_1}{\partial I_{1_{in}}} \cdot \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6} + 
\frac{\partial I_1}{\partial I_{1_{in}}} \cdot \frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \cdot \frac{\partial O_6}{\partial O_{6_{\text{in}}}} \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>we can evaluate this as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} = 1.0 \cdot \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} \cdot 1.0 \cdot (O_6 - y) + 1.0 \cdot \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>For fun I designed this notation for maximum clarity,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial I_{1_{\text{in}}}} = 
\overbrace{1.0}^{\textstyle \frac{\partial I_{1}}{\partial I_{1_{in}}}} \left[
\overbrace{\lambda_{1,4}}^{\textstyle \frac{\partial H_{4_{\text{in}}}}{\partial I_1}} \cdot
\overbrace{(1 - H_4) \cdot H_4}^{\textstyle \frac{\partial H_4}{\partial H_{4_{\text{in}}}}} \cdot
\overbrace{\lambda_{4,6}}^{\textstyle \frac{\partial O_{6_{\text{in}}}}{\partial H_4}} \cdot
\overbrace{1.0}^{\textstyle \frac{\partial O_{6}}{\partial O_{6_{in}}}} \cdot
\overbrace{(O_6 - Y_1^N)}^{\textstyle \frac{\partial L}{\partial O_{6}}} + 
\overbrace{\lambda_{1,5}}^{\textstyle \frac{\partial H_{5_{\text{in}}}}{\partial I_1}} \cdot
\overbrace{(1 - H_5) \cdot H_5}^{\textstyle \frac{\partial H_5}{\partial H_{5_{\text{in}}}}} \cdot
\overbrace{\lambda_{5,6}}^{\textstyle \frac{\partial O_{6_{\text{in}}}}{\partial H_5}} \cdot
\overbrace{1.0}^{\textstyle \frac{\partial O_{6}}{\partial O_{6_{in}}}} \cdot
\overbrace{(O_6 - Y_1^N)}^{\textstyle \frac{\partial L}{\partial O_{6}}} \right]
\]</div>
<p>But this can be simplified by removing the 1.0 values and grouping terms as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_1} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{in}}} = \left[ \lambda_{1,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{1,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
<p>For completeness here is the backpropagation for the other input nodes, here‚Äôs <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{2_{in}}}\)</span>,</p>
<figure style="text-align: center;">
  <img src="../Images/9b186fef88b4e0ad1fa6191394b0e0dd.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input_I2.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative for input node 2.
</figcaption>
</figure>
<p>For brevity I have remove the 1.0s and grouped like terms,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{2_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_2} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_2} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{2_{in}}} = \left[ \lambda_{2,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{2,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
<p>and here is <span class="math notranslate nohighlight">\(\frac{\partial \mathcal{L}}{\partial I_{3_{in}}}\)</span>,</p>
<figure style="text-align: center;">
  <img src="../Images/90c6a46319d78ae1b9d4f8cdc131fd2a.png" style="display: block; margin: 0 auto; width: 87%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_node_input_I3.png"/>
  <figcaption style="text-align: center;"> Backpropagation of the loss derivative for input node 3.
</figcaption>
</figure>
<p>For brevity I have remove the 1.0s and grouped like terms,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{3_{in}}} 
= \left[ \frac{\partial H_{4_{\text{in}}}}{\partial I_3} \cdot \frac{\partial H_4}{\partial H_{4_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_4} + 
\frac{\partial H_{5_{\text{in}}}}{\partial I_3} \cdot \frac{\partial H_5}{\partial H_{5_{\text{in}}}} \cdot \frac{\partial O_{6_{\text{in}}}}{\partial H_5} \right] \cdot \frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>and now we can evaluate this simplified form as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{3_{in}}} = \left[ \lambda_{3,4} \cdot \bigl((1 - H_4) \cdot H_4 \bigr) \cdot \lambda_{4,6} + \lambda_{3,5} \cdot \bigl((1 - H_5) \cdot H_5 \bigr) \cdot \lambda_{5,6} \right] \cdot (O_6 - y)
\]</div>
&#13;

<h3>Loss Derivatives with Respect to Weights and Biases</h3>
<p>Now we have back propagated the loss derivative through our network.</p>
<figure style="text-align: center;">
  <img src="../Images/97de6228871f7910de4d7a8fa86e0bd8.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_all_nodes.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to all network nodes inputs and outputs.
</figcaption>
</figure>
<p>and we have the loss derivative with respect to the input and output of each node in our network,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial I_{1_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_1},\quad
\frac{\partial \mathcal{L}}{\partial I_{2_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_2},\quad
\frac{\partial \mathcal{L}}{\partial I_{3_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial I_3},\quad
\frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial H_4},\quad
\frac{\partial \mathcal{L}}{\partial H_5},\quad
\frac{\partial \mathcal{L}}{\partial H_5},\quad
\frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}},\quad
\frac{\partial \mathcal{L}}{\partial O_6}
\]</div>
<p>But what we actually need is the loss derivative with respect to each connection weights,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{2,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{3,4}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{1,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{2,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{3,5}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}},\quad
\frac{\partial \mathcal{L}}{\partial \lambda_{5,6}}
\]</div>
<p>and node biases,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_4},\quad
\frac{\partial \mathcal{L}}{\partial b_5},\quad
\frac{\partial \mathcal{L}}{\partial b_6}
\]</div>
<p>How do we backpropagate the loss derivative to a connection weight? Let‚Äôs start with the <span class="math notranslate nohighlight">\(H_4\)</span> to <span class="math notranslate nohighlight">\(O_6\)</span> connection.</p>
<figure style="text-align: center;">
  <img src="../Images/bf1e650cd4b0613fa09aa5d5c0e72e26.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_connection_weight.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to a connection weight.
</figcaption>
</figure>
<p>Preactivation, input to node <span class="math notranslate nohighlight">\(O_6\)</span> we have,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative with respect to the connection weight as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} =
\frac{\partial \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right)}{\partial \lambda_{4,6}} = H_4
\]</div>
<p>We need the output of the node in the previous layer passed along the connection to backpropagate to the loss derivative with respect to the connection weight from the input to the next node,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_4 \cdot 1.0 \cdot (O_6 - y)
\]</div>
<p>Now, for completeness, here are the equations for all of our network‚Äôs connection weights.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{1,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_1 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{2,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{2,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_2 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{3,4}} =
\frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{3,4}} \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}} =
I_3 \cdot \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{1,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{1,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_1 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{2,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{2,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_2 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{3,5}} =
\frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{3,5}} \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}} =
I_3 \cdot \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{4,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_4 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial \lambda_{5,6}} =
\frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{5,6}} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
H_5 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<p>See the pattern, the loss derivatives with respect to connection weights are,</p>
<div class="math notranslate nohighlight">
\[
\text{Connection Signal} \times \text{Loss Derivative of Next Node Input}
\]</div>
<p>Now how do we backpropagate the loss derivative to a node bias? Let‚Äôs start with the <span class="math notranslate nohighlight">\(O_6\)</span> node.</p>
<figure style="text-align: center;">
  <img src="../Images/646997a228f8c1e8a3b2743ac13e388a.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/back_bias.png"/>
  <figcaption style="text-align: center;"> Backpropagated loss derivatives with respect to a node bias.
</figcaption>
</figure>
<p>Once again, the preactivation, input to node <span class="math notranslate nohighlight">\(O_6\)</span> is,</p>
<div class="math notranslate nohighlight">
\[
O_{6_{\text{in}}} = \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6
\]</div>
<p>We calculate the derivative of a connection weight as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial O_{6_{\text{in}}}}{\partial b_6} =
\frac{\partial \left( \lambda_{4,6} \cdot H_4 + \lambda_{5,6} \cdot H_5 + b_6 \right)}{\partial b_6} = 1.0
\]</div>
<p>so our bias loss derivative is equal to the node input loss derivative,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_6} =
\frac{\partial O_{6_{\text{in}}}}{\partial b_6} \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}} =
1.0 \cdot \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<p>For completeness here are all the loss derivatives with respect to node biases,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_6} = \frac{\partial \mathcal{L}}{\partial O_{6_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_4} = \frac{\partial \mathcal{L}}{\partial H_{4_{\text{in}}}}
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial \mathcal{L}}{\partial b_5} = \frac{\partial \mathcal{L}}{\partial H_{5_{\text{in}}}}
\]</div>
<p>See the pattern, the loss derivatives with respect to node biases are,</p>
<div class="math notranslate nohighlight">
\[
\text{Loss Derivative of the Node Input}
\]</div>
&#13;

<h2>Backpropagation Example</h2>
<p>Let‚Äôs take the backpropagation method explained above and apply them to my interactive neural network.</p>
<ul class="simple">
<li><p>Here‚Äôs the result for our first training epoch with only 1 sample,</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/b8b7d56b334d9728490cb2bc1408535e.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/backpropagate_node.png"/>
  <figcaption style="text-align: center;"> Backpropagation result for the first iteration.
</figcaption>
</figure>
<p>My interactive dashboard provides all the loss derivatives with respect to the input for each node and the output signals from each node, so for example we can calculate <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial \lambda_{4,6}}\)</span> as,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{4,6}} = \frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{4,6}} \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = H_4 \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = 0.42 \cdot 1.00 = 0.42
\]</div>
<p>Here‚Äôs the loss derivatives with respect to connection weights for the other hidden layer to output node connection,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{5,6}} = \frac{\partial O_{6_{\text{in}}}}{\partial \lambda_{5,6}} \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = H_5 \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = 0.60 \cdot 1.00 = 0.60
\]</div>
<p>and now let‚Äôs get all the input to hidden layer connections,</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{1,4}} = \frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{1,4}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_1 \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 0.50 \cdot (-0.13) = -0.07
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{1,5}} = \frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{1,5}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_1 \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 0.50 \cdot (-0.10) = -0.05
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{2,4}} = \frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{2,4}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_2 \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 0.20 \cdot (-0.13) = -0.03
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{2,5}} = \frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{2,5}} \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = I_2 \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 0.20 \cdot (-0.10) = -0.02
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{3,4}} = \frac{\partial H_{4_{\text{in}}}}{\partial \lambda_{3,4}} \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = I_3 \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 0.70 \cdot (-0.13) = -0.09
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{3,5}} = \frac{\partial H_{5_{\text{in}}}}{\partial \lambda_{3,5}} \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = I_3 \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 0.70 \cdot (-0.10) = -0.07
\]</div>
<p>This takes care of all of the connection weight error derivatives, now lets take care of the node bias error derivatives.</p>
<ul class="simple">
<li><p>the node bias error derivatives are the same as the node peractivation error derivatives. Now let‚Äôs calculate the bias terms in the hidden layer,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial b_4} =  \frac{\partial H_{4_{\text{in}}}}{\partial b_4}  \cdot \frac{\partial L}{\partial H_{4_{\text{in}}}} = 1.0 \cdot (-0.13) = -0.13
\]</div>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial b_5} =  \frac{\partial H_{5_{\text{in}}}}{\partial b_5}  \cdot \frac{\partial L}{\partial H_{5_{\text{in}}}} = 1.0 \cdot (-0.1) = -0.10
\]</div>
&#13;

<h2>Updating Model Parameters</h2>
<p>The loss derivatives with respect to each of the model parameters are the gradients, so we are ready to use gradient descent optimization with the addition of,</p>
<ul class="simple">
<li><p><strong>learning rate</strong> -  to scale the rate of change of the model updates we assign a learning rate, <span class="math notranslate nohighlight">\(\eta\)</span>. For our model parameter examples from above,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
<div class="math notranslate nohighlight">
\[
\lambda_{1,4}^{\ell} = \lambda_{1,4}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{1,4}}
\]</div>
<div class="math notranslate nohighlight">
\[
b_j^{\ell} = b_j^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial b_j}
\]</div>
<ul class="simple">
<li><p>recall, this process of gradient calculation and model parameters, weights and biases, updating is iterated and is known as gradient descent optimization.</p></li>
<li><p>the goal is to explore the loss hypersurface, avoiding and escaping local minimums and ultimately finding the global minimum.</p></li>
<li><p>learning rate, also known as step size is commonly set between 0.0 and 1.0, note 0.01 is the default in Keras module of TensorFlow</p></li>
<li><p><strong>Low Learning Rate</strong> ‚Äì more stable, but a slower solution, may get stuck in a local minimum</p></li>
<li><p><strong>High Learning Rate</strong> ‚Äì may be unstable, but perhaps a faster solution, may diverge out of the global minimum</p></li>
</ul>
<p>One strategy is to start with a high learning rate and then to decrease the learning rate over the iterations</p>
<ul class="simple">
<li><p><strong>Learning Rate Decay</strong> - set as &gt; 0 to avoid mitigate oscillations,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\eta^{\ell} = \eta^{\ell - 1} \cdot \left( \frac{1}{1 + \text{decay} \cdot \ell} \right)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\ell\)</span> is the model training epoch</p>
<p>Notice that the model parameter updates are for a single training data case? Consider this single model parameter,</p>
<p>we calculate the update over all samples in the batch and apply the average of the updates.</p>
<div class="math notranslate nohighlight">
\[
\frac{\partial L}{\partial \lambda_{4,6}} = H_4 \cdot \frac{\partial L}{\partial O_{6_{\text{in}}}} = 0.42 \cdot 1.00 = 0.42
\]</div>
<p>is applied to update the <span class="math notranslate nohighlight">\(\lambda_{4,6}\)</span> parameter as,</p>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \eta \cdot \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
<p>is dependent on <span class="math notranslate nohighlight">\(H_4\)</span> node output, and <span class="math notranslate nohighlight">\(L\)</span> error that are for a single sample, <span class="math notranslate nohighlight">\(ùë•_1,\ldots,ùë•_ùëö\)</span> and <span class="math notranslate nohighlight">\(ùë¶\)</span>; therefore, we cannot calculate a single parameter update over all our <span class="math notranslate nohighlight">\(1,\ldots,n\)</span> training data samples.</p>
<ul class="simple">
<li><p>instead we can calculate <span class="math notranslate nohighlight">\(1,\ldots,n\)</span> updates and then apply the average of all the updates to our model parameters,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \frac{1}{n_{batch}} \sum_{i=1}^{n_{batch}} \eta \cdot \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
<ul class="simple">
<li><p>since the learning rate is a constant, we can move it out of the sum and now we are averaging the gradients,</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\lambda_{4,6}^{\ell} = \lambda_{4,6}^{\ell - 1} + \eta \frac{1}{n_{batch}} \sum_{i=1}^{n_{batch}} \frac{\partial L}{\partial \lambda_{4,6}}
\]</div>
&#13;

<h2>Training Epochs</h2>
<p>This is a good time to talk about stochastic gradient descent optimization, first let‚Äôs define some common terms,</p>
<ul class="simple">
<li><p><strong>Batch Gradient Descent</strong> - updates the model parameters after passing through all of the data</p></li>
<li><p><strong>Stochastic Gradient Descent</strong> - updates the model parameters over each sample data</p></li>
<li><p><strong>Mini-batch Gradient Descent</strong> - updates the model parameter after passing through a single batch</p></li>
</ul>
<p>With mini-batch gradient descent stochasticity is introduced through the use of subsets of the data, known as batches,</p>
<ul class="simple">
<li><p>for example, if we divide our 100 samples into 4 batches, then we iterate over each batch separately</p></li>
<li><p>we speed up the individual updates, fewer data are faster to calculate, but we introduce more error</p></li>
<li><p>this often helps the training explore for the global minimum and avoid getting stuck in local minimums and along ridges in the loss hypersurface</p></li>
</ul>
<p>Finally our last definition here,</p>
<ul class="simple">
<li><p><strong>epoch</strong> - is one pass over all of the data, so that would be 4 iterations of updating the model parameters if we have 4 mini-batches</p></li>
</ul>
<p>There are many other considerations that I will add later including,</p>
<ul class="simple">
<li><p>momentum</p></li>
<li><p>adaptive optimization</p></li>
</ul>
<p>Now let‚Äôs build the above artificial neural network by-hand and visualize the solution!</p>
<ul class="simple">
<li><p>this is by-hand so that you can see every calculation. I intentionally avoided using TensorFlow or PyTorch.</p></li>
</ul>
&#13;

<h2>Interactive Dashboard</h2>
<p>I built out an interactive Python dashboard with the code below for training an artificial neural network. You can step through the training iteration and observe over the training epochs,</p>
<ul class="simple">
<li><p>model parameters</p></li>
<li><p>forward pass predictions</p></li>
<li><p>backpropagation of error derivatives</p></li>
</ul>
<p>If you would like to see artificial neural networks in action, check out my <a class="reference external" href="https://github.com/GeostatsGuy/DataScienceInteractivePython/blob/main/Interactive_ANN.ipynb">ANN interactive Python dashboard</a>,</p>
<figure style="text-align: center;">
  <img src="../Images/ab7e3b58fcfdbf8f7a2c19b5d78c7736.png" style="display: block; margin: 0 auto; width: 90%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/ANN/interactive_ann.png"/>
  <figcaption style="text-align: center;"> Interactive artificial neural network training Python dashboard.
</figcaption>
</figure> 
&#13;

<h2>Import Required Packages</h2>
<p>We will also need some standard packages. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span><span class="p">,</span> <span class="n">AutoLocator</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                            <span class="c1"># set axes and grids in the background for all plots</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">13</span>
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‚Äòpython -m pip install [package-name]‚Äô. More assistance is available with the respective package docs.</p>
&#13;

<h2>Declare Functions</h2>
<p>Here‚Äôs the functions to make, train and visualize our artificial neural network.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks   </span>

<span class="k">def</span> <span class="nf">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>     <span class="c1"># Calculate the differences</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>    <span class="c1"># Calculate the angle in radians</span>
    <span class="c1">#angle_degrees = math.degrees(angle_radians)    # Convert the angle to degrees</span>
    <span class="k">return</span> <span class="n">angle_rads</span>
    
<span class="k">def</span> <span class="nf">offset</span><span class="p">(</span><span class="n">pto</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">pto</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">pto</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offsetx</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xo</span><span class="p">,</span> <span class="n">x_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offset_arrx</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">,</span><span class="n">size</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">x_new</span> <span class="o">=</span> <span class="n">xo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">x_arr</span> <span class="o">=</span> <span class="n">x_new</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x_new</span><span class="p">,</span> <span class="n">x_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offsety</span><span class="p">(</span><span class="n">yo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">yo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">yo</span><span class="p">,</span> <span class="n">y_new</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">offset_arry</span><span class="p">(</span><span class="n">yo</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">angle_deg</span><span class="p">,</span><span class="n">size</span><span class="p">):</span> <span class="c1"># modified from ChatGPT 4.o generated</span>
    <span class="n">angle_rads</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle_deg</span><span class="p">)</span> <span class="c1"># Convert angle from degrees to radians</span>
    <span class="n">y_new</span> <span class="o">=</span> <span class="n">yo</span> <span class="o">+</span> <span class="n">distance</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="n">y_arr</span> <span class="o">=</span> <span class="n">y_new</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">y_new</span><span class="p">,</span> <span class="n">y_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lintx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">linty</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">lint_intx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xs</span><span class="p">,</span><span class="n">xe</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_inty</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">ts</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">ys</span><span class="p">,</span><span class="n">ye</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_int_arrx</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>
    <span class="n">line_angle_rads</span> <span class="o">=</span> <span class="n">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">x_arr</span> <span class="o">=</span> <span class="n">xe</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">line_angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">xe</span><span class="p">,</span><span class="n">x_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">lint_int_arry</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">ts</span><span class="p">,</span> <span class="n">te</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
    <span class="c1"># Calculate the interpolated coordinates</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">+</span> <span class="n">te</span> <span class="o">*</span> <span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">)</span>
    <span class="n">line_angle_rads</span> <span class="o">=</span> <span class="n">calculate_angle_rads</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
    <span class="n">y_arr</span> <span class="o">=</span> <span class="n">ye</span> <span class="o">+</span> <span class="n">size</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">line_angle_rads</span><span class="o">+</span><span class="mf">2.48</span><span class="p">)</span> <span class="c1"># Calculate the new coordinates</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">ye</span><span class="p">,</span><span class="n">y_arr</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">as_si</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ndp</span><span class="p">):</span> <span class="c1"># from xnx on StackOverflow https://stackoverflow.com/questions/31453422/displaying-numbers-with-x-instead-of-e-scientific-notation-in-matplotlib </span>
    <span class="n">s</span> <span class="o">=</span> <span class="s1">'{x:0.</span><span class="si">{ndp:d}</span><span class="s1">e}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">ndp</span><span class="o">=</span><span class="n">ndp</span><span class="p">)</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'e'</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s1">'</span><span class="si">{m:s}</span><span class="s1">\times 10^{{</span><span class="si">{e:d}</span><span class="s1">}}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">e</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>The Simple ANN</h2>
<p>I wrote this code to specify a simple ANN:</p>
<ul class="simple">
<li><p>three input nodes, 2 hidden nodes and 1 output node</p></li>
</ul>
<p>and to train the ANN by iteratively performing the forward calculation and backpropagation. I calculate:</p>
<ul class="simple">
<li><p>the error and then propagate it to each node</p></li>
<li><p>solve for the partial derivatives of the error with respect to each weight and bias</p></li>
</ul>
<p>all weights, biases and partial derivatives for all epoch are recorded in vectors for plotting</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">x1</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span> <span class="n">x2</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">;</span> <span class="n">x3</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">;</span> <span class="n">y</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="c1"># training data</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="c1"># learning rate</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

<span class="n">nepoch</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">y4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">w14</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w24</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w34</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">w15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w35</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">w46</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">w56</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">dw14</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw24</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw34</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dw15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw35</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">dw46</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">dw56</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">db4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">db5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">db6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="n">b4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">b5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">b6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">y4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">y6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>
<span class="n">d4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">);</span> <span class="n">d6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nepoch</span><span class="p">)</span>

<span class="c1"># initialize the weights - Xavier Weight Initialization </span>
<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="p">))</span> <span class="c1"># lower and upper bound for the weights, uses inputs to node</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(3.0 + 2.0)), (sqrt(6.0) / sqrt(3.0 + 2.0)) # Normalized Xavier weights, integrates ouputs also</span>
<span class="n">w14</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w24</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w34</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>
<span class="n">w15</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w25</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w35</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>

<span class="n">lower</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)),</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span>
<span class="c1">#lower, upper = -(sqrt(6.0) / sqrt(2.0 + 1.0)), (sqrt(6.0) / sqrt(2.0 + 1.0)) # Normalized Xavier weights, integrates ouputs also</span>

<span class="n">w46</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span> 
<span class="n">w56</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="n">lower</span><span class="p">);</span>     

<span class="c1">#b4[0] = np.random.random(); b5[0] = np.random.random(); b6[0] = np.random.random()</span>
<span class="n">b4</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="n">b5</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="n">b6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">;</span> <span class="c1"># small random value    </span>


<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nepoch</span><span class="p">):</span>

<span class="c1"># forward pass of model</span>
    <span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w14</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w24</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">b4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> 
    <span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    
    <span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w15</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="n">w25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="n">w35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="n">b5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    
    <span class="n">y6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">b6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="c1">#    y6[i] = 1.0/(1 + math.exp(-1*y6[i])) # sgimoid / logistic activation at o6 </span>

<span class="c1"># back propagate the error through the nodes</span>
<span class="c1">#    d6[i] = y6[i]*(1-y6[i])*(y-y6[i]) # sgimoid / logistic activation at o6 </span>
    <span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">y6</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># identity activation o at o6</span>
    <span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

<span class="c1"># calculate the change in weights</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nepoch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dw14</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span><span class="p">;</span> <span class="n">dw24</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span><span class="p">;</span> <span class="n">dw34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span>
        <span class="n">dw15</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x1</span><span class="p">;</span> <span class="n">dw25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x2</span><span class="p">;</span> <span class="n">dw35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x3</span>
        <span class="n">dw46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">dw56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">y5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        
        <span class="n">db4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">db5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d5</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">db6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lr</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

        <span class="n">w14</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w14</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw14</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w24</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w24</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw24</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w34</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw34</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">w15</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w15</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw15</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w25</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w25</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw25</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w35</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw35</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w46</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw46</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">dw56</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">b4</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">db4</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">b5</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">db5</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">b6</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">b6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">db6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Now Visualize the Network for a Specific Epoch</h2>
<p>I wrote a custom network visualization below, select iepoch and visualize the artificial neural network for a specific epoch.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">iepoch</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">dx</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.19</span><span class="p">;</span> <span class="n">dy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.09</span><span class="p">;</span> <span class="n">edge</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">o6x</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span> <span class="n">o6y</span> <span class="o">=</span><span class="mi">5</span><span class="p">;</span> <span class="n">h5x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">h5y</span> <span class="o">=</span> <span class="mf">3.5</span><span class="p">;</span> <span class="n">h4x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">h4y</span> <span class="o">=</span> <span class="mf">6.5</span>
<span class="n">i1x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i1y</span> <span class="o">=</span> <span class="mf">9.0</span><span class="p">;</span> <span class="n">i2x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i2y</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">i3x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="n">i3y</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="n">buffer</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_axis_off</span><span class="p">()</span>

<span class="n">circle_i1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">' $I_1$'</span><span class="p">,(</span><span class="n">i1x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">i1y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_i1b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i1b</span><span class="p">)</span>

<span class="n">circle_i2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">' $I_2$'</span><span class="p">,(</span><span class="n">i2x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">i2y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_i2b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i2b</span><span class="p">)</span>

<span class="n">circle_i3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">' $I_3$'</span><span class="p">,(</span><span class="n">i3x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">i3y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_i3b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_i3b</span><span class="p">)</span>

<span class="n">circle_h4</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_4$'</span><span class="p">,(</span><span class="n">h4x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">h4y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_h4b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h4</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h4b</span><span class="p">)</span>

<span class="n">circle_h5</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_5$'</span><span class="p">,(</span><span class="n">h5x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">h5y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_h5b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_h5b</span><span class="p">)</span>

<span class="n">circle_o6</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">),</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$O_6$'</span><span class="p">,(</span><span class="n">o6x</span><span class="o">+</span><span class="n">dx</span><span class="p">,</span><span class="n">o6y</span><span class="o">+</span><span class="n">dy</span><span class="p">),</span><span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span> 
<span class="n">circle_o6b</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">),</span> <span class="mf">0.40</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">facecolor</span> <span class="o">=</span> <span class="s1">'white'</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_o6</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">circle_o6b</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i1x</span><span class="o">-</span><span class="n">edge</span><span class="p">,</span><span class="n">i1x</span><span class="p">],[</span><span class="n">i1y</span><span class="p">,</span><span class="n">i1y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i2x</span><span class="o">-</span><span class="n">edge</span><span class="p">,</span><span class="n">i2x</span><span class="p">],[</span><span class="n">i2y</span><span class="p">,</span><span class="n">i2y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i3x</span><span class="o">-</span><span class="n">edge</span><span class="p">,</span><span class="n">i3x</span><span class="p">],[</span><span class="n">i3y</span><span class="p">,</span><span class="n">i3y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$x_1$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">i1x</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span><span class="n">i1y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$x_2$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">i2x</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span><span class="n">i2y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$x_3$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">i3x</span><span class="o">-</span><span class="n">buffer</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span><span class="n">i3y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i1x</span><span class="p">,</span><span class="n">h4x</span><span class="p">],[</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i2x</span><span class="p">,</span><span class="n">h4x</span><span class="p">],[</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i3x</span><span class="p">,</span><span class="n">h4x</span><span class="p">],[</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i1x</span><span class="p">,</span><span class="n">h5x</span><span class="p">],[</span><span class="n">i1y</span><span class="p">,</span><span class="n">h5y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i2x</span><span class="p">,</span><span class="n">h5x</span><span class="p">],[</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">i3x</span><span class="p">,</span><span class="n">h5x</span><span class="p">],[</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h4x</span><span class="p">,</span><span class="n">o6x</span><span class="p">],[</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">h5x</span><span class="p">,</span><span class="n">o6x</span><span class="p">],[</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">o6x</span><span class="o">+</span><span class="n">edge</span><span class="p">,</span><span class="n">o6x</span><span class="p">],[</span><span class="n">o6y</span><span class="p">,</span><span class="n">o6y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">o6x</span><span class="o">+</span><span class="n">buffer</span><span class="o">+</span><span class="mf">0.7</span><span class="p">,</span><span class="n">o6y</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'grey'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">h4y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">h4y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_</span><span class="si">{4}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y4</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">)</span><span class="o">-</span><span class="mf">0.0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">h5y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">h5y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$H_</span><span class="si">{5}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y5</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.07</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.07</span><span class="p">)</span><span class="o">+</span><span class="mf">0.25</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial O_{6_</span><span class="si">{in}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">o6x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">o6y</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{4_</span><span class="si">{in}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d4</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h4x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">h4y</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{5_</span><span class="si">{in}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d5</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h5x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">h5y</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \hat</span><span class="si">{y}</span><span class="s1">}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="o">-</span><span class="mf">1.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{4_</span><span class="si">{out}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w46</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="o">-</span><span class="mf">1.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial H_{5_</span><span class="si">{out}</span><span class="s1">}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w56</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">*</span><span class="n">d6</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="o">-</span><span class="mf">1.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span> <span class="n">o6x</span><span class="p">,</span> <span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{4,6}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dw46</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">4</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.72</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">11</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span> <span class="n">o6x</span><span class="p">,</span> <span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{5,6}}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">dw56</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">4</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">o6x</span><span class="p">,</span><span class="n">o6y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">i1y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">i1y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$I_</span><span class="si">{1}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">i2y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">i2y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$I_</span><span class="si">{2}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">),</span><span class="n">linty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.22</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offsetx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">),</span><span class="n">offsety</span><span class="p">(</span><span class="n">i3y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">offset_arrx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">offset_arry</span><span class="p">(</span><span class="n">i3y</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">38</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$I_</span><span class="si">{3}</span><span class="s1">$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">)</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.08</span><span class="p">)</span><span class="o">+</span><span class="mf">0.2</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{1,4}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w14</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i1x</span><span class="o">+</span><span class="n">h4x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.45</span><span class="p">,(</span><span class="n">i1y</span><span class="o">+</span><span class="n">h4y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">18</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{2,4}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w24</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i2x</span><span class="o">+</span><span class="n">h4x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.45</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,(</span><span class="n">i2y</span><span class="o">+</span><span class="n">h4y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.03</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{3,4}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w34</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i3x</span><span class="o">+</span><span class="n">h4x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.45</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,(</span><span class="n">i3y</span><span class="o">+</span><span class="n">h4y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">1.1</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{1,5}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w15</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i1x</span><span class="o">+</span><span class="n">h5x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.55</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,(</span><span class="n">i1y</span><span class="o">+</span><span class="n">h5y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.9</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">36</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{2,5}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w25</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i2x</span><span class="o">+</span><span class="n">h5x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.55</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,(</span><span class="n">i2y</span><span class="o">+</span><span class="n">h5y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.05</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{3,5}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w35</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">i3x</span><span class="o">+</span><span class="n">h5x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.55</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,(</span><span class="n">i3y</span><span class="o">+</span><span class="n">h5y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="mf">0.1</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span>
             <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{4,6}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w46</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">h4x</span><span class="o">+</span><span class="n">o6x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="p">,(</span><span class="n">h4y</span><span class="o">+</span><span class="n">o6y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="o">+</span><span class="mf">0.39</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\lambda_{5,6}$ = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w56</span><span class="p">[</span><span class="n">iepoch</span><span class="p">],</span><span class="mi">2</span><span class="p">)),((</span><span class="n">h5x</span><span class="o">+</span><span class="n">o6x</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="p">,(</span><span class="n">h5y</span><span class="o">+</span><span class="n">o6y</span><span class="p">)</span><span class="o">*</span><span class="mf">0.47</span><span class="o">+</span><span class="mf">0.26</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span> <span class="n">i1y</span><span class="p">,</span> <span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{1,4}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw14</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span> <span class="n">i2y</span><span class="p">,</span> <span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{2,4}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw24</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.05</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span> <span class="n">i3y</span><span class="p">,</span> <span class="n">h4x</span><span class="p">,</span> <span class="n">h4y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{3,4}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw34</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.7</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.7</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">38</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span> <span class="n">i3y</span><span class="p">,</span> <span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="mf">0.4</span><span class="p">,</span><span class="mf">0.6</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{3,5}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw35</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i3x</span><span class="p">,</span><span class="n">i3y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.6</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span> <span class="n">i2y</span><span class="p">,</span> <span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{2,5}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw25</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.2</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i2x</span><span class="p">,</span><span class="n">i2y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">0.65</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">12</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_intx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span> <span class="n">i1y</span><span class="p">,</span> <span class="n">h5x</span><span class="p">,</span> <span class="n">h5y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">),</span><span class="n">lint_inty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lint_int_arrx</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">),</span><span class="n">lint_int_arry</span><span class="p">(</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.2</span><span class="p">)</span><span class="o">-</span><span class="mf">0.12</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\frac{\partial P}{\partial \lambda_{1,5}} =$'</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">'$</span><span class="si">{0:s}</span><span class="s1">$'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">as_si</span><span class="p">(</span><span class="n">dw15</span><span class="p">[</span><span class="n">iepoch</span><span class="p">]</span><span class="o">/</span><span class="n">lr</span><span class="p">,</span><span class="mi">2</span><span class="p">)),(</span><span class="n">lintx</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h5x</span><span class="p">,</span><span class="n">h5y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">2.2</span><span class="p">,</span><span class="n">linty</span><span class="p">(</span><span class="n">i1x</span><span class="p">,</span><span class="n">i1y</span><span class="p">,</span><span class="n">h4x</span><span class="p">,</span><span class="n">h4y</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span><span class="o">-</span><span class="mf">1.5</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span>
              <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">"round,pad=0.0"</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">),</span><span class="n">rotation</span><span class="o">=-</span><span class="mi">36</span><span class="p">,</span><span class="n">xycoords</span> <span class="o">=</span> <span class="s1">'data'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f1c2dc9fc05ec8a3d07b5642c59c42dd91a2b2ed35c547faa409371a1e776270.png" src="../Images/6c1b34f06ebf3ebfafbbd206fc1033ca.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/f1c2dc9fc05ec8a3d07b5642c59c42dd91a2b2ed35c547faa409371a1e776270.png"/>
</div>
</div>
&#13;

<h2>Check the ANN Convergence</h2>
<p>Now we plot the weights, biases and prediction over the epochs to check the training convergence.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">y6</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epochs'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Simple Artificial Neural Network Prediction'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w14</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightcoral'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{1,4}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w24</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{2,4}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w34</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkred'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{3,4}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w15</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'dodgerblue'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{1,5}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{2,5}$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w35</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkblue'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{3,5}$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w46</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{4,6}$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w56</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\lambda_{5,6}$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epochs'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Simple Artificial Neural Network Weights'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w14</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'lightgreen'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\phi_</span><span class="si">{4}</span><span class="s1">$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w24</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\phi_</span><span class="si">{5}</span><span class="s1">$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">w34</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkgreen'</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\phi_</span><span class="si">{6}</span><span class="s1">$'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">nepoch</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Epochs'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\hat</span><span class="si">{y}</span><span class="s1">$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Simple Artificial Neural Network Biases'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/96a2f9a7007123700054af340b223a0c9017cbf262afe43f97c8f1b445ec44a6.png" src="../Images/41e5da630bdb6e70068ef584a2fc3d47.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/96a2f9a7007123700054af340b223a0c9017cbf262afe43f97c8f1b445ec44a6.png"/>
</div>
</div>
&#13;

<h2>Comments</h2>
<p>This was a basic treatment of artificial neural networks. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos‚Äô descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
&#13;

<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael‚Äôs university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael‚Äôs work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
&#13;

<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I‚Äôd be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I‚Äôm always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
    
</body>
</html>