<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Machine Learning Python Code Snippets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Machine Learning Python Code Snippets</h1>
<blockquote>原文：<a href="https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_python.html">https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_python.html</a></blockquote>

<p>Michael J. Pyrcz, Professor, The University of Texas at Austin</p>
<p><a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
<p>Chapter of e-book “Applied Machine Learning in Python: a Hands-on Guide with Code”.</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite this e-Book as:</p>
<p>Pyrcz, M.J., 2024, <em>Applied Machine Learning in Python: A Hands-on Guide with Code</em> [e-book]. Zenodo. doi:10.5281/zenodo.15169138 <a class="reference external" href="https://doi.org/10.5281/zenodo.15169138"><img alt="DOI" src="../Images/7e4ea662f44af1eae87e87ecbb962ff4.png" data-original-src="https://zenodo.org/badge/863274676.svg"/></a></p>
</div>
<p>The workflows in this book and more are available here:</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite the MachineLearningDemos GitHub Repository as:</p>
<p>Pyrcz, M.J., 2024, <em>MachineLearningDemos: Python Machine Learning Demonstration Workflows Repository</em> (0.0.3) [Software]. Zenodo. DOI: 10.5281/zenodo.13835312. GitHub repository: <a class="github reference external" href="https://github.com/GeostatsGuy/MachineLearningDemos">GeostatsGuy/MachineLearningDemos</a> <a class="reference external" href="https://zenodo.org/doi/10.5281/zenodo.13835312"><img alt="DOI" src="../Images/4e3a59c17d684b06a170c4af84e0f631.png" data-original-src="https://zenodo.org/badge/862519860.svg"/></a></p>
</div>
<p>By Michael J. Pyrcz <br/>
© Copyright 2024.</p>
<p>This chapter is a set of <strong>Machine Learning Python Code Snippets</strong> to help folks build machine learning workflows in Python.</p>
<p><strong>YouTube Lecture</strong>: check out my live code walk-throughs in my data science basics in Python playlist:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://youtube.com/playlist?list=PLG19vXLQHvSAufDFgZEFAYQEwMJXklnQV&amp;si=z9BF45XAod6brI8Z">Data Science Basics in Python Playlist</a></p></li>
</ul>
<p>These walkthrough support of my courses,</p>
<ul class="simple">
<li><p><a class="reference external" href="https://youtube.com/playlist?list=PLG19vXLQHvSC2ZKFIkgVpI9fCjkN38kwf&amp;si=XonjO2wHdXffMpeI">Machine Learning Course</a></p></li>
<li><p><a class="reference external" href="https://youtube.com/playlist?list=PLG19vXLQHvSB-D4XKYieEku9GQMQyAzjJ&amp;si=XobEAdz3ntDdp870">Data Analytics and Geostatistics Course</a></p></li>
</ul>
<p>on YouTube with linked well-documented Python workflows and interactive dashboards. My goal is to share accessible, actionable, and repeatable educational content. If you want to know about my motivation, check out <a class="reference external" href="https://michaelpyrcz.com/my-story">Michael’s Story</a>.</p>
<section id="motivation">
<h2>Motivation</h2>
<p>I taught a high school hackathon with great students from all over Texas and beyond and I felt that they could use some additional resources in the form of a <strong>code snippets</strong> to help them over the hurdles of completing their first data science workflow in Python.</p>
<p>Remember the definition of a code snippet is,</p>
<ul class="simple">
<li><p>a small, reusable section of code that programmers can quickly insert into a larger codebase</p></li>
</ul>
<p>My goal is to,</p>
<ul class="simple">
<li><p><strong>provide a set of minimum, simple code snippets</strong> to accomplish basic data science modeling build steps</p></li>
<li><p><strong>avoid fancy additions</strong>, like automatic diagnostics and plotting that are specific to the problem setting that will break with new data</p></li>
</ul>
<p>Therefore, improvements and additions to provide diagnostic outputs and plots are highly recommended.</p>
</section>
<section id="structure">
<h2>Structure</h2>
<div class="remove-from-content-only admonition">
<p class="admonition-title">This is not a workflow!</p>
<p>These are alphabetically ordered code snippets and not a complete workflow. Please do not attempt to run this chapter in sequence.</p>
</div>
<p>In order to run the snippets we need to first,</p>
<ol class="arabic simple">
<li><p>Import some python packages</p></li>
<li><p>Declare a couple of convenience functions</p></li>
<li><p>Load some data to demonstrate the code snippets</p></li>
</ol>
<p>After we load the data the remaining codes with be in alphabetical and not any logical workflow order for ease of search and retrieval.</p>
</section>
<section id="import-required-packages">
<h2>Import Required Packages</h2>
<p>We need some standard packages. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                                            <span class="c1"># arrays</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                                           <span class="c1"># dataframes</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>                               <span class="c1"># plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span><span class="p">,</span> <span class="n">AutoLocator</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span> <span class="c1"># variance inflation factor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>                      <span class="c1"># basic imputation method</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>     <span class="c1"># required for MICE imputation</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>                   <span class="c1"># MICE imputation</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>                         <span class="c1"># k-nearest neighbour imputation method</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>          <span class="c1"># train and test split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>             <span class="c1"># linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>              <span class="c1"># standardize the features</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>                <span class="c1"># min and max normalization</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">KBinsDiscretizer</span>            <span class="c1"># k-bin discretizer</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>             <span class="c1"># K-nearest neighbours</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>            <span class="c1"># random forest method</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">mutual_info_regression</span>  <span class="c1"># mutual information</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>               <span class="c1"># mean absolute error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">normalized_mutual_info_score</span>      <span class="c1"># normalized mutual information</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>                                      <span class="c1"># decision tree</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>                <span class="c1"># regression tree</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">plot_tree</span>                            <span class="c1"># plot the decision tree</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>                                   <span class="c1"># measures to check our models</span>
<span class="kn">import</span> <span class="nn">shap</span>                                                   <span class="c1"># Shapley values for feature ranking</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                <span class="c1"># set axes and grids in the background for all plots</span>
<span class="kn">import</span> <span class="nn">math</span>                                                  
<span class="n">seed</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>                                         <span class="c1"># a good colormap for folks with color perception issues</span>
<span class="n">utcolor</span> <span class="o">=</span> <span class="s1">'#BF5700'</span>                                           <span class="c1"># burnt orange, Hook'em!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‘python -m pip install [package-name]’. More assistance is available with the respective package docs.</p>
</section>
<section id="declare-functions">
<h2>Declare Functions</h2>
<p>Here’s the functions to improve code readability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>                                               <span class="c1"># add grid lines</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks   </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="load-a-couple-datasets">
<h2>Load a Couple Datasets</h2>
<p>We load a couple of datasets,</p>
<ol class="arabic simple">
<li><p>df - an exhaustive data table as a pandas DataFrame</p></li>
<li><p>df_missing an data table with some missing data as a pandas DataFrame</p></li>
<li><p>ndarray_2D - a 2D array map as a NumPy ndarray</p></li>
</ol>
<p>To demonstrat the methods below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/unconv_MV_v4.csv"</span><span class="p">)</span> <span class="c1"># load the data from my github repo</span>
<span class="n">df_missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/unconv_MV_missing.csv"</span><span class="p">)</span> 
<span class="n">df_spatial</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/12_sample_data.csv"</span><span class="p">)</span> 
<span class="n">ndarray_2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/12_AI.csv"</span><span class="p">,</span> 
                     <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span>                                     <span class="c1"># set random number seed for reproducibility</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">600.0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="c1"># add noise to demonstrate overfit and hyperparameter tuning</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="complete-some-basic-operations">
<h2>Complete Some Basic Operations</h2>
<p>Here I complete some basic operations to ensure that the alphabetically sorted code snippets below have the inputs to avoid errors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>                      <span class="c1"># separate predictor and response, assumes response is the last features</span>
<span class="n">X_missing</span> <span class="o">=</span> <span class="n">df_missing</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">y_missing</span> <span class="o">=</span> <span class="n">df_missing</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="c1"># separate predictor and response, assumes response is the last features</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
                <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>             <span class="c1"># train and test split</span>
<span class="n">linear_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>        <span class="c1"># instantiate and train linear regression model, no hyperparmeters</span>
<span class="n">y_hat_train</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>                   <span class="c1"># predict over the training data</span>
<span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                     <span class="c1"># predict over the training data</span>
<span class="n">linear_1pred_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s1">'Por'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># linear regression model with only 1 predictor feature</span>
<span class="n">linear_2pred_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># linear regression model with only 1 predictor feature</span>
</pre></div>
</div>
</div>
</div>
<p>OK, now we are ready to walk thorugh our alphabetically ordered code snippets.</p>
</section>
<section id="beta-beta-coefficients">
<h2>Beta, <span class="math notranslate nohighlight">\(\beta\)</span>, Coefficients</h2>
<p>Feature importance based on the multilinear regression coefficients of the normalized features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">normalizer</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>                                   <span class="c1"># instantiate the min/max normalizer</span>
<span class="n">norm_array</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># normalize the predictor features                 </span>
<span class="n">X_norm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">norm_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>          <span class="c1"># convert output to a DataFrame</span>
<span class="n">beta_linear_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_norm</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>   <span class="c1"># instantiate and train linear regression model, no hyperparmeters</span>
<span class="n">beta_coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Beta Coefficient'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))})</span>
<span class="n">beta_coef_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Beta Coefficient (normalized)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Beta Coefficients'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0242c4c943789f3508ddcdf0f54466db0571605cbffc4694f303c5b6f867cfec.png" src="../Images/9f28a7f6ef95f0886ba1d37234411ead.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0242c4c943789f3508ddcdf0f54466db0571605cbffc4694f303c5b6f867cfec.png"/>
</div>
</div>
</section>
<section id="correlation-pearson-product-momment">
<h2>Correlation (Pearson product momment)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">correlations</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>         <span class="c1"># calculate correlation matrix and extract the pred. rows for the response column</span>
<span class="n">correlations</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Correlation Coefficient'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Correlation Coefficients'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01b6c1f90ba99386369f74ed5c07b22976da6c3ab67393586c8e9287e428c995.png" src="../Images/055588d911cad1aa273eccf46788a793.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/01b6c1f90ba99386369f74ed5c07b22976da6c3ab67393586c8e9287e428c995.png"/>
</div>
</div>
</section>
<section id="correlation-spearman-rank">
<h2>Correlation (Spearman rank)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">rank_correlations</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'spearman'</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># calculate Spearman correlation with same method as Pearson above</span>
<span class="n">rank_correlations</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rank Correlation Coefficient'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Rank Correlation Coefficients'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/793c62c2e433f3d5824617e6404b5a63fc9fa91f3ffb1a23e5f11b6aef582fd6.png" src="../Images/5a27c57a196ffce0c3c085265c5bc0e9.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/793c62c2e433f3d5824617e6404b5a63fc9fa91f3ffb1a23e5f11b6aef582fd6.png"/>
</div>
</div>
</section>
<section id="cross-validation-plot-training-and-testing">
<h2>Cross Validation Plot (training and testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Training Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Testing Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9dd5b2ef7db8189250200c8fda4684707fd265c686f3d344fd988859b056f10c.png" src="../Images/751a56b5a9a1b3b432d910a4efc96752.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/9dd5b2ef7db8189250200c8fda4684707fd265c686f3d344fd988859b056f10c.png"/>
</div>
</div>
</section>
<section id="cross-validation-plot-testing">
<h2>Cross Validation Plot (testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Testing Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/46b7748af289cbd304af34994fe959c5a2f18d75bc1f14f21555bf54972513bf.png" src="../Images/3eeeb0c09c9483eeaa7356c233fe26bf.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/46b7748af289cbd304af34994fe959c5a2f18d75bc1f14f21555bf54972513bf.png"/>
</div>
</div>
</section>
<section id="cross-validation-plot-training">
<h2>Cross Validation Plot (training)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Training Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e9004125ee8191a22a71ca31d0c303276bc944bdac42e6a5baa00e5f1de1320d.png" src="../Images/4b42cb5667d6c4b3852871763244ac85.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e9004125ee8191a22a71ca31d0c303276bc944bdac42e6a5baa00e5f1de1320d.png"/>
</div>
</div>
</section>
<section id="dataframe-add-noise-to-a-feature">
<h2>DataFrame (add noise to a feature)</h2>
<p>I do this to experiment and make educational content, e.g., add noise to the response feature to demonstrate overfit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>                                     <span class="c1"># set random seed for repeatability</span>
<span class="n">df_temp</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_temp</span><span class="p">))</span> <span class="c1"># add a feature of ones called 'Ones'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2154.457620</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3199.991714</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2742.009861</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3927.738944</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2343.080242</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dataframe-add-a-new-feature-column">
<h2>DataFrame (add a new feature/column)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span><span class="p">[</span><span class="s1">'Ones'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df_temp</span><span class="p">)))</span>                     <span class="c1"># add a feature of ones called 'Ones'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
      <th>Ones</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dataframe-make-new">
<h2>DataFrame (make new)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Ones'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">)),</span><span class="s1">'Zeros'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">))})</span> <span class="c1"># make new DataFrame</span>
<span class="n">df_new</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Ones</th>
      <th>Zeros</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dataframe-preview">
<h2>DataFrame (preview)</h2>
<p>Display the first ‘n’ rows of the DataFrame</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>                                                 <span class="c1"># display the first n rows of the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4353.192212</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>3516.494383</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2083.845221</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>12.52</td>
      <td>2.72</td>
      <td>2.43</td>
      <td>65.77</td>
      <td>0.95</td>
      <td>1.98</td>
      <td>2775.906282</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>13.25</td>
      <td>3.94</td>
      <td>3.71</td>
      <td>66.20</td>
      <td>1.14</td>
      <td>2.65</td>
      <td>2966.741947</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>15.04</td>
      <td>4.39</td>
      <td>2.22</td>
      <td>61.11</td>
      <td>1.08</td>
      <td>1.77</td>
      <td>4022.323780</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>16.19</td>
      <td>6.30</td>
      <td>2.29</td>
      <td>49.10</td>
      <td>1.53</td>
      <td>1.86</td>
      <td>4799.763575</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>16.82</td>
      <td>5.42</td>
      <td>2.80</td>
      <td>66.65</td>
      <td>1.17</td>
      <td>1.98</td>
      <td>3616.427242</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dataframe-rename-a-feature-column">
<h2>DataFrame (rename a feature/column)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'Por'</span><span class="p">:</span><span class="s1">'Porosity (%)'</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   <span class="c1"># rename 'Por' features as 'Porosity'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Porosity (%)</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dataframe-remove-features-columns">
<h2>DataFrame (remove features/columns)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'Well'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        <span class="c1"># remove features 'Well','Por' and 'AI'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Perm</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.92</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.53</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.59</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6.75</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.57</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dataframe-remove-samples-rows">
<h2>DataFrame (remove samples/rows)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>                   <span class="c1"># removes samples 0, 2 and 4</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4353.192212</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>3516.494383</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2083.845221</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="dataframe-remove-samples-rows-by-condition">
<h2>DataFrame (remove samples/rows by condition)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">df_temp</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">13.0</span><span class="p">]</span>                      <span class="c1"># remove all samples with 'Por' &lt;= 13%</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4353.192212</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>3516.494383</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="decision-tree-feature-importance">
<h2>Decision Tree (feature importance)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>

<span class="n">beta_coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Tree-based Feature Importance'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">tree_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="o">.</span><span class="n">ravel</span><span class="p">())})</span>
<span class="n">beta_coef_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Feature Importance'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Decision Tree Feature Importance'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/498e717d8cd4f6a6f673071a88cbd7a4b3370249d7bdd3b4c0506fede88353ca.png" src="../Images/bcee90b2c8924008ccfa87e26612ee2c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/498e717d8cd4f6a6f673071a88cbd7a4b3370249d7bdd3b4c0506fede88353ca.png"/>
</div>
</div>
</section>
<section id="decision-tree-prediction-at-testing-data">
<h2>Decision Tree (prediction at testing data)</h2>
<p>Apply our model to predict at withheld testing data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_test_temp</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_test_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    <span class="c1"># predict over the training data</span>
<span class="n">y_test_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>656.507448</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>155</th>
      <td>3110.245382</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2581.359826</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>159</th>
      <td>6498.151446</td>
      <td>6482.917835</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4148.822923</td>
      <td>4297.451039</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="decision-tree-prediction-at-training-data">
<h2>Decision Tree (prediction at training data)</h2>
<p>Apply our model to predict at the retained training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_train_temp</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_train_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># predict over the training data</span>
<span class="n">y_train_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>125</th>
      <td>3750.106623</td>
      <td>4297.451039</td>
    </tr>
    <tr>
      <th>68</th>
      <td>4644.717576</td>
      <td>4297.451039</td>
    </tr>
    <tr>
      <th>69</th>
      <td>1991.991593</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>108</th>
      <td>6688.360827</td>
      <td>6482.917835</td>
    </tr>
    <tr>
      <th>131</th>
      <td>5076.638358</td>
      <td>4297.451039</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="decision-tree-train">
<h2>Decision Tree (train)</h2>
<p>Train model parameters on training data with specified model hyperparameters</p>
<ul class="simple">
<li><p>let’s look at the trained model parameters, by visualizing the trained decision tree.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">plot_tree</span><span class="p">(</span><span class="n">tree_model</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># plot the decision tree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d6589d670e2e9b593d1e13e44cfe8c153b4c836395654656835da04c747d5194.png" src="../Images/17779d19ebdf48d8cb9ff106de64bb16.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d6589d670e2e9b593d1e13e44cfe8c153b4c836395654656835da04c747d5194.png"/>
</div>
</div>
</section>
<section id="decision-tree-retrain-tuned-model">
<h2>Decision Tree (retrain tuned model)</h2>
<p>Apply tuned hyperparameters and retrain the model with all the data.</p>
<ul class="simple">
<li><p>this is the model that we will use for future predictions, real-world use</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">tuned_leaf_node</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>                                         <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tuned_tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">tuned_leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">tuned_tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                           <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bed759efe8f74ab399429a00ba5e1a7deb2f0564e294d93190f0787e1b1df966.png" src="../Images/b9f7acf97318db4212998bf321561437.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/bed759efe8f74ab399429a00ba5e1a7deb2f0564e294d93190f0787e1b1df966.png"/>
</div>
</div>
</section>
<section id="decision-tree-tune-prune">
<h2>Decision Tree (tune/prune)</h2>
<p>Train model parameters on training data with a range of model hyperparameters, select the model hyperparameters with minimum error over the withheld testing data</p>
<p>This requires the following steps,</p>
<p>Loop over the hyperparameter(s) values,</p>
<ol class="arabic simple">
<li><p>train the model with the retained training data</p></li>
<li><p>predict at the withheld testing data</p></li>
<li><p>calculate the testing error</p></li>
</ol>
<p>Select the hyperparameter that minimized the testing error</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">2</span>                                                 <span class="c1"># set initial hyperparameter</span>
<span class="n">MSE_tree_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">leaf_node_list</span> <span class="o">=</span> <span class="p">[]</span>                       <span class="c1"># make lists to store the results</span>
<span class="k">while</span> <span class="n">leaf_node</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>                                       <span class="c1"># loop over the number of leaf nodes hyperparameter</span>
    <span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instandiate and train the model</span>
    <span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                   <span class="c1"># predict over the testing cases</span>
    <span class="n">MSE_tree</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">)</span>  <span class="c1"># calculate the MSE testing</span>
    <span class="n">MSE_tree_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MSE_tree</span><span class="p">)</span>                            <span class="c1"># add to the list of MSE</span>
    <span class="n">leaf_node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leaf_node</span><span class="p">)</span>                          <span class="c1"># append leaf node to an array for plotting</span>
    <span class="n">leaf_node</span> <span class="o">=</span> <span class="n">leaf_node</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">tuned_leaf_nodes</span> <span class="o">=</span> <span class="n">leaf_node_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">MSE_tree_list</span><span class="p">)]</span>           <span class="c1"># get the k that minimizes the testing MSE</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">leaf_node_list</span><span class="p">,</span><span class="n">MSE_tree_list</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span> <span class="c1"># plot testing MSE vs. hyperparameter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tuned_leaf_nodes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Tuned Leaf Nodes = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tuned_leaf_nodes</span><span class="p">),[</span><span class="n">tuned_leaf_nodes</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.8e6</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Tree: Withheld Testing Error vs. Number of Leaf Nodes'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of Leaf Nodes'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Test Mean Square Error'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b60aa2eac0a1291d28f8028ee5949559b2cb770db7315a469587f57d0769aaa3.png" src="../Images/820a0d93ba1a606ae2d0b29b1b972028.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/b60aa2eac0a1291d28f8028ee5949559b2cb770db7315a469587f57d0769aaa3.png"/>
</div>
</div>
</section>
<section id="features-extraction-by-name">
<h2>Features Extraction (by name)</h2>
<p>Build a new DataFrame with only the selected predictor feature and the response feature</p>
<ol class="arabic simple">
<li><p>specify the selected predictor features</p></li>
<li><p>specify the response feature</p></li>
<li><p>build a list with both</p></li>
<li><p>make a new DataFrame with first the predictor features and then the response feature as the last column</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">selected_predictor_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">]</span>   <span class="c1"># set the selected predictor features</span>
<span class="n">response_feature</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span>                                   <span class="c1"># set the response feature</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">selected_predictor_features</span> <span class="o">+</span> <span class="n">response_feature</span>     <span class="c1"># build a list of selected predictor and response features</span>
<span class="n">df_selected</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">features</span><span class="p">]</span>                              <span class="c1"># slice the DataFrame</span>
<span class="n">df_selected</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="features-extraction-by-number">
<h2>Features Extraction (by number)</h2>
<p>Build a new DataFrame with only the selected predictor feature.</p>
<ol class="arabic simple">
<li><p>specify the selected predictor features</p></li>
<li><p>specify the response feature</p></li>
<li><p>build a list with both</p></li>
<li><p>make a new DataFrame with first the predictor features and then the response feature as the last column</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">selected_predictor_features</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>                     <span class="c1"># set the selected predictor features</span>
<span class="n">df_selected_predictor</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">selected_predictor_features</span><span class="p">]</span> <span class="c1"># slice the DataFrame</span>
<span class="n">df_selected_predictor</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="features-extraction-make-x-and-y-dataframes">
<h2>Features Extraction (make X and y DataFrames)</h2>
<p>Build a two new DataFrames, one with only the selected predictor feature and the other with the response feature,</p>
<ul class="simple">
<li><p>assuming that the last feature is the response feature</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'VR'</span><span class="p">]]</span>                               <span class="c1"># extract the list the predictor feature by name</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'Prod'</span><span class="p">]]</span>                                        <span class="c1"># extract the response feature</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Predictor features: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">Response feature: '</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Predictor features: ['Por', 'AI', 'VR']
Response feature: Prod
</pre></div>
</div>
</div>
</div>
</section>
<section id="features-extraction-make-x-and-y-dataframes-assumed-feature-order">
<h2>Features Extraction (make X and y DataFrames assumed feature order)</h2>
<p>Build a two new DataFrames, one with only the selected predictor feature and the other with the response feature,</p>
<ul class="simple">
<li><p>assuming that the last feature is the response feature</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>                      <span class="c1"># extract by assuming 2nd to 2nd last are predictors and last is response feature</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Predictor features: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">Response feature: '</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Predictor features: ['Por', 'Perm', 'AI', 'Brittle', 'TOC', 'VR']
Response feature: Prod
</pre></div>
</div>
</div>
</div>
</section>
<section id="histogram">
<h2>Histogram</h2>
<p>Simple histogram,</p>
<ul class="simple">
<li><p>you can set the histogram limits by specifying the exact bins with a method like, np.linspace(min,max,n)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">)</span> <span class="c1"># histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Porosity Distribution'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0ff41b2a04299239a5787ea06ee741abd39a85b84705e042e481757fa761783f.png" src="../Images/479b7b449b4f65cbff1f33f5912dd525.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0ff41b2a04299239a5787ea06ee741abd39a85b84705e042e481757fa761783f.png"/>
</div>
</div>
</section>
<section id="histogram-normalized">
<h2>Histogram (normalized)</h2>
<p>A histogram with probability on the y axis and the sum of all bars is one, i.e., probability closure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># normalized histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Porosity Distribution'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Probability'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/418e0e90a2846168a380bc4e0ecbfdc630e06e4d53b06e01a518f9cf2dbe00a1.png" src="../Images/1f995c05278fd97a4977e9ffb72e72ca.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/418e0e90a2846168a380bc4e0ecbfdc630e06e4d53b06e01a518f9cf2dbe00a1.png"/>
</div>
</div>
</section>
<section id="image-plot">
<h2>Image Plot</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">6500</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span> <span class="c1"># plot of 2D ndarray, image or map feature</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">7500</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X (m)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y (m)'</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Acoustic Impedence ($\frac</span><span class="si">{kg}</span><span class="s1">{m^3} \cdot \frac</span><span class="si">{m}{s}</span><span class="s1"> \cdot 10^3$)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Acoustic Impedance'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c86ec564386d943eec0c63d05909805d2ef77161ec97f54666f8f4014aa78cd5.png" src="../Images/81941c32cdbce6c5d5afa4c43c371885.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/c86ec564386d943eec0c63d05909805d2ef77161ec97f54666f8f4014aa78cd5.png"/>
</div>
</div>
</section>
<section id="image-plot-combined-with-location-map">
<h2>Image Plot (combined with location map)</h2>
<p>Superimpose multiple plots on top of each other,</p>
<ul class="simple">
<li><p>use ‘zorder’ to place object in front of other objects, higher number is in front</p></li>
<li><p>make sure all objects are in the same plot space</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">6500</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># plot of 2D ndarray, image or map feature</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'X'</span><span class="p">],</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'Y'</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'AI'</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">6500</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">7500</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X (m)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y (m)'</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Acoustic Impedence ($\frac</span><span class="si">{kg}</span><span class="s1">{m^3} \cdot \frac</span><span class="si">{m}{s}</span><span class="s1"> \cdot 10^3$)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Acoustic Impedance Image and Samples at Wells'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e209044ada9e1ec85d74ec9b44724049f126863a34e47f23e678d71f469c2e3d.png" src="../Images/a3b326fefec63f72f7e2b67536a2e4a6.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e209044ada9e1ec85d74ec9b44724049f126863a34e47f23e678d71f469c2e3d.png"/>
</div>
</div>
</section>
<section id="k-nearest-neighbours-feature-imputation">
<h2>K-Nearest Neighbours (feature imputation)</h2>
<p>Feature imputation by estimating missing features with the nearest neighbours,</p>
<ul class="simple">
<li><p>distance is accessed with all samples that have all features present in the sample with a missing feature</p></li>
<li><p>only one pass is applied, there is no iteration</p></li>
<li><p>not as robust as MICE is there is a lot of missing data, it does not learn the structure between the features to fill in missing data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">knn_imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">"uniform"</span><span class="p">)</span>    <span class="c1"># instantiate Multiple Imputation by Chained Equations (MICE) imputer</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">knn_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_missing</span><span class="p">)</span>              <span class="c1"># train and apply MICE to impute the missing data</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># make imputed results into a DataFrame with same columns as X</span>
<span class="n">X_imputed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                          <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14.924820</td>
      <td>1.375450</td>
      <td>2.982915</td>
      <td>49.227565</td>
      <td>1.014950</td>
      <td>1.997420</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.999168</td>
      <td>0.367557</td>
      <td>0.557240</td>
      <td>13.755077</td>
      <td>0.480852</td>
      <td>0.284183</td>
    </tr>
    <tr>
      <th>min</th>
      <td>5.400000</td>
      <td>0.120000</td>
      <td>0.960000</td>
      <td>-1.500000</td>
      <td>-0.250000</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.846250</td>
      <td>1.145000</td>
      <td>2.590000</td>
      <td>40.640000</td>
      <td>0.700000</td>
      <td>1.830000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>15.035000</td>
      <td>1.360000</td>
      <td>3.010000</td>
      <td>49.477500</td>
      <td>1.007500</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>17.012500</td>
      <td>1.610000</td>
      <td>3.330000</td>
      <td>58.055000</td>
      <td>1.370000</td>
      <td>2.165000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.650000</td>
      <td>2.580000</td>
      <td>4.700000</td>
      <td>93.470000</td>
      <td>2.710000</td>
      <td>2.900000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="k-nearest-neighbours-prediction-at-testing-data">
<h2>K-Nearest Neighbours (prediction at testing data)</h2>
<p>Apply our model to predict at withheld testing data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_neighbours</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                 <span class="c1"># KNN model hyperparameters</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbours</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_test_temp</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_test_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>     <span class="c1"># predict over the training data</span>
<span class="n">y_test_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>656.507448</td>
      <td>2303.626455</td>
    </tr>
    <tr>
      <th>155</th>
      <td>3110.245382</td>
      <td>3774.108284</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2581.359826</td>
      <td>2321.644376</td>
    </tr>
    <tr>
      <th>159</th>
      <td>6498.151446</td>
      <td>5713.166746</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4148.822923</td>
      <td>4108.942362</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="k-nearest-neighbours-prediction-at-training-data">
<h2>K-Nearest Neighbours (prediction at training data)</h2>
<p>Apply our model to predict at the retained training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_neighbours</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                 <span class="c1"># KNN model hyperparameters</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbours</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_train_temp</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_train_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>   <span class="c1"># predict over the training data</span>
<span class="n">y_train_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>125</th>
      <td>3750.106623</td>
      <td>3974.087763</td>
    </tr>
    <tr>
      <th>68</th>
      <td>4644.717576</td>
      <td>4226.039680</td>
    </tr>
    <tr>
      <th>69</th>
      <td>1991.991593</td>
      <td>3165.041802</td>
    </tr>
    <tr>
      <th>108</th>
      <td>6688.360827</td>
      <td>6336.236197</td>
    </tr>
    <tr>
      <th>131</th>
      <td>5076.638358</td>
      <td>5332.676914</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="k-nearest-neighbours-train">
<h2>K-Nearest Neighbours (train)</h2>
<p>Train model parameters on training data with specified model hyperparameters</p>
<ul class="simple">
<li><p>since K-nearest neighbours is a lazy learning model, there are no trained model parameters to display</p></li>
<li><p>instead we look at the cross validation plot</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                             <span class="c1"># KNN model hyperparameters</span>
<span class="n">neigh</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>                        <span class="c1"># train the model with the training data</span>
<span class="n">y_train_hat</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>                      <span class="c1"># predict over the testing cases</span>
<span class="n">y_test_hat</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                        <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_train_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Training Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_test_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Testing Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/eab39432f0ca9fd360006ebec626cc016401b43ee69b4f7b5b60678d249f978e.png" src="../Images/05f34f230707d1aed62b1163edc58876.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/eab39432f0ca9fd360006ebec626cc016401b43ee69b4f7b5b60678d249f978e.png"/>
</div>
</div>
</section>
<section id="k-nearest-neighbours-retrain-tuned-model">
<h2>K-Nearest Neighbours (retrain tuned model)</h2>
<p>Apply tuned hyperparameters and retrain the model with all the data.</p>
<ul class="simple">
<li><p>this is the model that we will use for future predictions, real-world use</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">tuned_k</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                      <span class="c1"># KNN model hyperparameters</span>
<span class="n">knn_tuned_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">tuned_k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c1"># retrain the tuned model with all data</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">knn_tuned_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                            <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5a2ca81f6a2c7d36a865cd0ca4aaeda29ddbc131ec5d90cbd7651a11d56abf5b.png" src="../Images/e88e73510d427f28dd66ee5ee6f593d7.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/5a2ca81f6a2c7d36a865cd0ca4aaeda29ddbc131ec5d90cbd7651a11d56abf5b.png"/>
</div>
</div>
</section>
<section id="k-nearest-neighbours-tune">
<h2>K-Nearest Neighbours (tune)</h2>
<p>Train model parameters on training data with a range of model hyperparameters, select the model hyperparameters with minimum error over the withheld testing data</p>
<p>This requires the following steps,</p>
<p>Loop over the hyperparameter(s) values,</p>
<ol class="arabic simple">
<li><p>train the model with the retained training data</p></li>
<li><p>predict at the withheld testing data</p></li>
<li><p>calculate the testing error</p></li>
</ol>
<p>Select the hyperparameter that minimized the testing error</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                                    <span class="c1"># set initial, lowest k hyperparameter</span>
<span class="n">MSE_knn_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k_list</span> <span class="o">=</span> <span class="p">[]</span>                                <span class="c1"># make lists to store the results</span>
<span class="k">while</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">150</span><span class="p">:</span>                                               <span class="c1"># loop over the k hyperparameter</span>
    <span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instandiate and train the model</span>
    <span class="n">y_test_hat</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                    <span class="c1"># predict over the testing cases</span>
    <span class="n">MSE</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_test_hat</span><span class="p">)</span>       <span class="c1"># calculate the MSE testing</span>
    <span class="n">MSE_knn_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                                  <span class="c1"># add to the list of MSE</span>
    <span class="n">k_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>                                          <span class="c1"># append k to an array for plotting</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">tuned_k</span> <span class="o">=</span> <span class="n">k_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">MSE_knn_list</span><span class="p">)]</span>                     <span class="c1"># get the k that minimizes the testing MSE</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>                                              <span class="c1"># plot the testing error vs. hyperparameter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span><span class="n">MSE_knn_list</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tuned_k</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Tuned k = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tuned_k</span><span class="p">),[</span><span class="n">tuned_k</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="mf">2.0e6</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'KNN: Testing Error vs. Number of Nearest Neighbours'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of Nearest Neighbours'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Testing Mean Square Error'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d19bc60e905a2ecfeaea5603abad42f0a080fc5df476fed45044fefd8c1b4a39.png" src="../Images/62c23543209403ea04861f7d6ec38b54.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d19bc60e905a2ecfeaea5603abad42f0a080fc5df476fed45044fefd8c1b4a39.png"/>
</div>
</div>
</section>
<section id="linear-regression-model-model-parameters">
<h2>Linear Regression Model (model parameters)</h2>
<p>Retreive the model parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Intercept'</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Coefficient'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">ravel</span><span class="p">())})</span>
<span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Feature</th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Intercept</td>
      <td>-4053.511325</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Por</td>
      <td>453.607135</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Perm</td>
      <td>24.707076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AI</td>
      <td>-154.448203</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brittle</td>
      <td>11.173989</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TOC</td>
      <td>-183.938586</td>
    </tr>
    <tr>
      <th>6</th>
      <td>VR</td>
      <td>580.078458</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="linear-regression-model-prediction-test">
<h2>Linear Regression Model (prediction test)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">y_test_temp</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                          <span class="c1"># make a deep copy of the y test DataFrame</span>
<span class="n">y_test_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>  <span class="c1"># predict over the training data</span>
<span class="n">y_test_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>656.507448</td>
      <td>379.818856</td>
    </tr>
    <tr>
      <th>155</th>
      <td>3110.245382</td>
      <td>2943.388125</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2581.359826</td>
      <td>1372.426014</td>
    </tr>
    <tr>
      <th>159</th>
      <td>6498.151446</td>
      <td>5563.914978</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4148.822923</td>
      <td>4987.375301</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="linear-regression-model-prediction-train">
<h2>Linear Regression Model (prediction train)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">y_train_temp</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                        <span class="c1"># make a deep copy of the y train DataFrame</span>
<span class="n">y_train_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="c1"># predict over the training data</span>
<span class="n">y_train_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>125</th>
      <td>3750.106623</td>
      <td>3938.246048</td>
    </tr>
    <tr>
      <th>68</th>
      <td>4644.717576</td>
      <td>3824.308392</td>
    </tr>
    <tr>
      <th>69</th>
      <td>1991.991593</td>
      <td>2906.015510</td>
    </tr>
    <tr>
      <th>108</th>
      <td>6688.360827</td>
      <td>6653.961261</td>
    </tr>
    <tr>
      <th>131</th>
      <td>5076.638358</td>
      <td>5048.864286</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="linear-regression-model-train">
<h2>Linear Regression Model (train)</h2>
<p>Train model parameters on training data, no hyperparameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">linear_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>        <span class="c1"># instantiate and train linear regression model, no hyperparmeters</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Intercept'</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Coefficient'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">ravel</span><span class="p">())})</span>
<span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Feature</th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Intercept</td>
      <td>-4053.511325</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Por</td>
      <td>453.607135</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Perm</td>
      <td>24.707076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AI</td>
      <td>-154.448203</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brittle</td>
      <td>11.173989</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TOC</td>
      <td>-183.938586</td>
    </tr>
    <tr>
      <th>6</th>
      <td>VR</td>
      <td>580.078458</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="listwise-deletion">
<h2>Listwise Deletion</h2>
<p>Remove all samples that are missing and features.</p>
<ul class="simple">
<li><p>the “sledge hammer” approach to avoid feature imputation</p></li>
<li><p>not recommended, often removes too much data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_listwise</span> <span class="o">=</span> <span class="n">df_missing</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'any'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>      <span class="c1"># listwise deletion</span>
<span class="n">df_listwise</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>WellIndex</th>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Production</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>485.680952</td>
      <td>14.976381</td>
      <td>1.407238</td>
      <td>2.999857</td>
      <td>49.406143</td>
      <td>1.005524</td>
      <td>2.001524</td>
      <td>2373.025529</td>
    </tr>
    <tr>
      <th>std</th>
      <td>292.292307</td>
      <td>3.072786</td>
      <td>0.422033</td>
      <td>0.584267</td>
      <td>14.311860</td>
      <td>0.521783</td>
      <td>0.306854</td>
      <td>1661.542253</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.000000</td>
      <td>6.480000</td>
      <td>0.360000</td>
      <td>1.330000</td>
      <td>17.200000</td>
      <td>-0.230000</td>
      <td>0.900000</td>
      <td>75.215188</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>206.250000</td>
      <td>12.682500</td>
      <td>1.110000</td>
      <td>2.612500</td>
      <td>39.117500</td>
      <td>0.640000</td>
      <td>1.800000</td>
      <td>1154.774039</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>477.500000</td>
      <td>15.035000</td>
      <td>1.415000</td>
      <td>3.055000</td>
      <td>48.320000</td>
      <td>0.980000</td>
      <td>2.010000</td>
      <td>2029.697410</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>729.500000</td>
      <td>17.085000</td>
      <td>1.680000</td>
      <td>3.360000</td>
      <td>58.547500</td>
      <td>1.347500</td>
      <td>2.220000</td>
      <td>3223.502405</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1000.000000</td>
      <td>24.650000</td>
      <td>2.480000</td>
      <td>4.500000</td>
      <td>86.800000</td>
      <td>2.560000</td>
      <td>2.820000</td>
      <td>12568.644130</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="location-map">
<h2>Location Map</h2>
<p>For plotting sparsely sampled features with X and Y sample locations to inspect the spatial structures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">;</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">10000</span><span class="p">;</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.27</span>   <span class="c1"># set plot limits and feature limits</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'X'</span><span class="p">],</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'Y'</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'Porosity'</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X (m)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y (m)'</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Porosity (fraction)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Location Map: Porosity'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a7838f0acb4fea58f25cb89ea2238304b6fc709f5438bc9fdbc9d89c96544a0e.png" src="../Images/77573508b926ea28e65e395fe3a10574.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a7838f0acb4fea58f25cb89ea2238304b6fc709f5438bc9fdbc9d89c96544a0e.png"/>
</div>
</div>
</section>
<section id="mean-imputation">
<h2>Mean (imputation)</h2>
<p>A very simple approach for feature imputation, replace the missing values with the mean of the feature,</p>
<ul class="simple">
<li><p>does on introduce a bias in the mean, but will introduce a bias in the standard deviation and variance</p></li>
<li><p>will likely bias low the between predictor and response feature correlation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">mean_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">)</span>                 <span class="c1"># instantiate mean imputor</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">mean_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_missing</span><span class="p">)</span>             <span class="c1"># train and apply MICE to impute the missing data</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># make imputed results into a DataFrame with same columns as X</span>
<span class="n">X_imputed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                          <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14.898708</td>
      <td>1.383061</td>
      <td>2.984200</td>
      <td>49.607696</td>
      <td>0.999551</td>
      <td>1.996173</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.933199</td>
      <td>0.344835</td>
      <td>0.544243</td>
      <td>12.532978</td>
      <td>0.431517</td>
      <td>0.265394</td>
    </tr>
    <tr>
      <th>min</th>
      <td>5.400000</td>
      <td>0.120000</td>
      <td>0.960000</td>
      <td>-1.500000</td>
      <td>-0.250000</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.940000</td>
      <td>1.217500</td>
      <td>2.630000</td>
      <td>43.937500</td>
      <td>0.800000</td>
      <td>1.897500</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>14.898708</td>
      <td>1.383061</td>
      <td>2.984200</td>
      <td>49.607696</td>
      <td>0.999551</td>
      <td>1.996173</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>16.840000</td>
      <td>1.530000</td>
      <td>3.302500</td>
      <td>55.515000</td>
      <td>1.210000</td>
      <td>2.110000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.650000</td>
      <td>2.580000</td>
      <td>4.700000</td>
      <td>93.470000</td>
      <td>2.710000</td>
      <td>2.900000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="minimum-and-maximum-dataframe">
<h2>Minimum and Maximum (dataframe)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="s1">'Dataframe Minimum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>                  <span class="c1"># using pandas DataFrame's min and max member functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Dataframe Maximum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Dataframe Minimum:
Well         1.000000
Por          6.550000
Perm         1.130000
AI           1.280000
Brittle     10.940000
TOC         -0.190000
VR           0.930000
Prod       463.579973
dtype: float64

Dataframe Maximum:
Well        200.000000
Por          23.550000
Perm          9.870000
AI            4.630000
Brittle      84.330000
TOC           2.180000
VR            2.870000
Prod       8428.187903
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="minimum-and-maximum-ndarray">
<h2>Minimum and Maximum (ndarray)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="s1">'2D ndarray Minimum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">))</span>       <span class="c1"># using NumPy's min and max functions that flatten internally</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">2D ndarray Maximum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>2D ndarray Minimum:
1516.949331702811

2D ndarray Maximum:
6735.039007281679
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-plot-linear-1d">
<h2>Model Plot (linear 1D)</h2>
<p>We use the follow steps,</p>
<ol class="arabic simple">
<li><p>make an array of equally spaced values of the predictor feature(s)</p></li>
<li><p>predict at all of these predictor values</p></li>
<li><p>cross plot the predictions with the predictor values</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>                <span class="c1"># array of equally space values in the predictor feature</span>
<span class="n">y_hat_linear_1pred</span> <span class="o">=</span> <span class="n">linear_1pred_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>     <span class="c1"># predict over the predictor feature values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="n">y_hat_linear_1pred</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># plot the predictions vs. the predictor values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Production (MCFPD)'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a4c0583b40c49bf06c7fa895961557fd17d1ca0773f145b95f65432f518cdeeb.png" src="../Images/141c08e9389489310c40fdfbff300226.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a4c0583b40c49bf06c7fa895961557fd17d1ca0773f145b95f65432f518cdeeb.png"/>
</div>
</div>
</section>
<section id="model-plot-linear-2d">
<h2>Model Plot (linear 2D)</h2>
<p>We use the follow steps,</p>
<ol class="arabic simple">
<li><p>make a mesh array of equally spaced values of the predictor feature(s)</p></li>
<li><p>predict at all of these predictor values</p></li>
<li><p>flatten all meshes to 1D</p></li>
<li><p>plot with a colored scatter plot with square markers (s) scalled to fill in the plot</p></li>
</ol>
<p>I prefer this method because plt.imshow often is inconsistent with other plots when added as a subplot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">XX1</span><span class="p">,</span> <span class="n">XX2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mf">25.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">102.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">))</span> <span class="c1"># get a regular grid of response feature values</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">linear_2pred_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">XX1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">XX2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># predict over grid and convert to a 1D vector</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">XX1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">XX2</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">c</span><span class="o">=</span><span class="n">y_hat</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span> <span class="c1"># convert XX1/2 to 1D vectors use for scatter plot</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">13</span><span class="p">));</span> <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Production (MCFPD)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Brittleness (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/193089af665cc59cf9497b4914122f55a90b0c545f5a56100202ad8a88b12a47.png" src="../Images/aeff9cc3fc5950d96bb7e8d93ffafa1c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/193089af665cc59cf9497b4914122f55a90b0c545f5a56100202ad8a88b12a47.png"/>
</div>
</div>
</section>
<section id="model-mean-absolute-error-testing">
<h2>Model Mean Absolute Error (testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_test</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">)</span>     <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MAE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_test</span><span class="p">))</span>                 <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MAE: 679.7220485741077
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-mean-absolute-error-training">
<h2>Model Mean Absolute Error (training)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_train</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">)</span>  <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MAE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_train</span><span class="p">))</span>                <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MAE: 713.4026730760603
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-mse-testing">
<h2>Model MSE (testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_test</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">)</span>      <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MSE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_test</span><span class="p">))</span>                 <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MSE: 731861.1594257785
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-mse-training">
<h2>Model MSE (training)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_train</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">)</span>   <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MSE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_train</span><span class="p">))</span>                <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MSE: 805986.6842431575
</pre></div>
</div>
</div>
</div>
</section>
<section id="multiple-imputation-by-chained-equations">
<h2>Multiple Imputation by Chained Equations</h2>
<p>Feature imputation by iterative application of K-nearest neighbours,</p>
<ul class="simple">
<li><p>accomplished by multiple passes, the structure in the data is learned to improve the imputation</p></li>
<li><p>robust with significant porportion of missing feature values</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">mice_imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># instantiate Multiple Imputation by Chained Equations (MICE) imputer</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">mice_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_missing</span><span class="p">)</span>             <span class="c1"># train and apply MICE to impute the missing data</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># make imputed results into a DataFrame with same columns as X</span>
<span class="n">X_imputed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                          <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14.944723</td>
      <td>1.404668</td>
      <td>2.980626</td>
      <td>49.817322</td>
      <td>1.005436</td>
      <td>1.990035</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.030406</td>
      <td>0.397241</td>
      <td>0.565985</td>
      <td>14.029791</td>
      <td>0.492149</td>
      <td>0.302019</td>
    </tr>
    <tr>
      <th>min</th>
      <td>5.400000</td>
      <td>0.120000</td>
      <td>0.960000</td>
      <td>-5.422936</td>
      <td>-0.306453</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.850000</td>
      <td>1.142772</td>
      <td>2.580000</td>
      <td>41.384356</td>
      <td>0.660000</td>
      <td>1.810000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>14.950000</td>
      <td>1.395805</td>
      <td>3.010000</td>
      <td>50.077539</td>
      <td>1.010000</td>
      <td>1.985885</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>17.052500</td>
      <td>1.670000</td>
      <td>3.350314</td>
      <td>57.951806</td>
      <td>1.358028</td>
      <td>2.170000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.650000</td>
      <td>2.580000</td>
      <td>4.700000</td>
      <td>100.043660</td>
      <td>2.710000</td>
      <td>2.927459</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="mutual-information">
<h2>Mutual Information</h2>
<p>Measure of information shared between predictors and the response feature,</p>
<ul class="simple">
<li><p>robust in the presence of nonlinearity and heteroscedasticity,</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>MI Value Range</p></th>
<th class="head"><p>Interpretation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Close to 0</p></td>
<td><p>Variables are nearly independent</p></td>
</tr>
<tr class="row-odd"><td><p>Low (small positive)</p></td>
<td><p>Weak dependency or little shared information</p></td>
</tr>
<tr class="row-even"><td><p>Moderate</p></td>
<td><p>Some meaningful dependency</p></td>
</tr>
<tr class="row-odd"><td><p>High</p></td>
<td><p>Strong dependency; variables share substantial information</p></td>
</tr>
<tr class="row-even"><td><p>Very High</p></td>
<td><p>Near deterministic relationship</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">mi</span> <span class="o">=</span> <span class="n">mutual_info_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># calculuate mutual information</span>
<span class="n">mi_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>                    <span class="c1"># convert ndarray to pandas series (column of a DataFrame) for ease of plotting</span>
<span class="n">mi_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Mutual Information'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Mutual Information'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/644b6fbdbf03216167f1baad977206f250ff2b88264e2e989d89465218f4edd7.png" src="../Images/e0abc6c7f9333ad69cfe019ae821faa6.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/644b6fbdbf03216167f1baad977206f250ff2b88264e2e989d89465218f4edd7.png"/>
</div>
</div>
</section>
<section id="mutual-information-normalized">
<h2>Mutual Information (normalized)</h2>
<p>Measure of information shared between predictors and the response feature,</p>
<ul class="simple">
<li><p>robust in the presence of nonlinearity and heteroscedasticity</p></li>
<li><p>normalized by marginal entropies to have a maximum value of 1.0, 0.0 = no information, 1.0 = perfect information</p></li>
</ul>
<p>Here’s the common rule of thumb to assist with interpretation,</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>NMI Value Range</p></th>
<th class="head"><p>Interpretation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.0 – 0.2</p></td>
<td><p>Very weak or negligible relation</p></td>
</tr>
<tr class="row-odd"><td><p>0.2 – 0.4</p></td>
<td><p>Weak relation</p></td>
</tr>
<tr class="row-even"><td><p>0.4 – 0.6</p></td>
<td><p>Moderate relation</p></td>
</tr>
<tr class="row-odd"><td><p>0.6 – 0.8</p></td>
<td><p>Strong relation</p></td>
</tr>
<tr class="row-even"><td><p>0.8 – 1.0</p></td>
<td><p>Very strong or near perfect</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">kbd</span> <span class="o">=</span> <span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">n_bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s1">'ordinal'</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">'quantile'</span><span class="p">)</span> <span class="c1"># instantiate dicretizer</span>
<span class="n">X_binned</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">kbd</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="c1"># discretize the predictor features</span>
<span class="n">y_bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s1">'drop'</span><span class="p">)</span> <span class="c1"># discretize the response features</span>
<span class="n">nmi_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_binned</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>                                  <span class="c1"># loop over predictor features </span>
    <span class="n">nmi</span> <span class="o">=</span> <span class="n">normalized_mutual_info_score</span><span class="p">(</span><span class="n">X_binned</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">y_bins</span><span class="p">)</span> <span class="c1"># calculate normalize mutual information</span>
    <span class="n">nmi_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nmi</span><span class="p">)</span>
<span class="n">nmi_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">nmi_scores</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">nmi_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Normalized Mutual Information'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Normalized Mutual Information'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">yvalue</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">yvalue</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>      <span class="c1"># add interpretation lines</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0e31eacf7d15566196b691c4dfa7fef7850043fa2b7a438b1ff8cc6a68987be8.png" src="../Images/be383c1698d1aa37199bfed76c929418.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0e31eacf7d15566196b691c4dfa7fef7850043fa2b7a438b1ff8cc6a68987be8.png"/>
</div>
</div>
</section>
<section id="normalize-predictor-features">
<h2>Normalize Predictor Features</h2>
<p>Normalize the predictor features to remove any sensitivity to feature range or variance, for example,</p>
<ul class="simple">
<li><p>put features all on equal playing field for distance calculations</p></li>
</ul>
<p>Min / max normalization forces the minimum to be 0.0 and the maximum to be 1.0</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">normalizer</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>                                   <span class="c1"># instantiate min / max normalizer </span>
<span class="n">norm_array</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># normalize the predictor features                 </span>
<span class="n">X_norm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">norm_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>          <span class="c1"># convert output to a DataFrame</span>
<span class="n">X_norm</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                             <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.496538</td>
      <td>0.366219</td>
      <td>0.504134</td>
      <td>0.507180</td>
      <td>0.498080</td>
      <td>0.533144</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.174775</td>
      <td>0.198057</td>
      <td>0.169220</td>
      <td>0.192526</td>
      <td>0.203202</td>
      <td>0.155066</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.374265</td>
      <td>0.227975</td>
      <td>0.378358</td>
      <td>0.365377</td>
      <td>0.340717</td>
      <td>0.432990</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.501176</td>
      <td>0.332380</td>
      <td>0.500000</td>
      <td>0.525548</td>
      <td>0.514768</td>
      <td>0.530928</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.638382</td>
      <td>0.475686</td>
      <td>0.616418</td>
      <td>0.644809</td>
      <td>0.649789</td>
      <td>0.625000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="random-forest-retrain-tuned-model">
<h2>Random Forest (retrain tuned model)</h2>
<p>Apply tuned hyperparameters and retrain the model.</p>
<ul class="simple">
<li><p>this is the model that we will use for future predictions, real-world use</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_node_tuned</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span> <span class="n">num_tree</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="n">max_features</span> <span class="o">=</span> <span class="mi">2</span>                <span class="c1"># random forest model hyperparameters</span>
<span class="n">random_forest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">max_leaf_node_tuned</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">num_tree</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span><span class="p">,</span>
                                       <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">random_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">y_rf_hat</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_rf_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Tuned Random Forest: Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e9fcd5f031e201181841d77931510c34d15f80eaae16df3fb6f993b0b29e18d1.png" src="../Images/85e09a63df070a97e49cb63ec6988185.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e9fcd5f031e201181841d77931510c34d15f80eaae16df3fb6f993b0b29e18d1.png"/>
</div>
</div>
</section>
<section id="random-forest-train">
<h2>Random Forest (train)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_node</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">num_tree</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="n">max_features</span> <span class="o">=</span> <span class="mi">2</span>                <span class="c1"># random forest model hyperparameters</span>
<span class="n">random_forest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">max_leaf_node</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">num_tree</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span><span class="p">,</span>
                                       <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">random_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">y_rf_hat</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_rf_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Random Forest: Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d4f91ebd10926c4f96b51e807a79e5bae0107950b77cdbfce9b17f8a524c1300.png" src="../Images/7da55fa460cfbd2f8be764b0c7717cfc.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d4f91ebd10926c4f96b51e807a79e5bae0107950b77cdbfce9b17f8a524c1300.png"/>
</div>
</div>
</section>
<section id="random-forest-tune">
<h2>Random Forest (tune)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_node_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>                        <span class="c1"># set the random forest hyperparameters</span>
<span class="n">max_features</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">trained_forests</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">MSE_oob_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">node_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">max_leaf_node</span> <span class="ow">in</span> <span class="n">max_leaf_node_mat</span><span class="p">:</span>                       <span class="c1"># loop over number of trees in our random forest</span>
    <span class="n">trained_forest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">max_leaf_node</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">num_tree</span><span class="p">,</span>
            <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">trained_forests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trained_forest</span><span class="p">)</span>
    <span class="n">oob_y_hat</span> <span class="o">=</span> <span class="n">trained_forest</span><span class="o">.</span><span class="n">oob_prediction_</span>
    <span class="n">oob_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">oob_y_hat</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">];</span> <span class="n">oob_y_hat</span> <span class="o">=</span> <span class="n">oob_y_hat</span><span class="p">[</span><span class="n">oob_y_hat</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">];</span> <span class="c1"># remove if not estimated</span>
    <span class="n">MSE_oob_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">oob_y</span><span class="p">,</span><span class="n">oob_y_hat</span><span class="p">));</span> <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_leaf_node</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">tuned_node</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">MSE_oob_list</span><span class="p">)]</span>               <span class="c1"># get the k that minimizes the testing MSE</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">node_list</span><span class="p">,</span><span class="n">MSE_oob_list</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">node_list</span><span class="p">,</span><span class="n">MSE_oob_list</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tuned_node</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Tuned Max Leaf Nodes = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tuned_node</span><span class="p">),[</span><span class="n">tuned_node</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.2e6</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of Leaf Nodes'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Mean Square Error'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Out-of-Bag Mean Square Error vs Maximum Number of Leaf Nodes'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a4378ef7e741036b57b87da2bfebdaca422f740e5e57a7c80830378ffb2a97e5.png" src="../Images/279dbea2db8df7df5a66bc53d7d84b38.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a4378ef7e741036b57b87da2bfebdaca422f740e5e57a7c80830378ffb2a97e5.png"/>
</div>
</div>
</section>
<section id="scatter-plot">
<h2>Scatter Plot</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Permeability (mD)'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Permeability vs. Porosity'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4aeafcadb98fdfb83173ccc394603ab43273c3b50a994399068a5faebea04ac0.png" src="../Images/b90b0ab6d27045759e55d1d659d09132.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/4aeafcadb98fdfb83173ccc394603ab43273c3b50a994399068a5faebea04ac0.png"/>
</div>
</div>
</section>
<section id="standardize-predictor-features">
<h2>Standardize Predictor Features</h2>
<p>Standardize the predictor features to remove any sensitivity to feature range or variance, for example,</p>
<ul class="simple">
<li><p>put features all on equal playing field for distance calculations</p></li>
</ul>
<p>Standardization forces the mean to be 0.0 and the standard deviation to be 1.0</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>                                     <span class="c1"># instantiate standardizer </span>
<span class="n">standard_array</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># standardize the predictor features    </span>
<span class="n">X_stand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">standard_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>     <span class="c1"># convert output to a DataFrame</span>
<span class="n">X_stand</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                            <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.486900e-16</td>
      <td>-6.217249e-17</td>
      <td>4.130030e-16</td>
      <td>2.042810e-16</td>
      <td>3.375078e-16</td>
      <td>9.081624e-16</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-2.848142e+00</td>
      <td>-1.853701e+00</td>
      <td>-2.986650e+00</td>
      <td>-2.640962e+00</td>
      <td>-2.457313e+00</td>
      <td>-3.446814e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-7.013606e-01</td>
      <td>-6.997528e-01</td>
      <td>-7.451372e-01</td>
      <td>-7.383912e-01</td>
      <td>-7.763606e-01</td>
      <td>-6.475066e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.660490e-02</td>
      <td>-1.712823e-01</td>
      <td>-2.449306e-02</td>
      <td>9.564649e-02</td>
      <td>8.233024e-02</td>
      <td>-1.432979e-02</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>8.136175e-01</td>
      <td>5.540977e-01</td>
      <td>6.652032e-01</td>
      <td>7.166516e-01</td>
      <td>7.484661e-01</td>
      <td>5.938532e-01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.887855e+00</td>
      <td>3.208033e+00</td>
      <td>2.937664e+00</td>
      <td>2.566186e+00</td>
      <td>2.476256e+00</td>
      <td>3.018254e+00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="shapley-values-feature-ranking">
<h2>Shapley Values (feature ranking)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_nodes</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">tree_shap_model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span> <span class="o">=</span> <span class="n">max_leaf_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">tree_shap_model</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>                          <span class="c1"># Explain the model with SHAP</span>
<span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">shap_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">shap_values</span><span class="p">),</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">shap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Shapley Values'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">shap_avg</span><span class="p">)});</span> <span class="n">shap_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Feature'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">shap_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Shapley Values (average, absolute)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Global Shapley Values'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b3537b09e57d634463cb4d12485c10ea473a4bdc2f13c5a57bff20c0c1ddcca9.png" src="../Images/4661eb5c68462f9ee6ec2e119b0bd0ae.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/b3537b09e57d634463cb4d12485c10ea473a4bdc2f13c5a57bff20c0c1ddcca9.png"/>
</div>
</div>
</section>
<section id="summary-statistics-dataframe">
<h2>Summary Statistics (DataFrame)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                                 <span class="c1"># calculate the summary statistics of each feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>100.500000</td>
      <td>14.991150</td>
      <td>4.330750</td>
      <td>2.968850</td>
      <td>48.161950</td>
      <td>0.990450</td>
      <td>1.964300</td>
      <td>3874.056957</td>
    </tr>
    <tr>
      <th>std</th>
      <td>57.879185</td>
      <td>2.971176</td>
      <td>1.731014</td>
      <td>0.566885</td>
      <td>14.129455</td>
      <td>0.481588</td>
      <td>0.300827</td>
      <td>1615.551334</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>6.550000</td>
      <td>1.130000</td>
      <td>1.280000</td>
      <td>10.940000</td>
      <td>-0.190000</td>
      <td>0.930000</td>
      <td>463.579973</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>50.750000</td>
      <td>12.912500</td>
      <td>3.122500</td>
      <td>2.547500</td>
      <td>37.755000</td>
      <td>0.617500</td>
      <td>1.770000</td>
      <td>2616.522434</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>100.500000</td>
      <td>15.070000</td>
      <td>4.035000</td>
      <td>2.955000</td>
      <td>49.510000</td>
      <td>1.030000</td>
      <td>1.960000</td>
      <td>3801.156899</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>150.250000</td>
      <td>17.402500</td>
      <td>5.287500</td>
      <td>3.345000</td>
      <td>58.262500</td>
      <td>1.350000</td>
      <td>2.142500</td>
      <td>4786.375831</td>
    </tr>
    <tr>
      <th>max</th>
      <td>200.000000</td>
      <td>23.550000</td>
      <td>9.870000</td>
      <td>4.630000</td>
      <td>84.330000</td>
      <td>2.180000</td>
      <td>2.870000</td>
      <td>8428.187903</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="train-and-test-split">
<h2>Train and Test Split</h2>
<p>Random splitting of the data into train and test splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">test_proportion</span> <span class="o">=</span> <span class="mf">0.2</span>                                         <span class="c1"># set the proportion of withheld testing data</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_proportion</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="c1"># train and test split</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="variance-inflation-factor">
<h2>Variance Inflation Factor</h2>
<p>Feature ranking method that only considers the linear redundancy between the predictor features,</p>
<ul class="simple">
<li><p>relationship with the response feature, relevancy is not considered</p></li>
<li><p>general used as a screening method to remove features before more comprehensive feature ranking</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>                                         <span class="c1"># loop over predictor features and store result in pandas series for ease of plotting</span>
    <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">vif_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Variance Inflation Factor (unitless)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Variance Inflation Factor'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e86fe7cffabcf6080b3ed4c7a671ff49b6e2b59355c6e39c654f7ab12292fe8b.png" src="../Images/492166c07e6984b6bc1a673cdc12b030.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e86fe7cffabcf6080b3ed4c7a671ff49b6e2b59355c6e39c654f7ab12292fe8b.png"/>
</div>
</div>
</section>
<section id="comments">
<h2>Comments</h2>
<p>These are some basic code snipets for predictive machine learning in Python. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos’ descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
</section>
<section id="about-the-author">
<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael’s university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael’s work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
</section>
<section id="want-to-work-together">
<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I’d be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I’m always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
</section>
&#13;

<h2>Motivation</h2>
<p>I taught a high school hackathon with great students from all over Texas and beyond and I felt that they could use some additional resources in the form of a <strong>code snippets</strong> to help them over the hurdles of completing their first data science workflow in Python.</p>
<p>Remember the definition of a code snippet is,</p>
<ul class="simple">
<li><p>a small, reusable section of code that programmers can quickly insert into a larger codebase</p></li>
</ul>
<p>My goal is to,</p>
<ul class="simple">
<li><p><strong>provide a set of minimum, simple code snippets</strong> to accomplish basic data science modeling build steps</p></li>
<li><p><strong>avoid fancy additions</strong>, like automatic diagnostics and plotting that are specific to the problem setting that will break with new data</p></li>
</ul>
<p>Therefore, improvements and additions to provide diagnostic outputs and plots are highly recommended.</p>
&#13;

<h2>Structure</h2>
<div class="remove-from-content-only admonition">
<p class="admonition-title">This is not a workflow!</p>
<p>These are alphabetically ordered code snippets and not a complete workflow. Please do not attempt to run this chapter in sequence.</p>
</div>
<p>In order to run the snippets we need to first,</p>
<ol class="arabic simple">
<li><p>Import some python packages</p></li>
<li><p>Declare a couple of convenience functions</p></li>
<li><p>Load some data to demonstrate the code snippets</p></li>
</ol>
<p>After we load the data the remaining codes with be in alphabetical and not any logical workflow order for ease of search and retrieval.</p>
&#13;

<h2>Import Required Packages</h2>
<p>We need some standard packages. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                                            <span class="c1"># arrays</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                                           <span class="c1"># dataframes</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>                               <span class="c1"># plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span> <span class="n">AutoMinorLocator</span><span class="p">,</span> <span class="n">AutoLocator</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span> <span class="c1"># variance inflation factor</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>                      <span class="c1"># basic imputation method</span>
<span class="kn">from</span> <span class="nn">sklearn.experimental</span> <span class="kn">import</span> <span class="n">enable_iterative_imputer</span>     <span class="c1"># required for MICE imputation</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">IterativeImputer</span>                   <span class="c1"># MICE imputation</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">KNNImputer</span>                         <span class="c1"># k-nearest neighbour imputation method</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>          <span class="c1"># train and test split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>             <span class="c1"># linear regression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>              <span class="c1"># standardize the features</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>                <span class="c1"># min and max normalization</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">KBinsDiscretizer</span>            <span class="c1"># k-bin discretizer</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>             <span class="c1"># K-nearest neighbours</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span>            <span class="c1"># random forest method</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">mutual_info_regression</span>  <span class="c1"># mutual information</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>               <span class="c1"># mean absolute error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">normalized_mutual_info_score</span>      <span class="c1"># normalized mutual information</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>                                      <span class="c1"># decision tree</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeRegressor</span>                <span class="c1"># regression tree</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">plot_tree</span>                            <span class="c1"># plot the decision tree</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>                                   <span class="c1"># measures to check our models</span>
<span class="kn">import</span> <span class="nn">shap</span>                                                   <span class="c1"># Shapley values for feature ranking</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                <span class="c1"># set axes and grids in the background for all plots</span>
<span class="kn">import</span> <span class="nn">math</span>                                                  
<span class="n">seed</span> <span class="o">=</span> <span class="mi">13</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>                                         <span class="c1"># a good colormap for folks with color perception issues</span>
<span class="n">utcolor</span> <span class="o">=</span> <span class="s1">'#BF5700'</span>                                           <span class="c1"># burnt orange, Hook'em!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‘python -m pip install [package-name]’. More assistance is available with the respective package docs.</p>
&#13;

<h2>Declare Functions</h2>
<p>Here’s the functions to improve code readability.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>                                               <span class="c1"># add grid lines</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks   </span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Load a Couple Datasets</h2>
<p>We load a couple of datasets,</p>
<ol class="arabic simple">
<li><p>df - an exhaustive data table as a pandas DataFrame</p></li>
<li><p>df_missing an data table with some missing data as a pandas DataFrame</p></li>
<li><p>ndarray_2D - a 2D array map as a NumPy ndarray</p></li>
</ol>
<p>To demonstrat the methods below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/unconv_MV_v4.csv"</span><span class="p">)</span> <span class="c1"># load the data from my github repo</span>
<span class="n">df_missing</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/unconv_MV_missing.csv"</span><span class="p">)</span> 
<span class="n">df_spatial</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/12_sample_data.csv"</span><span class="p">)</span> 
<span class="n">ndarray_2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">"https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/12_AI.csv"</span><span class="p">,</span> 
                     <span class="n">delimiter</span><span class="o">=</span><span class="s2">","</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="mi">7</span><span class="p">)</span>                                     <span class="c1"># set random number seed for reproducibility</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">600.0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="c1"># add noise to demonstrate overfit and hyperparameter tuning</span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Complete Some Basic Operations</h2>
<p>Here I complete some basic operations to ensure that the alphabetically sorted code snippets below have the inputs to avoid errors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>                      <span class="c1"># separate predictor and response, assumes response is the last features</span>
<span class="n">X_missing</span> <span class="o">=</span> <span class="n">df_missing</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">y_missing</span> <span class="o">=</span> <span class="n">df_missing</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="c1"># separate predictor and response, assumes response is the last features</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> 
                <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>             <span class="c1"># train and test split</span>
<span class="n">linear_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>        <span class="c1"># instantiate and train linear regression model, no hyperparmeters</span>
<span class="n">y_hat_train</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>                   <span class="c1"># predict over the training data</span>
<span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                     <span class="c1"># predict over the training data</span>
<span class="n">linear_1pred_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s1">'Por'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># linear regression model with only 1 predictor feature</span>
<span class="n">linear_2pred_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">[[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># linear regression model with only 1 predictor feature</span>
</pre></div>
</div>
</div>
</div>
<p>OK, now we are ready to walk thorugh our alphabetically ordered code snippets.</p>
&#13;

<h2>Beta, <span class="math notranslate nohighlight">\(\beta\)</span>, Coefficients</h2>
<p>Feature importance based on the multilinear regression coefficients of the normalized features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">normalizer</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>                                   <span class="c1"># instantiate the min/max normalizer</span>
<span class="n">norm_array</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># normalize the predictor features                 </span>
<span class="n">X_norm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">norm_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>          <span class="c1"># convert output to a DataFrame</span>
<span class="n">beta_linear_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_norm</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>   <span class="c1"># instantiate and train linear regression model, no hyperparmeters</span>
<span class="n">beta_coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Beta Coefficient'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">ravel</span><span class="p">()))})</span>
<span class="n">beta_coef_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Beta Coefficient (normalized)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Beta Coefficients'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0242c4c943789f3508ddcdf0f54466db0571605cbffc4694f303c5b6f867cfec.png" src="../Images/9f28a7f6ef95f0886ba1d37234411ead.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0242c4c943789f3508ddcdf0f54466db0571605cbffc4694f303c5b6f867cfec.png"/>
</div>
</div>
&#13;

<h2>Correlation (Pearson product momment)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">correlations</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>         <span class="c1"># calculate correlation matrix and extract the pred. rows for the response column</span>
<span class="n">correlations</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Correlation Coefficient'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Correlation Coefficients'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/01b6c1f90ba99386369f74ed5c07b22976da6c3ab67393586c8e9287e428c995.png" src="../Images/055588d911cad1aa273eccf46788a793.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/01b6c1f90ba99386369f74ed5c07b22976da6c3ab67393586c8e9287e428c995.png"/>
</div>
</div>
&#13;

<h2>Correlation (Spearman rank)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">rank_correlations</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">'spearman'</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1"># calculate Spearman correlation with same method as Pearson above</span>
<span class="n">rank_correlations</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rank Correlation Coefficient'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Rank Correlation Coefficients'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/793c62c2e433f3d5824617e6404b5a63fc9fa91f3ffb1a23e5f11b6aef582fd6.png" src="../Images/5a27c57a196ffce0c3c085265c5bc0e9.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/793c62c2e433f3d5824617e6404b5a63fc9fa91f3ffb1a23e5f11b6aef582fd6.png"/>
</div>
</div>
&#13;

<h2>Cross Validation Plot (training and testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Training Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Testing Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9dd5b2ef7db8189250200c8fda4684707fd265c686f3d344fd988859b056f10c.png" src="../Images/751a56b5a9a1b3b432d910a4efc96752.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/9dd5b2ef7db8189250200c8fda4684707fd265c686f3d344fd988859b056f10c.png"/>
</div>
</div>
&#13;

<h2>Cross Validation Plot (testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Testing Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/46b7748af289cbd304af34994fe959c5a2f18d75bc1f14f21555bf54972513bf.png" src="../Images/3eeeb0c09c9483eeaa7356c233fe26bf.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/46b7748af289cbd304af34994fe959c5a2f18d75bc1f14f21555bf54972513bf.png"/>
</div>
</div>
&#13;

<h2>Cross Validation Plot (training)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Training Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth Production (MCFPD)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e9004125ee8191a22a71ca31d0c303276bc944bdac42e6a5baa00e5f1de1320d.png" src="../Images/4b42cb5667d6c4b3852871763244ac85.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e9004125ee8191a22a71ca31d0c303276bc944bdac42e6a5baa00e5f1de1320d.png"/>
</div>
</div>
&#13;

<h2>DataFrame (add noise to a feature)</h2>
<p>I do this to experiment and make educational content, e.g., add noise to the response feature to demonstrate overfit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>                                     <span class="c1"># set random seed for repeatability</span>
<span class="n">df_temp</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df_temp</span><span class="p">))</span> <span class="c1"># add a feature of ones called 'Ones'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2154.457620</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3199.991714</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2742.009861</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3927.738944</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2343.080242</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>DataFrame (add a new feature/column)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span><span class="p">[</span><span class="s1">'Ones'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df_temp</span><span class="p">)))</span>                     <span class="c1"># add a feature of ones called 'Ones'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
      <th>Ones</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>DataFrame (make new)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Ones'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">100</span><span class="p">)),</span><span class="s1">'Zeros'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">))})</span> <span class="c1"># make new DataFrame</span>
<span class="n">df_new</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Ones</th>
      <th>Zeros</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>DataFrame (preview)</h2>
<p>Display the first ‘n’ rows of the DataFrame</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>                                                 <span class="c1"># display the first n rows of the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4353.192212</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>3516.494383</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2083.845221</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>12.52</td>
      <td>2.72</td>
      <td>2.43</td>
      <td>65.77</td>
      <td>0.95</td>
      <td>1.98</td>
      <td>2775.906282</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>13.25</td>
      <td>3.94</td>
      <td>3.71</td>
      <td>66.20</td>
      <td>1.14</td>
      <td>2.65</td>
      <td>2966.741947</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>15.04</td>
      <td>4.39</td>
      <td>2.22</td>
      <td>61.11</td>
      <td>1.08</td>
      <td>1.77</td>
      <td>4022.323780</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>16.19</td>
      <td>6.30</td>
      <td>2.29</td>
      <td>49.10</td>
      <td>1.53</td>
      <td>1.86</td>
      <td>4799.763575</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>16.82</td>
      <td>5.42</td>
      <td>2.80</td>
      <td>66.65</td>
      <td>1.17</td>
      <td>1.98</td>
      <td>3616.427242</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>DataFrame (rename a feature/column)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">'Por'</span><span class="p">:</span><span class="s1">'Porosity (%)'</span><span class="p">},</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   <span class="c1"># rename 'Por' features as 'Porosity'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Porosity (%)</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>DataFrame (remove features/columns)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'Well'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>        <span class="c1"># remove features 'Well','Por' and 'AI'</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Perm</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.92</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>3.53</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.59</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6.75</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4.57</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>DataFrame (remove samples/rows)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span> <span class="o">=</span> <span class="n">df_temp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>                   <span class="c1"># removes samples 0, 2 and 4</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4353.192212</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>3516.494383</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2083.845221</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>DataFrame (remove samples/rows by condition)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_temp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                  <span class="c1"># make a deep copy of the DataFrame</span>
<span class="n">df_temp</span> <span class="o">=</span> <span class="n">df_temp</span><span class="p">[</span><span class="n">df_temp</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">13.0</span><span class="p">]</span>                      <span class="c1"># remove all samples with 'Por' &lt;= 13%</span>
<span class="n">df_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2208.570072</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4353.192212</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>3516.494383</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Decision Tree (feature importance)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>

<span class="n">beta_coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Tree-based Feature Importance'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">tree_model</span><span class="o">.</span><span class="n">feature_importances_</span><span class="o">.</span><span class="n">ravel</span><span class="p">())})</span>
<span class="n">beta_coef_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Feature Importance'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Decision Tree Feature Importance'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/498e717d8cd4f6a6f673071a88cbd7a4b3370249d7bdd3b4c0506fede88353ca.png" src="../Images/bcee90b2c8924008ccfa87e26612ee2c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/498e717d8cd4f6a6f673071a88cbd7a4b3370249d7bdd3b4c0506fede88353ca.png"/>
</div>
</div>
&#13;

<h2>Decision Tree (prediction at testing data)</h2>
<p>Apply our model to predict at withheld testing data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_test_temp</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_test_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>    <span class="c1"># predict over the training data</span>
<span class="n">y_test_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>656.507448</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>155</th>
      <td>3110.245382</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2581.359826</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>159</th>
      <td>6498.151446</td>
      <td>6482.917835</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4148.822923</td>
      <td>4297.451039</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Decision Tree (prediction at training data)</h2>
<p>Apply our model to predict at the retained training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_train_temp</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_train_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>  <span class="c1"># predict over the training data</span>
<span class="n">y_train_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>125</th>
      <td>3750.106623</td>
      <td>4297.451039</td>
    </tr>
    <tr>
      <th>68</th>
      <td>4644.717576</td>
      <td>4297.451039</td>
    </tr>
    <tr>
      <th>69</th>
      <td>1991.991593</td>
      <td>2218.196237</td>
    </tr>
    <tr>
      <th>108</th>
      <td>6688.360827</td>
      <td>6482.917835</td>
    </tr>
    <tr>
      <th>131</th>
      <td>5076.638358</td>
      <td>4297.451039</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Decision Tree (train)</h2>
<p>Train model parameters on training data with specified model hyperparameters</p>
<ul class="simple">
<li><p>let’s look at the trained model parameters, by visualizing the trained decision tree.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">5</span>                                                 <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">plot_tree</span><span class="p">(</span><span class="n">tree_model</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span> <span class="c1"># plot the decision tree</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d6589d670e2e9b593d1e13e44cfe8c153b4c836395654656835da04c747d5194.png" src="../Images/17779d19ebdf48d8cb9ff106de64bb16.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d6589d670e2e9b593d1e13e44cfe8c153b4c836395654656835da04c747d5194.png"/>
</div>
</div>
&#13;

<h2>Decision Tree (retrain tuned model)</h2>
<p>Apply tuned hyperparameters and retrain the model with all the data.</p>
<ul class="simple">
<li><p>this is the model that we will use for future predictions, real-world use</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">tuned_leaf_node</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>                                         <span class="c1"># decision tree model hyperparameters</span>
<span class="n">tuned_tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">tuned_leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">tuned_tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                           <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bed759efe8f74ab399429a00ba5e1a7deb2f0564e294d93190f0787e1b1df966.png" src="../Images/b9f7acf97318db4212998bf321561437.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/bed759efe8f74ab399429a00ba5e1a7deb2f0564e294d93190f0787e1b1df966.png"/>
</div>
</div>
&#13;

<h2>Decision Tree (tune/prune)</h2>
<p>Train model parameters on training data with a range of model hyperparameters, select the model hyperparameters with minimum error over the withheld testing data</p>
<p>This requires the following steps,</p>
<p>Loop over the hyperparameter(s) values,</p>
<ol class="arabic simple">
<li><p>train the model with the retained training data</p></li>
<li><p>predict at the withheld testing data</p></li>
<li><p>calculate the testing error</p></li>
</ol>
<p>Select the hyperparameter that minimized the testing error</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">leaf_node</span> <span class="o">=</span> <span class="mi">2</span>                                                 <span class="c1"># set initial hyperparameter</span>
<span class="n">MSE_tree_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">leaf_node_list</span> <span class="o">=</span> <span class="p">[]</span>                       <span class="c1"># make lists to store the results</span>
<span class="k">while</span> <span class="n">leaf_node</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="p">:</span>                                       <span class="c1"># loop over the number of leaf nodes hyperparameter</span>
    <span class="n">tree_model</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">leaf_node</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instandiate and train the model</span>
    <span class="n">y_hat_test</span> <span class="o">=</span> <span class="n">tree_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                   <span class="c1"># predict over the testing cases</span>
    <span class="n">MSE_tree</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">)</span>  <span class="c1"># calculate the MSE testing</span>
    <span class="n">MSE_tree_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MSE_tree</span><span class="p">)</span>                            <span class="c1"># add to the list of MSE</span>
    <span class="n">leaf_node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">leaf_node</span><span class="p">)</span>                          <span class="c1"># append leaf node to an array for plotting</span>
    <span class="n">leaf_node</span> <span class="o">=</span> <span class="n">leaf_node</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">tuned_leaf_nodes</span> <span class="o">=</span> <span class="n">leaf_node_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">MSE_tree_list</span><span class="p">)]</span>           <span class="c1"># get the k that minimizes the testing MSE</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">leaf_node_list</span><span class="p">,</span><span class="n">MSE_tree_list</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span> <span class="c1"># plot testing MSE vs. hyperparameter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tuned_leaf_nodes</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Tuned Leaf Nodes = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tuned_leaf_nodes</span><span class="p">),[</span><span class="n">tuned_leaf_nodes</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">0.8e6</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Tree: Withheld Testing Error vs. Number of Leaf Nodes'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of Leaf Nodes'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Test Mean Square Error'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b60aa2eac0a1291d28f8028ee5949559b2cb770db7315a469587f57d0769aaa3.png" src="../Images/820a0d93ba1a606ae2d0b29b1b972028.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/b60aa2eac0a1291d28f8028ee5949559b2cb770db7315a469587f57d0769aaa3.png"/>
</div>
</div>
&#13;

<h2>Features Extraction (by name)</h2>
<p>Build a new DataFrame with only the selected predictor feature and the response feature</p>
<ol class="arabic simple">
<li><p>specify the selected predictor features</p></li>
<li><p>specify the response feature</p></li>
<li><p>build a list with both</p></li>
<li><p>make a new DataFrame with first the predictor features and then the response feature as the last column</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">selected_predictor_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">]</span>   <span class="c1"># set the selected predictor features</span>
<span class="n">response_feature</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Prod'</span><span class="p">]</span>                                   <span class="c1"># set the response feature</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">selected_predictor_features</span> <span class="o">+</span> <span class="n">response_feature</span>     <span class="c1"># build a list of selected predictor and response features</span>
<span class="n">df_selected</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">features</span><span class="p">]</span>                              <span class="c1"># slice the DataFrame</span>
<span class="n">df_selected</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Features Extraction (by number)</h2>
<p>Build a new DataFrame with only the selected predictor feature.</p>
<ol class="arabic simple">
<li><p>specify the selected predictor features</p></li>
<li><p>specify the response feature</p></li>
<li><p>build a list with both</p></li>
<li><p>make a new DataFrame with first the predictor features and then the response feature as the last column</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">selected_predictor_features</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>                     <span class="c1"># set the selected predictor features</span>
<span class="n">df_selected_predictor</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">selected_predictor_features</span><span class="p">]</span> <span class="c1"># slice the DataFrame</span>
<span class="n">df_selected_predictor</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>2225.696687</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>3124.615076</td>
    </tr>
    <tr>
      <th>2</th>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>2746.460169</td>
    </tr>
    <tr>
      <th>3</th>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>3882.557711</td>
    </tr>
    <tr>
      <th>4</th>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>2208.570072</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Features Extraction (make X and y DataFrames)</h2>
<p>Build a two new DataFrames, one with only the selected predictor feature and the other with the response feature,</p>
<ul class="simple">
<li><p>assuming that the last feature is the response feature</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'VR'</span><span class="p">]]</span>                               <span class="c1"># extract the list the predictor feature by name</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s1">'Prod'</span><span class="p">]]</span>                                        <span class="c1"># extract the response feature</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Predictor features: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">Response feature: '</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Predictor features: ['Por', 'AI', 'VR']
Response feature: Prod
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Features Extraction (make X and y DataFrames assumed feature order)</h2>
<p>Build a two new DataFrames, one with only the selected predictor feature and the other with the response feature,</p>
<ul class="simple">
<li><p>assuming that the last feature is the response feature</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span> <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>                      <span class="c1"># extract by assuming 2nd to 2nd last are predictors and last is response feature</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Predictor features: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="o">+</span> <span class="s1">'</span><span class="se">\n</span><span class="s1">Response feature: '</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Predictor features: ['Por', 'Perm', 'AI', 'Brittle', 'TOC', 'VR']
Response feature: Prod
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Histogram</h2>
<p>Simple histogram,</p>
<ul class="simple">
<li><p>you can set the histogram limits by specifying the exact bins with a method like, np.linspace(min,max,n)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">)</span> <span class="c1"># histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Porosity Distribution'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0ff41b2a04299239a5787ea06ee741abd39a85b84705e042e481757fa761783f.png" src="../Images/479b7b449b4f65cbff1f33f5912dd525.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0ff41b2a04299239a5787ea06ee741abd39a85b84705e042e481757fa761783f.png"/>
</div>
</div>
&#13;

<h2>Histogram (normalized)</h2>
<p>A histogram with probability on the y axis and the sum of all bars is one, i.e., probability closure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># normalized histogram</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Porosity Distribution'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Probability'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/418e0e90a2846168a380bc4e0ecbfdc630e06e4d53b06e01a518f9cf2dbe00a1.png" src="../Images/1f995c05278fd97a4977e9ffb72e72ca.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/418e0e90a2846168a380bc4e0ecbfdc630e06e4d53b06e01a518f9cf2dbe00a1.png"/>
</div>
</div>
&#13;

<h2>Image Plot</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">6500</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span> <span class="c1"># plot of 2D ndarray, image or map feature</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">7500</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X (m)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y (m)'</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Acoustic Impedence ($\frac</span><span class="si">{kg}</span><span class="s1">{m^3} \cdot \frac</span><span class="si">{m}{s}</span><span class="s1"> \cdot 10^3$)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Acoustic Impedance'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c86ec564386d943eec0c63d05909805d2ef77161ec97f54666f8f4014aa78cd5.png" src="../Images/81941c32cdbce6c5d5afa4c43c371885.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/c86ec564386d943eec0c63d05909805d2ef77161ec97f54666f8f4014aa78cd5.png"/>
</div>
</div>
&#13;

<h2>Image Plot (combined with location map)</h2>
<p>Superimpose multiple plots on top of each other,</p>
<ul class="simple">
<li><p>use ‘zorder’ to place object in front of other objects, higher number is in front</p></li>
<li><p>make sure all objects are in the same plot space</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">],</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">6500</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># plot of 2D ndarray, image or map feature</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'X'</span><span class="p">],</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'Y'</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'AI'</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1500</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">6500</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2500</span><span class="p">,</span> <span class="mi">7500</span><span class="p">,</span> <span class="mi">10</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X (m)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y (m)'</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Acoustic Impedence ($\frac</span><span class="si">{kg}</span><span class="s1">{m^3} \cdot \frac</span><span class="si">{m}{s}</span><span class="s1"> \cdot 10^3$)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Acoustic Impedance Image and Samples at Wells'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e209044ada9e1ec85d74ec9b44724049f126863a34e47f23e678d71f469c2e3d.png" src="../Images/a3b326fefec63f72f7e2b67536a2e4a6.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e209044ada9e1ec85d74ec9b44724049f126863a34e47f23e678d71f469c2e3d.png"/>
</div>
</div>
&#13;

<h2>K-Nearest Neighbours (feature imputation)</h2>
<p>Feature imputation by estimating missing features with the nearest neighbours,</p>
<ul class="simple">
<li><p>distance is accessed with all samples that have all features present in the sample with a missing feature</p></li>
<li><p>only one pass is applied, there is no iteration</p></li>
<li><p>not as robust as MICE is there is a lot of missing data, it does not learn the structure between the features to fill in missing data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">knn_imputer</span> <span class="o">=</span> <span class="n">KNNImputer</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">"uniform"</span><span class="p">)</span>    <span class="c1"># instantiate Multiple Imputation by Chained Equations (MICE) imputer</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">knn_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_missing</span><span class="p">)</span>              <span class="c1"># train and apply MICE to impute the missing data</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># make imputed results into a DataFrame with same columns as X</span>
<span class="n">X_imputed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                          <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14.924820</td>
      <td>1.375450</td>
      <td>2.982915</td>
      <td>49.227565</td>
      <td>1.014950</td>
      <td>1.997420</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.999168</td>
      <td>0.367557</td>
      <td>0.557240</td>
      <td>13.755077</td>
      <td>0.480852</td>
      <td>0.284183</td>
    </tr>
    <tr>
      <th>min</th>
      <td>5.400000</td>
      <td>0.120000</td>
      <td>0.960000</td>
      <td>-1.500000</td>
      <td>-0.250000</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.846250</td>
      <td>1.145000</td>
      <td>2.590000</td>
      <td>40.640000</td>
      <td>0.700000</td>
      <td>1.830000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>15.035000</td>
      <td>1.360000</td>
      <td>3.010000</td>
      <td>49.477500</td>
      <td>1.007500</td>
      <td>2.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>17.012500</td>
      <td>1.610000</td>
      <td>3.330000</td>
      <td>58.055000</td>
      <td>1.370000</td>
      <td>2.165000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.650000</td>
      <td>2.580000</td>
      <td>4.700000</td>
      <td>93.470000</td>
      <td>2.710000</td>
      <td>2.900000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>K-Nearest Neighbours (prediction at testing data)</h2>
<p>Apply our model to predict at withheld testing data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_neighbours</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                 <span class="c1"># KNN model hyperparameters</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbours</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_test_temp</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_test_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>     <span class="c1"># predict over the training data</span>
<span class="n">y_test_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>656.507448</td>
      <td>2303.626455</td>
    </tr>
    <tr>
      <th>155</th>
      <td>3110.245382</td>
      <td>3774.108284</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2581.359826</td>
      <td>2321.644376</td>
    </tr>
    <tr>
      <th>159</th>
      <td>6498.151446</td>
      <td>5713.166746</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4148.822923</td>
      <td>4108.942362</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>K-Nearest Neighbours (prediction at training data)</h2>
<p>Apply our model to predict at the retained training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_neighbours</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                 <span class="c1"># KNN model hyperparameters</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbours</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">y_train_temp</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y_train_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>   <span class="c1"># predict over the training data</span>
<span class="n">y_train_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>125</th>
      <td>3750.106623</td>
      <td>3974.087763</td>
    </tr>
    <tr>
      <th>68</th>
      <td>4644.717576</td>
      <td>4226.039680</td>
    </tr>
    <tr>
      <th>69</th>
      <td>1991.991593</td>
      <td>3165.041802</td>
    </tr>
    <tr>
      <th>108</th>
      <td>6688.360827</td>
      <td>6336.236197</td>
    </tr>
    <tr>
      <th>131</th>
      <td>5076.638358</td>
      <td>5332.676914</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>K-Nearest Neighbours (train)</h2>
<p>Train model parameters on training data with specified model hyperparameters</p>
<ul class="simple">
<li><p>since K-nearest neighbours is a lazy learning model, there are no trained model parameters to display</p></li>
<li><p>instead we look at the cross validation plot</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                             <span class="c1"># KNN model hyperparameters</span>
<span class="n">neigh</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">)</span> <span class="c1"># instantiate the prediction model</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>                        <span class="c1"># train the model with the training data</span>
<span class="n">y_train_hat</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>                      <span class="c1"># predict over the testing cases</span>
<span class="n">y_test_hat</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                        <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_train_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Training Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_test_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Testing Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/eab39432f0ca9fd360006ebec626cc016401b43ee69b4f7b5b60678d249f978e.png" src="../Images/05f34f230707d1aed62b1163edc58876.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/eab39432f0ca9fd360006ebec626cc016401b43ee69b4f7b5b60678d249f978e.png"/>
</div>
</div>
&#13;

<h2>K-Nearest Neighbours (retrain tuned model)</h2>
<p>Apply tuned hyperparameters and retrain the model with all the data.</p>
<ul class="simple">
<li><p>this is the model that we will use for future predictions, real-world use</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">tuned_k</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                      <span class="c1"># KNN model hyperparameters</span>
<span class="n">knn_tuned_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">tuned_k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="c1"># retrain the tuned model with all data</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">knn_tuned_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                            <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5a2ca81f6a2c7d36a865cd0ca4aaeda29ddbc131ec5d90cbd7651a11d56abf5b.png" src="../Images/e88e73510d427f28dd66ee5ee6f593d7.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/5a2ca81f6a2c7d36a865cd0ca4aaeda29ddbc131ec5d90cbd7651a11d56abf5b.png"/>
</div>
</div>
&#13;

<h2>K-Nearest Neighbours (tune)</h2>
<p>Train model parameters on training data with a range of model hyperparameters, select the model hyperparameters with minimum error over the withheld testing data</p>
<p>This requires the following steps,</p>
<p>Loop over the hyperparameter(s) values,</p>
<ol class="arabic simple">
<li><p>train the model with the retained training data</p></li>
<li><p>predict at the withheld testing data</p></li>
<li><p>calculate the testing error</p></li>
</ol>
<p>Select the hyperparameter that minimized the testing error</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">weights</span> <span class="o">=</span> <span class="s1">'uniform'</span>                                    <span class="c1"># set initial, lowest k hyperparameter</span>
<span class="n">MSE_knn_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">k_list</span> <span class="o">=</span> <span class="p">[]</span>                                <span class="c1"># make lists to store the results</span>
<span class="k">while</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="mi">150</span><span class="p">:</span>                                               <span class="c1"># loop over the k hyperparameter</span>
    <span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">weights</span> <span class="o">=</span> <span class="n">weights</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="n">k</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span> <span class="c1"># instandiate and train the model</span>
    <span class="n">y_test_hat</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>                    <span class="c1"># predict over the testing cases</span>
    <span class="n">MSE</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_test_hat</span><span class="p">)</span>       <span class="c1"># calculate the MSE testing</span>
    <span class="n">MSE_knn_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MSE</span><span class="p">)</span>                                  <span class="c1"># add to the list of MSE</span>
    <span class="n">k_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>                                          <span class="c1"># append k to an array for plotting</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">tuned_k</span> <span class="o">=</span> <span class="n">k_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">MSE_knn_list</span><span class="p">)]</span>                     <span class="c1"># get the k that minimizes the testing MSE</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>                                              <span class="c1"># plot the testing error vs. hyperparameter</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">k_list</span><span class="p">,</span><span class="n">MSE_knn_list</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tuned_k</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Tuned k = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tuned_k</span><span class="p">),[</span><span class="n">tuned_k</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="mf">2.0e6</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'KNN: Testing Error vs. Number of Nearest Neighbours'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of Nearest Neighbours'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Testing Mean Square Error'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d19bc60e905a2ecfeaea5603abad42f0a080fc5df476fed45044fefd8c1b4a39.png" src="../Images/62c23543209403ea04861f7d6ec38b54.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d19bc60e905a2ecfeaea5603abad42f0a080fc5df476fed45044fefd8c1b4a39.png"/>
</div>
</div>
&#13;

<h2>Linear Regression Model (model parameters)</h2>
<p>Retreive the model parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Intercept'</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Coefficient'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">ravel</span><span class="p">())})</span>
<span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Feature</th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Intercept</td>
      <td>-4053.511325</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Por</td>
      <td>453.607135</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Perm</td>
      <td>24.707076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AI</td>
      <td>-154.448203</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brittle</td>
      <td>11.173989</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TOC</td>
      <td>-183.938586</td>
    </tr>
    <tr>
      <th>6</th>
      <td>VR</td>
      <td>580.078458</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Linear Regression Model (prediction test)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">y_test_temp</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                          <span class="c1"># make a deep copy of the y test DataFrame</span>
<span class="n">y_test_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>  <span class="c1"># predict over the training data</span>
<span class="n">y_test_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>179</th>
      <td>656.507448</td>
      <td>379.818856</td>
    </tr>
    <tr>
      <th>155</th>
      <td>3110.245382</td>
      <td>2943.388125</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2581.359826</td>
      <td>1372.426014</td>
    </tr>
    <tr>
      <th>159</th>
      <td>6498.151446</td>
      <td>5563.914978</td>
    </tr>
    <tr>
      <th>96</th>
      <td>4148.822923</td>
      <td>4987.375301</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Linear Regression Model (prediction train)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">y_train_temp</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                        <span class="c1"># make a deep copy of the y train DataFrame</span>
<span class="n">y_train_temp</span><span class="p">[</span><span class="s1">'Estimated Prod'</span><span class="p">]</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span><span class="c1"># predict over the training data</span>
<span class="n">y_train_temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Prod</th>
      <th>Estimated Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>125</th>
      <td>3750.106623</td>
      <td>3938.246048</td>
    </tr>
    <tr>
      <th>68</th>
      <td>4644.717576</td>
      <td>3824.308392</td>
    </tr>
    <tr>
      <th>69</th>
      <td>1991.991593</td>
      <td>2906.015510</td>
    </tr>
    <tr>
      <th>108</th>
      <td>6688.360827</td>
      <td>6653.961261</td>
    </tr>
    <tr>
      <th>131</th>
      <td>5076.638358</td>
      <td>5048.864286</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Linear Regression Model (train)</h2>
<p>Train model parameters on training data, no hyperparameters</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">linear_model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span><span class="n">y_train</span><span class="p">)</span>        <span class="c1"># instantiate and train linear regression model, no hyperparmeters</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Intercept'</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Coefficient'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">linear_model</span><span class="o">.</span><span class="n">coef_</span><span class="o">.</span><span class="n">ravel</span><span class="p">())})</span>
<span class="n">coef_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Feature</th>
      <th>Coefficient</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Intercept</td>
      <td>-4053.511325</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Por</td>
      <td>453.607135</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Perm</td>
      <td>24.707076</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AI</td>
      <td>-154.448203</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Brittle</td>
      <td>11.173989</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TOC</td>
      <td>-183.938586</td>
    </tr>
    <tr>
      <th>6</th>
      <td>VR</td>
      <td>580.078458</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Listwise Deletion</h2>
<p>Remove all samples that are missing and features.</p>
<ul class="simple">
<li><p>the “sledge hammer” approach to avoid feature imputation</p></li>
<li><p>not recommended, often removes too much data</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df_listwise</span> <span class="o">=</span> <span class="n">df_missing</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">'any'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>      <span class="c1"># listwise deletion</span>
<span class="n">df_listwise</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>WellIndex</th>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Production</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
      <td>210.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>485.680952</td>
      <td>14.976381</td>
      <td>1.407238</td>
      <td>2.999857</td>
      <td>49.406143</td>
      <td>1.005524</td>
      <td>2.001524</td>
      <td>2373.025529</td>
    </tr>
    <tr>
      <th>std</th>
      <td>292.292307</td>
      <td>3.072786</td>
      <td>0.422033</td>
      <td>0.584267</td>
      <td>14.311860</td>
      <td>0.521783</td>
      <td>0.306854</td>
      <td>1661.542253</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.000000</td>
      <td>6.480000</td>
      <td>0.360000</td>
      <td>1.330000</td>
      <td>17.200000</td>
      <td>-0.230000</td>
      <td>0.900000</td>
      <td>75.215188</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>206.250000</td>
      <td>12.682500</td>
      <td>1.110000</td>
      <td>2.612500</td>
      <td>39.117500</td>
      <td>0.640000</td>
      <td>1.800000</td>
      <td>1154.774039</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>477.500000</td>
      <td>15.035000</td>
      <td>1.415000</td>
      <td>3.055000</td>
      <td>48.320000</td>
      <td>0.980000</td>
      <td>2.010000</td>
      <td>2029.697410</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>729.500000</td>
      <td>17.085000</td>
      <td>1.680000</td>
      <td>3.360000</td>
      <td>58.547500</td>
      <td>1.347500</td>
      <td>2.220000</td>
      <td>3223.502405</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1000.000000</td>
      <td>24.650000</td>
      <td>2.480000</td>
      <td>4.500000</td>
      <td>86.800000</td>
      <td>2.560000</td>
      <td>2.820000</td>
      <td>12568.644130</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Location Map</h2>
<p>For plotting sparsely sampled features with X and Y sample locations to inspect the spatial structures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">;</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">10000</span><span class="p">;</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">;</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.27</span>   <span class="c1"># set plot limits and feature limits</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'X'</span><span class="p">],</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'Y'</span><span class="p">],</span><span class="n">c</span><span class="o">=</span><span class="n">df_spatial</span><span class="p">[</span><span class="s1">'Porosity'</span><span class="p">],</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">vmin</span><span class="p">,</span><span class="n">vmax</span><span class="p">,</span><span class="mi">10</span><span class="p">));</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X (m)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y (m)'</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Porosity (fraction)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Location Map: Porosity'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a7838f0acb4fea58f25cb89ea2238304b6fc709f5438bc9fdbc9d89c96544a0e.png" src="../Images/77573508b926ea28e65e395fe3a10574.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a7838f0acb4fea58f25cb89ea2238304b6fc709f5438bc9fdbc9d89c96544a0e.png"/>
</div>
</div>
&#13;

<h2>Mean (imputation)</h2>
<p>A very simple approach for feature imputation, replace the missing values with the mean of the feature,</p>
<ul class="simple">
<li><p>does on introduce a bias in the mean, but will introduce a bias in the standard deviation and variance</p></li>
<li><p>will likely bias low the between predictor and response feature correlation</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">mean_imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">'mean'</span><span class="p">)</span>                 <span class="c1"># instantiate mean imputor</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">mean_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_missing</span><span class="p">)</span>             <span class="c1"># train and apply MICE to impute the missing data</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># make imputed results into a DataFrame with same columns as X</span>
<span class="n">X_imputed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                          <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14.898708</td>
      <td>1.383061</td>
      <td>2.984200</td>
      <td>49.607696</td>
      <td>0.999551</td>
      <td>1.996173</td>
    </tr>
    <tr>
      <th>std</th>
      <td>2.933199</td>
      <td>0.344835</td>
      <td>0.544243</td>
      <td>12.532978</td>
      <td>0.431517</td>
      <td>0.265394</td>
    </tr>
    <tr>
      <th>min</th>
      <td>5.400000</td>
      <td>0.120000</td>
      <td>0.960000</td>
      <td>-1.500000</td>
      <td>-0.250000</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.940000</td>
      <td>1.217500</td>
      <td>2.630000</td>
      <td>43.937500</td>
      <td>0.800000</td>
      <td>1.897500</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>14.898708</td>
      <td>1.383061</td>
      <td>2.984200</td>
      <td>49.607696</td>
      <td>0.999551</td>
      <td>1.996173</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>16.840000</td>
      <td>1.530000</td>
      <td>3.302500</td>
      <td>55.515000</td>
      <td>1.210000</td>
      <td>2.110000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.650000</td>
      <td>2.580000</td>
      <td>4.700000</td>
      <td>93.470000</td>
      <td>2.710000</td>
      <td>2.900000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Minimum and Maximum (dataframe)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="s1">'Dataframe Minimum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>                  <span class="c1"># using pandas DataFrame's min and max member functions</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">Dataframe Maximum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Dataframe Minimum:
Well         1.000000
Por          6.550000
Perm         1.130000
AI           1.280000
Brittle     10.940000
TOC         -0.190000
VR           0.930000
Prod       463.579973
dtype: float64

Dataframe Maximum:
Well        200.000000
Por          23.550000
Perm          9.870000
AI            4.630000
Brittle      84.330000
TOC           2.180000
VR            2.870000
Prod       8428.187903
dtype: float64
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Minimum and Maximum (ndarray)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="nb">print</span><span class="p">(</span><span class="s1">'2D ndarray Minimum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">))</span>       <span class="c1"># using NumPy's min and max functions that flatten internally</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">2D ndarray Maximum:'</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ndarray_2D</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>2D ndarray Minimum:
1516.949331702811

2D ndarray Maximum:
6735.039007281679
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Model Plot (linear 1D)</h2>
<p>We use the follow steps,</p>
<ol class="arabic simple">
<li><p>make an array of equally spaced values of the predictor feature(s)</p></li>
<li><p>predict at all of these predictor values</p></li>
<li><p>cross plot the predictions with the predictor values</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>                <span class="c1"># array of equally space values in the predictor feature</span>
<span class="n">y_hat_linear_1pred</span> <span class="o">=</span> <span class="n">linear_1pred_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_values</span><span class="p">)</span>     <span class="c1"># predict over the predictor feature values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">100</span><span class="p">),</span><span class="n">y_hat_linear_1pred</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># plot the predictions vs. the predictor values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Production (MCFPD)'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a4c0583b40c49bf06c7fa895961557fd17d1ca0773f145b95f65432f518cdeeb.png" src="../Images/141c08e9389489310c40fdfbff300226.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a4c0583b40c49bf06c7fa895961557fd17d1ca0773f145b95f65432f518cdeeb.png"/>
</div>
</div>
&#13;

<h2>Model Plot (linear 2D)</h2>
<p>We use the follow steps,</p>
<ol class="arabic simple">
<li><p>make a mesh array of equally spaced values of the predictor feature(s)</p></li>
<li><p>predict at all of these predictor values</p></li>
<li><p>flatten all meshes to 1D</p></li>
<li><p>plot with a colored scatter plot with square markers (s) scalled to fill in the plot</p></li>
</ol>
<p>I prefer this method because plt.imshow often is inconsistent with other plots when added as a subplot</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">XX1</span><span class="p">,</span> <span class="n">XX2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mf">25.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">102.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">))</span> <span class="c1"># get a regular grid of response feature values</span>
<span class="n">y_hat</span> <span class="o">=</span> <span class="n">linear_2pred_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">XX1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">XX2</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># predict over grid and convert to a 1D vector</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">XX1</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">XX2</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">c</span><span class="o">=</span><span class="n">y_hat</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s1">'s'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span> <span class="c1"># convert XX1/2 to 1D vectors use for scatter plot</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">"vertical"</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">13</span><span class="p">));</span> <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Production (MCFPD)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Brittleness (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">25</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/193089af665cc59cf9497b4914122f55a90b0c545f5a56100202ad8a88b12a47.png" src="../Images/aeff9cc3fc5950d96bb7e8d93ffafa1c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/193089af665cc59cf9497b4914122f55a90b0c545f5a56100202ad8a88b12a47.png"/>
</div>
</div>
&#13;

<h2>Model Mean Absolute Error (testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_test</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">)</span>     <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MAE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_test</span><span class="p">))</span>                 <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MAE: 679.7220485741077
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Model Mean Absolute Error (training)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_train</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">)</span>  <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MAE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_train</span><span class="p">))</span>                <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MAE: 713.4026730760603
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Model MSE (testing)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_test</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span><span class="n">y_hat_test</span><span class="p">)</span>      <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MSE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_test</span><span class="p">))</span>                 <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MSE: 731861.1594257785
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Model MSE (training)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">MSE_train</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span><span class="n">y_hat_train</span><span class="p">)</span>   <span class="c1"># calculate the training MSE</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Model Training MSE: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">MSE_train</span><span class="p">))</span>                <span class="c1"># print the training MSE</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model Training MSE: 805986.6842431575
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Multiple Imputation by Chained Equations</h2>
<p>Feature imputation by iterative application of K-nearest neighbours,</p>
<ul class="simple">
<li><p>accomplished by multiple passes, the structure in the data is learned to improve the imputation</p></li>
<li><p>robust with significant porportion of missing feature values</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">mice_imputer</span> <span class="o">=</span> <span class="n">IterativeImputer</span><span class="p">(</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">,</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># instantiate Multiple Imputation by Chained Equations (MICE) imputer</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">mice_imputer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_missing</span><span class="p">)</span>             <span class="c1"># train and apply MICE to impute the missing data</span>
<span class="n">X_imputed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_imputed</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">X_missing</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="c1"># make imputed results into a DataFrame with same columns as X</span>
<span class="n">X_imputed</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                          <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>LogPerm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
      <td>1000.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>14.944723</td>
      <td>1.404668</td>
      <td>2.980626</td>
      <td>49.817322</td>
      <td>1.005436</td>
      <td>1.990035</td>
    </tr>
    <tr>
      <th>std</th>
      <td>3.030406</td>
      <td>0.397241</td>
      <td>0.565985</td>
      <td>14.029791</td>
      <td>0.492149</td>
      <td>0.302019</td>
    </tr>
    <tr>
      <th>min</th>
      <td>5.400000</td>
      <td>0.120000</td>
      <td>0.960000</td>
      <td>-5.422936</td>
      <td>-0.306453</td>
      <td>0.900000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>12.850000</td>
      <td>1.142772</td>
      <td>2.580000</td>
      <td>41.384356</td>
      <td>0.660000</td>
      <td>1.810000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>14.950000</td>
      <td>1.395805</td>
      <td>3.010000</td>
      <td>50.077539</td>
      <td>1.010000</td>
      <td>1.985885</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>17.052500</td>
      <td>1.670000</td>
      <td>3.350314</td>
      <td>57.951806</td>
      <td>1.358028</td>
      <td>2.170000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>24.650000</td>
      <td>2.580000</td>
      <td>4.700000</td>
      <td>100.043660</td>
      <td>2.710000</td>
      <td>2.927459</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Mutual Information</h2>
<p>Measure of information shared between predictors and the response feature,</p>
<ul class="simple">
<li><p>robust in the presence of nonlinearity and heteroscedasticity,</p></li>
</ul>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>MI Value Range</p></th>
<th class="head"><p>Interpretation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Close to 0</p></td>
<td><p>Variables are nearly independent</p></td>
</tr>
<tr class="row-odd"><td><p>Low (small positive)</p></td>
<td><p>Weak dependency or little shared information</p></td>
</tr>
<tr class="row-even"><td><p>Moderate</p></td>
<td><p>Some meaningful dependency</p></td>
</tr>
<tr class="row-odd"><td><p>High</p></td>
<td><p>Strong dependency; variables share substantial information</p></td>
</tr>
<tr class="row-even"><td><p>Very High</p></td>
<td><p>Near deterministic relationship</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">mi</span> <span class="o">=</span> <span class="n">mutual_info_regression</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># calculuate mutual information</span>
<span class="n">mi_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">mi</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>                    <span class="c1"># convert ndarray to pandas series (column of a DataFrame) for ease of plotting</span>
<span class="n">mi_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Mutual Information'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Mutual Information'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/644b6fbdbf03216167f1baad977206f250ff2b88264e2e989d89465218f4edd7.png" src="../Images/e0abc6c7f9333ad69cfe019ae821faa6.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/644b6fbdbf03216167f1baad977206f250ff2b88264e2e989d89465218f4edd7.png"/>
</div>
</div>
&#13;

<h2>Mutual Information (normalized)</h2>
<p>Measure of information shared between predictors and the response feature,</p>
<ul class="simple">
<li><p>robust in the presence of nonlinearity and heteroscedasticity</p></li>
<li><p>normalized by marginal entropies to have a maximum value of 1.0, 0.0 = no information, 1.0 = perfect information</p></li>
</ul>
<p>Here’s the common rule of thumb to assist with interpretation,</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>NMI Value Range</p></th>
<th class="head"><p>Interpretation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0.0 – 0.2</p></td>
<td><p>Very weak or negligible relation</p></td>
</tr>
<tr class="row-odd"><td><p>0.2 – 0.4</p></td>
<td><p>Weak relation</p></td>
</tr>
<tr class="row-even"><td><p>0.4 – 0.6</p></td>
<td><p>Moderate relation</p></td>
</tr>
<tr class="row-odd"><td><p>0.6 – 0.8</p></td>
<td><p>Strong relation</p></td>
</tr>
<tr class="row-even"><td><p>0.8 – 1.0</p></td>
<td><p>Very strong or near perfect</p></td>
</tr>
</tbody>
</table>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">kbd</span> <span class="o">=</span> <span class="n">KBinsDiscretizer</span><span class="p">(</span><span class="n">n_bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">encode</span><span class="o">=</span><span class="s1">'ordinal'</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">'quantile'</span><span class="p">)</span> <span class="c1"># instantiate dicretizer</span>
<span class="n">X_binned</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">kbd</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="c1"># discretize the predictor features</span>
<span class="n">y_bins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">q</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s1">'drop'</span><span class="p">)</span> <span class="c1"># discretize the response features</span>
<span class="n">nmi_scores</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_binned</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>                                  <span class="c1"># loop over predictor features </span>
    <span class="n">nmi</span> <span class="o">=</span> <span class="n">normalized_mutual_info_score</span><span class="p">(</span><span class="n">X_binned</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">y_bins</span><span class="p">)</span> <span class="c1"># calculate normalize mutual information</span>
    <span class="n">nmi_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nmi</span><span class="p">)</span>
<span class="n">nmi_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">nmi_scores</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">nmi_series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Normalized Mutual Information'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Normalized Mutual Information'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">yvalue</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">yvalue</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>      <span class="c1"># add interpretation lines</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0e31eacf7d15566196b691c4dfa7fef7850043fa2b7a438b1ff8cc6a68987be8.png" src="../Images/be383c1698d1aa37199bfed76c929418.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0e31eacf7d15566196b691c4dfa7fef7850043fa2b7a438b1ff8cc6a68987be8.png"/>
</div>
</div>
&#13;

<h2>Normalize Predictor Features</h2>
<p>Normalize the predictor features to remove any sensitivity to feature range or variance, for example,</p>
<ul class="simple">
<li><p>put features all on equal playing field for distance calculations</p></li>
</ul>
<p>Min / max normalization forces the minimum to be 0.0 and the maximum to be 1.0</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">normalizer</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>                                   <span class="c1"># instantiate min / max normalizer </span>
<span class="n">norm_array</span> <span class="o">=</span> <span class="n">normalizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># normalize the predictor features                 </span>
<span class="n">X_norm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">norm_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>          <span class="c1"># convert output to a DataFrame</span>
<span class="n">X_norm</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                             <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.496538</td>
      <td>0.366219</td>
      <td>0.504134</td>
      <td>0.507180</td>
      <td>0.498080</td>
      <td>0.533144</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.174775</td>
      <td>0.198057</td>
      <td>0.169220</td>
      <td>0.192526</td>
      <td>0.203202</td>
      <td>0.155066</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.374265</td>
      <td>0.227975</td>
      <td>0.378358</td>
      <td>0.365377</td>
      <td>0.340717</td>
      <td>0.432990</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.501176</td>
      <td>0.332380</td>
      <td>0.500000</td>
      <td>0.525548</td>
      <td>0.514768</td>
      <td>0.530928</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.638382</td>
      <td>0.475686</td>
      <td>0.616418</td>
      <td>0.644809</td>
      <td>0.649789</td>
      <td>0.625000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Random Forest (retrain tuned model)</h2>
<p>Apply tuned hyperparameters and retrain the model.</p>
<ul class="simple">
<li><p>this is the model that we will use for future predictions, real-world use</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_node_tuned</span> <span class="o">=</span> <span class="mi">40</span><span class="p">;</span> <span class="n">num_tree</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="n">max_features</span> <span class="o">=</span> <span class="mi">2</span>                <span class="c1"># random forest model hyperparameters</span>
<span class="n">random_forest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">max_leaf_node_tuned</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">num_tree</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span><span class="p">,</span>
                                       <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">random_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">y_rf_hat</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_rf_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Tuned Random Forest: Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e9fcd5f031e201181841d77931510c34d15f80eaae16df3fb6f993b0b29e18d1.png" src="../Images/85e09a63df070a97e49cb63ec6988185.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e9fcd5f031e201181841d77931510c34d15f80eaae16df3fb6f993b0b29e18d1.png"/>
</div>
</div>
&#13;

<h2>Random Forest (train)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_node</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">num_tree</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span> <span class="n">max_features</span> <span class="o">=</span> <span class="mi">2</span>                <span class="c1"># random forest model hyperparameters</span>
<span class="n">random_forest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">max_leaf_node</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">num_tree</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span><span class="p">,</span>
                                       <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">random_forest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
<span class="n">y_rf_hat</span> <span class="o">=</span> <span class="n">random_forest</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># predict over the testing cases</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">y_rf_hat</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'orange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'All Data'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Estimated'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Truth'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Random Forest: Cross Validation Plot'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s1">'upper left'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">,);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8000</span><span class="p">)</span> 
<span class="n">add_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d4f91ebd10926c4f96b51e807a79e5bae0107950b77cdbfce9b17f8a524c1300.png" src="../Images/7da55fa460cfbd2f8be764b0c7717cfc.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d4f91ebd10926c4f96b51e807a79e5bae0107950b77cdbfce9b17f8a524c1300.png"/>
</div>
</div>
&#13;

<h2>Random Forest (tune)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_node_mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>                        <span class="c1"># set the random forest hyperparameters</span>
<span class="n">max_features</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">trained_forests</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">MSE_oob_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">node_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">max_leaf_node</span> <span class="ow">in</span> <span class="n">max_leaf_node_mat</span><span class="p">:</span>                       <span class="c1"># loop over number of trees in our random forest</span>
    <span class="n">trained_forest</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="n">max_leaf_node</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">,</span><span class="n">n_estimators</span><span class="o">=</span><span class="n">num_tree</span><span class="p">,</span>
            <span class="n">oob_score</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">bootstrap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">max_features</span><span class="o">=</span><span class="n">max_features</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">trained_forests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trained_forest</span><span class="p">)</span>
    <span class="n">oob_y_hat</span> <span class="o">=</span> <span class="n">trained_forest</span><span class="o">.</span><span class="n">oob_prediction_</span>
    <span class="n">oob_y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">oob_y_hat</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">];</span> <span class="n">oob_y_hat</span> <span class="o">=</span> <span class="n">oob_y_hat</span><span class="p">[</span><span class="n">oob_y_hat</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">];</span> <span class="c1"># remove if not estimated</span>
    <span class="n">MSE_oob_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="o">.</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">oob_y</span><span class="p">,</span><span class="n">oob_y_hat</span><span class="p">));</span> <span class="n">node_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_leaf_node</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">tuned_node</span> <span class="o">=</span> <span class="n">node_list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">MSE_oob_list</span><span class="p">)]</span>               <span class="c1"># get the k that minimizes the testing MSE</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">node_list</span><span class="p">,</span><span class="n">MSE_oob_list</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">node_list</span><span class="p">,</span><span class="n">MSE_oob_list</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">'--'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">tuned_node</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">'Tuned Max Leaf Nodes = '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tuned_node</span><span class="p">),[</span><span class="n">tuned_node</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.2e6</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span> <span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Number of Leaf Nodes'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Mean Square Error'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Out-of-Bag Mean Square Error vs Maximum Number of Leaf Nodes'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a4378ef7e741036b57b87da2bfebdaca422f740e5e57a7c80830378ffb2a97e5.png" src="../Images/279dbea2db8df7df5a66bc53d7d84b38.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a4378ef7e741036b57b87da2bfebdaca422f740e5e57a7c80830378ffb2a97e5.png"/>
</div>
</div>
&#13;

<h2>Scatter Plot</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Porosity (%)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Permeability (mD)'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Permeability vs. Porosity'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4aeafcadb98fdfb83173ccc394603ab43273c3b50a994399068a5faebea04ac0.png" src="../Images/b90b0ab6d27045759e55d1d659d09132.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/4aeafcadb98fdfb83173ccc394603ab43273c3b50a994399068a5faebea04ac0.png"/>
</div>
</div>
&#13;

<h2>Standardize Predictor Features</h2>
<p>Standardize the predictor features to remove any sensitivity to feature range or variance, for example,</p>
<ul class="simple">
<li><p>put features all on equal playing field for distance calculations</p></li>
</ul>
<p>Standardization forces the mean to be 0.0 and the standard deviation to be 1.0</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>                                     <span class="c1"># instantiate standardizer </span>
<span class="n">standard_array</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>                      <span class="c1"># standardize the predictor features    </span>
<span class="n">X_stand</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">standard_array</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>     <span class="c1"># convert output to a DataFrame</span>
<span class="n">X_stand</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                            <span class="c1"># preview the DataFrame</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
      <td>2.000000e+02</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.486900e-16</td>
      <td>-6.217249e-17</td>
      <td>4.130030e-16</td>
      <td>2.042810e-16</td>
      <td>3.375078e-16</td>
      <td>9.081624e-16</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
      <td>1.002509e+00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-2.848142e+00</td>
      <td>-1.853701e+00</td>
      <td>-2.986650e+00</td>
      <td>-2.640962e+00</td>
      <td>-2.457313e+00</td>
      <td>-3.446814e+00</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-7.013606e-01</td>
      <td>-6.997528e-01</td>
      <td>-7.451372e-01</td>
      <td>-7.383912e-01</td>
      <td>-7.763606e-01</td>
      <td>-6.475066e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2.660490e-02</td>
      <td>-1.712823e-01</td>
      <td>-2.449306e-02</td>
      <td>9.564649e-02</td>
      <td>8.233024e-02</td>
      <td>-1.432979e-02</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>8.136175e-01</td>
      <td>5.540977e-01</td>
      <td>6.652032e-01</td>
      <td>7.166516e-01</td>
      <td>7.484661e-01</td>
      <td>5.938532e-01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2.887855e+00</td>
      <td>3.208033e+00</td>
      <td>2.937664e+00</td>
      <td>2.566186e+00</td>
      <td>2.476256e+00</td>
      <td>3.018254e+00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Shapley Values (feature ranking)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">max_leaf_nodes</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">tree_shap_model</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span><span class="n">max_leaf_nodes</span> <span class="o">=</span> <span class="n">max_leaf_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">tree_shap_model</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>                          <span class="c1"># Explain the model with SHAP</span>
<span class="n">shap_values</span> <span class="o">=</span> <span class="n">explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">shap_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">shap_values</span><span class="p">),</span><span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">shap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'Feature'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span><span class="s1">'Shapley Values'</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">shap_avg</span><span class="p">)});</span> <span class="n">shap_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">'Feature'</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">shap_df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Shapley Values (average, absolute)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Global Shapley Values'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b3537b09e57d634463cb4d12485c10ea473a4bdc2f13c5a57bff20c0c1ddcca9.png" src="../Images/4661eb5c68462f9ee6ec2e119b0bd0ae.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/b3537b09e57d634463cb4d12485c10ea473a4bdc2f13c5a57bff20c0c1ddcca9.png"/>
</div>
</div>
&#13;

<h2>Summary Statistics (DataFrame)</h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>                                                 <span class="c1"># calculate the summary statistics of each feature</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>100.500000</td>
      <td>14.991150</td>
      <td>4.330750</td>
      <td>2.968850</td>
      <td>48.161950</td>
      <td>0.990450</td>
      <td>1.964300</td>
      <td>3874.056957</td>
    </tr>
    <tr>
      <th>std</th>
      <td>57.879185</td>
      <td>2.971176</td>
      <td>1.731014</td>
      <td>0.566885</td>
      <td>14.129455</td>
      <td>0.481588</td>
      <td>0.300827</td>
      <td>1615.551334</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>6.550000</td>
      <td>1.130000</td>
      <td>1.280000</td>
      <td>10.940000</td>
      <td>-0.190000</td>
      <td>0.930000</td>
      <td>463.579973</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>50.750000</td>
      <td>12.912500</td>
      <td>3.122500</td>
      <td>2.547500</td>
      <td>37.755000</td>
      <td>0.617500</td>
      <td>1.770000</td>
      <td>2616.522434</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>100.500000</td>
      <td>15.070000</td>
      <td>4.035000</td>
      <td>2.955000</td>
      <td>49.510000</td>
      <td>1.030000</td>
      <td>1.960000</td>
      <td>3801.156899</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>150.250000</td>
      <td>17.402500</td>
      <td>5.287500</td>
      <td>3.345000</td>
      <td>58.262500</td>
      <td>1.350000</td>
      <td>2.142500</td>
      <td>4786.375831</td>
    </tr>
    <tr>
      <th>max</th>
      <td>200.000000</td>
      <td>23.550000</td>
      <td>9.870000</td>
      <td>4.630000</td>
      <td>84.330000</td>
      <td>2.180000</td>
      <td>2.870000</td>
      <td>8428.187903</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Train and Test Split</h2>
<p>Random splitting of the data into train and test splits.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">test_proportion</span> <span class="o">=</span> <span class="mf">0.2</span>                                         <span class="c1"># set the proportion of withheld testing data</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">test_proportion</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="c1"># train and test split</span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Variance Inflation Factor</h2>
<p>Feature ranking method that only considers the linear redundancy between the predictor features,</p>
<ul class="simple">
<li><p>relationship with the response feature, relevancy is not considered</p></li>
<li><p>general used as a screening method to remove features before more comprehensive feature ranking</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">vif_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>                                         <span class="c1"># loop over predictor features and store result in pandas series for ease of plotting</span>
    <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])],</span>
    <span class="n">index</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">vif_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">utcolor</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="s1">'o'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Predictor Features'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Variance Inflation Factor (unitless)'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'--'</span><span class="p">);</span>
<span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Feature Ranking: Variance Inflation Factor'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e86fe7cffabcf6080b3ed4c7a671ff49b6e2b59355c6e39c654f7ab12292fe8b.png" src="../Images/492166c07e6984b6bc1a673cdc12b030.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e86fe7cffabcf6080b3ed4c7a671ff49b6e2b59355c6e39c654f7ab12292fe8b.png"/>
</div>
</div>
&#13;

<h2>Comments</h2>
<p>These are some basic code snipets for predictive machine learning in Python. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos’ descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
&#13;

<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael’s university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael’s work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
&#13;

<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I’d be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I’m always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
    
</body>
</html>