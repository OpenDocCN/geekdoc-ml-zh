<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Update operations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Update operations</h1>
<blockquote>原文：<a href="https://rust-exercises.com/100-exercises/07_threads/10_patch.html">https://rust-exercises.com/100-exercises/07_threads/10_patch.html</a></blockquote>
                        
<p>So far we've implemented only insertion and retrieval operations.<br/>
Let's see how we can expand the system to provide an update operation.</p>
<h2 id="legacy-updates"><a class="header" href="#legacy-updates">Legacy updates</a></h2>
<p>In the non-threaded version of the system, updates were fairly straightforward: <code>TicketStore</code> exposed a
<code>get_mut</code> method that allowed the caller to obtain a mutable reference to a ticket, and then modify it.</p>
<h2 id="multithreaded-updates"><a class="header" href="#multithreaded-updates">Multithreaded updates</a></h2>
<p>The same strategy won't work in the current multithreaded version. The borrow checker would
stop us: <code>SyncSender&lt;&amp;mut Ticket&gt;</code> isn't <code>'static</code> because <code>&amp;mut Ticket</code> doesn't satisfy the <code>'static</code> lifetime, therefore
they can't be captured by the closure that gets passed to <code>std::thread::spawn</code>.</p>
<p>There are a few ways to work around this limitation. We'll explore a few of them in the following exercises.</p>
<h3 id="patching"><a class="header" href="#patching">Patching</a></h3>
<p>We can't send a <code>&amp;mut Ticket</code> over a channel, therefore we can't mutate on the client-side.<br/>
Can we mutate on the server-side?</p>
<p>We can, if we tell the server what needs to be changed. In other words, if we send a <strong>patch</strong> to the server:</p>
<pre><code class="language-rust">struct TicketPatch {
    id: TicketId,
    title: Option&lt;TicketTitle&gt;,
    description: Option&lt;TicketDescription&gt;,
    status: Option&lt;TicketStatus&gt;,
}</code></pre>
<p>The <code>id</code> field is mandatory, since it's required to identify the ticket that needs to be updated.<br/>
All other fields are optional:</p>
<ul>
<li>If a field is <code>None</code>, it means that the field should not be changed.</li>
<li>If a field is <code>Some(value)</code>, it means that the field should be changed to <code>value</code>.</li>
</ul>
<h2 id="exercise"><a class="header" href="#exercise">Exercise</a></h2>
<p>The exercise for this section is located in <a href="https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/07_threads/10_patch"><code>07_threads/10_patch</code></a></p>

                        
</body>
</html>