- en: Leaking data
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://rust-exercises.com/100-exercises/07_threads/03_leak.html](https://rust-exercises.com/100-exercises/07_threads/03_leak.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'The main concern around passing references to spawned threads is use-after-free
    bugs: accessing data using a pointer to a memory region that''s already been freed/de-allocated.'
  prefs: []
  type: TYPE_NORMAL
- en: 'If you''re working with heap-allocated data, you can avoid the issue by telling
    Rust that you''ll never reclaim that memory: you choose to **leak memory**, intentionally.'
  prefs: []
  type: TYPE_NORMAL
- en: 'This can be done, for example, using the `Box::leak` method from Rust''s standard
    library:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '[Data leakage is process-scoped](#data-leakage-is-process-scoped)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Leaking data is dangerous: if you keep leaking memory, you''ll eventually run
    out and crash with an out-of-memory error.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: At the same time, memory leaked via `leak` method is not truly forgotten.
  prefs: []
  type: TYPE_NORMAL
- en: The operating system can map each memory region to the process responsible for
    it. When the process exits, the operating system will reclaim that memory.
  prefs: []
  type: TYPE_NORMAL
- en: 'Keeping this in mind, it can be OK to leak memory when:'
  prefs: []
  type: TYPE_NORMAL
- en: The amount of memory you need to leak is bounded/known upfront, or
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Your process is short-lived and you're confident you won't exhaust all the available
    memory before it exits
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '"Let the OS deal with it" is a perfectly valid memory management strategy if
    your usecase allows for it.'
  prefs: []
  type: TYPE_NORMAL
- en: '[Exercise](#exercise)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The exercise for this section is located in [`07_threads/03_leak`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/07_threads/03_leak)
  prefs: []
  type: TYPE_NORMAL
