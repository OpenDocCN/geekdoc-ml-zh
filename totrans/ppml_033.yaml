- en: String slices
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://rust-exercises.com/100-exercises/04_traits/06_str_slice.html](https://rust-exercises.com/100-exercises/04_traits/06_str_slice.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Throughout the previous chapters you've seen quite a few **string literals**
    being used in the code, like `"To-Do"` or `"A ticket description"`. They were
    always followed by a call to `.to_string()` or `.into()`. It's time to understand
    why!
  prefs: []
  type: TYPE_NORMAL
- en: '[String literals](#string-literals)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'You define a string literal by enclosing the raw text in double quotes:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The type of `s` is `&str`, a **reference to a string slice**.
  prefs: []
  type: TYPE_NORMAL
- en: '[Memory layout](#memory-layout)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '`&str` and `String` are different types—they''re not interchangeable.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s recall the memory layout of a `String` from our [previous exploration](/100-exercises/03_ticket_v1/09_heap).
    If we run:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: 'we''ll get this scenario in memory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'If you remember, we''ve [also examined](/100-exercises/03_ticket_v1/10_references_in_memory)
    how a `&String` is laid out in memory:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: '`&String` points to the memory location where the `String`''s metadata is stored.'
  prefs: []
  type: TYPE_NORMAL
- en: If we follow the pointer, we get to the heap-allocated data. In particular,
    we get to the first byte of the string, `H`.
  prefs: []
  type: TYPE_NORMAL
- en: What if we wanted a type that represents a **substring** of `s`? E.g. `ello`
    in `Hello`?
  prefs: []
  type: TYPE_NORMAL
- en: '[String slices](#string-slices-1)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'A `&str` is a **view** into a string, a **reference** to a sequence of UTF-8
    bytes stored elsewhere. You can, for example, create a `&str` from a `String`
    like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'In memory, it''d look like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: '`slice` stores two pieces of information on the stack:'
  prefs: []
  type: TYPE_NORMAL
- en: A pointer to the first byte of the slice.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The length of the slice.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`slice` doesn''t own the data, it just points to it: it''s a **reference**
    to the `String`''s heap-allocated data.'
  prefs: []
  type: TYPE_NORMAL
- en: 'When `slice` is dropped, the heap-allocated data won''t be deallocated, because
    it''s still owned by `s`. That''s why `slice` doesn''t have a `capacity` field:
    it doesn''t own the data, so it doesn''t need to know how much space it was allocated
    for it; it only cares about the data it references.'
  prefs: []
  type: TYPE_NORMAL
- en: '[`&str` vs `&String`](#str-vs-string)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: As a rule of thumb, use `&str` rather than `&String` whenever you need a reference
    to textual data.
  prefs: []
  type: TYPE_NORMAL
- en: '`&str` is more flexible and generally considered more idiomatic in Rust code.'
  prefs: []
  type: TYPE_NORMAL
- en: If a method returns a `&String`, you're promising that there is heap-allocated
    UTF-8 text somewhere that **matches exactly** the one you're returning a reference
    to.
  prefs: []
  type: TYPE_NORMAL
- en: 'If a method returns a `&str`, instead, you have a lot more freedom: you''re
    just saying that *somewhere* there''s a bunch of text data and that a subset of
    it matches what you need, therefore you''re returning a reference to it.'
  prefs: []
  type: TYPE_NORMAL
- en: '[Exercise](#exercise)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The exercise for this section is located in [`04_traits/06_str_slice`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/04_traits/06_str_slice)
  prefs: []
  type: TYPE_NORMAL
