<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <title>ch036.xhtml</title>
  <style>
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css" />
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    /* Figure formatting */
    .quarto-layout-panel>figure>figcaption,
    .quarto-layout-panel>.panel-caption {
      margin-top: 10pt;
    }

    .quarto-layout-row {
      display: flex;
      align-items: flex-start;
    }

    .quarto-layout-valign-top {
      align-items: flex-start;
    }

    .quarto-layout-valign-bottom {
      align-items: flex-end;
    }

    .quarto-layout-valign-center {
      align-items: center;
    }

    .quarto-layout-cell {
      position: relative;
      margin-right: 20px;
    }

    .quarto-layout-cell:last-child {
      margin-right: 0;
    }

    .quarto-layout-cell figure,
    .quarto-layout-cell>p {
      margin: 0.2em;
    }

    .quarto-layout-cell .html-widget {
      width: 100% !important;
    }

    .quarto-layout-cell div figure p {
      margin: 0;
    }

    .quarto-layout-cell figure {
      display: inline-block;
      margin-inline-start: 0;
      margin-inline-end: 0;
    }

    .quarto-layout-cell table {
      display: inline-table;
    }

    .quarto-layout-cell-subref figcaption {
      font-style: italic;
      text-align: center;
    }

    .quarto-figure>figure {
      width: 100%;
    }

    .quarto-figure-left>figure>p {
      text-align: left;
    }

    .quarto-figure-center>figure>p {
      text-align: center;
    }

    .quarto-figure-right>figure>p {
      text-align: right;
    }

    figure>p:empty {
      display: none;
    }

    figure>p:first-child {
      margin-top: 0;
      margin-bottom: 0;
    }

    figure>figcaption {
      margin-top: 0.5em;
    }

    figcaption {
      font-size: 0.8em;
    }

    details {
      margin-bottom: 1em;
    }

    details[show] {
      margin-bottom: 0;
    }

    .quarto-unresolved-ref {
      font-weight: 600;
    }

    .quarto-cover-image {
      float: right;
      margin-left: 30px;
    }

    .cell-output-display {
      overflow-x: scroll;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body epub:type="bodymatter">
<section id="motion-classification-and-anomaly-detection" class="level1 unnumbered">
<h1 class="unnumbered">Motion Classification and Anomaly Detection</h1>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="../media/file470.jpg" alt="" /></p>
<figcaption><em>DALL·E 3 Prompt: 1950s style cartoon illustration depicting a movement research room. In the center of the room, there’s a simulated container used for transporting goods on trucks, boats, and forklifts. The container is detailed with rivets and markings typical of industrial cargo boxes. Around the container, the room is filled with vintage equipment, including an oscilloscope, various sensor arrays, and large paper rolls of recorded data. The walls are adorned with educational posters about transportation safety and logistics. The overall ambiance of the room is nostalgic and scientific, with a hint of industrial flair.</em></figcaption>
</figure>
</div>
<section id="sec-motion-classification-anomaly-detection-overview-b1a8" class="level2 unnumbered">
<h2 class="unnumbered">Overview</h2>
<p>Transportation is the backbone of global commerce. Millions of containers are transported daily via various means, such as ships, trucks, and trains, to destinations worldwide. Ensuring these containers’ safe and efficient transit is a monumental task that requires leveraging modern technology, and TinyML is undoubtedly one of them.</p>
<p>In this hands-on tutorial, we will work to solve real-world problems related to transportation. We will develop a Motion Classification and Anomaly Detection system using the Arduino Nicla Vision board, the Arduino IDE, and the Edge Impulse Studio. This project will help us understand how containers experience different forces and motions during various phases of transportation, such as terrestrial and maritime transit, vertical movement via forklifts, and stationary periods in warehouses.</p>
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Learning Objectives</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Setting up the Arduino Nicla Vision Board</li>
<li>Data Collection and Preprocessing</li>
<li>Building the Motion Classification Model</li>
<li>Implementing Anomaly Detection</li>
<li>Real-world Testing and Analysis</li>
</ul>
</div>
</div>
</div>
<p>By the end of this tutorial, you’ll have a working prototype that can classify different types of motion and detect anomalies during the transportation of containers. This knowledge can be a stepping stone to more advanced projects in the burgeoning field of TinyML involving vibration.</p>
</section>
<section id="sec-motion-classification-anomaly-detection-imu-installation-testing-deff" class="level2 unnumbered">
<h2 class="unnumbered">IMU Installation and testing</h2>
<p>For this project, we will use an accelerometer. As discussed in the Hands-On Tutorial, <em>Setup Nicla Vision</em>, the Nicla Vision Board has an onboard <strong>6-axis IMU</strong>: 3D gyroscope and 3D accelerometer, the <a href="https://www.st.com/en/mems-and-sensors/lsm6dsox.html">LSM6DSOX</a>. Let’s verify if the <a href="https://github.com/arduino-libraries/Arduino_LSM6DSOX">LSM6DSOX IMU library</a> is installed. If not, install it.</p>
<p> <img src="../media/file471.jpg" class="quarto-figure quarto-figure-center" style="width:90.0%" alt="" /></p>
<p>Next, go to <code>Examples &gt; Arduino_LSM6DSOX &gt; SimpleAccelerometer</code> and run the accelerometer test. You can check if it works by opening the IDE Serial Monitor or Plotter. The values are in g (earth gravity), with a default range of +/- 4g:</p>
<p> <img src="../media/file472.jpg" alt="" /></p>
<section id="sec-motion-classification-anomaly-detection-defining-sampling-frequency-7405" class="level3 unnumbered">
<h3 class="unnumbered">Defining the Sampling frequency:</h3>
<p>Choosing an appropriate sampling frequency is crucial for capturing the motion characteristics you’re interested in studying. The Nyquist-Shannon sampling theorem states that the sampling rate should be at least twice the highest frequency component in the signal to reconstruct it properly. In the context of motion classification and anomaly detection for transportation, the choice of sampling frequency would depend on several factors:</p>
<ol type="1">
<li><p><strong>Nature of the Motion</strong>: Different types of transportation (terrestrial, maritime, etc.) may involve different ranges of motion frequencies. Faster movements may require higher sampling frequencies.</p></li>
<li><p><strong>Hardware Limitations</strong>: The Arduino Nicla Vision board and any associated sensors may have limitations on how fast they can sample data.</p></li>
<li><p><strong>Computational Resources</strong>: Higher sampling rates will generate more data, which might be computationally intensive, especially critical in a TinyML environment.</p></li>
<li><p><strong>Battery Life</strong>: A higher sampling rate will consume more power. If the system is battery-operated, this is an important consideration.</p></li>
<li><p><strong>Data Storage</strong>: More frequent sampling will require more storage space, another crucial consideration for embedded systems with limited memory.</p></li>
</ol>
<p>In many human activity recognition tasks, <strong>sampling rates of around 50 Hz to 100 Hz</strong> are commonly used. Given that we are simulating transportation scenarios, which are generally not high-frequency events, a sampling rate in that range (50-100 Hz) might be a reasonable starting point.</p>
<p>Let’s define a sketch that will allow us to capture our data with a defined sampling frequency (for example, 50 Hz):</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource cpp number-lines"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1"></a><span class="co">/*</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"> * Based on Edge Impulse Data Forwarder Example (Arduino)</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">  - https://docs.edgeimpulse.com/docs/cli-data-forwarder</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"> * Developed by M.Rovai @11May23</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"> */</span></span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">/* Include ------------------------------------------- */</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="pp">#include </span><span class="im">&lt;Arduino_LSM6DSOX.h&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">/* Constant defines ---------------------------------- */</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="pp">#define CONVERT_G_TO_MS2 </span><span class="fl">9.80665</span><span class="bu">f</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="pp">#define FREQUENCY_HZ        </span><span class="dv">50</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="pp">#define INTERVAL_MS         </span><span class="op">(</span><span class="dv">1000</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span><span class="op">(</span>FREQUENCY_HZ<span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">1</span><span class="op">))</span></span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="at">static</span> <span class="dt">unsigned</span> <span class="dt">long</span> last_interval_ms <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="dt">float</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="dt">void</span> setup<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>  Serial<span class="op">.</span>begin<span class="op">(</span><span class="dv">9600</span><span class="op">);</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="cf">while</span> <span class="op">(!</span>Serial<span class="op">);</span></span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a>  <span class="cf">if</span> <span class="op">(!</span>IMU<span class="op">.</span>begin<span class="op">())</span> <span class="op">{</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>    Serial<span class="op">.</span>println<span class="op">(</span><span class="st">&quot;Failed to initialize IMU!&quot;</span><span class="op">);</span></span>
<span id="cb1-24"><a href="#cb1-24"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="op">}</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="op">}</span></span>
<span id="cb1-27"><a href="#cb1-27"></a></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="dt">void</span> loop<span class="op">()</span> <span class="op">{</span></span>
<span id="cb1-29"><a href="#cb1-29"></a>  <span class="cf">if</span> <span class="op">(</span>millis<span class="op">()</span> <span class="op">&gt;</span> last_interval_ms <span class="op">+</span> INTERVAL_MS<span class="op">)</span> <span class="op">{</span></span>
<span id="cb1-30"><a href="#cb1-30"></a>    last_interval_ms <span class="op">=</span> millis<span class="op">();</span></span>
<span id="cb1-31"><a href="#cb1-31"></a></span>
<span id="cb1-32"><a href="#cb1-32"></a>    <span class="cf">if</span> <span class="op">(</span>IMU<span class="op">.</span>accelerationAvailable<span class="op">())</span> <span class="op">{</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>      <span class="co">// Read raw acceleration measurements from the device</span></span>
<span id="cb1-34"><a href="#cb1-34"></a>      IMU<span class="op">.</span>readAcceleration<span class="op">(</span>x<span class="op">,</span> y<span class="op">,</span> z<span class="op">);</span></span>
<span id="cb1-35"><a href="#cb1-35"></a></span>
<span id="cb1-36"><a href="#cb1-36"></a>      <span class="co">// converting to m/s2</span></span>
<span id="cb1-37"><a href="#cb1-37"></a>      <span class="dt">float</span> ax_m_s2 <span class="op">=</span> x <span class="op">*</span> CONVERT_G_TO_MS2<span class="op">;</span></span>
<span id="cb1-38"><a href="#cb1-38"></a>      <span class="dt">float</span> ay_m_s2 <span class="op">=</span> y <span class="op">*</span> CONVERT_G_TO_MS2<span class="op">;</span></span>
<span id="cb1-39"><a href="#cb1-39"></a>      <span class="dt">float</span> az_m_s2 <span class="op">=</span> z <span class="op">*</span> CONVERT_G_TO_MS2<span class="op">;</span></span>
<span id="cb1-40"><a href="#cb1-40"></a></span>
<span id="cb1-41"><a href="#cb1-41"></a>      Serial<span class="op">.</span>print<span class="op">(</span>ax_m_s2<span class="op">);</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-43"><a href="#cb1-43"></a>      Serial<span class="op">.</span>print<span class="op">(</span>ay_m_s2<span class="op">);</span></span>
<span id="cb1-44"><a href="#cb1-44"></a>      Serial<span class="op">.</span>print<span class="op">(</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb1-45"><a href="#cb1-45"></a>      Serial<span class="op">.</span>println<span class="op">(</span>az_m_s2<span class="op">);</span></span>
<span id="cb1-46"><a href="#cb1-46"></a>    <span class="op">}</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>  <span class="op">}</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="op">}</span></span></code></pre></div>
<p>Uploading the sketch and inspecting the Serial Monitor, we can see that we are capturing 50 samples per second.</p>
<p> <img src="../media/file473.jpg" class="quarto-figure quarto-figure-center" style="width:90.0%" alt="" /></p>
<blockquote>
<p>Note that with the Nicla board resting on a table (with the camera facing down), the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>-axis measures around 9.8 m/s<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>2</mn></msup><annotation encoding="application/x-tex">^2</annotation></semantics></math>, the expected earth acceleration.</p>
</blockquote>
</section>
</section>
<section id="sec-motion-classification-anomaly-detection-case-study-simulated-container-transportation-1b32" class="level2 unnumbered">
<h2 class="unnumbered">The Case Study: Simulated Container Transportation</h2>
<p>We will simulate container (or better package) transportation through different scenarios to make this tutorial more relatable and practical. Using the built-in accelerometer of the Arduino Nicla Vision board, we’ll capture motion data by manually simulating the conditions of:</p>
<ol type="1">
<li><strong>Terrestrial</strong> Transportation (by road or train)</li>
<li><strong>Maritime</strong>-associated Transportation</li>
<li>Vertical Movement via Fork-<strong>Lift</strong></li>
<li>Stationary <strong>(Idle</strong>) period in a Warehouse</li>
</ol>
<p> <img src="../media/file474.jpg" class="quarto-figure quarto-figure-center" style="width:80.0%" alt="" /></p>
<p>From the above images, we can define for our simulation that primarily horizontal movements (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> or <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math> axis) should be associated with the “Terrestrial class,” Vertical movements (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>-axis) with the “Lift Class,” no activity with the “Idle class,” and movement on all three axes to <a href="https://www.containerhandbuch.de/chb_e/stra/index.html?/chb_e/stra/stra_02_03_03.htm">Maritime class.</a></p>
<p> <img src="../media/file475.jpg" class="quarto-figure quarto-figure-center" style="width:80.0%" alt="" /></p>
</section>
<section id="sec-motion-classification-anomaly-detection-data-collection-aa04" class="level2 unnumbered">
<h2 class="unnumbered">Data Collection</h2>
<p>For data collection, we can have several options. In a real case, we can have our device, for example, connected directly to one container, and the data collected on a file (for example .CSV) and stored on an SD card (Via SPI connection) or an offline repo in your computer. Data can also be sent remotely to a nearby repository, such as a mobile phone, using Bluetooth (as done in this project: <a href="https://www.hackster.io/mjrobot/sensor-datalogger-50e44d">Sensor DataLogger</a>). Once your dataset is collected and stored as a .CSV file, it can be uploaded to the Studio using the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/data-acquisition/csv-wizard">CSV Wizard tool</a>.</p>
<blockquote>
<p>In this <a href="https://youtu.be/2KBPq_826WM">video</a>, you can learn alternative ways to send data to the Edge Impulse Studio.</p>
</blockquote>
<section id="sec-motion-classification-anomaly-detection-connecting-device-edge-impulse-b8c0" class="level3 unnumbered">
<h3 class="unnumbered">Connecting the device to Edge Impulse</h3>
<p>We will connect the Nicla directly to the Edge Impulse Studio, which will also be used for data pre-processing, model training, testing, and deployment. For that, you have two options:</p>
<ol type="1">
<li>Download the latest firmware and connect it directly to the <code>Data Collection</code> section.</li>
<li>Use the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-cli/cli-data-forwarder">CLI Data Forwarder</a> tool to capture sensor data from the sensor and send it to the Studio.</li>
</ol>
<p>Option 1 is more straightforward, as we saw in the <em>Setup Nicla Vision</em> hands-on, but option 2 will give you more flexibility regarding capturing your data, such as sampling frequency definition. Let’s do it with the last one.</p>
<p>Please create a new project on the Edge Impulse Studio (EIS) and connect the Nicla to it, following these steps:</p>
<ol type="1">
<li>Install the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-cli/cli-installation">Edge Impulse CLI</a> and the <a href="https://nodejs.org/en/">Node.js</a> into your computer.</li>
<li>Upload a sketch for data capture (the one discussed previously in this tutorial).</li>
<li>Use the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-cli/cli-data-forwarder">CLI Data Forwarder</a> to capture data from the Nicla’s accelerometer and send it to the Studio, as shown in this diagram:</li>
</ol>
<p> <img src="../media/file476.jpg" class="quarto-figure quarto-figure-center" style="width:50.0%" alt="" /></p>
<p>Start the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-cli/cli-data-forwarder">CLI Data Forwarder</a> on your terminal, entering (if it is the first time) the following command:</p>
<pre><code>$ edge-impulse-data-forwarder --clean</code></pre>
<p>Next, enter your EI credentials and choose your project, variables (for example, <em>accX,</em> <em>accY</em>, and <em>accZ</em>), and device name (for example, <em>NiclaV</em>:</p>
<p> <img src="../media/file477.jpg" class="quarto-figure quarto-figure-center" style="width:95.0%" alt="" /></p>
<p>Go to the <code>Devices</code> section on your EI Project and verify if the device is connected (the dot should be green):</p>
<p> <img src="../media/file478.jpg" alt="" /></p>
<blockquote>
<p>You can clone the project developed for this hands-on: <a href="https://studio.edgeimpulse.com/public/302078/latest">NICLA Vision Movement Classification</a>.</p>
</blockquote>
</section>
<section id="sec-motion-classification-anomaly-detection-data-collection-5657" class="level3 unnumbered">
<h3 class="unnumbered">Data Collection</h3>
<p>On the <code>Data Acquisition</code> section, you should see that your board <code>[NiclaV]</code> is connected. The sensor is available: <code>[sensor with 3 axes (accX, accY, accZ)]</code> with a sampling frequency of <code>[50 Hz]</code>. The Studio suggests a sample length of <code>[10000]</code> ms (10 s). The last thing left is defining the sample label. Let’s start with<code>[terrestrial]</code>:</p>
<p> <img src="../media/file479.jpg" alt="" /></p>
<p><strong>Terrestrial</strong> (palettes in a Truck or Train), moving horizontally. Press <code>[Start Sample]</code>and move your device horizontally, keeping one direction over your table. After 10 s, your data will be uploaded to the studio. Here is how the sample was collected:</p>
<p> <img src="../media/file480.jpg" alt="" /></p>
<p>As expected, the movement was captured mainly in the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>-axis (green). In the blue, we see the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math> axis, around -10 m/s<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mn>2</mn></msup><annotation encoding="application/x-tex">^2</annotation></semantics></math> (the Nicla has the camera facing up).</p>
<p>As discussed before, we should capture data from all four Transportation Classes. So, imagine that you have a container with a built-in accelerometer facing the following situations:</p>
<p><strong>Maritime</strong> (pallets in boats into an angry ocean). The movement is captured on all three axes:</p>
<p> <img src="../media/file481.jpg" alt="" /></p>
<p><strong>Lift</strong> (Palettes being handled vertically by a Forklift). Movement captured only in the <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>-axis:</p>
<p> <img src="../media/file482.jpg" alt="" /></p>
<p><strong>Idle</strong> (Palettes in a warehouse). No movement detected by the accelerometer:</p>
<p> <img src="../media/file483.jpg" alt="" /></p>
<p>You can capture, for example, 2 minutes (twelve samples of 10 seconds) for each of the four classes (a total of 8 minutes of data). Using the <code>three dots</code> menu after each one of the samples, select 2 of them, reserving them for the Test set. Alternatively, you can use the automatic <code>Train/Test Split tool</code> on the <code>Danger Zone</code> of <code>Dashboard</code> tab. Below, you can see the resulting dataset:</p>
<p> <img src="../media/file484.jpg" alt="" /></p>
<p>Once you have captured your dataset, you can explore it in more detail using the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/data-acquisition/data-explorer">Data Explorer</a>, a visual tool to find outliers or mislabeled data (helping to correct them). The data explorer first tries to extract meaningful features from your data (by applying signal processing and neural network embeddings) and then uses a dimensionality reduction algorithm such as <a href="https://en.wikipedia.org/wiki/Principal_component_analysis">PCA</a> or <a href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding">t-SNE</a> to map these features to a 2D space. This gives you a one-look overview of your complete dataset.</p>
<p> <img src="../media/file485.jpg" class="quarto-figure quarto-figure-center" style="width:95.0%" alt="" /></p>
<p>In our case, the dataset seems OK (good separation). But the PCA shows we can have issues between maritime (green) and lift (orange). This is expected, once on a boat, sometimes the movement can be only “vertical”.</p>
</section>
</section>
<section id="sec-motion-classification-anomaly-detection-impulse-design-076e" class="level2 unnumbered">
<h2 class="unnumbered">Impulse Design</h2>
<p>The next step is the definition of our Impulse, which takes the raw data and uses signal processing to extract features, passing them as the input tensor of a <em>learning block</em> to classify new data. Go to <code>Impulse Design</code> and <code>Create Impulse</code>. The Studio will suggest the basic design. Let’s also add a second <em>Learning Block</em> for <code>Anomaly Detection</code>.</p>
<p> <img src="../media/file486.jpg" class="quarto-figure quarto-figure-center" style="width:95.0%" alt="" /></p>
<p>This second model uses a K-means model. If we imagine that we could have our known classes as clusters, any sample that could not fit on that could be an outlier, an anomaly such as a container rolling out of a ship on the ocean or falling from a Forklift.</p>
<p> <img src="../media/file487.jpg" class="quarto-figure quarto-figure-center" style="width:100.0%" alt="" /></p>
<p>The sampling frequency should be automatically captured, if not, enter it: <code>[50]</code>Hz. The Studio suggests a <em>Window Size</em> of 2 seconds (<code>[2000]</code> ms) with a <em>sliding window</em> of <code>[20]</code>ms. What we are defining in this step is that we will pre-process the captured data (Time-Seres data), creating a tabular dataset features) that will be the input for a Neural Networks Classifier (DNN) and an Anomaly Detection model (K-Means), as shown below:</p>
<p> <img src="../media/file488.jpg" alt="" /></p>
<p>Let’s dig into those steps and parameters to understand better what we are doing here.</p>
<section id="sec-motion-classification-anomaly-detection-data-preprocessing-overview-52c4" class="level3 unnumbered">
<h3 class="unnumbered">Data Pre-Processing Overview</h3>
<p>Data pre-processing is extracting features from the dataset captured with the accelerometer, which involves processing and analyzing the raw data. Accelerometers measure the acceleration of an object along one or more axes (typically three, denoted as <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>). These measurements can be used to understand various aspects of the object’s motion, such as movement patterns and vibrations.</p>
<p>Raw accelerometer data can be noisy and contain errors or irrelevant information. Preprocessing steps, such as filtering and normalization, can clean and standardize the data, making it more suitable for feature extraction. In our case, we should divide the data into smaller segments or <strong>windows</strong>. This can help focus on specific events or activities within the dataset, making feature extraction more manageable and meaningful. The <strong>window size</strong> and overlap (<strong>window increase</strong>) choice depend on the application and the frequency of the events of interest. As a thumb rule, we should try to capture a couple of “cycles of data”.</p>
<blockquote>
<p>With a sampling rate (SR) of 50 Hz and a window size of 2 seconds, we will get 100 samples per axis, or 300 in total (3 axis <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math> 2 seconds <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>×</mi><annotation encoding="application/x-tex">\times</annotation></semantics></math> 50 samples). We will slide this window every 200 ms, creating a larger dataset where each instance has 300 raw features.</p>
</blockquote>
<p> <img src="../media/file489.jpg" class="quarto-figure quarto-figure-center" style="width:85.0%" alt="" /></p>
<p>Once the data is preprocessed and segmented, you can extract features that describe the motion’s characteristics. Some typical features extracted from accelerometer data include:</p>
<ul>
<li><strong>Time-domain</strong> features describe the data’s statistical properties within each segment, such as mean, median, standard deviation, skewness, kurtosis, and zero-crossing rate.</li>
<li><strong>Frequency-domain</strong> features are obtained by transforming the data into the frequency domain using techniques like the Fast Fourier Transform (FFT). Some typical frequency-domain features include the power spectrum, spectral energy, dominant frequencies (amplitude and frequency), and spectral entropy.</li>
<li><strong>Time-frequency</strong> domain features combine the time and frequency domain information, such as the Short-Time Fourier Transform (STFT) or the Discrete Wavelet Transform (DWT). They can provide a more detailed understanding of how the signal’s frequency content changes over time.</li>
</ul>
<p>In many cases, the number of extracted features can be large, which may lead to overfitting or increased computational complexity. Feature selection techniques, such as mutual information, correlation-based methods, or principal component analysis (PCA), can help identify the most relevant features for a given application and reduce the dimensionality of the dataset. The Studio can help with such feature importance calculations.</p>
</section>
<section id="sec-motion-classification-anomaly-detection-ei-studio-spectral-features-ed14" class="level3 unnumbered">
<h3 class="unnumbered">EI Studio Spectral Features</h3>
<p>Data preprocessing is a challenging area for embedded machine learning, still, Edge Impulse helps overcome this with its digital signal processing (DSP) preprocessing step and, more specifically, the <a href="https://docs.edgeimpulse.com/docs/edge-impulse-studio/processing-blocks/spectral-features">Spectral Features Block</a>.</p>
<p>On the Studio, the collected raw dataset will be the input of a Spectral Analysis block, which is excellent for analyzing repetitive motion, such as data from accelerometers. This block will perform a DSP (Digital Signal Processing), extracting features such as <a href="https://en.wikipedia.org/wiki/Fast_Fourier_transform">FFT</a> or <a href="https://en.wikipedia.org/wiki/Digital_signal_processing#Wavelet">Wavelets</a>.</p>
<p>For our project, once the time signal is continuous, we should use FFT with, for example, a length of <code>[32]</code>.</p>
<p>The per axis/channel <strong>Time Domain Statistical features</strong> are:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Root_mean_square">RMS</a>: 1 feature</li>
<li><a href="https://colab.research.google.com/corgiredirector?site=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSkewness">Skewness</a>: 1 feature</li>
<li><a href="https://colab.research.google.com/corgiredirector?site=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FKurtosis">Kurtosis</a>: 1 feature</li>
</ul>
<p>The per axis/channel <strong>Frequency Domain Spectral features</strong> are:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Spectral_density">Spectral Power</a>: 16 features (FFT Length/2)</li>
<li>Skewness: 1 feature</li>
<li>Kurtosis: 1 feature</li>
</ul>
<p>So, for an FFT length of 32 points, the resulting output of the Spectral Analysis Block will be 21 features per axis (a total of 63 features).</p>
<blockquote>
<p>You can learn more about how each feature is calculated by downloading the notebook <a href="https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/Motion_Classification/Edge_Impulse_Spectral_Features_Block.ipynb">Edge Impulse - Spectral Features Block Analysis</a> <a href="https://www.hackster.io/mjrobot/tinyml-under-the-hood-spectral-analysis-94676c">TinyML under the hood: Spectral Analysis</a> or <a href="https://colab.research.google.com/github/Mjrovai/Arduino_Nicla_Vision/blob/main/Motion_Classification/Edge_Impulse_Spectral_Features_Block.ipynb">opening it directly on Google CoLab</a>.</p>
</blockquote>
</section>
<section id="sec-motion-classification-anomaly-detection-generating-features-2e22" class="level3 unnumbered">
<h3 class="unnumbered">Generating features</h3>
<p>Once we understand what the pre-processing does, it is time to finish the job. So, let’s take the raw data (time-series type) and convert it to tabular data. For that, go to the <code>Spectral Features</code> section on the <code>Parameters</code> tab, define the main parameters as discussed in the previous section (<code>[FFT]</code> with <code>[32]</code> points), and select<code>[Save Parameters]</code>:</p>
<p> <img src="../media/file490.jpg" class="quarto-figure quarto-figure-center" style="width:85.0%" alt="" /></p>
<p>At the top menu, select the <code>Generate Features</code> option and the <code>Generate Features</code> button. Each 2-second window data will be converted into one data point of 63 features.</p>
<blockquote>
<p>The Feature Explorer will show those data in 2D using <a href="https://umap-learn.readthedocs.io/en/latest/">UMAP.</a> Uniform Manifold Approximation and Projection (UMAP) is a dimension reduction technique that can be used for visualization similarly to t-SNE but is also applicable for general non-linear dimension reduction.</p>
</blockquote>
<p>The visualization makes it possible to verify that after the feature generation, the classes present keep their excellent separation, which indicates that the classifier should work well. Optionally, you can analyze how important each one of the features is for one class compared with others.</p>
<p> <img src="../media/file491.jpg" class="quarto-figure quarto-figure-center" style="width:95.0%" alt="" /></p>
</section>
</section>
<section id="sec-motion-classification-anomaly-detection-models-training-3795" class="level2 unnumbered">
<h2 class="unnumbered">Models Training</h2>
<p>Our classifier will be a Dense Neural Network (DNN) that will have 63 neurons on its input layer, two hidden layers with 20 and 10 neurons, and an output layer with four neurons (one per each class), as shown here:</p>
<p> <img src="../media/file492.jpg" alt="" /></p>
<p>As hyperparameters, we will use a Learning Rate of <code>[0.005]</code>, a Batch size of <code>[32]</code>, and <code>[20]</code>% of data for validation for <code>[30]</code> epochs. After training, we can see that the accuracy is 98.5%. The cost of memory and latency is meager.</p>
<p> <img src="../media/file493.jpg" class="quarto-figure quarto-figure-center" style="width:90.0%" alt="" /></p>
<p>For Anomaly Detection, we will choose the suggested features that are precisely the most important ones in the Feature Extraction, plus the accZ RMS. The number of clusters will be <code>[32]</code>, as suggested by the Studio:</p>
<p> <img src="../media/file494.jpg" class="quarto-figure quarto-figure-center" style="width:90.0%" alt="" /></p>
</section>
<section id="sec-motion-classification-anomaly-detection-testing-5598" class="level2 unnumbered">
<h2 class="unnumbered">Testing</h2>
<p>We can verify how our model will behave with unknown data using 20% of the data left behind during the data capture phase. The result was almost 95%, which is good. You can always work to improve the results, for example, to understand what went wrong with one of the wrong results. If it is a unique situation, you can add it to the training dataset and then repeat it.</p>
<p>The default minimum threshold for a considered uncertain result is <code>[0.6]</code> for classification and <code>[0.3]</code> for anomaly. Once we have four classes (their output sum should be 1.0), you can also set up a lower threshold for a class to be considered valid (for example, 0.4). You can <code>Set confidence thresholds</code> on the <code>three dots</code> menu, besides the <code>Classify all</code> button.</p>
<p> <img src="../media/file495.jpg" alt="" /></p>
<p>You can also perform Live Classification with your device (which should still be connected to the Studio).</p>
<blockquote>
<p>Be aware that here, you will capture real data with your device and upload it to the Studio, where an inference will be taken using the trained model (But the <strong>model is NOT in your device</strong>).</p>
</blockquote>
</section>
<section id="sec-motion-classification-anomaly-detection-deploy-1e77" class="level2 unnumbered">
<h2 class="unnumbered">Deploy</h2>
<p>It is time to deploy the preprocessing block and the trained model to the Nicla. The Studio will package all the needed libraries, preprocessing functions, and trained models, downloading them to your computer. You should select the option <code>Arduino Library</code>, and at the bottom, you can choose <code>Quantized (Int8)</code> or <code>Unoptimized (float32)</code> and <code>[Build]</code>. A Zip file will be created and downloaded to your computer.</p>
<p> <img src="../media/file496.jpg" alt="" /></p>
<p>On your Arduino IDE, go to the <code>Sketch</code> tab, select <code>Add.ZIP Library</code>, and Choose the.zip file downloaded by the Studio. A message will appear in the IDE Terminal: <code>Library installed</code>.</p>
<section id="sec-motion-classification-anomaly-detection-inference-b173" class="level3 unnumbered">
<h3 class="unnumbered">Inference</h3>
<p>Now, it is time for a real test. We will make inferences wholly disconnected from the Studio. Let’s change one of the code examples created when you deploy the Arduino Library.</p>
<p>In your Arduino IDE, go to the <code>File/Examples</code> tab and look for your project, and on examples, select <code>Nicla_vision_fusion</code>:</p>
<p> <img src="../media/file497.jpg" alt="" /></p>
<p>Note that the code created by Edge Impulse considers a <em>sensor fusion</em> approach where the IMU (Accelerometer and Gyroscope) and the ToF are used. At the beginning of the code, you have the libraries related to our project, IMU and ToF:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource cpp number-lines"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">/* Includes ---------------------------------------------- */</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="pp">#include </span><span class="im">&lt;NICLA_Vision_Movement_Classification_inferencing.h&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="pp">#include </span><span class="im">&lt;Arduino_LSM6DSOX.h&gt;</span><span class="pp"> </span><span class="co">//IMU</span></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="pp">#include </span><span class="im">&quot;VL53L1X.h&quot;</span><span class="pp"> </span><span class="co">// ToF</span></span></code></pre></div>
<blockquote>
<p>You can keep the code this way for testing because the trained model will use only features pre-processed from the accelerometer. But consider that you will write your code only with the needed libraries for a real project.</p>
</blockquote>
<p>And that is it!</p>
<p>You can now upload the code to your device and proceed with the inferences. Press the Nicla <code>[RESET]</code> button twice to put it on boot mode (disconnect from the Studio if it is still connected), and upload the sketch to your board.</p>
<p>Now you should try different movements with your board (similar to those done during data capture), observing the inference result of each class on the Serial Monitor:</p>
<ul>
<li><strong>Idle and lift classes</strong>:</li>
</ul>
<p> <img src="../media/file498.jpg" alt="" /></p>
<ul>
<li><strong>Maritime and terrestrial</strong>:</li>
</ul>
<p> <img src="../media/file499.jpg" alt="" /></p>
<p>Note that in all situations above, the value of the <code>anomaly score</code> was smaller than 0.0. Try a new movement that was not part of the original dataset, for example, “rolling” the Nicla, facing the camera upside-down, as a container falling from a boat or even a boat accident:</p>
<ul>
<li><strong>Anomaly detection</strong>:</li>
</ul>
<p> <img src="../media/file500.jpg" alt="" /></p>
<p>In this case, the anomaly is much bigger, over 1.00</p>
</section>
<section id="sec-motion-classification-anomaly-detection-postprocessing-3f0d" class="level3 unnumbered">
<h3 class="unnumbered">Post-processing</h3>
<p>Now that we know the model is working since it detects the movements, we suggest that you modify the code to see the result with the NiclaV completely offline (disconnected from the PC and powered by a battery, a power bank, or an independent 5 V power supply).</p>
<p>The idea is to do the same as with the KWS project: if one specific movement is detected, a specific LED could be lit. For example, if <em>terrestrial</em> is detected, the Green LED will light; if <em>maritime</em>, the Red LED will light, if it is a <em>lift,</em> the Blue LED will light; and if no movement is detected <em>(idle</em>), the LEDs will be OFF. You can also add a condition when an anomaly is detected, in this case, for example, a white color can be used (all e LEDs light simultaneously).</p>
</section>
</section>
<section id="sec-motion-classification-anomaly-detection-summary-b36e" class="level2 unnumbered">
<h2 class="unnumbered">Summary</h2>
<blockquote>
<p>The notebooks and codeused in this hands-on tutorial will be found on the <a href="https://github.com/Mjrovai/Arduino_Nicla_Vision/tree/main/Motion_Classification">GitHub</a> repository.</p>
</blockquote>
<p>Before we finish, consider that Movement Classification and Object Detection can be utilized in many applications across various domains. Here are some of the potential applications:</p>
<section id="sec-motion-classification-anomaly-detection-case-applications-b15e" class="level3 unnumbered">
<h3 class="unnumbered">Case Applications</h3>
<section id="sec-motion-classification-anomaly-detection-industrial-manufacturing-faae" class="level4 unnumbered">
<h4 class="unnumbered">Industrial and Manufacturing</h4>
<ul>
<li><strong>Predictive Maintenance</strong>: Detecting anomalies in machinery motion to predict failures before they occur.</li>
<li><strong>Quality Control</strong>: Monitoring the motion of assembly lines or robotic arms for precision assessment and deviation detection from the standard motion pattern.</li>
<li><strong>Warehouse Logistics</strong>: Managing and tracking the movement of goods with automated systems that classify different types of motion and detect anomalies in handling.</li>
</ul>
</section>
<section id="sec-motion-classification-anomaly-detection-healthcare-33cd" class="level4 unnumbered">
<h4 class="unnumbered">Healthcare</h4>
<ul>
<li><strong>Patient Monitoring</strong>: Detecting falls or abnormal movements in the elderly or those with mobility issues.</li>
<li><strong>Rehabilitation</strong>: Monitoring the progress of patients recovering from injuries by classifying motion patterns during physical therapy sessions.</li>
<li><strong>Activity Recognition</strong>: Classifying types of physical activity for fitness applications or patient monitoring.</li>
</ul>
</section>
<section id="sec-motion-classification-anomaly-detection-consumer-electronics-346f" class="level4 unnumbered">
<h4 class="unnumbered">Consumer Electronics</h4>
<ul>
<li><strong>Gesture Control</strong>: Interpreting specific motions to control devices, such as turning on lights with a hand wave.</li>
<li><strong>Gaming</strong>: Enhancing gaming experiences with motion-controlled inputs.</li>
</ul>
</section>
<section id="sec-motion-classification-anomaly-detection-transportation-logistics-1ec8" class="level4 unnumbered">
<h4 class="unnumbered">Transportation and Logistics</h4>
<ul>
<li><strong>Vehicle Telematics</strong>: Monitoring vehicle motion for unusual behavior such as hard braking, sharp turns, or accidents.</li>
<li><strong>Cargo Monitoring</strong>: Ensuring the integrity of goods during transport by detecting unusual movements that could indicate tampering or mishandling.</li>
</ul>
</section>
<section id="sec-motion-classification-anomaly-detection-smart-cities-infrastructure-3a9c" class="level4 unnumbered">
<h4 class="unnumbered">Smart Cities and Infrastructure</h4>
<ul>
<li><strong>Structural Health Monitoring</strong>: Detecting vibrations or movements within structures that could indicate potential failures or maintenance needs.</li>
<li><strong>Traffic Management</strong>: Analyzing the flow of pedestrians or vehicles to improve urban mobility and safety.</li>
</ul>
</section>
<section id="sec-motion-classification-anomaly-detection-security-surveillance-10e2" class="level4 unnumbered">
<h4 class="unnumbered">Security and Surveillance</h4>
<ul>
<li><strong>Intruder Detection</strong>: Detecting motion patterns typical of unauthorized access or other security breaches.</li>
<li><strong>Wildlife Monitoring</strong>: Detecting poachers or abnormal animal movements in protected areas.</li>
</ul>
</section>
<section id="sec-motion-classification-anomaly-detection-agriculture-6782" class="level4 unnumbered">
<h4 class="unnumbered">Agriculture</h4>
<ul>
<li><strong>Equipment Monitoring</strong>: Tracking the performance and usage of agricultural machinery.</li>
<li><strong>Animal Behavior Analysis</strong>: Monitoring livestock movements to detect behaviors indicating health issues or stress.</li>
</ul>
</section>
<section id="sec-motion-classification-anomaly-detection-environmental-monitoring-0d3f" class="level4 unnumbered">
<h4 class="unnumbered">Environmental Monitoring</h4>
<ul>
<li><strong>Seismic Activity</strong>: Detecting irregular motion patterns that precede earthquakes or other geologically relevant events.</li>
<li><strong>Oceanography</strong>: Studying wave patterns or marine movements for research and safety purposes.</li>
</ul>
</section>
</section>
<section id="sec-motion-classification-anomaly-detection-nicla-3d-case-f3b8" class="level3 unnumbered">
<h3 class="unnumbered">Nicla 3D case</h3>
<p>For real applications, as some described before, we can add a case to our device, and Eoin Jordan, from Edge Impulse, developed a great wearable and machine health case for the Nicla range of boards. It works with a 10mm magnet, 2M screws, and a 16mm strap for human and machine health use case scenarios. Here is the link: <a href="https://www.thingiverse.com/thing:5923305">Arduino Nicla Voice and Vision Wearable Case</a>.</p>
<p> <img src="../media/file501.jpg" alt="" /></p>
<p>The applications for motion classification and anomaly detection are extensive, and the Arduino Nicla Vision is well-suited for scenarios where low power consumption and edge processing are advantageous. Its small form factor and efficiency in processing make it an ideal choice for deploying portable and remote applications where real-time processing is crucial and connectivity may be limited.</p>
</section>
</section>
<section id="sec-motion-classification-anomaly-detection-resources-a2eb" class="level2 unnumbered">
<h2 class="unnumbered">Resources</h2>
<ul>
<li><p><a href="https://github.com/Mjrovai/Arduino_Nicla_Vision/tree/main/Motion_Classification/Niclav_Acc_Data_Capture">Arduino Code</a></p></li>
<li><p><a href="https://colab.research.google.com/github/Mjrovai/Arduino_Nicla_Vision/blob/main/Motion_Classification/Edge_Impulse_Spectral_Features_Block.ipynb">Edge Impulse Spectral Features Block Colab Notebook</a></p></li>
<li><p><a href="https://studio.edgeimpulse.com/public/302078/latest">Edge Impulse Project</a></p></li>
</ul>
<!-- This is here to make sure that quizzes are inserted properly before a part begins. -->
<div class="quiz-end">

</div>
<div>

</div>
</section>
</section>
</body>
</html>
