<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Vectors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Vectors</h1>
<blockquote>原文：<a href="https://rust-exercises.com/100-exercises/06_ticket_management/02_vec.html">https://rust-exercises.com/100-exercises/06_ticket_management/02_vec.html</a></blockquote>
                        
<p>Arrays' strength is also their weakness: their size must be known upfront, at compile-time.
If you try to create an array with a size that's only known at runtime, you'll get a compilation error:</p>
<pre><code class="language-rust">let n = 10;
let numbers: [u32; n];</code></pre>
<pre><code class="language-text">error[E0435]: attempt to use a non-constant value in a constant
 --&gt; src/main.rs:3:20
  |
2 | let n = 10;
3 | let numbers: [u32; n];
  |                    ^ non-constant value
</code></pre>
<p>Arrays wouldn't work for our ticket management system—we don't know how many tickets we'll need to store at compile-time.
This is where <code>Vec</code> comes in.</p>
<h2 id="vec"><a class="header" href="#vec"><code>Vec</code></a></h2>
<p><code>Vec</code> is a growable array type, provided by the standard library.<br/>
You can create an empty array using the <code>Vec::new</code> function:</p>
<pre><code class="language-rust">let mut numbers: Vec&lt;u32&gt; = Vec::new();</code></pre>
<p>You would then push elements into the vector using the <code>push</code> method:</p>
<pre><code class="language-rust">numbers.push(1);
numbers.push(2);
numbers.push(3);</code></pre>
<p>New values are added to the end of the vector.<br/>
You can also create an initialized vector using the <code>vec!</code> macro, if you know the values at creation time:</p>
<pre><code class="language-rust">let numbers = vec![1, 2, 3];</code></pre>
<h2 id="accessing-elements"><a class="header" href="#accessing-elements">Accessing elements</a></h2>
<p>The syntax for accessing elements is the same as with arrays:</p>
<pre><code class="language-rust">let numbers = vec![1, 2, 3];
let first = numbers[0];
let second = numbers[1];
let third = numbers[2];</code></pre>
<p>The index must be of type <code>usize</code>.<br/>
You can also use the <code>get</code> method, which returns an <code>Option&lt;&amp;T&gt;</code>:</p>
<pre><code class="language-rust">let numbers = vec![1, 2, 3];
assert_eq!(numbers.get(0), Some(&amp;1));
// You get a `None` if you try to access an out-of-bounds index
// rather than a panic.
assert_eq!(numbers.get(3), None);</code></pre>
<p>Access is bounds-checked, just like element access with arrays. It has O(1) complexity.</p>
<h2 id="memory-layout"><a class="header" href="#memory-layout">Memory layout</a></h2>
<p><code>Vec</code> is a heap-allocated data structure.<br/>
When you create a <code>Vec</code>, it allocates memory on the heap to store the elements.</p>
<p>If you run the following code:</p>
<pre><code class="language-rust">let mut numbers = Vec::with_capacity(3);
numbers.push(1);
numbers.push(2);</code></pre>
<p>you'll get the following memory layout:</p>
<pre><code class="language-text">      +---------+--------+----------+
Stack | pointer | length | capacity | 
      |  |      |   2    |    3     |
      +--|------+--------+----------+
         |
         |
         v
       +---+---+---+
Heap:  | 1 | 2 | ? |
       +---+---+---+
</code></pre>
<p><code>Vec</code> keeps track of three things:</p>
<ul>
<li>The <strong>pointer</strong> to the heap region you reserved.</li>
<li>The <strong>length</strong> of the vector, i.e. how many elements are in the vector.</li>
<li>The <strong>capacity</strong> of the vector, i.e. the number of elements that can fit in the space reserved on the heap.</li>
</ul>
<p>This layout should look familiar: it's exactly the same as <code>String</code>!<br/>
That's not a coincidence: <code>String</code> is defined as a vector of bytes, <code>Vec&lt;u8&gt;</code>, under the hood:</p>
<pre><code class="language-rust">pub struct String {
    vec: Vec&lt;u8&gt;,
}</code></pre>
<h2 id="exercise"><a class="header" href="#exercise">Exercise</a></h2>
<p>The exercise for this section is located in <a href="https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/06_ticket_management/02_vec"><code>06_ticket_management/02_vec</code></a></p>

                        
</body>
</html>