["```py\ndf_raw = pd.read_feather(\"data/bulldozer-train.feather\")\ndf_raw = df_raw.iloc[-100_000:] # same 100,000 records as before\ndf = pd.read_feather(\"data/bulldozer-train-clean.feather\")\n\n```", "```py\nX, y = df.drop(['SalePrice','saledate'], axis=1), df['SalePrice']\nrf, oob_clean = test(X, y, n_estimators=150)\n\n```", "```py\ndef df_split_dates(df,colname):\n    df[\"saleyear\"] = df[colname].dt.year\n    df[\"salemonth\"] = df[colname].dt.month\n    df[\"saleday\"] = df[colname].dt.day\n    df[\"saledayofweek\"] = df[colname].dt.dayofweek\n    df[\"saledayofyear\"] = df[colname].dt.dayofyear\n    df[colname] = df[colname].astype(np.int64) # convert to seconds since 1970\n\n```", "```py\ndf_split_dates(df, 'saledate')\ndf.filter(regex=('sale*')).head(2).T\n```", "```py\nX, y = df.drop('SalePrice', axis=1), df['SalePrice']\nrf, oob_dates = test(X, y, n_estimators=150)\n\n```", "```py\ndf['age'] = df['saleyear'] - df['YearMade']\n\nX, y = df.drop('SalePrice', axis=1), df['SalePrice']\nrf, oob_age = test(X, y, n_estimators=150)\n\n```", "```py\nI = importances(rf, X, y)\nplot_importances(I.head(15))\n```", "```py\nfeatures = list(df.drop('SalePrice',axis=1).columns)\ndatefeatures = list(df.filter(regex=(\"sale*\")).columns)\nfor f in datefeatures:\n    features.remove(f)\nfeatures.remove('YearMade')\nfeatures.remove('age')\nfeatures += [['YearMade','age']+datefeatures]\nI = importances(rf, X, y, features=features)\nplot_importances(I.head(15))\n```", "```py\nfig,ax = plt.subplots()\ndf_small = df.sample(n=5_000) # don't draw too many dots\nax.scatter(df_small['age'], df_small['SalePrice'],\n           alpha=0.03, c=bookcolors['blue'])\nax.set_ylabel(\"SalePrice\")\nax.set_xlabel(\"Age in years\")\n```", "```py\ntemp = df_raw.fillna('nan') # original dataset\ntemp = temp.groupby('ProductSize').mean()\ntemp[['SalePrice']].sort_values('SalePrice').plot.barh()\n```", "```py\nsizes = {None:0, 'Mini':1, 'Compact':1, 'Small':2, 'Medium':3,\n         'Large / Medium':4, 'Large':5}\ndf['ProductSize'] = df_raw['ProductSize'].map(sizes).values\nprint(df['ProductSize'].unique())\n```", "```py\nX, y = df.drop('SalePrice', axis=1), df['SalePrice']\nrf, oob_ProductSize = test(X, y, n_estimators=150)\n\n```", "```py\ndf_toy = pd.DataFrame()\ndf_toy['Dept'] = ['Math','CS','Physics',np.nan]\ndf_toy\n```", "```py\nonehot = pd.get_dummies(df_toy['Dept'])\ndf_toy = pd.concat([df_toy, onehot], axis=1)\ndf_toy\n```", "```py\nprint(df_raw.Hydraulics_Flow.value_counts(dropna=False))\n```", "```py\ndf['Hydraulics_Flow'] = df_raw['Hydraulics_Flow'].values\ndf['Hydraulics_Flow'] = df['Hydraulics_Flow'].replace('None or Unspecified', np.nan)\nonehot = pd.get_dummies(df['Hydraulics_Flow'],\n                        prefix='Hydraulics_Flow',\n                        dtype=bool)\n\n```", "```py\ndel df['Hydraulics_Flow']\ndf = pd.concat([df, onehot], axis=1)\n\n```", "```py\nX, y = df.drop('SalePrice', axis=1), df['SalePrice']\nrf, oob_Hydraulics_Flow = test(X, y, n_estimators=150)\n\n```", "```py\nprint(df_raw.Enclosure.value_counts(dropna=False))\n```", "```py\ndf['Enclosure'] = df_raw['Enclosure'].values\ndf['Enclosure'] = df['Enclosure'].replace('EROPS w AC', 'EROPS AC')\ndf['Enclosure'] = df['Enclosure'].replace('None or Unspecified', np.nan)\ndf['Enclosure'] = df['Enclosure'].replace('NO ROPS', np.nan)\n\n```", "```py\ntemp = df.groupby('Enclosure').mean()\ntemp[['SalePrice']].sort_values('SalePrice').plot.barh()\n```", "```py\nonehot = pd.get_dummies(df['Enclosure'],\n                        prefix='Enclosure',\n                        dtype=bool)\ndel df['Enclosure']\ndf = pd.concat([df, onehot], axis=1)\nX, y = df.drop('SalePrice', axis=1), df['SalePrice']\nrf, oob_Enclosure = test(X, y, n_estimators=150)\n\n```", "```py\nI = importances(rf, X, y)\nplot_importances(I.head(20))\n```", "```py\ntemp = df_raw.groupby('fiProductClassDesc').mean()\ntemp[['SalePrice']].sort_values('SalePrice').head(15).plot.barh()\n```", "```py\n# careful when copying between dataframes; use .values\ndf_split = df_raw.fiProductClassDesc.str.split(' - ',expand=True).values\ndf['fiProductClassDesc'] = df_split[:,0] \ndf['fiProductClassSpec'] = df_split[:,1] # temporary column\nprint(df['fiProductClassDesc'].unique())\n```", "```py\nprint(df['fiProductClassSpec'].unique()[:5])\n```", "```py\npattern = r'([0-9.\\+]*)(?: to ([0-9.\\+]*)|\\+) ([a-zA-Z ]*)'\ndf_split = df['fiProductClassSpec'].str.extract(pattern, expand=True).values\ndf['fiProductClassSpec_lower'] = pd.to_numeric(df_split[:,0])\ndf['fiProductClassSpec_upper'] = pd.to_numeric(df_split[:,1])\ndf['fiProductClassSpec_units'] = df_split[:,2]\ndel df['fiProductClassSpec'] # remove temporary column\ndf.filter(regex=('fiProductClassSpec*')).head(3)\n```", "```py\nfix_missing_num(df, 'fiProductClassSpec_lower')\nfix_missing_num(df, 'fiProductClassSpec_upper')\n# label encode fiProductClassDesc fiProductClassSpec_units\ndf_string_to_cat(df)\ndf_cat_to_catcode(df)\n\n```", "```py\nX, y = df.drop('SalePrice', axis=1), df['SalePrice']\nrf, oob_fiProductClassDesc = test(X, y, n_estimators=150)\n\n```", "```py\nX, y = df.drop('SalePrice', axis=1), df['SalePrice']\ny = np.log(y)\nrf, oob_log = test(X, y, n_estimators=150)\n\n```", "```py\ndf[\"salemonth\"] = df[colname].dt.month\n```", "```py\ndf[colname] = df[colname].astype(np.int64) # convert date to seconds\n```", "```py\nm = {np.nan:0, 'low':1, 'medium':2, 'high':3}\ndf[colname] = df_raw[colname].map(m)\n```", "```py\nonehot = pd.get_dummies(df[colname])\ndf = pd.concat([df, onehot], axis=1)\ndel df[colname]\n```", "```py\n# get two columns\ndf_descr_spec_split = df[colname].str.split(' - ',expand=True)\n```", "```py\n# get three columns\npattern = r'([0-9.\\+]*)(?: to ([0-9.\\+]*)|\\+) ([a-zA-Z ]*)'\ndf_split = df['fiProductClassSpec'].str.extract(pattern, expand=True)\n```"]