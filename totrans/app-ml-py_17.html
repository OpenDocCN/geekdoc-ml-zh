<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Random Projection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Random Projection</h1>
<blockquote>ÂéüÊñáÔºö<a href="https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_random_projection.html">https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_random_projection.html</a></blockquote>

<p>Michael J. Pyrcz, Professor, The University of Texas at Austin</p>
<p><a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
<p>Chapter of e-book ‚ÄúApplied Machine Learning in Python: a Hands-on Guide with Code‚Äù.</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite this e-Book as:</p>
<p>Pyrcz, M.J., 2024, <em>Applied Machine Learning in Python: A Hands-on Guide with Code</em> [e-book]. Zenodo. doi:10.5281/zenodo.15169138 <a class="reference external" href="https://doi.org/10.5281/zenodo.15169138"><img alt="DOI" src="../Images/7e4ea662f44af1eae87e87ecbb962ff4.png" data-original-src="https://zenodo.org/badge/863274676.svg"/></a></p>
</div>
<p>The workflows in this book and more are available here:</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite the MachineLearningDemos GitHub Repository as:</p>
<p>Pyrcz, M.J., 2024, <em>MachineLearningDemos: Python Machine Learning Demonstration Workflows Repository</em> (0.0.3) [Software]. Zenodo. DOI: 10.5281/zenodo.13835312. GitHub repository: <a class="github reference external" href="https://github.com/GeostatsGuy/MachineLearningDemos">GeostatsGuy/MachineLearningDemos</a> <a class="reference external" href="https://zenodo.org/doi/10.5281/zenodo.13835312"><img alt="DOI" src="../Images/4e3a59c17d684b06a170c4af84e0f631.png" data-original-src="https://zenodo.org/badge/862519860.svg"/></a></p>
</div>
<p>By Michael J. Pyrcz <br/>
¬© Copyright 2024.</p>
<p>This chapter is a tutorial for / demonstration of <strong>Random Projection</strong>.</p>
<p><strong>YouTube Lecture</strong>: check out my lectures on:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://youtu.be/zOUM_AnI1DQ?si=wzWdJ35qJ9n8O6Bl">Introduction to Machine Learning</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/-to3JXiae9Y?si=W1j2CwR9t0t8hxIB">Curse of Dimensionality, Dimensionality Reduction, Principal Component Analysis</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/Yt0o8ukIOKU?si=_ri1NPwKVdhYzgO3">Multidimensional Scaling and Random Projection</a></p></li>
</ul>
<p>These lectures are all part of my <a class="reference external" href="https://youtube.com/playlist?list=PLG19vXLQHvSC2ZKFIkgVpI9fCjkN38kwf&amp;si=XonjO2wHdXffMpeI">Machine Learning Course</a> on YouTube with linked well-documented Python workflows and interactive dashboards. My goal is to share accessible, actionable, and repeatable educational content. If you want to know about my motivation, check out <a class="reference external" href="https://michaelpyrcz.com/my-story">Michael‚Äôs Story</a>.</p>
<section id="motivation-for-random-projection">
<h2>Motivation for Random Projection</h2>
<p>Imagine we need very fast dimensionality reduction by a projection from <span class="math notranslate nohighlight">\(m\)</span> features, i.e., high dimensional, to <span class="math notranslate nohighlight">\(p\)</span> features, i.e., lower dimensional space,</p>
<div class="math notranslate nohighlight">
\[
ùëù, \quad \text{where} \quad ùëù &lt;&lt; ùëö
\]</div>
<p>and in this case,</p>
<ul class="simple">
<li><p>we do not have all the data now (for example, real-time data), so we cannot calculate a matrix of covariances nor dissimilarities</p></li>
<li><p>we cannot afford to calculate an orthogonal transform, given the size of <span class="math notranslate nohighlight">\(m\)</span> it is too computationally expensive</p></li>
</ul>
<p>Can we transform the <span class="math notranslate nohighlight">\(m\)</span> features to a lower dimensional <span class="math notranslate nohighlight">\(p\)</span> with a random linear projection?</p>
<figure style="text-align: center;">
  <img src="../Images/9ff1ace2c6fcc051cac02de9dd663851.png" style="display: block; margin: 0 auto; width: 60%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static\random_projection\context.png"/>
  <figcaption style="text-align: center;">The concept of random projection, vs. multidimensional scaling.</figcaption>
</figure>
<p>where <span class="math notranslate nohighlight">\(ùëã_{1 \times m}\)</span> is a single data sample over <span class="math notranslate nohighlight">\(m\)</span> features, <span class="math notranslate nohighlight">\(ùëÖ_{p \times m}\)</span> is a random projection matrix, populated with random values, and <span class="math notranslate nohighlight">\(ùëã_{p \times n}^{ùëÖùëÉ}\)</span> is the new data projected to <span class="math notranslate nohighlight">\(p\)</span> features.</p>
</section>
<section id="id1">
<h2>Random Projection</h2>
<p>An alternative to principal components analysis and multidimensional scaling that relies on an random (<span class="math notranslate nohighlight">\(p \times n\)</span>) projection matrix, <span class="math notranslate nohighlight">\(ùëÖ_{p \times m}\)</span>.</p>
<ul class="simple">
<li><p>all values are independent, random variables, typically standard normal, <span class="math notranslate nohighlight">\(N\left[0,1\right]\)</span>.</p></li>
</ul>
<p>To avoid distortion, the projection <span class="math notranslate nohighlight">\(ùëÖ_{p \times m}\)</span> should be orthogonal, but as said above, ensuring orthogonality is too computationally expensive, to understand how this can work, we need to understand,</p>
<ul class="simple">
<li><p><strong>Hercht-Neilsen (1994)</strong> - the existence of a much larger number of orthogonal vectors in high dimensional space, likely quasi-orthogonal</p></li>
<li><p><strong>Johnson-Lindenstrauss lemma (1984)</strong> - that points in high-dimensional space can be linearly embedded in lower dimension with approximate preservation of pairwise distance with a high probability</p></li>
</ul>
</section>
<section id="near-orthogonal-vectors-in-high-dimensional-space">
<h2>Near-orthogonal Vectors in High Dimensional Space</h2>
<p>Robert Hercht-Neilsen (1994) demonstrates that in high dimensional space, there exists a much larger number of almost orthogonal than strictly orthogonal directions.</p>
<ul class="simple">
<li><p>Random matrices may be sufficiently close to orthogonal in high dimensions.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
ùëÖ_{m√óp}^ùëá ùëÖ_{p√óm} \approx ùêº_{m√óm}
\]</div>
<p>where <span class="math notranslate nohighlight">\(I\)</span> is the identify matrix, <span class="math notranslate nohighlight">\(\approx\)</span> indicates approximate equal to identity matrix.</p>
<p>Our random vectors will be close enough to orthogonal if the dimensionality is large enough, i.e., high dimensional space.</p>
<ul class="simple">
<li><p>the probability increases with increase in dimensionality, the number of features, <span class="math notranslate nohighlight">\(ùëö\)</span></p></li>
</ul>
</section>
<section id="probability-of-near-preservation-of-pairwise-distance-in-high-dimensional-space">
<h2>Probability of Near Preservation of Pairwise Distance in High Dimensional Space</h2>
<p>This random approach works practically because of the The Johnson-Lindenstrauss lemma:</p>
<p><em>In mathematics, the Johnson-Lindenstrauss lemma is a result concerning low-distortion embeddings of points from high-dimensional into low-dimensional Euclidean space. The lemma states that a small set of points in a high-dimensional space can be embedded into a space of much lower dimension in such a way that distances between the points are nearly preserved. The map used for the embedding is at least Lipschitz, and can even be taken to be an orthogonal projection.</em> - Wikipedia article.</p>
<p>Points in a high-dimensionality space can be linearly embedded in a space of much lower dimensionality in such a way that distances between the points are nearly preserved (we allow for error, ùúÄ)</p>
<p>We can calculate given the size of data set, ùëõ, and desired error limit, ùúÄ, the minimum number of dimensions, ùëù, that we can project to with high probability of based on random projection, as a minimum,</p>
<div class="math notranslate nohighlight">
\[
ùëù &gt; \frac{ln‚Å°(ùëõ)}{ùúÄ^2} 
\]</div>
<p>For example, for 1,000 data with an pairwise distance error of 10% (0.1) we can project randomly to 690 dimensional.</p>
<ul class="simple">
<li><p>this minimum does not depend on the original dimensionality of the problem, <span class="math notranslate nohighlight">\(ùëö\)</span>!</p></li>
</ul>
</section>
<section id="load-the-required-libraries">
<h2>Load the Required Libraries</h2>
<p>The following code loads the required libraries. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">ignore_warnings</span> <span class="o">=</span> <span class="kc">True</span>                                        <span class="c1"># ignore warnings?</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                                            <span class="c1"># ndarrays for gridded data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                                           <span class="c1"># DataFrames for tabular data</span>
<span class="kn">import</span> <span class="nn">os</span>                                                     <span class="c1"># set working directory, run executables</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>                               <span class="c1"># for plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span><span class="n">AutoMinorLocator</span><span class="p">,</span><span class="n">NullLocator</span><span class="p">,</span><span class="n">FuncFormatter</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>                          <span class="c1"># add square to matrix plot</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>                                       <span class="c1"># summary statistics</span>
<span class="kn">import</span> <span class="nn">math</span>                                                   <span class="c1"># trigonometry etc.</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>                                 <span class="c1"># kernel for moving window calculation</span>
<span class="kn">import</span> <span class="nn">random</span>                                                 <span class="c1"># for random numbers</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>                                         <span class="c1"># for matrix scatter plots</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>                                      <span class="c1"># for linear regression</span>

<span class="kn">from</span> <span class="nn">sklearn.random_projection</span> <span class="kn">import</span> <span class="n">GaussianRandomProjection</span> <span class="c1"># random projection</span>
<span class="kn">from</span> <span class="nn">sklearn.random_projection</span> <span class="kn">import</span> <span class="n">johnson_lindenstrauss_min_dim</span>
<span class="kn">from</span> <span class="nn">sklearn.random_projection</span> <span class="kn">import</span> <span class="n">SparseRandomProjection</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>              <span class="c1"># standardize features</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                <span class="c1"># plot all grids below the plot elements</span>
<span class="k">if</span> <span class="n">ignore_warnings</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>                                   
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>                                         <span class="c1"># color map</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>                                                     <span class="c1"># random number seed </span>
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‚Äòpython -m pip install [package-name]‚Äô. More assistance is available with the respective package docs.</p>
</section>
<section id="declare-functions">
<h2>Declare Functions</h2>
<p>Convenience functions to add commas to numbers and major and minor gridlines to plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">comma_format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">'</span>
    
<span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>                                            
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-the-working-directory">
<h2>Set the working directory</h2>
<p>I always like to do this so I don‚Äôt lose files and to simplify subsequent read and writes (avoid including the full address each time).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">#os.chdir("c:/PGE383")                                        # set the working directory</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-tabular-data">
<h2>Loading Tabular Data</h2>
<p>Here‚Äôs the command to load our comma delimited data file in to a Pandas‚Äô DataFrame object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">#df = pd.read_csv('unconv_MV_v4.csv')                         # load our data table</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/unconv_MV_v4.csv'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'TOC'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'TOC'</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">'TOC'</span><span class="p">])</span> <span class="c1"># set TOC &lt; 0.0 as 0.0, otherwise leave the same</span>
</pre></div>
</div>
</div>
</div>
<p>Visualizing the DataFrame would be useful and we already learned about these methods in this demo (<a class="reference external" href="https://git.io/fNgRW">https://git.io/fNgRW</a>).</p>
<p>We can preview the DataFrame by utilizing the ‚Äòhead‚Äô DataFrame member function (with a nice and clean format, see below). With the head command, add parameter ‚Äòn=13‚Äô to see the first 13 rows of the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>                                                 <span class="c1"># we could also use this command for a table preview</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>1695.360819</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3007.096063</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2531.938259</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>5288.514854</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2859.469624</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4017.374438</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>2952.812773</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2670.933846</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>12.52</td>
      <td>2.72</td>
      <td>2.43</td>
      <td>65.77</td>
      <td>0.95</td>
      <td>1.98</td>
      <td>2474.048178</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>13.25</td>
      <td>3.94</td>
      <td>3.71</td>
      <td>66.20</td>
      <td>1.14</td>
      <td>2.65</td>
      <td>2722.893266</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>15.04</td>
      <td>4.39</td>
      <td>2.22</td>
      <td>61.11</td>
      <td>1.08</td>
      <td>1.77</td>
      <td>3828.247174</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>16.19</td>
      <td>6.30</td>
      <td>2.29</td>
      <td>49.10</td>
      <td>1.53</td>
      <td>1.86</td>
      <td>5095.810104</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>16.82</td>
      <td>5.42</td>
      <td>2.80</td>
      <td>66.65</td>
      <td>1.17</td>
      <td>1.98</td>
      <td>4091.637316</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This dataset has features from 200 unconventional wells including:</p>
<ol class="arabic simple" start="0">
<li><p>well index</p></li>
<li><p>well average porosity (%)</p></li>
<li><p>permeability (mD)</p></li>
<li><p>acoustic impedance (kg/m2s*10^6)</p></li>
<li><p>brittleness ratio (%)</p></li>
<li><p>total organic carbon (%)</p></li>
<li><p>vitrinite reflectance (%)</p></li>
<li><p>normalized initial production 90 day average (MCFPD).</p></li>
</ol>
<p>Note, the dataset is synthetic, but has realistic ranges and general multivariate relationships.</p>
<p>Ranking features is really an effort to understand the features and their relationships with each other.  We will start with basic data visualization and move to more complicated methods such are partial correlation and recursive feature elimination.</p>
</section>
<section id="summary-statistics">
<h2>Summary Statistics</h2>
<p>Let‚Äôs check the summary statistics of our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>                                     <span class="c1"># display summary statistics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Well</th>
      <td>200.0</td>
      <td>100.500000</td>
      <td>57.879185</td>
      <td>1.000000</td>
      <td>50.750000</td>
      <td>100.500000</td>
      <td>150.250000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>Por</th>
      <td>200.0</td>
      <td>14.991150</td>
      <td>2.971176</td>
      <td>6.550000</td>
      <td>12.912500</td>
      <td>15.070000</td>
      <td>17.402500</td>
      <td>23.550000</td>
    </tr>
    <tr>
      <th>Perm</th>
      <td>200.0</td>
      <td>4.330750</td>
      <td>1.731014</td>
      <td>1.130000</td>
      <td>3.122500</td>
      <td>4.035000</td>
      <td>5.287500</td>
      <td>9.870000</td>
    </tr>
    <tr>
      <th>AI</th>
      <td>200.0</td>
      <td>2.968850</td>
      <td>0.566885</td>
      <td>1.280000</td>
      <td>2.547500</td>
      <td>2.955000</td>
      <td>3.345000</td>
      <td>4.630000</td>
    </tr>
    <tr>
      <th>Brittle</th>
      <td>200.0</td>
      <td>48.161950</td>
      <td>14.129455</td>
      <td>10.940000</td>
      <td>37.755000</td>
      <td>49.510000</td>
      <td>58.262500</td>
      <td>84.330000</td>
    </tr>
    <tr>
      <th>TOC</th>
      <td>200.0</td>
      <td>0.991950</td>
      <td>0.478264</td>
      <td>0.000000</td>
      <td>0.617500</td>
      <td>1.030000</td>
      <td>1.350000</td>
      <td>2.180000</td>
    </tr>
    <tr>
      <th>VR</th>
      <td>200.0</td>
      <td>1.964300</td>
      <td>0.300827</td>
      <td>0.930000</td>
      <td>1.770000</td>
      <td>1.960000</td>
      <td>2.142500</td>
      <td>2.870000</td>
    </tr>
    <tr>
      <th>Prod</th>
      <td>200.0</td>
      <td>3864.407081</td>
      <td>1553.277558</td>
      <td>839.822063</td>
      <td>2686.227611</td>
      <td>3604.303506</td>
      <td>4752.637555</td>
      <td>8590.384044</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Summary statistics are a critical first step in data checking.</p>
<ul class="simple">
<li><p>this includes the number of valid (non-null) values for each feature (count removes all np.NaN from the totals for each variable).</p></li>
<li><p>we can see the general behaviors such as central tendency, mean, and dispersion, variance.</p></li>
<li><p>we can identify issue with negative values, extreme values, and values that are outside the range of plausible values for each property.</p></li>
<li><p>We can also establish the feature ranges for plotting.  We could calculate the feature range directly from the data with code like this:</p></li>
</ul>
<div class="highlight-p notranslate"><div class="highlight"><pre><span/>Pormin = np.min(df['Por'].values)          # extract ndarray of data table column
Pormax = np.max(df['Por'].values)          # and calculate min and max
</pre></div>
</div>
<p>but, this would not result in easy to understand color bars and axis scales, let‚Äôs pick convenient round numbers. We will also declare feature labels for ease of plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">pormin</span> <span class="o">=</span> <span class="mf">6.0</span><span class="p">;</span> <span class="n">pormax</span> <span class="o">=</span> <span class="mf">24.0</span><span class="p">;</span> <span class="n">porname</span> <span class="o">=</span> <span class="s1">'Porosity (%)'</span><span class="p">;</span> <span class="n">portitle</span> <span class="o">=</span> <span class="s1">'Porosity'</span>
<span class="n">permmin</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">permmax</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">permname</span> <span class="o">=</span> <span class="s1">'Permeability (mD)'</span><span class="p">;</span> <span class="n">permtitle</span> <span class="o">=</span> <span class="s1">'Permeability'</span>                
<span class="n">AImin</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="n">AImax</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span> <span class="n">AIname</span> <span class="o">=</span> <span class="s1">'Acoustic Impedance (kg/m2s*10^6)'</span><span class="p">;</span> <span class="n">AItitle</span> <span class="o">=</span> <span class="s1">'Acoustic Impedance'</span>
<span class="n">brmin</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">;</span> <span class="n">brmax</span> <span class="o">=</span> <span class="mf">85.0</span><span class="p">;</span> <span class="n">brname</span> <span class="o">=</span> <span class="s1">'Brittleness Ratio (%)'</span><span class="p">;</span> <span class="n">brtitle</span> <span class="o">=</span> <span class="s1">'Brittleness'</span>
<span class="n">TOCmin</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">TOCmax</span> <span class="o">=</span> <span class="mf">2.2</span><span class="p">;</span> <span class="n">TOCname</span> <span class="o">=</span> <span class="s1">'Total Organic Carbon (%)'</span><span class="p">;</span> <span class="n">TOCtitle</span> <span class="o">=</span> <span class="s1">'Total Organic Carbon'</span> 
<span class="n">VRmin</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">;</span> <span class="n">VRmax</span> <span class="o">=</span> <span class="mf">2.9</span><span class="p">;</span> <span class="n">VRname</span> <span class="o">=</span> <span class="s1">'Vitrinite Reflectance (%)'</span><span class="p">;</span> <span class="n">VRtitle</span> <span class="o">=</span> <span class="s1">'Vitrinite Reflectance'</span>
<span class="n">prodmin</span> <span class="o">=</span> <span class="mf">500.0</span><span class="p">;</span> <span class="n">prodmax</span> <span class="o">=</span> <span class="mf">9000.0</span><span class="p">;</span> <span class="n">prodname</span> <span class="o">=</span> <span class="s1">'Normalized Initial Production (MCFPD)'</span><span class="p">;</span> <span class="n">prodtitle</span> <span class="o">=</span> <span class="s1">'Normalized Initial Production'</span>
</pre></div>
</div>
</div>
</div>
<p>The data looks to be in pretty good shape and for brevity we skip outlier detection. Let‚Äôs look at the distributions with a matrix scatter plot from the Seaborn package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">,</span><span class="s1">'TOC'</span><span class="p">,</span><span class="s1">'VR'</span><span class="p">,</span><span class="s1">'Prod'</span><span class="p">],</span><span class="n">markers</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span><span class="n">plot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">'alpha'</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d82e98fd3f20b062e5af7a1166a4e2e974afd596af23ad51bb6ea0c6f780ddce.png" src="../Images/95fb79f6de153d43d36030d365b24d3e.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d82e98fd3f20b062e5af7a1166a4e2e974afd596af23ad51bb6ea0c6f780ddce.png"/>
</div>
</div>
</section>
<section id="feature-standardization">
<h2>Feature Standardization</h2>
<p>Since our model works with dissimilarity (analogous to distance in feature space) measures, we need to standardize the features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">,</span><span class="s1">'TOC'</span><span class="p">,</span><span class="s1">'VR'</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">ns_features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'NS_'</span><span class="o">+</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ns_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'NS_'</span><span class="o">+</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
      <th>NS_Por</th>
      <th>NS_Perm</th>
      <th>NS_AI</th>
      <th>NS_Brittle</th>
      <th>NS_TOC</th>
      <th>NS_VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>1695.360819</td>
      <td>-0.982256</td>
      <td>-0.817030</td>
      <td>-0.298603</td>
      <td>2.358297</td>
      <td>0.352257</td>
      <td>1.152048</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3007.096063</td>
      <td>-0.881032</td>
      <td>-0.463751</td>
      <td>0.444147</td>
      <td>-0.141332</td>
      <td>-0.213702</td>
      <td>-0.280931</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2531.938259</td>
      <td>-0.327677</td>
      <td>-1.008148</td>
      <td>1.841224</td>
      <td>1.748113</td>
      <td>-0.213702</td>
      <td>2.518377</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>5288.514854</td>
      <td>0.903875</td>
      <td>1.401098</td>
      <td>-0.599240</td>
      <td>-0.592585</td>
      <td>0.184565</td>
      <td>-0.280931</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2859.469624</td>
      <td>0.853263</td>
      <td>0.138561</td>
      <td>0.373409</td>
      <td>-2.640962</td>
      <td>1.085907</td>
      <td>-0.214280</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4017.374438</td>
      <td>-0.155597</td>
      <td>0.277556</td>
      <td>-0.493133</td>
      <td>0.385839</td>
      <td>-0.108895</td>
      <td>-0.980758</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>2952.812773</td>
      <td>-0.506505</td>
      <td>-0.423211</td>
      <td>-0.068704</td>
      <td>1.103161</td>
      <td>-0.402355</td>
      <td>-0.380906</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2670.933846</td>
      <td>-1.150962</td>
      <td>-0.753324</td>
      <td>0.497200</td>
      <td>0.343268</td>
      <td>-0.632930</td>
      <td>-0.114305</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>12.52</td>
      <td>2.72</td>
      <td>2.43</td>
      <td>65.77</td>
      <td>0.95</td>
      <td>1.98</td>
      <td>2474.048178</td>
      <td>-0.833795</td>
      <td>-0.932859</td>
      <td>-0.952930</td>
      <td>1.249322</td>
      <td>-0.087933</td>
      <td>0.052320</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>13.25</td>
      <td>3.94</td>
      <td>3.71</td>
      <td>66.20</td>
      <td>1.14</td>
      <td>2.65</td>
      <td>2722.893266</td>
      <td>-0.587484</td>
      <td>-0.226301</td>
      <td>1.310688</td>
      <td>1.279831</td>
      <td>0.310334</td>
      <td>2.285102</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>15.04</td>
      <td>4.39</td>
      <td>2.22</td>
      <td>61.11</td>
      <td>1.08</td>
      <td>1.77</td>
      <td>3828.247174</td>
      <td>0.016483</td>
      <td>0.034314</td>
      <td>-1.324305</td>
      <td>0.918687</td>
      <td>0.184565</td>
      <td>-0.647507</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>16.19</td>
      <td>6.30</td>
      <td>2.29</td>
      <td>49.10</td>
      <td>1.53</td>
      <td>1.86</td>
      <td>5095.810104</td>
      <td>0.404506</td>
      <td>1.140483</td>
      <td>-1.200514</td>
      <td>0.066556</td>
      <td>1.127830</td>
      <td>-0.347581</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>16.82</td>
      <td>5.42</td>
      <td>2.80</td>
      <td>66.65</td>
      <td>1.17</td>
      <td>1.98</td>
      <td>4091.637316</td>
      <td>0.617075</td>
      <td>0.630834</td>
      <td>-0.298603</td>
      <td>1.311759</td>
      <td>0.373218</td>
      <td>0.052320</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="data-preparation">
<h2>Data Preparation</h2>
<p>Let‚Äôs make an ordinal feature from the continuous production:</p>
<ol class="arabic simple">
<li><p>low</p></li>
<li><p>medium</p></li>
<li><p>high</p></li>
<li><p>very high</p></li>
</ol>
<p>production rates.  This will help us visualize the results as we proceed, we can look at wells with different levels of production projected into a variety of lower dimensional spaces with multidimensional scaling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">7500</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>                <span class="c1"># assign the production bins (these are the fence posts)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'low'</span><span class="p">,</span> <span class="s1">'med'</span><span class="p">,</span> <span class="s1">'high'</span><span class="p">,</span> <span class="s1">'vhigh'</span><span class="p">]</span>       <span class="c1"># assign the labels</span>
<span class="n">category</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">],</span><span class="n">bins</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>     <span class="c1"># make the 1D array with the labels for our data</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'tProd'</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>                                <span class="c1"># add the new ordinal production feature to our DataFrames    </span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">dpalette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"rocket_r"</span><span class="p">,</span><span class="n">n_colors</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"rocket"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs take a look at the matrix scatter plot of our 3 features and the production levels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ns_features</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'tProd'</span><span class="p">]],</span><span class="n">markers</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span><span class="n">hue</span> <span class="o">=</span> <span class="s1">'tProd'</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">dpalette</span><span class="p">,</span><span class="n">diag_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">'edgecolor'</span><span class="p">:</span><span class="s1">'black'</span><span class="p">},</span><span class="n">plot_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/88023e2fe485fa10c6d95a886b783b2fbba0d51476bfbbaea540a357171cf53f.png" src="../Images/361d301ea20bab27b890f9dc5260164c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/88023e2fe485fa10c6d95a886b783b2fbba0d51476bfbbaea540a357171cf53f.png"/>
</div>
</div>
</section>
<section id="id2">
<h2>Random Projection</h2>
<p>Let‚Äôs demonstrate the use of random projection.</p>
<ul class="simple">
<li><p>given the low dimensionality you will see quite poor performance for some random seeds</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_components</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">73058</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">GaussianRandomProjection</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>

<span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ns_features</span><span class="p">],</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">!=</span> <span class="mi">0</span>   <span class="c1"># select only non-identical samples pairs</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">projected_data</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ns_features</span><span class="p">])</span>
<span class="n">projected_dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">projected_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span><span class="n">projected_dists</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: original space"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: projected space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">rates</span> <span class="o">=</span> <span class="n">projected_dists</span> <span class="o">/</span> <span class="n">dists</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Distance Ratio, mean: </span><span class="si">%0.2f</span><span class="s2">, standard deviation </span><span class="si">%0.2f</span><span class="s2">."</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rates</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">rates</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'darkorange'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Distance Ratio: projected / original"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'darkorange'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Original Data"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">projected_dists</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'darkorange'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Distance Ratio, mean: 0.83, standard deviation 0.16.
</pre></div>
</div>
<img alt="_images/9d381e4fb7046bb5ea95413bbcb76d715648c0783488f14ad9ea4a0c6ebf4ee0.png" src="../Images/b97660935d743314d8384f5fbdb20615.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/9d381e4fb7046bb5ea95413bbcb76d715648c0783488f14ad9ea4a0c6ebf4ee0.png"/>
</div>
</div>
<p>Check the orthogonality of the random projection matrix.</p>
<ul class="simple">
<li><p>by calculating and displaying <span class="math notranslate nohighlight">\(R_p^T R_p\)</span>, if orthogonal it should be a strictly diagonal matrix</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">orthogonal_check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#cbar = plt.colorbar(); cbar.set_label('Value')</span>

<span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Assuming the matrix is square (m x m)</span>
<span class="n">square_size</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Each square has size 1x1</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix_size</span><span class="p">):</span>
    <span class="c1"># Add a square around each diagonal element</span>
    <span class="n">square</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">),</span><span class="n">square_size</span><span class="p">,</span><span class="n">square_size</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>

<span class="c1"># Add a colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># Set label for colorbar</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Orthogonal Check, $R_p^T R_p$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Columns'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rows'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span/><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">orthogonal_check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1">#cbar = plt.colorbar(); cbar.set_label('Value')</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Assuming the matrix is square (m x m)</span>

<span class="ne">AttributeError</span>: module 'matplotlib.cm' has no attribute 'grey'
</pre></div>
</div>
<img alt="_images/b939873a0ebfe0d1abe1e7218ce8f485bb698d87d0fd5a003af297c5e30b4bbf.png" src="../Images/fb33fb692e076e2c71f895be6dd85b6c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/b939873a0ebfe0d1abe1e7218ce8f485bb698d87d0fd5a003af297c5e30b4bbf.png"/>
</div>
</div>
</section>
<section id="add-more-features">
<h2>Add More Features</h2>
<p>We are seeing that for m = 6 we are not seeing significant dimensionality reduction. Let‚Äôs instantiate a larger model.</p>
<ul class="simple">
<li><p>set <span class="math notranslate nohighlight">\(m\)</span> as large, i.e., <span class="math notranslate nohighlight">\(m \ge 100\)</span></p></li>
<li><p>set <span class="math notranslate nohighlight">\(p\)</span> as a reasonable ratio of <span class="math notranslate nohighlight">\(m\)</span>, for example <span class="math notranslate nohighlight">\(\frac{2}{3}\)</span> up to <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span></p></li>
</ul>
<p>Since we don‚Äôt have access to a arbitrarily large data set, let‚Äôs generate it randomly.</p>
<ul class="simple">
<li><p>standard normal, high dimensional multiGaussian distribution with all means of 0 and variances of 1.0</p></li>
<li><p>random correlations between the features</p></li>
<li><p>we use eigendecomposition, set the negative or zero eigenvalues to small positive to ensure the correlation matrix is positive semi-definite</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">m</span> <span class="o">=</span> <span class="mi">100</span>                                                       <span class="c1"># number of dimensions</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>                                              <span class="c1"># number of samples</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>                                   <span class="c1"># set the random seed</span>
<span class="n">mean_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>                                     <span class="c1"># mean vector (zero mean for all variables)</span>

<span class="n">random_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>                          <span class="c1"># step 1: generate a random matrix </span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">random_matrix</span><span class="p">,</span> <span class="n">random_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>   <span class="c1"># step 2: create a symmetric correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">correlation_matrix</span> <span class="o">+</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># step 3: symmetrize the correlation matrix (ensures the matrix is symmetric)</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>                       <span class="c1"># step 4: normalize to have ones on the diagonal (this ensures unit variances)</span>

<span class="c1"># Ensure the covariance matrix is positive semi-definite using eigendecomposition</span>
<span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span>         <span class="c1"># eigendecomposition of the correlation matrix</span>
<span class="n">eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">eigvals</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>                           <span class="c1"># set any negative eigenvalues to a small positive value</span>
<span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">eigvecs</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span> <span class="o">@</span> <span class="n">eigvecs</span><span class="o">.</span><span class="n">T</span>           <span class="c1"># reconstruct the covariance matrix</span>

<span class="n">big_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean_vector</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">)</span> <span class="c1"># step 6: generate the multi-dimensional Gaussian dataset</span>
<span class="n">df_big_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">big_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"Dim_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)])</span> <span class="c1"># convert the data into a pandas DataFrame</span>
</pre></div>
</div>
</div>
</div>
<p>This data is too high dimensional to conveniently visualize, let‚Äôs proceed with random projection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_components</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">73058</span>
<span class="n">rp_big</span> <span class="o">=</span> <span class="n">GaussianRandomProjection</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>

<span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">df_big_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">!=</span> <span class="mi">0</span>   <span class="c1"># select only non-identical samples pairs</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">projected_data</span> <span class="o">=</span> <span class="n">rp_big</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_big_data</span><span class="p">)</span>
<span class="n">projected_dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">projected_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span><span class="n">projected_dists</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: original space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: projected space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">rates</span> <span class="o">=</span> <span class="n">projected_dists</span> <span class="o">/</span> <span class="n">dists</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Distance Ratio, mean: </span><span class="si">%0.2f</span><span class="s2">, standard deviation </span><span class="si">%0.2f</span><span class="s2">."</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rates</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">rates</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'red'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Distance Ratio: projected / original"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Distance Ratio, mean: 0.95, standard deviation 0.02.
</pre></div>
</div>
<img alt="_images/39619edae0c2641f4556b98d82390b3cbcb222a4cf0be2e436876337fd5ab48c.png" src="../Images/9e5d080e00dc637a851d8dfb22c425df.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/39619edae0c2641f4556b98d82390b3cbcb222a4cf0be2e436876337fd5ab48c.png"/>
</div>
</div>
<p>Check the orthogonality of the random projection matrix.</p>
<ul class="simple">
<li><p>by calculating and displaying <span class="math notranslate nohighlight">\(R_p^T R_p\)</span>, if orthogonal it should be a strictly diagonal matrix</p></li>
</ul>
<p>Note, <span class="math notranslate nohighlight">\(R_p\)</span> is not square, it is <span class="math notranslate nohighlight">\(p \times m\)</span>, so we are actually checking column orthogonality, <span class="math notranslate nohighlight">\(R_p^T R_p\)</span></p>
<ul class="simple">
<li><p>we are checking is the reduced dimensional projects forms an orthogonal basis</p></li>
<li><p>from above <span class="math notranslate nohighlight">\(R_p^T\)</span> is <span class="math notranslate nohighlight">\(m \times p\)</span> and <span class="math notranslate nohighlight">\(R_p\)</span> is <span class="math notranslate nohighlight">\(p \times m\)</span> so <span class="math notranslate nohighlight">\(R_p^T R_p\)</span> is <span class="math notranslate nohighlight">\(m \times m\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">orthogonal_check_big</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp_big</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp_big</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check_big</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                       <span class="c1"># assuming the matrix is square (m x m)</span>
<span class="n">square_size</span> <span class="o">=</span> <span class="mi">1</span>                                               <span class="c1"># each square has size 1x1</span>

<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">);</span> <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Orthogonal Check, $R_p^T R_p$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Columns'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rows'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e0a3c6713266a89bcad286ac5af2612cfcfd85f9cb728fa32ecee957d3274e79.png" src="../Images/7f0d011d72830b71ea8a9544642b5b1e.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e0a3c6713266a89bcad286ac5af2612cfcfd85f9cb728fa32ecee957d3274e79.png"/>
</div>
</div>
</section>
<section id="add-even-more-features">
<h2>Add Even More Features</h2>
<p>Let‚Äôs try a larger dimensionality with a single code block.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">m</span> <span class="o">=</span> <span class="mi">1000</span>                                                      <span class="c1"># number of dimensions</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>                                              <span class="c1"># number of samples</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="mi">200</span>                                            <span class="c1"># number of components </span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">73058</span>                                                  <span class="c1"># random seed</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>                                   <span class="c1"># set the random seed</span>
<span class="n">mean_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>                                     <span class="c1"># mean vector (zero mean for all variables)</span>

<span class="n">random_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>                          <span class="c1"># step 1: generate a random matrix </span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">random_matrix</span><span class="p">,</span> <span class="n">random_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>   <span class="c1"># step 2: create a symmetric correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">correlation_matrix</span> <span class="o">+</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># step 3: symmetrize the correlation matrix (ensures the matrix is symmetric)</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>                       <span class="c1"># step 4: normalize to have ones on the diagonal (this ensures unit variances)</span>

<span class="c1"># Ensure the covariance matrix is positive semi-definite using eigendecomposition</span>
<span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span>         <span class="c1"># eigendecomposition of the correlation matrix</span>
<span class="n">eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">eigvals</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>                           <span class="c1"># set any negative eigenvalues to a small positive value</span>
<span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">eigvecs</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span> <span class="o">@</span> <span class="n">eigvecs</span><span class="o">.</span><span class="n">T</span>           <span class="c1"># reconstruct the covariance matrix</span>

<span class="n">very_big_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean_vector</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">)</span> <span class="c1"># step 6: generate the multi-dimensional Gaussian dataset</span>
<span class="n">df_very_big_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">very_big_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"Dim_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)])</span> <span class="c1"># convert the data into a pandas DataFrame</span>

<span class="n">rp_very_big</span> <span class="o">=</span> <span class="n">GaussianRandomProjection</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>

<span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">df_very_big_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">!=</span> <span class="mi">0</span>                                          <span class="c1"># select only non-identical samples pairs</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">projected_data</span> <span class="o">=</span> <span class="n">rp_very_big</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_very_big_data</span><span class="p">)</span>
<span class="n">projected_dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">projected_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span><span class="n">projected_dists</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: original space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: projected space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">orthogonal_check_very_big</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp_very_big</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp_very_big</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check_very_big</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                       <span class="c1"># assuming the matrix is square (m x m)</span>
<span class="n">square_size</span> <span class="o">=</span> <span class="mi">1</span>                                               <span class="c1"># each square has size 1x1</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">);</span> <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Orthogonal Check, $R_p^T R_p$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Columns'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rows'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8f03681f7a32673249e97bfda2fb7f490b40578656a4cd639874efec9a003e83.png" src="../Images/11e2a354bd1b2543a20f9194cee52d96.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/8f03681f7a32673249e97bfda2fb7f490b40578656a4cd639874efec9a003e83.png"/>
</div>
</div>
</section>
<section id="comments">
<h2>Comments</h2>
<p>This was a basic treatment of random projection. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos‚Äô descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
</section>
<section id="about-the-author">
<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael‚Äôs university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael‚Äôs work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
</section>
<section id="want-to-work-together">
<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I‚Äôd be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I‚Äôm always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
</section>
&#13;

<h2>Motivation for Random Projection</h2>
<p>Imagine we need very fast dimensionality reduction by a projection from <span class="math notranslate nohighlight">\(m\)</span> features, i.e., high dimensional, to <span class="math notranslate nohighlight">\(p\)</span> features, i.e., lower dimensional space,</p>
<div class="math notranslate nohighlight">
\[
ùëù, \quad \text{where} \quad ùëù &lt;&lt; ùëö
\]</div>
<p>and in this case,</p>
<ul class="simple">
<li><p>we do not have all the data now (for example, real-time data), so we cannot calculate a matrix of covariances nor dissimilarities</p></li>
<li><p>we cannot afford to calculate an orthogonal transform, given the size of <span class="math notranslate nohighlight">\(m\)</span> it is too computationally expensive</p></li>
</ul>
<p>Can we transform the <span class="math notranslate nohighlight">\(m\)</span> features to a lower dimensional <span class="math notranslate nohighlight">\(p\)</span> with a random linear projection?</p>
<figure style="text-align: center;">
  <img src="../Images/9ff1ace2c6fcc051cac02de9dd663851.png" style="display: block; margin: 0 auto; width: 60%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static\random_projection\context.png"/>
  <figcaption style="text-align: center;">The concept of random projection, vs. multidimensional scaling.</figcaption>
</figure>
<p>where <span class="math notranslate nohighlight">\(ùëã_{1 \times m}\)</span> is a single data sample over <span class="math notranslate nohighlight">\(m\)</span> features, <span class="math notranslate nohighlight">\(ùëÖ_{p \times m}\)</span> is a random projection matrix, populated with random values, and <span class="math notranslate nohighlight">\(ùëã_{p \times n}^{ùëÖùëÉ}\)</span> is the new data projected to <span class="math notranslate nohighlight">\(p\)</span> features.</p>
&#13;

<h2>Random Projection</h2>
<p>An alternative to principal components analysis and multidimensional scaling that relies on an random (<span class="math notranslate nohighlight">\(p \times n\)</span>) projection matrix, <span class="math notranslate nohighlight">\(ùëÖ_{p \times m}\)</span>.</p>
<ul class="simple">
<li><p>all values are independent, random variables, typically standard normal, <span class="math notranslate nohighlight">\(N\left[0,1\right]\)</span>.</p></li>
</ul>
<p>To avoid distortion, the projection <span class="math notranslate nohighlight">\(ùëÖ_{p \times m}\)</span> should be orthogonal, but as said above, ensuring orthogonality is too computationally expensive, to understand how this can work, we need to understand,</p>
<ul class="simple">
<li><p><strong>Hercht-Neilsen (1994)</strong> - the existence of a much larger number of orthogonal vectors in high dimensional space, likely quasi-orthogonal</p></li>
<li><p><strong>Johnson-Lindenstrauss lemma (1984)</strong> - that points in high-dimensional space can be linearly embedded in lower dimension with approximate preservation of pairwise distance with a high probability</p></li>
</ul>
&#13;

<h2>Near-orthogonal Vectors in High Dimensional Space</h2>
<p>Robert Hercht-Neilsen (1994) demonstrates that in high dimensional space, there exists a much larger number of almost orthogonal than strictly orthogonal directions.</p>
<ul class="simple">
<li><p>Random matrices may be sufficiently close to orthogonal in high dimensions.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
ùëÖ_{m√óp}^ùëá ùëÖ_{p√óm} \approx ùêº_{m√óm}
\]</div>
<p>where <span class="math notranslate nohighlight">\(I\)</span> is the identify matrix, <span class="math notranslate nohighlight">\(\approx\)</span> indicates approximate equal to identity matrix.</p>
<p>Our random vectors will be close enough to orthogonal if the dimensionality is large enough, i.e., high dimensional space.</p>
<ul class="simple">
<li><p>the probability increases with increase in dimensionality, the number of features, <span class="math notranslate nohighlight">\(ùëö\)</span></p></li>
</ul>
&#13;

<h2>Probability of Near Preservation of Pairwise Distance in High Dimensional Space</h2>
<p>This random approach works practically because of the The Johnson-Lindenstrauss lemma:</p>
<p><em>In mathematics, the Johnson-Lindenstrauss lemma is a result concerning low-distortion embeddings of points from high-dimensional into low-dimensional Euclidean space. The lemma states that a small set of points in a high-dimensional space can be embedded into a space of much lower dimension in such a way that distances between the points are nearly preserved. The map used for the embedding is at least Lipschitz, and can even be taken to be an orthogonal projection.</em> - Wikipedia article.</p>
<p>Points in a high-dimensionality space can be linearly embedded in a space of much lower dimensionality in such a way that distances between the points are nearly preserved (we allow for error, ùúÄ)</p>
<p>We can calculate given the size of data set, ùëõ, and desired error limit, ùúÄ, the minimum number of dimensions, ùëù, that we can project to with high probability of based on random projection, as a minimum,</p>
<div class="math notranslate nohighlight">
\[
ùëù &gt; \frac{ln‚Å°(ùëõ)}{ùúÄ^2} 
\]</div>
<p>For example, for 1,000 data with an pairwise distance error of 10% (0.1) we can project randomly to 690 dimensional.</p>
<ul class="simple">
<li><p>this minimum does not depend on the original dimensionality of the problem, <span class="math notranslate nohighlight">\(ùëö\)</span>!</p></li>
</ul>
&#13;

<h2>Load the Required Libraries</h2>
<p>The following code loads the required libraries. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">ignore_warnings</span> <span class="o">=</span> <span class="kc">True</span>                                        <span class="c1"># ignore warnings?</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                                            <span class="c1"># ndarrays for gridded data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                                           <span class="c1"># DataFrames for tabular data</span>
<span class="kn">import</span> <span class="nn">os</span>                                                     <span class="c1"># set working directory, run executables</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>                               <span class="c1"># for plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span><span class="n">AutoMinorLocator</span><span class="p">,</span><span class="n">NullLocator</span><span class="p">,</span><span class="n">FuncFormatter</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>                          <span class="c1"># add square to matrix plot</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>                                       <span class="c1"># summary statistics</span>
<span class="kn">import</span> <span class="nn">math</span>                                                   <span class="c1"># trigonometry etc.</span>
<span class="kn">import</span> <span class="nn">scipy.signal</span> <span class="k">as</span> <span class="nn">signal</span>                                 <span class="c1"># kernel for moving window calculation</span>
<span class="kn">import</span> <span class="nn">random</span>                                                 <span class="c1"># for random numbers</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>                                         <span class="c1"># for matrix scatter plots</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">linalg</span>                                      <span class="c1"># for linear regression</span>

<span class="kn">from</span> <span class="nn">sklearn.random_projection</span> <span class="kn">import</span> <span class="n">GaussianRandomProjection</span> <span class="c1"># random projection</span>
<span class="kn">from</span> <span class="nn">sklearn.random_projection</span> <span class="kn">import</span> <span class="n">johnson_lindenstrauss_min_dim</span>
<span class="kn">from</span> <span class="nn">sklearn.random_projection</span> <span class="kn">import</span> <span class="n">SparseRandomProjection</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span> <span class="kn">import</span> <span class="n">euclidean_distances</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>              <span class="c1"># standardize features</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                <span class="c1"># plot all grids below the plot elements</span>
<span class="k">if</span> <span class="n">ignore_warnings</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>                                   
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>                                         <span class="c1"># color map</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>                                                     <span class="c1"># random number seed </span>
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‚Äòpython -m pip install [package-name]‚Äô. More assistance is available with the respective package docs.</p>
&#13;

<h2>Declare Functions</h2>
<p>Convenience functions to add commas to numbers and major and minor gridlines to plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">comma_format</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">:</span><span class="s1">,</span><span class="si">}</span><span class="s1">'</span>
    
<span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>                                            
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks </span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Set the working directory</h2>
<p>I always like to do this so I don‚Äôt lose files and to simplify subsequent read and writes (avoid including the full address each time).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">#os.chdir("c:/PGE383")                                        # set the working directory</span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Loading Tabular Data</h2>
<p>Here‚Äôs the command to load our comma delimited data file in to a Pandas‚Äô DataFrame object.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">#df = pd.read_csv('unconv_MV_v4.csv')                         # load our data table</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/unconv_MV_v4.csv'</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'TOC'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'TOC'</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">'TOC'</span><span class="p">])</span> <span class="c1"># set TOC &lt; 0.0 as 0.0, otherwise leave the same</span>
</pre></div>
</div>
</div>
</div>
<p>Visualizing the DataFrame would be useful and we already learned about these methods in this demo (<a class="reference external" href="https://git.io/fNgRW">https://git.io/fNgRW</a>).</p>
<p>We can preview the DataFrame by utilizing the ‚Äòhead‚Äô DataFrame member function (with a nice and clean format, see below). With the head command, add parameter ‚Äòn=13‚Äô to see the first 13 rows of the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>                                                 <span class="c1"># we could also use this command for a table preview</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>1695.360819</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3007.096063</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2531.938259</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>5288.514854</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2859.469624</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4017.374438</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>2952.812773</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2670.933846</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>12.52</td>
      <td>2.72</td>
      <td>2.43</td>
      <td>65.77</td>
      <td>0.95</td>
      <td>1.98</td>
      <td>2474.048178</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>13.25</td>
      <td>3.94</td>
      <td>3.71</td>
      <td>66.20</td>
      <td>1.14</td>
      <td>2.65</td>
      <td>2722.893266</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>15.04</td>
      <td>4.39</td>
      <td>2.22</td>
      <td>61.11</td>
      <td>1.08</td>
      <td>1.77</td>
      <td>3828.247174</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>16.19</td>
      <td>6.30</td>
      <td>2.29</td>
      <td>49.10</td>
      <td>1.53</td>
      <td>1.86</td>
      <td>5095.810104</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>16.82</td>
      <td>5.42</td>
      <td>2.80</td>
      <td>66.65</td>
      <td>1.17</td>
      <td>1.98</td>
      <td>4091.637316</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>This dataset has features from 200 unconventional wells including:</p>
<ol class="arabic simple" start="0">
<li><p>well index</p></li>
<li><p>well average porosity (%)</p></li>
<li><p>permeability (mD)</p></li>
<li><p>acoustic impedance (kg/m2s*10^6)</p></li>
<li><p>brittleness ratio (%)</p></li>
<li><p>total organic carbon (%)</p></li>
<li><p>vitrinite reflectance (%)</p></li>
<li><p>normalized initial production 90 day average (MCFPD).</p></li>
</ol>
<p>Note, the dataset is synthetic, but has realistic ranges and general multivariate relationships.</p>
<p>Ranking features is really an effort to understand the features and their relationships with each other.  We will start with basic data visualization and move to more complicated methods such are partial correlation and recursive feature elimination.</p>
&#13;

<h2>Summary Statistics</h2>
<p>Let‚Äôs check the summary statistics of our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>                                     <span class="c1"># display summary statistics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Well</th>
      <td>200.0</td>
      <td>100.500000</td>
      <td>57.879185</td>
      <td>1.000000</td>
      <td>50.750000</td>
      <td>100.500000</td>
      <td>150.250000</td>
      <td>200.000000</td>
    </tr>
    <tr>
      <th>Por</th>
      <td>200.0</td>
      <td>14.991150</td>
      <td>2.971176</td>
      <td>6.550000</td>
      <td>12.912500</td>
      <td>15.070000</td>
      <td>17.402500</td>
      <td>23.550000</td>
    </tr>
    <tr>
      <th>Perm</th>
      <td>200.0</td>
      <td>4.330750</td>
      <td>1.731014</td>
      <td>1.130000</td>
      <td>3.122500</td>
      <td>4.035000</td>
      <td>5.287500</td>
      <td>9.870000</td>
    </tr>
    <tr>
      <th>AI</th>
      <td>200.0</td>
      <td>2.968850</td>
      <td>0.566885</td>
      <td>1.280000</td>
      <td>2.547500</td>
      <td>2.955000</td>
      <td>3.345000</td>
      <td>4.630000</td>
    </tr>
    <tr>
      <th>Brittle</th>
      <td>200.0</td>
      <td>48.161950</td>
      <td>14.129455</td>
      <td>10.940000</td>
      <td>37.755000</td>
      <td>49.510000</td>
      <td>58.262500</td>
      <td>84.330000</td>
    </tr>
    <tr>
      <th>TOC</th>
      <td>200.0</td>
      <td>0.991950</td>
      <td>0.478264</td>
      <td>0.000000</td>
      <td>0.617500</td>
      <td>1.030000</td>
      <td>1.350000</td>
      <td>2.180000</td>
    </tr>
    <tr>
      <th>VR</th>
      <td>200.0</td>
      <td>1.964300</td>
      <td>0.300827</td>
      <td>0.930000</td>
      <td>1.770000</td>
      <td>1.960000</td>
      <td>2.142500</td>
      <td>2.870000</td>
    </tr>
    <tr>
      <th>Prod</th>
      <td>200.0</td>
      <td>3864.407081</td>
      <td>1553.277558</td>
      <td>839.822063</td>
      <td>2686.227611</td>
      <td>3604.303506</td>
      <td>4752.637555</td>
      <td>8590.384044</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Summary statistics are a critical first step in data checking.</p>
<ul class="simple">
<li><p>this includes the number of valid (non-null) values for each feature (count removes all np.NaN from the totals for each variable).</p></li>
<li><p>we can see the general behaviors such as central tendency, mean, and dispersion, variance.</p></li>
<li><p>we can identify issue with negative values, extreme values, and values that are outside the range of plausible values for each property.</p></li>
<li><p>We can also establish the feature ranges for plotting.  We could calculate the feature range directly from the data with code like this:</p></li>
</ul>
<div class="highlight-p notranslate"><div class="highlight"><pre><span/>Pormin = np.min(df['Por'].values)          # extract ndarray of data table column
Pormax = np.max(df['Por'].values)          # and calculate min and max
</pre></div>
</div>
<p>but, this would not result in easy to understand color bars and axis scales, let‚Äôs pick convenient round numbers. We will also declare feature labels for ease of plotting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">pormin</span> <span class="o">=</span> <span class="mf">6.0</span><span class="p">;</span> <span class="n">pormax</span> <span class="o">=</span> <span class="mf">24.0</span><span class="p">;</span> <span class="n">porname</span> <span class="o">=</span> <span class="s1">'Porosity (%)'</span><span class="p">;</span> <span class="n">portitle</span> <span class="o">=</span> <span class="s1">'Porosity'</span>
<span class="n">permmin</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">permmax</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="n">permname</span> <span class="o">=</span> <span class="s1">'Permeability (mD)'</span><span class="p">;</span> <span class="n">permtitle</span> <span class="o">=</span> <span class="s1">'Permeability'</span>                
<span class="n">AImin</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="n">AImax</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span> <span class="n">AIname</span> <span class="o">=</span> <span class="s1">'Acoustic Impedance (kg/m2s*10^6)'</span><span class="p">;</span> <span class="n">AItitle</span> <span class="o">=</span> <span class="s1">'Acoustic Impedance'</span>
<span class="n">brmin</span> <span class="o">=</span> <span class="mf">10.0</span><span class="p">;</span> <span class="n">brmax</span> <span class="o">=</span> <span class="mf">85.0</span><span class="p">;</span> <span class="n">brname</span> <span class="o">=</span> <span class="s1">'Brittleness Ratio (%)'</span><span class="p">;</span> <span class="n">brtitle</span> <span class="o">=</span> <span class="s1">'Brittleness'</span>
<span class="n">TOCmin</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">TOCmax</span> <span class="o">=</span> <span class="mf">2.2</span><span class="p">;</span> <span class="n">TOCname</span> <span class="o">=</span> <span class="s1">'Total Organic Carbon (%)'</span><span class="p">;</span> <span class="n">TOCtitle</span> <span class="o">=</span> <span class="s1">'Total Organic Carbon'</span> 
<span class="n">VRmin</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">;</span> <span class="n">VRmax</span> <span class="o">=</span> <span class="mf">2.9</span><span class="p">;</span> <span class="n">VRname</span> <span class="o">=</span> <span class="s1">'Vitrinite Reflectance (%)'</span><span class="p">;</span> <span class="n">VRtitle</span> <span class="o">=</span> <span class="s1">'Vitrinite Reflectance'</span>
<span class="n">prodmin</span> <span class="o">=</span> <span class="mf">500.0</span><span class="p">;</span> <span class="n">prodmax</span> <span class="o">=</span> <span class="mf">9000.0</span><span class="p">;</span> <span class="n">prodname</span> <span class="o">=</span> <span class="s1">'Normalized Initial Production (MCFPD)'</span><span class="p">;</span> <span class="n">prodtitle</span> <span class="o">=</span> <span class="s1">'Normalized Initial Production'</span>
</pre></div>
</div>
</div>
</div>
<p>The data looks to be in pretty good shape and for brevity we skip outlier detection. Let‚Äôs look at the distributions with a matrix scatter plot from the Seaborn package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="nb">vars</span><span class="o">=</span><span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">,</span><span class="s1">'TOC'</span><span class="p">,</span><span class="s1">'VR'</span><span class="p">,</span><span class="s1">'Prod'</span><span class="p">],</span><span class="n">markers</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span><span class="n">plot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">'alpha'</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">})</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d82e98fd3f20b062e5af7a1166a4e2e974afd596af23ad51bb6ea0c6f780ddce.png" src="../Images/95fb79f6de153d43d36030d365b24d3e.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d82e98fd3f20b062e5af7a1166a4e2e974afd596af23ad51bb6ea0c6f780ddce.png"/>
</div>
</div>
&#13;

<h2>Feature Standardization</h2>
<p>Since our model works with dissimilarity (analogous to distance in feature space) measures, we need to standardize the features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">,</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Brittle'</span><span class="p">,</span><span class="s1">'TOC'</span><span class="p">,</span><span class="s1">'VR'</span><span class="p">]</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">features</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">xs</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">ns_features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)):</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">'NS_'</span><span class="o">+</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
    <span class="n">ns_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'NS_'</span><span class="o">+</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>Well</th>
      <th>Por</th>
      <th>Perm</th>
      <th>AI</th>
      <th>Brittle</th>
      <th>TOC</th>
      <th>VR</th>
      <th>Prod</th>
      <th>NS_Por</th>
      <th>NS_Perm</th>
      <th>NS_AI</th>
      <th>NS_Brittle</th>
      <th>NS_TOC</th>
      <th>NS_VR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>12.08</td>
      <td>2.92</td>
      <td>2.80</td>
      <td>81.40</td>
      <td>1.16</td>
      <td>2.31</td>
      <td>1695.360819</td>
      <td>-0.982256</td>
      <td>-0.817030</td>
      <td>-0.298603</td>
      <td>2.358297</td>
      <td>0.352257</td>
      <td>1.152048</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>12.38</td>
      <td>3.53</td>
      <td>3.22</td>
      <td>46.17</td>
      <td>0.89</td>
      <td>1.88</td>
      <td>3007.096063</td>
      <td>-0.881032</td>
      <td>-0.463751</td>
      <td>0.444147</td>
      <td>-0.141332</td>
      <td>-0.213702</td>
      <td>-0.280931</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>14.02</td>
      <td>2.59</td>
      <td>4.01</td>
      <td>72.80</td>
      <td>0.89</td>
      <td>2.72</td>
      <td>2531.938259</td>
      <td>-0.327677</td>
      <td>-1.008148</td>
      <td>1.841224</td>
      <td>1.748113</td>
      <td>-0.213702</td>
      <td>2.518377</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>17.67</td>
      <td>6.75</td>
      <td>2.63</td>
      <td>39.81</td>
      <td>1.08</td>
      <td>1.88</td>
      <td>5288.514854</td>
      <td>0.903875</td>
      <td>1.401098</td>
      <td>-0.599240</td>
      <td>-0.592585</td>
      <td>0.184565</td>
      <td>-0.280931</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>17.52</td>
      <td>4.57</td>
      <td>3.18</td>
      <td>10.94</td>
      <td>1.51</td>
      <td>1.90</td>
      <td>2859.469624</td>
      <td>0.853263</td>
      <td>0.138561</td>
      <td>0.373409</td>
      <td>-2.640962</td>
      <td>1.085907</td>
      <td>-0.214280</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>14.53</td>
      <td>4.81</td>
      <td>2.69</td>
      <td>53.60</td>
      <td>0.94</td>
      <td>1.67</td>
      <td>4017.374438</td>
      <td>-0.155597</td>
      <td>0.277556</td>
      <td>-0.493133</td>
      <td>0.385839</td>
      <td>-0.108895</td>
      <td>-0.980758</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>13.49</td>
      <td>3.60</td>
      <td>2.93</td>
      <td>63.71</td>
      <td>0.80</td>
      <td>1.85</td>
      <td>2952.812773</td>
      <td>-0.506505</td>
      <td>-0.423211</td>
      <td>-0.068704</td>
      <td>1.103161</td>
      <td>-0.402355</td>
      <td>-0.380906</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>11.58</td>
      <td>3.03</td>
      <td>3.25</td>
      <td>53.00</td>
      <td>0.69</td>
      <td>1.93</td>
      <td>2670.933846</td>
      <td>-1.150962</td>
      <td>-0.753324</td>
      <td>0.497200</td>
      <td>0.343268</td>
      <td>-0.632930</td>
      <td>-0.114305</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>12.52</td>
      <td>2.72</td>
      <td>2.43</td>
      <td>65.77</td>
      <td>0.95</td>
      <td>1.98</td>
      <td>2474.048178</td>
      <td>-0.833795</td>
      <td>-0.932859</td>
      <td>-0.952930</td>
      <td>1.249322</td>
      <td>-0.087933</td>
      <td>0.052320</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>13.25</td>
      <td>3.94</td>
      <td>3.71</td>
      <td>66.20</td>
      <td>1.14</td>
      <td>2.65</td>
      <td>2722.893266</td>
      <td>-0.587484</td>
      <td>-0.226301</td>
      <td>1.310688</td>
      <td>1.279831</td>
      <td>0.310334</td>
      <td>2.285102</td>
    </tr>
    <tr>
      <th>10</th>
      <td>11</td>
      <td>15.04</td>
      <td>4.39</td>
      <td>2.22</td>
      <td>61.11</td>
      <td>1.08</td>
      <td>1.77</td>
      <td>3828.247174</td>
      <td>0.016483</td>
      <td>0.034314</td>
      <td>-1.324305</td>
      <td>0.918687</td>
      <td>0.184565</td>
      <td>-0.647507</td>
    </tr>
    <tr>
      <th>11</th>
      <td>12</td>
      <td>16.19</td>
      <td>6.30</td>
      <td>2.29</td>
      <td>49.10</td>
      <td>1.53</td>
      <td>1.86</td>
      <td>5095.810104</td>
      <td>0.404506</td>
      <td>1.140483</td>
      <td>-1.200514</td>
      <td>0.066556</td>
      <td>1.127830</td>
      <td>-0.347581</td>
    </tr>
    <tr>
      <th>12</th>
      <td>13</td>
      <td>16.82</td>
      <td>5.42</td>
      <td>2.80</td>
      <td>66.65</td>
      <td>1.17</td>
      <td>1.98</td>
      <td>4091.637316</td>
      <td>0.617075</td>
      <td>0.630834</td>
      <td>-0.298603</td>
      <td>1.311759</td>
      <td>0.373218</td>
      <td>0.052320</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Data Preparation</h2>
<p>Let‚Äôs make an ordinal feature from the continuous production:</p>
<ol class="arabic simple">
<li><p>low</p></li>
<li><p>medium</p></li>
<li><p>high</p></li>
<li><p>very high</p></li>
</ol>
<p>production rates.  This will help us visualize the results as we proceed, we can look at wells with different levels of production projected into a variety of lower dimensional spaces with multidimensional scaling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2500</span><span class="p">,</span><span class="mi">5000</span><span class="p">,</span><span class="mi">7500</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>                <span class="c1"># assign the production bins (these are the fence posts)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'low'</span><span class="p">,</span> <span class="s1">'med'</span><span class="p">,</span> <span class="s1">'high'</span><span class="p">,</span> <span class="s1">'vhigh'</span><span class="p">]</span>       <span class="c1"># assign the labels</span>
<span class="n">category</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'Prod'</span><span class="p">],</span><span class="n">bins</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">)</span>     <span class="c1"># make the 1D array with the labels for our data</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'tProd'</span><span class="p">]</span> <span class="o">=</span> <span class="n">category</span>                                <span class="c1"># add the new ordinal production feature to our DataFrames    </span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">dpalette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"rocket_r"</span><span class="p">,</span><span class="n">n_colors</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">"rocket"</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let‚Äôs take a look at the matrix scatter plot of our 3 features and the production levels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ns_features</span> <span class="o">+</span> <span class="p">[</span><span class="s1">'tProd'</span><span class="p">]],</span><span class="n">markers</span><span class="o">=</span><span class="s1">'o'</span><span class="p">,</span><span class="n">hue</span> <span class="o">=</span> <span class="s1">'tProd'</span><span class="p">,</span> <span class="n">palette</span> <span class="o">=</span> <span class="n">dpalette</span><span class="p">,</span><span class="n">diag_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">'edgecolor'</span><span class="p">:</span><span class="s1">'black'</span><span class="p">},</span><span class="n">plot_kws</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/88023e2fe485fa10c6d95a886b783b2fbba0d51476bfbbaea540a357171cf53f.png" src="../Images/361d301ea20bab27b890f9dc5260164c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/88023e2fe485fa10c6d95a886b783b2fbba0d51476bfbbaea540a357171cf53f.png"/>
</div>
</div>
&#13;

<h2>Random Projection</h2>
<p>Let‚Äôs demonstrate the use of random projection.</p>
<ul class="simple">
<li><p>given the low dimensionality you will see quite poor performance for some random seeds</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_components</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">73058</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">GaussianRandomProjection</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>

<span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ns_features</span><span class="p">],</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">!=</span> <span class="mi">0</span>   <span class="c1"># select only non-identical samples pairs</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">projected_data</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">ns_features</span><span class="p">])</span>
<span class="n">projected_dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">projected_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span><span class="n">projected_dists</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'darkorange'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">15</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: original space"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: projected space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">rates</span> <span class="o">=</span> <span class="n">projected_dists</span> <span class="o">/</span> <span class="n">dists</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Distance Ratio, mean: </span><span class="si">%0.2f</span><span class="s2">, standard deviation </span><span class="si">%0.2f</span><span class="s2">."</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rates</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">rates</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'darkorange'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Distance Ratio: projected / original"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'darkorange'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Original Data"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">projected_dists</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">15.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'darkorange'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Distance Ratio, mean: 0.83, standard deviation 0.16.
</pre></div>
</div>
<img alt="_images/9d381e4fb7046bb5ea95413bbcb76d715648c0783488f14ad9ea4a0c6ebf4ee0.png" src="../Images/b97660935d743314d8384f5fbdb20615.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/9d381e4fb7046bb5ea95413bbcb76d715648c0783488f14ad9ea4a0c6ebf4ee0.png"/>
</div>
</div>
<p>Check the orthogonality of the random projection matrix.</p>
<ul class="simple">
<li><p>by calculating and displaying <span class="math notranslate nohighlight">\(R_p^T R_p\)</span>, if orthogonal it should be a strictly diagonal matrix</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">orthogonal_check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1">#cbar = plt.colorbar(); cbar.set_label('Value')</span>

<span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Assuming the matrix is square (m x m)</span>
<span class="n">square_size</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Each square has size 1x1</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">matrix_size</span><span class="p">):</span>
    <span class="c1"># Add a square around each diagonal element</span>
    <span class="n">square</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">),</span><span class="n">square_size</span><span class="p">,</span><span class="n">square_size</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">'none'</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>

<span class="c1"># Add a colorbar</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># Set label for colorbar</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Orthogonal Check, $R_p^T R_p$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Columns'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rows'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span/><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">orthogonal_check</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1">#cbar = plt.colorbar(); cbar.set_label('Value')</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Assuming the matrix is square (m x m)</span>

<span class="ne">AttributeError</span>: module 'matplotlib.cm' has no attribute 'grey'
</pre></div>
</div>
<img alt="_images/b939873a0ebfe0d1abe1e7218ce8f485bb698d87d0fd5a003af297c5e30b4bbf.png" src="../Images/fb33fb692e076e2c71f895be6dd85b6c.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/b939873a0ebfe0d1abe1e7218ce8f485bb698d87d0fd5a003af297c5e30b4bbf.png"/>
</div>
</div>
&#13;

<h2>Add More Features</h2>
<p>We are seeing that for m = 6 we are not seeing significant dimensionality reduction. Let‚Äôs instantiate a larger model.</p>
<ul class="simple">
<li><p>set <span class="math notranslate nohighlight">\(m\)</span> as large, i.e., <span class="math notranslate nohighlight">\(m \ge 100\)</span></p></li>
<li><p>set <span class="math notranslate nohighlight">\(p\)</span> as a reasonable ratio of <span class="math notranslate nohighlight">\(m\)</span>, for example <span class="math notranslate nohighlight">\(\frac{2}{3}\)</span> up to <span class="math notranslate nohighlight">\(\frac{1}{2}\)</span></p></li>
</ul>
<p>Since we don‚Äôt have access to a arbitrarily large data set, let‚Äôs generate it randomly.</p>
<ul class="simple">
<li><p>standard normal, high dimensional multiGaussian distribution with all means of 0 and variances of 1.0</p></li>
<li><p>random correlations between the features</p></li>
<li><p>we use eigendecomposition, set the negative or zero eigenvalues to small positive to ensure the correlation matrix is positive semi-definite</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">m</span> <span class="o">=</span> <span class="mi">100</span>                                                       <span class="c1"># number of dimensions</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>                                              <span class="c1"># number of samples</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>                                   <span class="c1"># set the random seed</span>
<span class="n">mean_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>                                     <span class="c1"># mean vector (zero mean for all variables)</span>

<span class="n">random_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>                          <span class="c1"># step 1: generate a random matrix </span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">random_matrix</span><span class="p">,</span> <span class="n">random_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>   <span class="c1"># step 2: create a symmetric correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">correlation_matrix</span> <span class="o">+</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># step 3: symmetrize the correlation matrix (ensures the matrix is symmetric)</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>                       <span class="c1"># step 4: normalize to have ones on the diagonal (this ensures unit variances)</span>

<span class="c1"># Ensure the covariance matrix is positive semi-definite using eigendecomposition</span>
<span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span>         <span class="c1"># eigendecomposition of the correlation matrix</span>
<span class="n">eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">eigvals</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>                           <span class="c1"># set any negative eigenvalues to a small positive value</span>
<span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">eigvecs</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span> <span class="o">@</span> <span class="n">eigvecs</span><span class="o">.</span><span class="n">T</span>           <span class="c1"># reconstruct the covariance matrix</span>

<span class="n">big_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean_vector</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">)</span> <span class="c1"># step 6: generate the multi-dimensional Gaussian dataset</span>
<span class="n">df_big_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">big_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"Dim_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)])</span> <span class="c1"># convert the data into a pandas DataFrame</span>
</pre></div>
</div>
</div>
</div>
<p>This data is too high dimensional to conveniently visualize, let‚Äôs proceed with random projection.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">n_components</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="n">seed</span> <span class="o">=</span> <span class="mi">73058</span>
<span class="n">rp_big</span> <span class="o">=</span> <span class="n">GaussianRandomProjection</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>

<span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">df_big_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">!=</span> <span class="mi">0</span>   <span class="c1"># select only non-identical samples pairs</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">projected_data</span> <span class="o">=</span> <span class="n">rp_big</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_big_data</span><span class="p">)</span>
<span class="n">projected_dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">projected_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span><span class="n">projected_dists</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: original space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: projected space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">rates</span> <span class="o">=</span> <span class="n">projected_dists</span> <span class="o">/</span> <span class="n">dists</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Distance Ratio, mean: </span><span class="si">%0.2f</span><span class="s2">, standard deviation </span><span class="si">%0.2f</span><span class="s2">."</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">rates</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">rates</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rates</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">),</span><span class="n">color</span> <span class="o">=</span> <span class="s1">'red'</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Distance Ratio: projected / original"</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Distance Ratio, mean: 0.95, standard deviation 0.02.
</pre></div>
</div>
<img alt="_images/39619edae0c2641f4556b98d82390b3cbcb222a4cf0be2e436876337fd5ab48c.png" src="../Images/9e5d080e00dc637a851d8dfb22c425df.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/39619edae0c2641f4556b98d82390b3cbcb222a4cf0be2e436876337fd5ab48c.png"/>
</div>
</div>
<p>Check the orthogonality of the random projection matrix.</p>
<ul class="simple">
<li><p>by calculating and displaying <span class="math notranslate nohighlight">\(R_p^T R_p\)</span>, if orthogonal it should be a strictly diagonal matrix</p></li>
</ul>
<p>Note, <span class="math notranslate nohighlight">\(R_p\)</span> is not square, it is <span class="math notranslate nohighlight">\(p \times m\)</span>, so we are actually checking column orthogonality, <span class="math notranslate nohighlight">\(R_p^T R_p\)</span></p>
<ul class="simple">
<li><p>we are checking is the reduced dimensional projects forms an orthogonal basis</p></li>
<li><p>from above <span class="math notranslate nohighlight">\(R_p^T\)</span> is <span class="math notranslate nohighlight">\(m \times p\)</span> and <span class="math notranslate nohighlight">\(R_p\)</span> is <span class="math notranslate nohighlight">\(p \times m\)</span> so <span class="math notranslate nohighlight">\(R_p^T R_p\)</span> is <span class="math notranslate nohighlight">\(m \times m\)</span></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">orthogonal_check_big</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp_big</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp_big</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check_big</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                       <span class="c1"># assuming the matrix is square (m x m)</span>
<span class="n">square_size</span> <span class="o">=</span> <span class="mi">1</span>                                               <span class="c1"># each square has size 1x1</span>

<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax</span><span class="p">);</span> <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> 

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Orthogonal Check, $R_p^T R_p$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Columns'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rows'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e0a3c6713266a89bcad286ac5af2612cfcfd85f9cb728fa32ecee957d3274e79.png" src="../Images/7f0d011d72830b71ea8a9544642b5b1e.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e0a3c6713266a89bcad286ac5af2612cfcfd85f9cb728fa32ecee957d3274e79.png"/>
</div>
</div>
&#13;

<h2>Add Even More Features</h2>
<p>Let‚Äôs try a larger dimensionality with a single code block.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">m</span> <span class="o">=</span> <span class="mi">1000</span>                                                      <span class="c1"># number of dimensions</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">1000</span>                                              <span class="c1"># number of samples</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="mi">200</span>                                            <span class="c1"># number of components </span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">73058</span>                                                  <span class="c1"># random seed</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>                                   <span class="c1"># set the random seed</span>
<span class="n">mean_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>                                     <span class="c1"># mean vector (zero mean for all variables)</span>

<span class="n">random_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>                          <span class="c1"># step 1: generate a random matrix </span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">random_matrix</span><span class="p">,</span> <span class="n">random_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>   <span class="c1"># step 2: create a symmetric correlation matrix</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">correlation_matrix</span> <span class="o">+</span> <span class="n">correlation_matrix</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># step 3: symmetrize the correlation matrix (ensures the matrix is symmetric)</span>
<span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>                       <span class="c1"># step 4: normalize to have ones on the diagonal (this ensures unit variances)</span>

<span class="c1"># Ensure the covariance matrix is positive semi-definite using eigendecomposition</span>
<span class="n">eigvals</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span>         <span class="c1"># eigendecomposition of the correlation matrix</span>
<span class="n">eigvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">eigvals</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">)</span>                           <span class="c1"># set any negative eigenvalues to a small positive value</span>
<span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">eigvecs</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">eigvals</span><span class="p">)</span> <span class="o">@</span> <span class="n">eigvecs</span><span class="o">.</span><span class="n">T</span>           <span class="c1"># reconstruct the covariance matrix</span>

<span class="n">very_big_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">mean_vector</span><span class="p">,</span> <span class="n">cov_matrix</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">)</span> <span class="c1"># step 6: generate the multi-dimensional Gaussian dataset</span>
<span class="n">df_very_big_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">very_big_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">"Dim_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">)])</span> <span class="c1"># convert the data into a pandas DataFrame</span>

<span class="n">rp_very_big</span> <span class="o">=</span> <span class="n">GaussianRandomProjection</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>

<span class="n">dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">df_very_big_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">nonzero</span> <span class="o">=</span> <span class="n">dists</span> <span class="o">!=</span> <span class="mi">0</span>                                          <span class="c1"># select only non-identical samples pairs</span>
<span class="n">dists</span> <span class="o">=</span> <span class="n">dists</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">projected_data</span> <span class="o">=</span> <span class="n">rp_very_big</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_very_big_data</span><span class="p">)</span>
<span class="n">projected_dists</span> <span class="o">=</span> <span class="n">euclidean_distances</span><span class="p">(</span><span class="n">projected_data</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="n">nonzero</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dists</span><span class="p">,</span><span class="n">projected_dists</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span><span class="n">edgecolor</span> <span class="o">=</span> <span class="s1">'black'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="mi">10000</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">head_length</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">head_width</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: original space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Pairwise Distance: projected space"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Pairwise Distance: Projected to </span><span class="si">%d</span><span class="s2"> Components"</span> <span class="o">%</span> <span class="n">n_components</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">400</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">orthogonal_check_very_big</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">rp_very_big</span><span class="o">.</span><span class="n">components_</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">rp_very_big</span><span class="o">.</span><span class="n">components_</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">orthogonal_check_very_big</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">grey</span><span class="p">,</span><span class="n">vmin</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">'None'</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">matrix_size</span> <span class="o">=</span> <span class="n">orthogonal_check</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                       <span class="c1"># assuming the matrix is square (m x m)</span>
<span class="n">square_size</span> <span class="o">=</span> <span class="mi">1</span>                                               <span class="c1"># each square has size 1x1</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">);</span> <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Value'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Orthogonal Check, $R_p^T R_p$'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Columns'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Rows'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8f03681f7a32673249e97bfda2fb7f490b40578656a4cd639874efec9a003e83.png" src="../Images/11e2a354bd1b2543a20f9194cee52d96.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/8f03681f7a32673249e97bfda2fb7f490b40578656a4cd639874efec9a003e83.png"/>
</div>
</div>
&#13;

<h2>Comments</h2>
<p>This was a basic treatment of random projection. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos‚Äô descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
&#13;

<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael‚Äôs university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael‚Äôs work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
&#13;

<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I‚Äôd be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I‚Äôm always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
    
</body>
</html>