<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Implementation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Implementation</h1>
<blockquote>原文：<a href="https://dafriedman97.github.io/mlbook/content/c7/code.html">https://dafriedman97.github.io/mlbook/content/c7/code.html</a></blockquote>

<p>Several Python libraries allow for easy and efficient implementation of neural networks. Here, we’ll show examples with the very popular <code class="docutils literal notranslate"><span class="pre">tf.keras</span></code> submodule. This submodule integrates Keras, a user-friendly high-level API, into Tensorflow, a lower-level backend. Let’s start by loading Tensorflow, our visualization packages, and the <a class="reference internal" href="../appendix/data.html"><span class="doc">Boston</span></a> housing dataset from <code class="docutils literal notranslate"><span class="pre">scikit-learn</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">boston</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_boston</span><span class="p">()</span>
<span class="n">X_boston</span> <span class="o">=</span> <span class="n">boston</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span>
<span class="n">y_boston</span> <span class="o">=</span> <span class="n">boston</span><span class="p">[</span><span class="s1">'target'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Neural networks in Keras can be fit through one of two APIs: the <em>sequential</em> or the <em>functional</em> API. For the type of models discussed in this chapter, either approach works.</p>
<div class="section" id="the-sequential-api">
<h2>1. The Sequential API</h2>
<p>Fitting a network with the Keras sequential API can be broken down into four steps:</p>
<ol class="simple">
<li><p>Instantiate model</p></li>
<li><p>Add layers</p></li>
<li><p>Compile model (and summarize)</p></li>
<li><p>Fit model</p></li>
</ol>
<p>An example of the code for these four steps is shown below. We first instantiate the network using <code class="docutils literal notranslate"><span class="pre">tf.keras.models.Sequential()</span></code>.</p>
<p>Next, we add layers to the network. Specifically, we have to add any hidden layers we like followed by a single output layer. The type of networks covered in this chapter use only <code class="docutils literal notranslate"><span class="pre">Dense</span></code> layers. A “dense” layer is one in which each neuron is a function of all the other neurons in the previous layer. We identify the number of neurons in the layer with the <code class="docutils literal notranslate"><span class="pre">units</span></code> argument and the activation function applied to the layer with the <code class="docutils literal notranslate"><span class="pre">activation</span></code> argument. For the first layer only, we must also identify the <code class="docutils literal notranslate"><span class="pre">input_shape</span></code>, or the number of neurons in the input layer. If our predictors are of length <code class="docutils literal notranslate"><span class="pre">D</span></code>, the input shape will be <code class="docutils literal notranslate"><span class="pre">(D,</span> <span class="pre">)</span></code> (which is the shape of a single observation, as we can see with <code class="docutils literal notranslate"><span class="pre">X[0].shape</span></code>).</p>
<p>The next step is to compile the model. Compiling determines the configuration of the model; we specify the optimizer and loss function to be used as well as any metrics we would like to monitor. After compiling, we can also preview our model with <code class="docutils literal notranslate"><span class="pre">model.summary()</span></code>.</p>
<p>Finally, we fit the model. Here is where we actually provide our training data. Two other important arguments are <code class="docutils literal notranslate"><span class="pre">epochs</span></code> and <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>. Models in Keras are fit with <em>mini-batch gradient descent</em>, in which samples of the training data are looped through and individually used to calculate and update gradients. <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> determines the size of these samples, and <code class="docutils literal notranslate"><span class="pre">epochs</span></code> determines how many times the gradient is calculated for each sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">## 1. Instantiate</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Sequential_Model'</span><span class="p">)</span>

<span class="c1">## 2. Add Layers</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
                                <span class="n">activation</span> <span class="o">=</span> <span class="s1">'relu'</span><span class="p">,</span>
                                <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_boston</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">),</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s1">'hidden'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">activation</span> <span class="o">=</span> <span class="s1">'linear'</span><span class="p">,</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s1">'output'</span><span class="p">))</span>

<span class="c1">## 3. Compile (and summarize)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s1">'adam'</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="s1">'mse'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="c1">## 4. Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_boston</span><span class="p">,</span> <span class="n">y_boston</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model: "Sequential_Model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
hidden (Dense)               (None, 8)                 112       
_________________________________________________________________
output (Dense)               (None, 1)                 9         
=================================================================
Total params: 121
Trainable params: 121
Non-trainable params: 0
_________________________________________________________________
None
</pre></div>
</div>
</div>
</div>
<p>Predictions with the model built above are shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1"># Create Predictions</span>
<span class="n">yhat_boston</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_boston</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y_boston</span><span class="p">,</span> <span class="n">yhat_boston</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$"</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$ vs. $\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/code_8_01.png" src="../Images/92958b9a2375bcdb5723ba8fd688db7a.png" data-original-src="https://dafriedman97.github.io/mlbook/_images/code_8_01.png"/>
</div>
</div>
</div>
<div class="section" id="the-functional-api">
<h2>2. The Functional API</h2>
<p>Fitting models with the Functional API can again be broken into four steps, listed below.</p>
<ol class="simple">
<li><p>Define layers</p></li>
<li><p>Define model</p></li>
<li><p>Compile model (and summarize)</p></li>
<li><p>Fit model</p></li>
</ol>
<p>While the sequential approach first defines the model and then adds layers, the functional approach does the opposite. We start by adding an input layer using <code class="docutils literal notranslate"><span class="pre">tf.keras.Input()</span></code>. Next, we add one or more hidden layers using <code class="docutils literal notranslate"><span class="pre">tf.keras.layers.Dense()</span></code>. Note that in this approach, we link layers directly. For instance, we indicate that the <code class="docutils literal notranslate"><span class="pre">hidden</span></code> layer below follows the <code class="docutils literal notranslate"><span class="pre">inputs</span></code> layer by adding <code class="docutils literal notranslate"><span class="pre">(inputs)</span></code> to the end of its definition.</p>
<p>After creating the layers, we can define our model. We do this by using <code class="docutils literal notranslate"><span class="pre">tf.keras.Model()</span></code> and identifying the input and output layers. Finally, we compile and fit our model as in the sequential API.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">## 1. Define layers</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_boston</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],),</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"input"</span><span class="p">)</span>
<span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s2">"relu"</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"first_hidden"</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s2">"linear"</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"output"</span><span class="p">)(</span><span class="n">hidden</span><span class="p">)</span>

<span class="c1">## 2. Model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"Functional_Model"</span><span class="p">)</span>

<span class="c1">## 3. Compile (and summarize)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s2">"adam"</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="s2">"mse"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="c1">## 4. Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_boston</span><span class="p">,</span> <span class="n">y_boston</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model: "Functional_Model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input (InputLayer)           [(None, 13)]              0         
_________________________________________________________________
first_hidden (Dense)         (None, 8)                 112       
_________________________________________________________________
output (Dense)               (None, 1)                 9         
=================================================================
Total params: 121
Trainable params: 121
Non-trainable params: 0
_________________________________________________________________
None
</pre></div>
</div>
</div>
</div>
<p>Predictions formed with this model are shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1"># Create Predictions</span>
<span class="n">yhat_boston</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_boston</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y_boston</span><span class="p">,</span> <span class="n">yhat_boston</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$"</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$ vs. $\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/code_13_0.png" src="../Images/780d61e9d6ddfcc0c879e00f897defa6.png" data-original-src="https://dafriedman97.github.io/mlbook/_images/code_13_0.png"/>
</div>
</div>
</div>
&#13;

<h2>1. The Sequential API</h2>
<p>Fitting a network with the Keras sequential API can be broken down into four steps:</p>
<ol class="simple">
<li><p>Instantiate model</p></li>
<li><p>Add layers</p></li>
<li><p>Compile model (and summarize)</p></li>
<li><p>Fit model</p></li>
</ol>
<p>An example of the code for these four steps is shown below. We first instantiate the network using <code class="docutils literal notranslate"><span class="pre">tf.keras.models.Sequential()</span></code>.</p>
<p>Next, we add layers to the network. Specifically, we have to add any hidden layers we like followed by a single output layer. The type of networks covered in this chapter use only <code class="docutils literal notranslate"><span class="pre">Dense</span></code> layers. A “dense” layer is one in which each neuron is a function of all the other neurons in the previous layer. We identify the number of neurons in the layer with the <code class="docutils literal notranslate"><span class="pre">units</span></code> argument and the activation function applied to the layer with the <code class="docutils literal notranslate"><span class="pre">activation</span></code> argument. For the first layer only, we must also identify the <code class="docutils literal notranslate"><span class="pre">input_shape</span></code>, or the number of neurons in the input layer. If our predictors are of length <code class="docutils literal notranslate"><span class="pre">D</span></code>, the input shape will be <code class="docutils literal notranslate"><span class="pre">(D,</span> <span class="pre">)</span></code> (which is the shape of a single observation, as we can see with <code class="docutils literal notranslate"><span class="pre">X[0].shape</span></code>).</p>
<p>The next step is to compile the model. Compiling determines the configuration of the model; we specify the optimizer and loss function to be used as well as any metrics we would like to monitor. After compiling, we can also preview our model with <code class="docutils literal notranslate"><span class="pre">model.summary()</span></code>.</p>
<p>Finally, we fit the model. Here is where we actually provide our training data. Two other important arguments are <code class="docutils literal notranslate"><span class="pre">epochs</span></code> and <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>. Models in Keras are fit with <em>mini-batch gradient descent</em>, in which samples of the training data are looped through and individually used to calculate and update gradients. <code class="docutils literal notranslate"><span class="pre">batch_size</span></code> determines the size of these samples, and <code class="docutils literal notranslate"><span class="pre">epochs</span></code> determines how many times the gradient is calculated for each sample.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">## 1. Instantiate</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">'Sequential_Model'</span><span class="p">)</span>

<span class="c1">## 2. Add Layers</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
                                <span class="n">activation</span> <span class="o">=</span> <span class="s1">'relu'</span><span class="p">,</span>
                                <span class="n">input_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_boston</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">),</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s1">'hidden'</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                                <span class="n">activation</span> <span class="o">=</span> <span class="s1">'linear'</span><span class="p">,</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="s1">'output'</span><span class="p">))</span>

<span class="c1">## 3. Compile (and summarize)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s1">'adam'</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="s1">'mse'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="c1">## 4. Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_boston</span><span class="p">,</span> <span class="n">y_boston</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model: "Sequential_Model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
hidden (Dense)               (None, 8)                 112       
_________________________________________________________________
output (Dense)               (None, 1)                 9         
=================================================================
Total params: 121
Trainable params: 121
Non-trainable params: 0
_________________________________________________________________
None
</pre></div>
</div>
</div>
</div>
<p>Predictions with the model built above are shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1"># Create Predictions</span>
<span class="n">yhat_boston</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_boston</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y_boston</span><span class="p">,</span> <span class="n">yhat_boston</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$"</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$ vs. $\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/code_8_01.png" src="../Images/92958b9a2375bcdb5723ba8fd688db7a.png" data-original-src="https://dafriedman97.github.io/mlbook/_images/code_8_01.png"/>
</div>
</div>
&#13;

<h2>2. The Functional API</h2>
<p>Fitting models with the Functional API can again be broken into four steps, listed below.</p>
<ol class="simple">
<li><p>Define layers</p></li>
<li><p>Define model</p></li>
<li><p>Compile model (and summarize)</p></li>
<li><p>Fit model</p></li>
</ol>
<p>While the sequential approach first defines the model and then adds layers, the functional approach does the opposite. We start by adding an input layer using <code class="docutils literal notranslate"><span class="pre">tf.keras.Input()</span></code>. Next, we add one or more hidden layers using <code class="docutils literal notranslate"><span class="pre">tf.keras.layers.Dense()</span></code>. Note that in this approach, we link layers directly. For instance, we indicate that the <code class="docutils literal notranslate"><span class="pre">hidden</span></code> layer below follows the <code class="docutils literal notranslate"><span class="pre">inputs</span></code> layer by adding <code class="docutils literal notranslate"><span class="pre">(inputs)</span></code> to the end of its definition.</p>
<p>After creating the layers, we can define our model. We do this by using <code class="docutils literal notranslate"><span class="pre">tf.keras.Model()</span></code> and identifying the input and output layers. Finally, we compile and fit our model as in the sequential API.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">## 1. Define layers</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">X_boston</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],),</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"input"</span><span class="p">)</span>
<span class="n">hidden</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s2">"relu"</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"first_hidden"</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span> <span class="o">=</span> <span class="s2">"linear"</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"output"</span><span class="p">)(</span><span class="n">hidden</span><span class="p">)</span>

<span class="c1">## 2. Model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">"Functional_Model"</span><span class="p">)</span>

<span class="c1">## 3. Compile (and summarize)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span> <span class="o">=</span> <span class="s2">"adam"</span><span class="p">,</span> <span class="n">loss</span> <span class="o">=</span> <span class="s2">"mse"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

<span class="c1">## 4. Fit</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_boston</span><span class="p">,</span> <span class="n">y_boston</span><span class="p">,</span> <span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">validation_split</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span/>Model: "Functional_Model"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input (InputLayer)           [(None, 13)]              0         
_________________________________________________________________
first_hidden (Dense)         (None, 8)                 112       
_________________________________________________________________
output (Dense)               (None, 1)                 9         
=================================================================
Total params: 121
Trainable params: 121
Non-trainable params: 0
_________________________________________________________________
None
</pre></div>
</div>
</div>
</div>
<p>Predictions formed with this model are shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1"># Create Predictions</span>
<span class="n">yhat_boston</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_boston</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">y_boston</span><span class="p">,</span> <span class="n">yhat_boston</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$"</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"$y$ vs. $\hat</span><span class="si">{y}</span><span class="s2">$"</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/code_13_0.png" src="../Images/780d61e9d6ddfcc0c879e00f897defa6.png" data-original-src="https://dafriedman97.github.io/mlbook/_images/code_13_0.png"/>
</div>
</div>
    
</body>
</html>