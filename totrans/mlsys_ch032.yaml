- en: Setup
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '![](../media/file333.jpg)'
  prefs: []
  type: TYPE_IMG
- en: '*DALL·E 3 Prompt: Illustration reminiscent of a 1950s cartoon where the Arduino
    NICLA VISION board, equipped with various sensors including a camera, is the focal
    point on an old-fashioned desk. In the background, a computer screen with rounded
    edges displays the Arduino IDE. The code is related to LED configurations and
    machine learning voice command detection. Outputs on the Serial Monitor explicitly
    display the words ‘yes’ and ‘no’.*'
  prefs: []
  type: TYPE_NORMAL
- en: Overview
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The [Arduino Nicla Vision](https://docs.arduino.cc/hardware/nicla-vision) (sometimes
    called *NiclaV*) is a development board that includes two processors that can
    run tasks in parallel. It is part of a family of development boards with the same
    form factor but designed for specific tasks, such as the [Nicla Sense ME](https://www.bosch-sensortec.com/software-tools/tools/arduino-nicla-sense-me/)
    and the [Nicla Voice](https://store-usa.arduino.cc/products/nicla-voice?_gl=1*l3abc6*_ga*MTQ3NzE4Mjk4Mi4xNjQwMDIwOTk5*_ga_NEXN8H46L5*MTY5NjM0Mzk1My4xMDIuMS4xNjk2MzQ0MjQ1LjAuMC4w).
    The *Niclas* can efficiently run processes created with TensorFlow Lite. For example,
    one of the cores of the NiclaV runs a computer vision algorithm on the fly (inference).
    At the same time, the other executes low-level operations like controlling a motor
    and communicating or acting as a user interface. The onboard wireless module allows
    the simultaneous management of WiFi and Bluetooth Low Energy (BLE) connectivity.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file334.png)'
  prefs: []
  type: TYPE_IMG
- en: Hardware
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Two Parallel Cores
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The central processor is the dual-core [STM32H747,](https://content.arduino.cc/assets/Arduino-Portenta-H7_Datasheet_stm32h747xi.pdf?_gl=1*6quciu*_ga*MTQ3NzE4Mjk4Mi4xNjQwMDIwOTk5*_ga_NEXN8H46L5*MTY0NzQ0NTg1My4xMS4xLjE2NDc0NDYzMzkuMA..)
    including a Cortex M7 at 480 MHz and a Cortex M4 at 240 MHz. The two cores communicate
    via a Remote Procedure Call mechanism that seamlessly allows calling functions
    on the other processor. Both processors share all the on-chip peripherals and
    can run:'
  prefs: []
  type: TYPE_NORMAL
- en: Arduino sketches on top of the Arm Mbed OS
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Native Mbed applications
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: MicroPython / JavaScript via an interpreter
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: TensorFlow Lite
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../media/file335.png)'
  prefs: []
  type: TYPE_IMG
- en: Memory
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: Memory is crucial for embedded machine learning projects. The NiclaV board can
    host up to 16 MB of QSPI Flash for storage. However, it is essential to consider
    that the MCU SRAM is the one to be used with machine learning inferences; the
    STM32H747 is only 1 MB, shared by both processors. This MCU also has incorporated
    2 MB of FLASH, mainly for code storage.
  prefs: []
  type: TYPE_NORMAL
- en: Sensors
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: '**Camera**: A GC2145 2 MP Color CMOS Camera.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Microphone**: The `MP34DT05` is an ultra-compact, low-power, omnidirectional,
    digital MEMS microphone built with a capacitive sensing element and the IC interface.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**6-Axis IMU**: 3D gyroscope and 3D accelerometer data from the `LSM6DSOX`
    6-axis IMU.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Time of Flight Sensor**: The `VL53L1CBV0FY` Time-of-Flight sensor adds accurate
    and low-power-ranging capabilities to Nicla Vision. The invisible near-infrared
    VCSEL laser (including the analog driver) is encapsulated with receiving optics
    in an all-in-one small module below the camera.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Arduino IDE Installation
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Start connecting the board (*micro USB*) to your computer:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file336.png)'
  prefs: []
  type: TYPE_IMG
- en: Install the Mbed OS core for Nicla boards in the Arduino IDE. Having the IDE
    open, navigate to `Tools > Board > Board Manager`, look for Arduino Nicla Vision
    on the search window, and install the board.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file337.png)'
  prefs: []
  type: TYPE_IMG
- en: Next, go to `Tools > Board > Arduino Mbed OS Nicla Boards` and select `Arduino
    Nicla Vision`. Having your board connected to the USB, you should see the Nicla
    on Port and select it.
  prefs: []
  type: TYPE_NORMAL
- en: Open the Blink sketch on Examples/Basic and run it using the IDE Upload button.
    You should see the Built-in LED (green RGB) blinking, which means the Nicla board
    is correctly installed and functional!
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Testing the Microphone
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'On Arduino IDE, go to `Examples > PDM > PDMSerialPlotter`, open it, and run
    the sketch. Open the Plotter and see the audio representation from the microphone:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file338.png)'
  prefs: []
  type: TYPE_IMG
- en: Vary the frequency of the sound you generate and confirm that the mic is working
    correctly.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Testing the IMU
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'Before testing the IMU, it will be necessary to install the LSM6DSOX library.
    To do so, go to Library Manager and look for LSM6DSOX. Install the library provided
    by Arduino:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file339.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, go to `Examples > Arduino_LSM6DSOX > SimpleAccelerometer` and run the
    accelerometer test (you can also run Gyro and board temperature):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file340.png)'
  prefs: []
  type: TYPE_IMG
- en: Testing the ToF (Time of Flight) Sensor
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'As we did with IMU, installing the VL53L1X ToF library is necessary. To do
    that, go to Library Manager and look for VL53L1X. Install the library provided
    by Pololu:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file341.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Next, run the sketch [proximity_detection.ino](https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/Arduino-IDE/proximity_detection/proximity_detection.ino):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file342.png)'
  prefs: []
  type: TYPE_IMG
- en: On the Serial Monitor, you will see the distance from the camera to an object
    in front of it (max of 4 m).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file343.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Testing the Camera
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: We can also test the camera using, for example, the code provided on `Examples
    > Camera > CameraCaptureRawBytes`. We cannot see the image directly, but we can
    get the raw image data generated by the camera.
  prefs: []
  type: TYPE_NORMAL
- en: We can use the [`Web Serial Camera`](https://labs.arduino.cc/en/labs/web-serial-camera)
    ([API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Serial_API)) to see
    the image generated by the camera. This web application streams the camera image
    over Web Serial from camera-equipped Arduino boards.
  prefs: []
  type: TYPE_NORMAL
- en: The Web Serial Camera example shows you how to send image data over the wire
    from your Arduino board and how to unpack the data in JavaScript for rendering.
    In addition, in the [source code](https://github.com/arduino/ArduinoCore-mbed/tree/main/libraries/Camera/extras/WebSerialCamera)
    of the web application, we can find some example image filters that show us how
    to manipulate pixel data to achieve visual effects.
  prefs: []
  type: TYPE_NORMAL
- en: The **Arduino sketch** (CameraCaptureWebSerial) for sending the camera image
    data can be found [here](https://github.com/arduino/ArduinoCore-mbed/tree/main/libraries/Camera/examples/CameraCaptureWebSerial)
    and is also directly available from the “`Examples→Camera`” menu in the Arduino
    IDE when selecting the Nicla board.
  prefs: []
  type: TYPE_NORMAL
- en: The **web application** for displaying the camera image can be accessed [here](https://arduino.github.io/labs-pages/web-serial-camera/).
    We may also look at [this tutorial, which explains the setup in more detail.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file344.png)'
  prefs: []
  type: TYPE_IMG
- en: Installing the OpenMV IDE
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: OpenMV IDE is the premier integrated development environment with OpenMV cameras,
    similar to the Nicla Vision. It features a powerful text editor, debug terminal,
    and frame buffer viewer with a histogram display. We will use MicroPython to program
    the camera.
  prefs: []
  type: TYPE_NORMAL
- en: Go to the [OpenMV IDE page](https://openmv.io/pages/download), download the
    correct version for your Operating System, and follow the instructions for its
    installation on your computer.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file345.png)'
  prefs: []
  type: TYPE_IMG
- en: The IDE should open, defaulting to the helloworld_1.py code on its Code Area.
    If not, you can open it from `Files > Examples > HelloWord > helloword.py`
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file346.png)'
  prefs: []
  type: TYPE_IMG
- en: Any messages sent through a serial connection (using print() or error messages)
    will be displayed on the **Serial Terminal** during run time. The image captured
    by a camera will be displayed in the **Camera Viewer** Area (or Frame Buffer)
    and in the Histogram area, immediately below the Camera Viewer.
  prefs: []
  type: TYPE_NORMAL
- en: Updating the Bootloader
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: Before connecting the Nicla to the OpenMV IDE, ensure you have the latest bootloader
    version. Go to your Arduino IDE, select the Nicla board, and open the sketch on
    `Examples > STM_32H747_System STM32H747_manageBootloader`. Upload the code to
    your board. The Serial Monitor will guide you.
  prefs: []
  type: TYPE_NORMAL
- en: Installing the Firmware
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: '**After updating the bootloader**, put the Nicla Vision in bootloader mode
    by double-pressing the reset button on the board. The built-in green LED will
    start fading in and out. Now return to the OpenMV IDE and click on the connect
    icon (Left ToolBar):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file347.jpg)'
  prefs: []
  type: TYPE_IMG
- en: A pop-up will tell you that a board in DFU mode was detected and ask how you
    would like to proceed. First, select `Install the latest release firmware (vX.Y.Z)`.
    This action will install the latest OpenMV firmware on the Nicla Vision.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file348.png)'
  prefs: []
  type: TYPE_IMG
- en: You can leave the option `Erase internal file system` unselected and click `[OK]`.
  prefs: []
  type: TYPE_NORMAL
- en: Nicla’s green LED will start flashing while the OpenMV firmware is uploaded
    to the board, and a terminal window will then open, showing the flashing progress.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file349.png)'
  prefs: []
  type: TYPE_IMG
- en: Wait until the green LED stops flashing and fading. When the process ends, you
    will see a message saying, “DFU firmware update complete!”. Press `[OK]`.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file350.png)'
  prefs: []
  type: TYPE_IMG
- en: A green play button appears when the Nicla Vison connects to the Tool Bar.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file351.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Also, note that a drive named “NO NAME” will appear on your computer.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file352.png)'
  prefs: []
  type: TYPE_IMG
- en: Every time you press the `[RESET]` button on the board, the main.py script stored
    on it automatically executes. You can load the [main.py](https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/Micropython/main.py)
    code on the IDE (`File > Open File...`).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file353.png)'
  prefs: []
  type: TYPE_IMG
- en: This code is the “Blink” code, confirming that the HW is OK.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Testing the Camera
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
- en: To test the camera, let’s run *helloword_1.py*. For that, select the script
    on `File > Examples > HelloWorld > helloword.py`,
  prefs: []
  type: TYPE_NORMAL
- en: When clicking the green play button, the MicroPython script (*helloworld.py*)
    on the Code Area will be uploaded and run on the Nicla Vision. On-Camera Viewer,
    you will start to see the video streaming. The Serial Monitor will show us the
    FPS (Frames per second), which should be around 27fps.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file354.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Here is the `helloworld.py` script:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: In [GitHub](https://github.com/Mjrovai/Arduino_Nicla_Vision), you can find the
    Python scripts used here.
  prefs: []
  type: TYPE_NORMAL
- en: 'The code can be split into two parts:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Setup**: Where the libraries are imported, initialized and the variables
    are defined and initiated.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Loop**: (while loop) part of the code that runs continually. The image (*img*
    variable) is captured (one frame). Each of those frames can be used for inference
    in Machine Learning Applications.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: To interrupt the program execution, press the red `[X]` button.
  prefs: []
  type: TYPE_NORMAL
- en: 'Note: OpenMV Cam runs about half as fast when connected to the IDE. The FPS
    should increase once disconnected.'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: In the [GitHub](https://github.com/Mjrovai/Arduino_Nicla_Vision/tree/main/Micropython),
    You can find other Python scripts. Try to test the onboard sensors.
  prefs: []
  type: TYPE_NORMAL
- en: Connecting the Nicla Vision to Edge Impulse Studio
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: We will need the Edge Impulse Studio later in other labs. [Edge Impulse](https://www.edgeimpulse.com/)
    is a leading development platform for machine learning on edge devices.
  prefs: []
  type: TYPE_NORMAL
- en: 'Edge Impulse officially supports the Nicla Vision. So, to start, please create
    a new project on the Studio and connect the Nicla to it. For that, follow the
    steps:'
  prefs: []
  type: TYPE_NORMAL
- en: Download the [Arduino CLI](https://arduino.github.io/arduino-cli/1.2/installation/)
    for your specific computer architecture (OS)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Download the most updated [EI Firmware](https://cdn.edgeimpulse.com/firmware/arduino-nicla-vision.zip).
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Unzip both files and place all the files in the same folder.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Put the Nicla-Vision on Boot Mode, pressing the reset button twice.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Run the uploader (EI FW) corresponding to your OS:'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '![](../media/file355.png)'
  prefs: []
  type: TYPE_IMG
- en: Executing the specific batch code for your OS will upload the binary *arduino-nicla-vision.bin*
    to your board.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Using `Chrome`, WebUSB can be used to connect the Nicla to the EI Studio. **The
    EI CLI is not needed.**
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Go to your project on the Studio, and on the `Data Acquisition tab`, select
    `WebUSB` (1). A window will pop up; choose the option that shows that the `Nicla
    is paired` (2) and press `[Connect]` (3).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file356.png)'
  prefs: []
  type: TYPE_IMG
- en: You can choose which sensor data to pick in the Collect Data section on the
    Data Acquisition tab.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file357.png)'
  prefs: []
  type: TYPE_IMG
- en: 'For example. `IMU data (inertial)`:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file358.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Or Image (`Camera`):'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file359.png)'
  prefs: []
  type: TYPE_IMG
- en: You can also test an external sensor connected to the `ADC` (Nicla pin 0) and
    the other onboard sensors, such as the `built-in microphone`, the `ToF (Proximity)`
    or a combination of sensors (`fusion`).
  prefs: []
  type: TYPE_NORMAL
- en: Expanding the Nicla Vision Board (optional)
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A last item to explore is that sometimes, during prototyping, it is essential
    to experiment with external sensors and devices. An excellent expansion to the
    Nicla is the [Arduino MKR Connector Carrier (Grove compatible)](https://store-usa.arduino.cc/products/arduino-mkr-connector-carrier-grove-compatible).
  prefs: []
  type: TYPE_NORMAL
- en: 'The shield has 14 Grove connectors: five single analog inputs (A0-A5), one
    double analog input (A5/A6), five single digital I/Os (D0-D4), one double digital
    I/O (D5/D6), one I2C (TWI), and one UART (Serial). All connectors are 5V compatible.'
  prefs: []
  type: TYPE_NORMAL
- en: Note that all 17 Nicla Vision pins will be connected to the Shield Groves, but
    some Grove connections remain disconnected.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: '![](../media/file360.jpg)'
  prefs: []
  type: TYPE_IMG
- en: This shield is MKR compatible and can be used with the Nicla Vision and Portenta.
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file361.jpg)'
  prefs: []
  type: TYPE_IMG
- en: 'For example, suppose that on a TinyML project, you want to send inference results
    using a LoRaWAN device and add information about local luminosity. Often, with
    offline operations, a local low-power display such as an OLED is advised. This
    setup can be seen here:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file362.jpg)'
  prefs: []
  type: TYPE_IMG
- en: The [Grove Light Sensor](https://wiki.seeedstudio.com/Grove-Light_Sensor/) would
    be connected to one of the single Analog pins (A0/PC4), the [LoRaWAN device](https://wiki.seeedstudio.com/Grove_LoRa_E5_New_Version/)
    to the UART, and the [OLED](https://wiki.seeedstudio.com/Grove-OLED-Display-0.96-SSD1315/)
    to the I2C connector.
  prefs: []
  type: TYPE_NORMAL
- en: 'The Nicla Pins 3 (Tx) and 4 (Rx) are connected with the Serial Shield connector.
    The UART communication is used with the LoRaWan device. Here is a simple code
    to use the UART:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: To verify that the UART is working, you should, for example, connect another
    device as the Arduino UNO, displaying “Hello Word” on the Serial Monitor. Here
    is the [code](https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/Arduino-IDE/teste_uart_UNO/teste_uart_UNO.ino).
  prefs: []
  type: TYPE_NORMAL
- en: '![](../media/file363.jpg)'
  prefs: []
  type: TYPE_IMG
- en: Below is the *Hello World code* to be used with the I2C OLED. The MicroPython
    SSD1306 OLED driver (ssd1306.py), created by Adafruit, should also be uploaded
    to the Nicla (the ssd1306.py script can be found in [GitHub](https://github.com/Mjrovai/Arduino_Nicla_Vision/blob/main/Micropython/ssd1306.py)).
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'Finally, here is a simple script to read the ADC value on pin “PC4” (Nicla
    pin A0):'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: The ADC can be used for other sensor variables, such as [Temperature](https://wiki.seeedstudio.com/Grove-Temperature_Sensor_V1.2/).
  prefs: []
  type: TYPE_NORMAL
- en: Note that the above scripts ([downloaded from Github](https://github.com/Mjrovai/Arduino_Nicla_Vision/tree/main/Micropython))
    introduce only how to connect external devices with the Nicla Vision board using
    MicroPython.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The Arduino Nicla Vision is an excellent *tiny device* for industrial and professional
    uses! However, it is powerful, trustworthy, low power, and has suitable sensors
    for the most common embedded machine learning applications such as vision, movement,
    sensor fusion, and sound.
  prefs: []
  type: TYPE_NORMAL
- en: On the [GitHub repository,](https://github.com/Mjrovai/Arduino_Nicla_Vision/tree/main)
    you will find the last version of all the code used or commented on in this hands-on
    lab.
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Resources
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[Micropython codes](https://github.com/Mjrovai/Arduino_Nicla_Vision/tree/main/Micropython)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Arduino Codes](https://github.com/Mjrovai/Arduino_Nicla_Vision/tree/main/Arduino-IDE)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
