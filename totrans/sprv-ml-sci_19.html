<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>13  Reproducibility</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>13  Reproducibility</h1>
<blockquote>原文：<a href="https://ml-science-book.com/reproducibility.html">https://ml-science-book.com/reproducibility.html</a></blockquote>

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part-two.html">Integrating Machine Learning Into Science</a></li><li class="breadcrumb-item"><a href="./reproducibility.html"><span class="chapter-number">13</span>  <span class="chapter-title">Reproducibility</span></a></li></ol></nav>
<div class="quarto-title">

</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The beauty of code: Once written, you can use it as often as you like. If set up correctly, the same code applied to the same data will produce the same results. Ideally, training your machine learning model works the same: at the click of a button, you can run your code again and get the exact same machine learning model. This is known as computational reproducibility, and it <a href="https://book.the-turing-way.org/reproducible-research/overview/overview-benefit">comes with many advantages</a>.</p>
<ul>
<li>Reproducibility makes it easier to track changes in your project.</li>
<li>You can reproduce your work. Comes in handy when reviewer 2 asks you to retrain your model.</li>
<li>People will enjoy working with you and your beautiful code base.</li>
<li>Other researchers can build on your work.</li>
<li>Reproducibility allows you to put a model into production later.</li>
</ul>
<p>But making your code reproducible is much harder than it seems. Computational reproducibility is inherently unstable due to ever-changing computing environments and the unique challenges of machine learning.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"/>
</div>
<div class="callout-title-container flex-fill">
Reproducibility versus replicability
</div>
</div>
<div class="callout-body-container callout-body">
<p>You may have heard about the replicability crisis in the social sciences <span class="citation" data-cites="open2015estimating"><a href="references.html#ref-open2015estimating" role="doc-biblioref">[1]</a></span>: Many research findings couldn’t be replicated. Reproducibility focuses on a narrower goal: getting the same results (e.g. the same model) using the same code on the same data. For an overview of definitions, see the <a href="https://book.the-turing-way.org/reproducible-research/overview/overview-definitions">Turing Way Book</a> <span class="citation" data-cites="arnold2019turing"><a href="references.html#ref-arnold2019turing" role="doc-biblioref">[2]</a></span>.</p>
</div>
</div>
<p>Reproducibility is not binary, but it is a spectrum. This chapter will help you move up that spectrum by highlighting the unique challenges that machine learning poses to reproducibility. Let’s dive in.</p>
<div class="raven-box">
<p>The tornado prediction model worked like a charm for many years. Until it didn’t. One hot summer day, the server had a meltdown and the model was gone. Rattle went into early retirement with a wealth of money, but her original learning algorithm was still sitting on an old laptop. Well, should be a simple retraining task. Or so they thought. They were confronted with a strange folder structure, mysterious file names, and unclear instructions. Other Ravens’ code can be such a pain.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="../Images/bab47648c997b411e3835973c0ac5751.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:50.0%" data-original-src="https://ml-science-book.com/images/raven-reproducibility.jpg"/></p>
</figure>
</div>
</div>
<section id="making-any-coding-project-reproducible" class="level2" data-number="13.1">
<h2 data-number="13.1" class="anchored" data-anchor-id="making-any-coding-project-reproducible"><span class="header-section-number">13.1</span> Making any coding project reproducible</h2>
<p>Reproducibility is a challenge for any coding project even without machine learning. This chapter focuses more on the machine learning-specific challenges, but it wouldn’t be complete if we didn’t mention some general tips and tricks for reproducibility <span class="citation" data-cites="seibold_2024_12744715"><a href="references.html#ref-seibold_2024_12744715" role="doc-biblioref">[3]</a></span>:</p>
<ul>
<li>Create a clear folder structure.</li>
<li>Use good names for files, folders, and functions.</li>
<li>Document your project, including a README, metadata, and code documentation.</li>
<li>Use version control software such as git to track changes to code and text.</li>
<li>Stabilize the computing environment and software using environment management tools such as Conda and virtualization tools such as Docker.</li>
<li>Automate computations, e.g. Makefile, workflow stuff, and have all steps reproducible with code.</li>
<li>Publish your work.</li>
</ul>
<p>The more of these tips you follow, the more reproducible and satisfying your project will be. However, it may require learning new tools like git and adopting new habits like documenting your code – this is an initial investment of time and effort, but it will pay off in the long run. Your future self will thank you.</p>
<p>Now let’s move on to the machine learning-specific challenges.</p>
</section>
<section id="handling-non-deterministic-code" class="level2" data-number="13.2">
<h2 data-number="13.2" class="anchored" data-anchor-id="handling-non-deterministic-code"><span class="header-section-number">13.2</span> Handling non-deterministic code</h2>
<!-- Randomness inherent in machine learning -->
<p>Running the same code twice can produce different results due to randomness. Machine learning involves a lot of randomness: random weight initialization, stochastic gradient descent, random forests, and random data splitting. It is not a bug, it is a feature: Randomness is an inherent driver of learning. For example, randomly splitting data into training and testing simulates “drawing from the same distribution” which is a crucial element of generalization (see <a href="generalization.html" class="quarto-xref"><span>Chapter 7</span></a>) and stochastic gradient descent implicitly regularizes the model through its random nature <span class="citation" data-cites="bottou2010largescale"><a href="references.html#ref-bottou2010largescale" role="doc-biblioref">[4]</a></span>.</p>
<!-- steered by random seed -->
<p>To introduce randomness into the deterministic world of programming logic, machine learning software relies on “random number generators”. These generators are not truly random – they are based on pseudorandom processes that can be controlled by setting an initial random seed. A random seed initializes the random number generator, and all subsequent “random” numbers are deterministic.</p>
<!-- reproducibility via random seed -->
<p>This random seed is also your key to reproducibility for code with randomness. Without a random seed, training a machine learning model will produce different models every time. At least it is unlikely to get the same results twice. But by setting a random seed, you make the random number generation reproducible. There are some exceptions: When running multiple processes in parallel, setting a random seed may still not guarantee deterministic results if the order of execution is inconsistent.</p>
<!-- other software/hardware based reproducibility issues -->
<p>Besides your computer’s random number generator, there are other reasons why running the same code twice may produce different results, even if you have followed all the tips, like making sure you are using the same software:</p>
<ul>
<li>Operations on GPUs can be non-deterministic, even simple ones like a sum (see <a href="https://stackoverflow.com/questions/50744565/how-to-handle-non-determinism-when-training-on-a-gpu">this StackOverflow question</a>).</li>
<li>External systems can change over time (e.g. API calls).</li>
<li>Floating point arithmetic can vary between different hardware and software platforms.</li>
</ul>
</section>
<section id="jupyter-notebooks" class="level2" data-number="13.3">
<h2 data-number="13.3" class="anchored" data-anchor-id="jupyter-notebooks"><span class="header-section-number">13.3</span> Jupyter Notebooks</h2>
<p>Jupyter Notebooks are a blessing and a course to research.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"/>
</div>
<div class="callout-title-container flex-fill">
Jupyter Notebook
</div>
</div>
<div class="callout-body-container callout-body">
<p>The term refers to both the software and the document, just as “Excel” can refer to both the program and a single spreadsheet. Jupyter Notebooks – the software – is essentially an HTML application where you can manage multiple notebooks (the documents), create new ones, delete, edit, and run them. A notebook – the document – is a collection of “cells”. A cell can contain markdown, code, or plain text. Markdown cells are rendered so that you can structure your notebook like a document, with titles, bold text, and other formatting. You can execute code cells, and the results are embedded in the document, whether it is a plot, code warnings, or a printout.</p>
</div>
</div>
<p>Notebooks let you experiment, quickly prototype ideas, and explore data; they encourage documentation; they are great for reporting results. But they make reproducibility difficult. In his provocative talk <a href="https://docs.google.com/presentation/d/1n2RlMdmv1p25Xy5thJUhkKGvjtV-dkAIsUXP-AL4ffI">“I Don’t Like Notebooks”</a>, Joel Grus specifically criticized “hidden states” that make reproducibility difficult:</p>
<ul>
<li>You can run the cells in any order.</li>
<li>You can delete cells, but the variables that were created remain in the workspace.</li>
<li>You can change a cell’s content while only running the old version.</li>
</ul>
<p>Imagine you’re working on a machine learning project in a Jupyter Notebook. You decide to standardize features before training but forget to run the updated cell. You save the model, but now the code doesn’t match the model, and re-running the notebook produces a different model.</p>
<p>In another scenario, you accidentally delete the cell that generates a weight vector shortly after writing the code. But because you executed the cell, the vector is in memory. You finish the project, check your latest changes into version control, and call it a day. The next person to work on the project gets an error about the missing weight vector.</p>
<p>There are even more problems with notebooks: While you can put them under version control, they are quite verbose because they store all HTML output, and actually comparing code changes is no fun like this.</p>
<p>It is possible to make a research project reproducible, even if it relies on notebooks. But you have to be very strict about running them <em>linearly</em> from the first cell to the last, and always with a fresh Python session.</p>
</section>
<section id="apis-and-proprietary-software" class="level2" data-number="13.4">
<h2 data-number="13.4" class="anchored" data-anchor-id="apis-and-proprietary-software"><span class="header-section-number">13.4</span> APIs and proprietary software</h2>
<p>Training a machine learning algorithm on someone else’s hardware can make your life a lot easier: You don’t have to worry about hardware and software installations. Hundreds of machine-learning-as-a-service platforms allow you to upload your data and train a model. The problem: lack of reproducibility. The company behind the machine learning software can change its software without informing you. And even if they don’t: You may not have enough control over the workflow to make it fully reproducible for others. It may not be transparent what algorithms, settings, and software versions the platform uses. Or the company may simply go out of business and you lose access to your training setup.</p>
<p>This problem has gotten much worse with generative AI, especially with large language models like ChatGPT. Whether you are studying ChatGPT for bias or using it to label data: The company behind it is constantly updating the models, and once a model is retired, no one can reproduce your research.</p>
</section>
<section id="hardware-specific-challenges" class="level2" data-number="13.5">
<h2 data-number="13.5" class="anchored" data-anchor-id="hardware-specific-challenges"><span class="header-section-number">13.5</span> Hardware-specific challenges</h2>
<p>Even if you control the server or use your laptop and have followed all the reproducibility recommendations, your project may still not be at 100% reproducible. At least when it comes to running your code on different hardware. The problem is that we can’t completely abstract the training and so on from the hardware. Increasingly, machine learning, especially deep learning, relies on more specific hardware, such as NVIDIA GPUs and Google TPUs. The more hardware-specific your setup, the harder it is for others to reproduce your models.</p>
</section>
<section id="inaccessible-data" class="level2" data-number="13.6">
<h2 data-number="13.6" class="anchored" data-anchor-id="inaccessible-data"><span class="header-section-number">13.6</span> Inaccessible data</h2>
<p>Data can be inaccessible for a number of reasons: it may be too large to share, there may be privacy concerns (such as patient data), or it may be proprietary. This makes reproducibility difficult. But even making it reproducible within the project itself can be difficult, especially with large datasets. A possible “incremental” solution would be to share a subset of the data or simulated data.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"/>
</div>
<div class="callout-title-container flex-fill">
Reproducible versus reusable
</div>
</div>
<div class="callout-body-container callout-body">
<p>Reproducibility and reusability are not the same thing: A research result can be reproducible without being reusable. You may be able to reproduce someone else’s project but if, for example, many things are hard-coded, it will take a lot of effort to adapt it to your use case.</p>
</div>
</div>
</section>
<section id="reproducibility-and-other-issues" class="level2" data-number="13.7">
<h2 data-number="13.7" class="anchored" data-anchor-id="reproducibility-and-other-issues"><span class="header-section-number">13.7</span> Reproducibility and other issues</h2>
<p>Reproducibility is about more than just making sure that others, including your future self, can reproduce your work. It relates to many other aspects we cover in this book:</p>
<ul>
<li>You can think of reproducibility as a form of robustness (see <a href="robustness.html" class="quarto-xref"><span>Chapter 11</span></a>): A reproducible model is robust to the computing environment and to the random number generation.</li>
<li>A lack of reproducibility introduces uncertainty (see <a href="uncertainty.html" class="quarto-xref"><span>Chapter 12</span></a>). Let’s say you forgot to set a random seed. This means that the next time the model is trained, it will be subject to uncertainty due to random splitting of the data and other operations based on a random number generator.</li>
<li>Publication (see <a href="reporting.html" class="quarto-xref"><span>Chapter 14</span></a>) and reproducibility both rely on documentation and go well together: If you have good reporting, you have also made your project more reproducible.</li>
</ul>


<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-open2015estimating" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">O. S. Collaboration, <span>“Estimating the reproducibility of psychological science,”</span> <em>Science</em>, vol. 349, no. 6251, p. aac4716, 2015, doi: <a href="https://doi.org/10.1126/science.aac4716">10.1126/science.aac4716</a>.</div>
</div>
<div id="ref-arnold2019turing" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">B. Arnold <em>et al.</em>, <span>“The turing way: A handbook for reproducible data science,”</span> <em>Zenodo</em>, 2019.</div>
</div>
<div id="ref-seibold_2024_12744715" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">H. Seibold, <em>6 steps towards reproducible research</em>. Zenodo, 2024. doi: <a href="https://doi.org/10.5281/zenodo.12744715">10.5281/zenodo.12744715</a>.</div>
</div>
<div id="ref-bottou2010largescale" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">L. Bottou, <span>“Large-<span>Scale</span> <span>Machine</span> <span>Learning</span> with <span>Stochastic</span> <span>Gradient</span> <span>Descent</span>,”</span> in <em>Proceedings of <span>COMPSTAT</span>’2010</em>, Y. Lechevallier and G. Saporta, Eds., Heidelberg: Physica-Verlag HD, 2010, pp. 177–186. doi: <a href="https://doi.org/10.1007/978-3-7908-2604-3_16">10.1007/978-3-7908-2604-3_16</a>.</div>
</div>
</div>
</section>

    
</body>
</html>