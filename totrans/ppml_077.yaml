- en: '''static'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://rust-exercises.com/100-exercises/07_threads/02_static.html](https://rust-exercises.com/100-exercises/07_threads/02_static.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'If you tried to borrow a slice from the vector in the previous exercise, you
    probably got a compiler error that looks something like this:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: '`argument requires that v is borrowed for ''static`, what does that mean?'
  prefs: []
  type: TYPE_NORMAL
- en: The `'static` lifetime is a special lifetime in Rust.
  prefs: []
  type: TYPE_NORMAL
- en: It means that the value will be valid for the entire duration of the program.
  prefs: []
  type: TYPE_NORMAL
- en: '[Detached threads](#detached-threads)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: A thread launched via `thread::spawn` can **outlive** the thread that spawned
    it.
  prefs: []
  type: TYPE_NORMAL
- en: 'For example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: In this example, the first spawned thread will in turn spawn a child thread
    that prints a message every second.
  prefs: []
  type: TYPE_NORMAL
- en: The first thread will then finish and exit. When that happens, its child thread
    will **continue running** for as long as the overall process is running.
  prefs: []
  type: TYPE_NORMAL
- en: In Rust's lingo, we say that the child thread has **outlived** its parent.
  prefs: []
  type: TYPE_NORMAL
- en: '[`''static` lifetime](#static-lifetime)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Since a spawned thread can:'
  prefs: []
  type: TYPE_NORMAL
- en: outlive the thread that spawned it (its parent thread)
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: run until the program exits
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: it must not borrow any values that might be dropped before the program exits;
    violating this constraint would expose us to a use-after-free bug.
  prefs: []
  type: TYPE_NORMAL
- en: 'That''s why `std::thread::spawn`''s signature requires that the closure passed
    to it has the `''static` lifetime:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: '[`''static` is not (just) about references](#static-is-not-just-about-references)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: All values in Rust have a lifetime, not just references.
  prefs: []
  type: TYPE_NORMAL
- en: 'In particular, a type that owns its data (like a `Vec` or a `String`) satisfies
    the `''static` constraint: if you own it, you can keep working with it for as
    long as you want, even after the function that originally created it has returned.'
  prefs: []
  type: TYPE_NORMAL
- en: 'You can thus interpret `''static` as a way to say:'
  prefs: []
  type: TYPE_NORMAL
- en: Give me an owned value
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Give me a reference that's valid for the entire duration of the program
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'The first approach is how you solved the issue in the previous exercise: by
    allocating new vectors to hold the left and right parts of the original vector,
    which were then moved into the spawned threads.'
  prefs: []
  type: TYPE_NORMAL
- en: '[`''static` references](#static-references)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Let's talk about the second case, references that are valid for the entire duration
    of the program.
  prefs: []
  type: TYPE_NORMAL
- en: '[Static data](#static-data)'
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
- en: 'The most common case is a reference to **static data**, such as string literals:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: Since string literals are known at compile-time, Rust stores them *inside* your
    executable, in a region known as **read-only data segment**. All references pointing
    to that region will therefore be valid for as long as the program runs; they satisfy
    the `'static` contract.
  prefs: []
  type: TYPE_NORMAL
- en: '[Further reading](#further-reading)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '[The data segment](https://en.wikipedia.org/wiki/Data_segment)'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[Exercise](#exercise)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The exercise for this section is located in [`07_threads/02_static`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/07_threads/02_static)
  prefs: []
  type: TYPE_NORMAL
