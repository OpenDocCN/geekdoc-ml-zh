<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Density-based Clustering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1>Density-based Clustering</h1>
<blockquote>原文：<a href="https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_density-based_clustering.html">https://geostatsguy.github.io/MachineLearningDemos_Book/MachineLearning_density-based_clustering.html</a></blockquote>

<p>Michael J. Pyrcz, Professor, The University of Texas at Austin</p>
<p><a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
<p>Chapter of e-book “Applied Machine Learning in Python: a Hands-on Guide with Code”.</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite this e-Book as:</p>
<p>Pyrcz, M.J., 2024, <em>Applied Machine Learning in Python: A Hands-on Guide with Code</em> [e-book]. Zenodo. doi:10.5281/zenodo.15169138 <a class="reference external" href="https://doi.org/10.5281/zenodo.15169138"><img alt="DOI" src="../Images/7e4ea662f44af1eae87e87ecbb962ff4.png" data-original-src="https://zenodo.org/badge/863274676.svg"/></a></p>
</div>
<p>The workflows in this book and more are available here:</p>
<div class="remove-from-content-only admonition">
<p class="admonition-title">Cite the MachineLearningDemos GitHub Repository as:</p>
<p>Pyrcz, M.J., 2024, <em>MachineLearningDemos: Python Machine Learning Demonstration Workflows Repository</em> (0.0.3) [Software]. Zenodo. DOI: 10.5281/zenodo.13835312. GitHub repository: <a class="github reference external" href="https://github.com/GeostatsGuy/MachineLearningDemos">GeostatsGuy/MachineLearningDemos</a> <a class="reference external" href="https://zenodo.org/doi/10.5281/zenodo.13835312"><img alt="DOI" src="../Images/4e3a59c17d684b06a170c4af84e0f631.png" data-original-src="https://zenodo.org/badge/862519860.svg"/></a></p>
</div>
<p>By Michael J. Pyrcz <br/>
© Copyright 2024.</p>
<p>This is a tutorial for / demonstration of <strong>Density-based Clustering</strong>.</p>
<p><strong>YouTube Lecture</strong>: check out my lectures on:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://youtu.be/zOUM_AnI1DQ?si=wzWdJ35qJ9n8O6Bl">Introduction to Machine Learning</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/oFE10cLl0Fs?si=AwmYnrYggtYWGV2n">Cluster Analysis</a></p></li>
<li><p><a class="reference external" href="https://youtu.be/ysJw8M_J40I?si=EIlg2941QrfAt7zE">Issues with k-Means Clustering</a></p></li>
<li><p><a class="reference external" href="https://www.youtube.com/watch?v=3GaLe8HaDMc&amp;list=PLG19vXLQHvSC2ZKFIkgVpI9fCjkN38kwf&amp;index=15">Density-based Clustering</a></p></li>
</ul>
<p>These lectures are all part of my <a class="reference external" href="https://youtube.com/playlist?list=PLG19vXLQHvSC2ZKFIkgVpI9fCjkN38kwf&amp;si=XonjO2wHdXffMpeI">Machine Learning Course</a> on YouTube with linked well-documented Python workflows and interactive dashboards. My goal is to share accessible, actionable, and repeatable educational content. If you want to know about my motivation, check out <a class="reference external" href="https://michaelpyrcz.com/my-story">Michael’s Story</a>.</p>
<section id="motivation-for-density-based-cluster-analysis">
<h2>Motivation for Density-based Cluster Analysis</h2>
<p>We need to learn and segment distinct populations to improve our prediction models,</p>
<ul class="simple">
<li><p>mixing distinct populations to train prediction models often reduces model accuracy</p></li>
<li><p>clustering is an inferential machine learning method to automate the segmentation of the dataset into separate groups, known as clusters and specified by an integer index</p></li>
<li><p>common methods for cluster analysis like k-means clustering are easy to apply but are quite inflexible; therefore, it is essential to add more flexible clustering methods, like density-based clustering, to our toolkit</p></li>
<li><p>always remember, the computer does not provide meaning nor description of the groups, that is our job!</p></li>
</ul>
<p>Here’s a simple workflow, demonstration of K-means, density- and spectral-based clustering (for automated category assignment) for subsurface modeling workflows. This should help you get started with inferential methods to find patterns in your subsurface data sets.</p>
</section>
<section id="k-means-clustering">
<h2>k-Means Clustering</h2>
<p>Let’s recall K-means clustering, a common clustering approach for clustering, group assignment to unlabeled data, where dissimilarity within clustered groups is mini minimized. The loss function that is minimized is,</p>
<div class="math notranslate nohighlight">
\[ 
J = \sum^k_{i=1} \sum_{\alpha \in C_i} || X_{\alpha} - \mu_i ||
\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is the cluster index, <span class="math notranslate nohighlight">\(\alpha\)</span> is the data sample index, <span class="math notranslate nohighlight">\(X\)</span> is the data sample and <span class="math notranslate nohighlight">\(\mu_i\)</span> is the <span class="math notranslate nohighlight">\(i\)</span> cluster prototype, <span class="math notranslate nohighlight">\(k\)</span> is the total number of clusters, and <span class="math notranslate nohighlight">\(|| X_m - \mu_m ||\)</span> is the Euclidean distance from a sample to the cluster prototype in <span class="math notranslate nohighlight">\(M\)</span> dimensional space calculated as,</p>
<div class="math notranslate nohighlight">
\[
|| X_{m,\alpha} - \mu_i || =  \sqrt{ \sum_m^M \left( X_{m,\alpha} - \mu_{m,i} \right)^2 }
\]</div>
<p>Here is a summary of import aspects for k-means clustering:</p>
<ul class="simple">
<li><p><strong>Prototype Method</strong> - represents the training data with number of synthetic cases in the features space. For K-means clustering we assign and iteratively update <span class="math notranslate nohighlight">\(K\)</span> prototypes.</p></li>
<li><p><strong>Iterative Solution</strong> - the initial prototypes are assigned randomly in the feature space, the labels for each training sample are updated to the nearest prototype, then the prototypes are adjusted to the centroid of their assigned training data, repeat until there is no further update to the training data assignments.</p></li>
<li><p><strong>Unsupervised Learning</strong> - the training data are not labeled and are assigned <span class="math notranslate nohighlight">\(K\)</span> labels based on their proximity to the prototypes in the feature space. The idea is that similar things, proximity in feature space, should belong to the same cluster group.</p></li>
<li><p><strong>Feature Weighting</strong> - the procedure depends on the Euclidian distance between training samples and prototypes in feature space. Distance is treated as the ‘inverse’ of similarity. If the features have significantly different magnitudes, the feature(s) with the largest magnitudes and ranges will dominate the loss function and cluster groups will become anisotropic aligned orthogonal to the high range feature(s). While the common approach is to standardize / normalize the variables, by-feature weighting may be applied through unequal variances. Note, in this demonstration we normalize the features to range from 0.0 to 1.0.</p></li>
</ul>
</section>
<section id="assumptions-of-k-means-clustering">
<h2>Assumptions of k-means Clustering</h2>
<p>These are the assumptions that result in significant reduction in flexibility of k-means clustering:</p>
<ol class="arabic simple">
<li><p>The clusters are spherical, convex, and isotropic within the predictor feature space.</p></li>
</ol>
<ul class="simple">
<li><p>This is due to the model loss based on minimizes difference within clusters, this is accomplished through this simple spherical geometry in the predictor feature space.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>There is equal variance for all features</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\sigma_{X_1}^2 = \sigma_{X_2}^2= \ldots = \sigma_{X_m}^2
\]</div>
<ul class="simple">
<li><p>this assumed with the between sample distance / dissimilarity calculation</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>The clusters have similar sizes and frequency (number of samples in the clusters)</p></li>
</ol>
<ul class="simple">
<li><p>larger cluster are divided to minimize the overall squared difference within clusters</p></li>
<li><p>clusters with few samples in feature space are overwhelmed!</p></li>
</ul>
<p>The limitations are quite significant, it is useful to have a more flexible method for clustering.</p>
</section>
<section id="dbscan-for-density-based-clustering">
<h2>DBSCAN for Density-based Clustering</h2>
<p>For dense, nonlinear, and potentially overlapping groups we can use a form of nature inspired computing for clustering.</p>
<ul class="simple">
<li><p>did you know that your brain has built-in cluster analysis, based on density?</p></li>
<li><p>I can prove this with a form of art know as pointillism.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/09d143db8fd83558429e6fce57d02cd8.png" style="display: block; margin: 0 auto; width: 80%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/art.png"/>
  <figcaption style="text-align: center;"> “The banks of the Marne at dawn.”, by Albert Dubois-Pillet (1886), an example of pointillism. I removed the color to highlight the automated cluster analysis in our brains based on changes in point density.
</figcaption>
</figure>
<p>Did it work? You grouped the trees, the clouds, the vegetated river banks via local density.</p>
<ul class="simple">
<li><p>the only reason I know about pointillism is because my sister Susan Weckesser was an incredible artist and musician. Rest in peace, Suse.</p></li>
</ul>
<p>With density-based clustering the cluster groups are seeded or grown in feature space at locations with sufficient point density determined by hyperparameters,</p>
<figure style="text-align: center;">
  <img src="../Images/f25368b953ac38bbbfc103ec47b2d5d6.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/hyperparameters.png"/>
  <figcaption style="text-align: center;"> Density-based clustering hyperparameters require to check for sufficient local density to instantiate a cluster.
</figcaption>
</figure>
<p><span class="math notranslate nohighlight">\(\epsilon\)</span> – the radius of the local neighbourhood in the metric of normalized features. The is the scale / resolution of the clusters. If this values is set too small, too many samples are left as outliers and if set too large, all the clusters merge to one single cluster.</p>
<p><span class="math notranslate nohighlight">\(min_{Pts}\)</span> – the minimum number of points to assign a core point, where core points are applied to initialize or grow a cluster group.</p>
<p>as you can see above, density is quantified by number of samples over a volume, where the volume is based on a radius over all dimensions of feature space.</p>
<p>Automated or guided <span class="math notranslate nohighlight">\(\epsilon\)</span> parameter estimation is available by k-distance graph (in this case is k nearest neighbor),</p>
<figure style="text-align: center;">
  <img src="../Images/a43305c81354672317592744b885b78c.png" style="display: block; margin: 0 auto; width: 100%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/kdistance.png"/>
  <figcaption style="text-align: center;"> k-distance graph with elbow about 0.07 distance in predictor feature space.
</figcaption>
</figure>
<ol class="arabic simple">
<li><p>Calculate the nearest neighbor distance in normalized feature space for all the sample data (1,700 in this case).</p></li>
<li><p>Sort in ascending order and plot.</p></li>
<li><p>Select the distance that maximizes the positive curvature (the elbow).</p></li>
</ol>
<p>Here is a summary of the important aspects for DBSCAN clustering,</p>
<ul class="simple">
<li><p><strong>DBSCAN</strong> - stands for <a class="reference external" href="https://cdn.aaai.org/KDD/1996/KDD96-037.pdf">Density-Based Spatial Clustering of Applications with Noise</a> (Ester et al.,1996).</p></li>
<li><p><strong>Advantages</strong> - include minimum domain knowledge to estimate hyperparameters, the ability to represent any arbitrary shape of cluster groups and efficient to apply for large data sets</p></li>
<li><p><strong>Hierarchical Bottom-up / Agglomerative Clustering</strong> – all data samples start as their own group, called ‘unvisited’ but practically as outliers until assigned to a group, and then the cluster group grow iteratively.</p></li>
<li><p><strong>Mutually Exclusive</strong> – like k-means clustering, all samples may only belong to a single cluster group.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
P(C_i \cap C_j | i \ne j) = 0.0
\]</div>
<ul class="simple">
<li><p><strong>Non-exhaustive</strong> – some samples may be left as unassigned and assumed as outliers for the cluster group assignment</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
P(C_1 \cup C_2 \cup \dots C_k) \le 1.0 
\]</div>
</section>
<section id="dbscan-iterative-solution">
<h2>DBSCAN Iterative Solution</h2>
<p>All data samples are initialized as unvisited and then the method proceeds through the dataset and assigns the samples as,</p>
<ul class="simple">
<li><p><strong>core</strong> point if there are <span class="math notranslate nohighlight">\(\ge\)</span> <strong>min_samples</strong> within <strong>eps</strong> distance from the sample, start of a new cluster</p></li>
<li><p><strong>border</strong> point if there are <span class="math notranslate nohighlight">\(lt\)</span> <strong>min_samples</strong> within <strong>eps</strong> distance from the sample, but the sample is within <strong>eps</strong> distance of a core point, potential growth of an existing cluster</p></li>
<li><p><strong>outlier</strong> point if there are <span class="math notranslate nohighlight">\(lt\)</span> <strong>min_samples</strong> within <strong>eps</strong> distance from the sample and the sample is not within <strong>eps</strong> distance of a core point</p></li>
</ul>
<p>If you would like to see DBSCAN in action, check out my <a class="reference external" href="https://github.com/GeostatsGuy/DataScienceInteractivePython/blob/main/Interactive_DBSCAN.ipynb">DBSCAN interactive Python dashboard</a>,</p>
<figure style="text-align: center;">
  <img src="../Images/02615bd47a459eefbeef250260c431ac.png" style="display: block; margin: 0 auto; width: 100%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/interactive_density.png"/>
  <figcaption style="text-align: center;"> My interactive Python dashboard for DBSCAN.
</figcaption>
</figure>
<p>Once the points are assigned these labels, all connected core points and their associate border points are assigned to an unique cluster.  Outlier points are left as outliers without an assigned cluster. To understand the cluster assignments we should explain the following forms of connection.</p>
<p><strong>directly density reachable</strong> - point X is directly density reachable from A, if A is a core point and X belongs to the neighborhood (distance <span class="math notranslate nohighlight">\(le\)</span> eps) from A.</p>
<p><strong>density-reachable</strong> - point Y is density reachable from A if Y belongs to a neighborhood of a core point that can reached from A. This would require a chain of core points each belonging the previous core points and the last core point including point Y.</p>
<figure style="text-align: center;">
  <img src="../Images/8dbca0ae43ddea0ec062c0109fc23a79.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/densityreachable.png"/>
  <figcaption style="text-align: center;"> Directly density reachable and density reachable.
</figcaption></figure>
<p><strong>density-connected</strong> - points A and B are density-connected if there is a point Z that is density-reachable from both points A and B.</p>
<figure style="text-align: center;">
  <img src="../Images/601d90b59a9fbb894776c62ebf7e5537.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/densityconnected.png"/>
  <figcaption style="text-align: center;"> Density connected.
</figcaption></figure>
<p><strong>density-based cluster</strong> - a nonempty set where all points are density-connected to each other.</p>
<figure style="text-align: center;">
  <img src="../Images/c1541a1e7a843de78416ea2d62714561.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/clusters.png"/>
  <figcaption style="text-align: center;"> Density-based clusters.
</figcaption></figure>
<p>Here’s a concise summary of these steps for solving DBSCAN,</p>
<ol class="arabic simple">
<li><p>all points are labeled as unvisited</p></li>
<li><p>randomly visit an unvisited sample</p></li>
<li><p>check if a core point (<span class="math notranslate nohighlight">\(\ge min_{Pts}\)</span> within <span class="math notranslate nohighlight">\(\epsilon\)</span> distance), if so label as core otherwise label as outlier</p></li>
<li><p>now visit all points within eps distance of the core point, determine if core, otherwise label as border point</p></li>
<li><p>recursive operation where all points within eps distance of new core points are checked</p></li>
<li><p>once this is exhausted then randomly visit an unvisited point</p></li>
</ol>
<p>This approach may be thought of as identify and grow/merge clusters guided by local point density.</p>
</section>
<section id="load-the-required-libraries">
<h2>Load the required libraries</h2>
<p>The following code loads the required libraries. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">ignore_warnings</span> <span class="o">=</span> <span class="kc">True</span>                                        <span class="c1"># ignore warnings?</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                                            <span class="c1"># ndarrays for gridded data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                                           <span class="c1"># DataFrames for tabular data</span>
<span class="kn">import</span> <span class="nn">copy</span>                                                   <span class="c1"># for deep copies</span>
<span class="kn">import</span> <span class="nn">os</span>                                                     <span class="c1"># set working directory, run executables</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>                               <span class="c1"># for plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>                  <span class="c1"># custom color maps</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span><span class="n">AutoMinorLocator</span><span class="p">,</span><span class="n">NullLocator</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mtick</span>                             <span class="c1"># control tick label formatting</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>                <span class="c1"># nearest neighbours function to calculate eps hyperparameter</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>                <span class="c1"># min/max normalization</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>                            <span class="c1"># k-means clustering</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>                            <span class="c1"># DBSCAN clustering</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                <span class="c1"># plot all grids below the plot elements</span>
<span class="k">if</span> <span class="n">ignore_warnings</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>                                   
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>                                         <span class="c1"># color map</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>                                                     <span class="c1"># random number seed </span>
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‘python -m pip install [package-name]’. More assistance is available with the respective package docs.</p>
</section>
<section id="declare-functions">
<h2>Declare functions</h2>
<p>Convenience function to add major and minor gridlines to plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks </span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="custom-colormap">
<h2>Custom Colormap</h2>
<p>Custom colormap for DBSCAN for several groups and 0 set as an outlier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">paired</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">'Paired'</span><span class="p">)</span>                               <span class="c1"># build on categorical colormap</span>
<span class="n">paired_colors</span> <span class="o">=</span> <span class="n">paired</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">paired</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
<span class="n">paired_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>                               <span class="c1"># white in RGBA format for first value</span>
<span class="n">lcmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">paired_colors</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-the-working-directory">
<h2>Set the working directory</h2>
<p>I always like to do this so I don’t lose files and to simplify subsequent read and writes (avoid including the full address each time).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">#os.chdir("d:/PGE383")                                        # set the working directory with the input data file</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loading-data">
<h2>Loading Data</h2>
<p>Let’s load one of the provided multivariate, spatial datasets:</p>
<ul class="simple">
<li><p>you can select datasets 1-4 below.</p></li>
</ul>
<p>These are diverse multivariate datasets with:</p>
<ul class="simple">
<li><p>facies (integers)</p></li>
<li><p>porosity (fraction)</p></li>
<li><p>permeability (<span class="math notranslate nohighlight">\(mD\)</span>)</p></li>
</ul>
<p>Yes, cluster analysis is unsupervised, inferential machine learning and does not use labels. We have facies available so we can evaluate our cluster groups with respect to the facies assigned.</p>
<p>We load the selected dataset with the pandas ‘read_csv’ function into a data frame we called ‘df’ and then preview it to make sure it loaded correctly.</p>
<p><strong>Python Tip: using functions from a package</strong> just type the label for the package that we declared at the beginning:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p>so we can access the pandas function ‘read_csv’ with the command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">()</span>
</pre></div>
</div>
<p>but read_csv() has required input parameters. The essential one is the name of the file. For our circumstance all the other default parameters are fine. If you want to see all the possible parameters for this function, just go to the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html">docs</a>.</p>
<ul class="simple">
<li><p><strong>Tip</strong> - established Python packages like pandas have excellent documentation. They are an excellent first stop to learn new packages. I also find examples critical and this motivates all the workflow examples and codes in my courses!</p></li>
</ul>
<p>also, the program has an output, a pandas DataFrame loaded from the data file. So we have to specficy the name / variable representing this new DataFrame object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"nonlinear_facies_v1.csv"</span><span class="p">)</span>  
</pre></div>
</div>
<p>You can switch the dataset from <span class="math notranslate nohighlight">\(1, \ldots, 4\)</span> to try out different clustering challenges.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">dataset</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Warning some of these datasets examples are quite difficult for clustering! I made a variety for you to test your skills!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">dataset</span> <span class="o">=</span> <span class="mi">2</span>                                                   <span class="c1"># select a dataset, 1 - 4</span>
<span class="n">reduce_the_data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">retain_fraction</span> <span class="o">=</span> <span class="mf">0.3</span>                <span class="c1"># reduce the number of samples to improve visualization and run time </span>
<span class="n">yname</span> <span class="o">=</span> <span class="s1">'Facies'</span>                                              <span class="c1"># available group label for checking</span>

<span class="k">if</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'%'</span><span class="p">,</span><span class="s1">'mD'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Porosity'</span><span class="p">,</span><span class="s1">'Brittleness'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">1200.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/nonlinear_facies_v1.csv'</span><span class="p">)</span> <span class="c1"># load our data table   </span>
<span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">'$kg/m2*10^3$'</span><span class="p">,</span><span class="s1">'%'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Acoustic Impedance'</span><span class="p">,</span><span class="s1">'Porosity'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1200.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/nonlinear_facies_v2.csv'</span><span class="p">)</span> <span class="c1"># load our data table</span>
<span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">'$kg/m2*10^3$'</span><span class="p">,</span><span class="s1">'%'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Acoustic Impedance'</span><span class="p">,</span><span class="s1">'Porosity'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1200.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/nonlinear_facies_v3.csv'</span><span class="p">)</span> <span class="c1"># load our data table</span>
<span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">'$kg/m2*10^3$'</span><span class="p">,</span><span class="s1">'%'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Acoustic Impedance'</span><span class="p">,</span><span class="s1">'Porosity'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">7000.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/sample_data_Gaussian_mixture_v1.csv'</span><span class="p">)</span> <span class="c1"># load our data table</span>

<span class="n">nXname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'n'</span> <span class="o">+</span> <span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">Xname</span><span class="p">]</span>                 <span class="c1"># labels, units and ranges for normalized features</span>
<span class="n">nXunit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'norm['</span> <span class="o">+</span> <span class="n">unit</span> <span class="o">+</span> <span class="s1">']'</span> <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">Xunit</span><span class="p">]</span>
<span class="n">nXlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Normalized '</span> <span class="o">+</span> <span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">Xlabel</span><span class="p">]</span>
<span class="n">nXlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">nXunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">nXunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
<span class="n">nXmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">nXmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>    

<span class="k">if</span> <span class="n">reduce_the_data</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">retain_fraction</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">73073</span><span class="p">);</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1"># extract a fraction of the data</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span> <span class="o">+</span> <span class="p">[</span><span class="n">yname</span><span class="p">]]</span>                                      <span class="c1"># make a new DataFrame with only the features of interest</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>AI</th>
      <th>Por</th>
      <th>Facies</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>381.296221</td>
      <td>8.980678</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>304.449932</td>
      <td>10.135657</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>193.607906</td>
      <td>16.150132</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>205.778123</td>
      <td>13.696509</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>290.854794</td>
      <td>13.132821</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="summary-statistics-and-histograms-for-the-tabular-data">
<h2>Summary Statistics and Histograms for the Tabular Data</h2>
<p>The table includes porosity (fraction) and acoustic impedance (<span class="math notranslate nohighlight">\(\frac{kg}{m^3} \cdot \frac{m}{s} \cdot 10^3\)</span>) that we will work with in the demonstration below.</p>
<p>There are a lot of efficient methods to calculate summary statistics from tabular data in DataFrames. The describe command provides count, mean, minimum, maximum, and quartiles all in a nice data table. We use transpose just to flip the table so that features are on the rows and the statistics are on the columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>                                     <span class="c1"># DataFrame summary statistics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AI</th>
      <td>1800.0</td>
      <td>625.522917</td>
      <td>247.547997</td>
      <td>10.0</td>
      <td>518.076017</td>
      <td>683.865824</td>
      <td>783.315226</td>
      <td>1200.0</td>
    </tr>
    <tr>
      <th>Por</th>
      <td>1800.0</td>
      <td>17.122778</td>
      <td>4.778704</td>
      <td>0.0</td>
      <td>14.663434</td>
      <td>17.674606</td>
      <td>20.361860</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>Facies</th>
      <td>1800.0</td>
      <td>1.666667</td>
      <td>0.816723</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s also check the proportion of facies.</p>
<ul class="simple">
<li><p>once again, we will not use facies, but facies indicates the proportion of samples natural cluster in the dataset</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># histogram feature 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>                                              <span class="c1"># histogram feature 2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># histogram truth label</span>
<span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Shale'</span><span class="p">,</span><span class="s1">'SandShale'</span><span class="p">,</span><span class="s1">'Sand'</span><span class="p">],</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span><span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Facies Proportions'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Facies'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Proportion"</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">));</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">patches</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d433b8288a0a3df029306975e7de39b87ce67841a32778154ff039c43b6462c0.png" src="../Images/597839898a00cdf727aab95af331e2dc.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d433b8288a0a3df029306975e7de39b87ce67841a32778154ff039c43b6462c0.png"/>
</div>
</div>
</section>
<section id="feature-normalization">
<h2>Feature Normalization</h2>
<p>The two considered features are quite incompatible. They have dramatically different:</p>
<ul class="simple">
<li><p>magnitudes / averages</p></li>
<li><p>variances / ranges</p></li>
</ul>
<p>Since the difference in ranges between the features is arbitrary we need to remove this by transforming each of the features. We normalize each of the features to range from 0.0 (minimum) to 1.0 (maximum).</p>
<ul class="simple">
<li><p>Note, with normalization there is no distribution shape change so we would typically check for issues like outliers before the transformation, for brevity this step is not included here given there are no outliers in the provided datasets.</p></li>
</ul>
<p>Now we use these normalized feature values for the clustering workflows, e.g., for calculating the required distances distance between samples and prototypes in our workflow:</p>
<ul class="simple">
<li><p>note, for each data sample we have original feature and transformed feature values; therefore, it is very easy to go back and forth without the need for backtransformation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">transform</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">();</span>                                   <span class="c1"># instantiate the normalization object</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'n'</span> <span class="o">+</span> <span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="s1">'n'</span> <span class="o">+</span> <span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">Xname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="c1"># normalize features</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>AI</th>
      <th>Por</th>
      <th>Facies</th>
      <th>nAI</th>
      <th>nPor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>381.296221</td>
      <td>8.980678</td>
      <td>3</td>
      <td>0.312014</td>
      <td>0.299356</td>
    </tr>
    <tr>
      <th>1</th>
      <td>304.449932</td>
      <td>10.135657</td>
      <td>3</td>
      <td>0.247437</td>
      <td>0.337855</td>
    </tr>
    <tr>
      <th>2</th>
      <td>193.607906</td>
      <td>16.150132</td>
      <td>3</td>
      <td>0.154292</td>
      <td>0.538338</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s confirm that our normalized porosity and acoustic impedance now range between 0 and 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>                                     <span class="c1"># check normalization via summary statistics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AI</th>
      <td>1800.0</td>
      <td>625.522917</td>
      <td>247.547997</td>
      <td>10.0</td>
      <td>518.076017</td>
      <td>683.865824</td>
      <td>783.315226</td>
      <td>1200.0</td>
    </tr>
    <tr>
      <th>Por</th>
      <td>1800.0</td>
      <td>17.122778</td>
      <td>4.778704</td>
      <td>0.0</td>
      <td>14.663434</td>
      <td>17.674606</td>
      <td>20.361860</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>Facies</th>
      <td>1800.0</td>
      <td>1.666667</td>
      <td>0.816723</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>nAI</th>
      <td>1800.0</td>
      <td>0.517246</td>
      <td>0.208024</td>
      <td>0.0</td>
      <td>0.426955</td>
      <td>0.566274</td>
      <td>0.649845</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>nPor</th>
      <td>1800.0</td>
      <td>0.570759</td>
      <td>0.159290</td>
      <td>0.0</td>
      <td>0.488781</td>
      <td>0.589154</td>
      <td>0.678729</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>and let’s compare the original and transformed histograms for the features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># original histograms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># normalized histograms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/262590e49456fa3a3dfcfb8df4eedb2bc7e2381fde8f758cfb076cab46379e9f.png" src="../Images/6946eafd11051796db89f44d89a41b0a.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/262590e49456fa3a3dfcfb8df4eedb2bc7e2381fde8f758cfb076cab46379e9f.png"/>
</div>
</div>
</section>
<section id="quick-peek-at-available-labels-for-educational-purposes">
<h2>Quick Peek at Available Labels for Educational Purposes</h2>
<p>I know this is cheating, but to calibrate our eye’s and to check the natural clusters in our dataset, let’s cheat and look at the features scatter plotted colored by the facies labels.</p>
<ul class="simple">
<li><p>for this demonstration workflow this is our inaccessible truth model, we are using this as only a teaching tool</p></li>
<li><p>after this we will leave these labels out and attempt to automate their assignment with cluster analysis</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">facies_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">])</span>                            <span class="c1"># get the facies list from loaded data</span>
<span class="n">min_facies</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">facies_list</span><span class="p">);</span> <span class="n">max_facies</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">facies_list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifacies</span> <span class="ow">in</span> <span class="n">facies_list</span><span class="p">:</span>                                   <span class="c1"># plot the labeled data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">]</span> <span class="o">==</span> <span class="n">ifacies</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">]</span> <span class="o">==</span> <span class="n">ifacies</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">((</span><span class="n">ifacies</span><span class="o">-</span><span class="n">min_facies</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_facies</span><span class="o">-</span><span class="n">min_facies</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_facies</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">max_facies</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ifacies</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Truth '</span> <span class="o">+</span> <span class="n">yname</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/652cda19b2c66a627a22fa17d9640e4e3745a8cf34e2a24347e8901aaf82fdc4.png" src="../Images/a385f8e325d6fef6ece0176c37991757.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/652cda19b2c66a627a22fa17d9640e4e3745a8cf34e2a24347e8901aaf82fdc4.png"/>
</div>
</div>
<p>For just a moment, look at the truth model. Does it look like this will be difficult to reproduce and automate with cluster analysis?</p>
<ul class="simple">
<li><p>are the natural groups separated - is there overlap?</p></li>
<li><p>what is the shape of the cluster groups - are the groups spherical?</p></li>
<li><p>what are the frequencies in each cluster group?</p></li>
</ul>
<p>This is instructive, since if the groups are not well separated, not spherical and have uneven frequencies within each natural group, then k-means clustering will not likely perform well.</p>
<p>Now, let’s ignore the truth facies categorical assignments and move forward with proper cluster analysis, unsupervised without labels.</p>
</section>
<section id="visualize-the-unlabeled-data">
<h2>Visualize the Unlabeled Data</h2>
<p>In this exercise, we want to use clustering for automated assignment of facies based on two features.</p>
<ul class="simple">
<li><p>I limit us two features for each of visualization</p></li>
<li><p>Let’s start by visualizing the unlabeled data</p></li>
<li><p>We look at the data in original units and normalized units through this entire exercise.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>                                              <span class="c1"># scatter plot our data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>                                              <span class="c1"># scatter plot our normalized data </span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">nXlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0dba4275f8b9d01f98df3f5f393358b936a2551c1053c568b18662686d49c08e.png" src="../Images/1beddf39d6d6aa601f72c6ced44757ef.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0dba4275f8b9d01f98df3f5f393358b936a2551c1053c568b18662686d49c08e.png"/>
</div>
</div>
</section>
<section id="id1">
<h2>k-Means Clustering</h2>
<p>First we start with k-means clustering. From our previous analysis we may know that this will not go well!</p>
<ul class="simple">
<li><p>I have an entire demonstration dedicated to <a class="reference external" href="https://github.com/GeostatsGuy/PythonNumericalDemos/blob/master/SubsurfaceDataAnalytics_Clustering.ipynb">k-means cluster</a>.</p></li>
<li><p>Here we use k-means Clustering to compare and contrast with the subsequent density-based method that we will attempt.</p></li>
</ul>
<p>Once again, let’s be mindful of the assumptions of k-means clustering:</p>
<ul class="simple">
<li><p>spherical variability over the features</p></li>
<li><p>same variability over each feature (after our min/max normalization)</p></li>
<li><p>prior probability of membership in all clusters, equal number of samples in each</p></li>
</ul>
<p>This dataset violates these assumptions with non-spherical shapes, unequal proportions of samples in each cluster (we know this because we have the truth facies and we did peak).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>                                                         <span class="c1"># number of prototypes</span>
<span class="n">ignore_warnings</span> <span class="o">=</span> <span class="kc">True</span>                                        <span class="c1"># ignore warnings?</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># plot the data unlabeled</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups</span>
<span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Clusters'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups histograms       </span>
<span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_cluster</span><span class="p">,</span><span class="n">max_cluster</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)):</span>
    <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">((</span><span class="n">cluster_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)));</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'k-Means Clusters'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'k-Means Clustering Groups'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>   
    
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da99a7400002db428b69cf03b1f80d110a90cd9da772d44ceb538fe35ad1df0b.png" src="../Images/b6800135b0332bade66709fafc2729e0.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/da99a7400002db428b69cf03b1f80d110a90cd9da772d44ceb538fe35ad1df0b.png"/>
</div>
</div>
<p>As expected there are issues:</p>
<ul class="simple">
<li><p>the non-convex, nonlinear shapes, and low-density representation of edges of clusters are not captured well</p></li>
</ul>
<p>As a results obvious connected geometries are broken up.</p>
</section>
<section id="dbscan-clustering">
<h2>DBSCAN Clustering</h2>
<p>The DBSCAN approach that seeds and grows clusters groups based on high density is well suited to working with data with an arbitrary (even non-convex) shape and with noise.</p>
<p>Once again the two parameters include:</p>
<ul class="simple">
<li><p><strong>eps</strong> - maximum distance between to samples in features space for a sample to be included in the neighbourhood of the other sample. Too small a value will result in many clusters and outliers, and too large a value will result in one cluster with all the samples together.</p></li>
<li><p><strong>min_samples</strong> - minimum number of samples in a neighbourhood to spawn a new cluster. Use a larger value for noisy data to prevent identifying clusters due to a few grouped outliers.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">eps</span> <span class="o">=</span> <span class="mf">0.026</span><span class="p">;</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="mi">10</span>                                 <span class="c1"># DBSCAN model parameters</span>

<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.029</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># plot the assigned training data and K prototypes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups</span>
<span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">icluster</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Outliers'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Clusters'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'lower left'</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>                                              <span class="c1"># plot the cluster histogram</span>
<span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_cluster</span><span class="p">,</span><span class="n">max_cluster</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)):</span>
    <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">lcmap</span><span class="p">((</span><span class="n">cluster_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)));</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'DBSCAN Clusters'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'DBSCAN Clustering Groups'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>   
<span class="n">current_labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">current_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Outliers'</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">current_labels</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">NullLocator</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a6d400b449a860659a58145ad193c6f51de9b329465afd97fd7e2cbb3204f27f.png" src="../Images/6bb64696f44116faf7cea700a0f22200.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a6d400b449a860659a58145ad193c6f51de9b329465afd97fd7e2cbb3204f27f.png"/>
</div>
</div>
<p>This result is very different than k-means clustering:</p>
<ul class="simple">
<li><p>the cluster groups are not symmetric or spherical</p></li>
<li><p>we also have outliers</p></li>
</ul>
<p>Let’s explore the sensitivity in the parameters, by looking at the results over a <span class="math notranslate nohighlight">\(3 \times 3\)</span> combinatorial of hyperparameters. Run this the first time as is and then try making changes the values in this code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">eps_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.026</span><span class="p">,</span><span class="mf">0.029</span><span class="p">,</span><span class="mf">0.032</span><span class="p">]</span> 
<span class="n">min_sample_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">eps_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.026</span><span class="p">,</span><span class="mf">0.029</span><span class="p">,</span><span class="mf">0.032</span><span class="p">]</span>                                 <span class="c1"># set parameters to explore - set for 3 cases of each</span>
<span class="n">min_sample_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">eps</span> <span class="ow">in</span> <span class="n">eps_mat</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">min_sample</span> <span class="ow">in</span> <span class="n">min_sample_mat</span><span class="p">:</span>
        <span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_sample</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="c1"># perform DBSCAN</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span> <span class="c1"># cluster indexes</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>                                <span class="c1"># plot the cluster groups</span>
        <span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">icluster</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Outliers'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' Clusters, eps: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">', $min_</span><span class="si">{sample}</span><span class="s1">$ '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_sample</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span> <span class="n">add_grid</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">3.50</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3a9018a2b915e0bf08f57be33b055aefbf0440860254662a0505d30738c82ef9.png" src="../Images/6026c92be73d1f48a2bf8b744cf3ab03.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/3a9018a2b915e0bf08f57be33b055aefbf0440860254662a0505d30738c82ef9.png"/>
</div>
</div>
</section>
<section id="calculating-the-dbscan-parameters">
<h2>Calculating the DBSCAN Parameters</h2>
<p>Now let’s try to use a more repeatable method to calculate the DBSCAN hyperparameters.</p>
<ul class="simple">
<li><p><strong>min samples</strong> - we set with expert knowledge, there is a rule of thumb, <span class="math notranslate nohighlight">\(min_{sample} \ge D + 1\)</span> or <span class="math notranslate nohighlight">\(min_{sample} \ge 2 \times D + 1\)</span> for large, noisy datasets</p></li>
<li><p><strong>eps</strong> - we will use the nearest neighbour function to estimate it given the minimum number of samples</p></li>
</ul>
<p>Let’s calculate the nearest neighbour distance for each sample data to the min sample nearest neighbour in normalized feature space with the command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">neigh</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">min_sample</span><span class="p">)</span>
<span class="n">nbrs</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">'nPor'</span><span class="p">,</span><span class="s1">'nPerm'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">'nPor'</span><span class="p">,</span><span class="s1">'nPerm'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<p>We have a <span class="math notranslate nohighlight">\(n \times k\)</span> array with the distances and the sample data indices:</p>
<ul class="simple">
<li><p>for each <span class="math notranslate nohighlight">\(n\)</span> sample we have a row of nearest neighbour distances up to k nearest neighbours (closest to furthest in the columns), note the first neighbour is sample itself; therefore the first column is 0.</p></li>
<li><p>we will then sort the rows in ascending order and plot relative to the sample index, <span class="math notranslate nohighlight">\(i = 1,\ldots,n-1\)</span></p></li>
</ul>
<p>Then we will plot the distances vs. the sample index in the ascending order</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">min_sample</span> <span class="o">=</span> <span class="mi">15</span>                                               <span class="c1"># set the number of neighbours for k-nearest neighbour plot</span>

<span class="n">neigh</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">min_sample</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mf">999.0</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">'kd_tree'</span><span class="p">)</span>
<span class="n">nbrs</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[:,</span><span class="n">min_sample</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Sorted Ascending Data Index'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Intersample Distance in Feature Space'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))),</span><span class="n">distances</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Nearest Neighbour Plot'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00f3b27f3c08d348670d975111110a79e3fd87b0b9515312a5f750c7be546819.png" src="../Images/d60288cd53277b9a6eb6b87f952c36fc.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/00f3b27f3c08d348670d975111110a79e3fd87b0b9515312a5f750c7be546819.png"/>
</div>
</div>
<p>Now we look for the nearest neighbour distance with the maximum positive curvature, known as the ‘elbow’ of the nearest neighbour plot</p>
<ul class="simple">
<li><p>this provides an indication of the cluster sizes</p></li>
<li><p>we would estimate eps as just above 0.03 - 0.04 in this case.</p></li>
</ul>
<p>Some observations from DBSCAN</p>
<ul class="simple">
<li><p>the results are quite sensitive to the selection of <strong>eps</strong> and <strong>min_samples</strong>.</p></li>
<li><p>in the sparse part of the ‘cluster’ many of the data are assigned to other groups are remain as outliers</p></li>
</ul>
<p>In this case, the result with this estimated eps hyperparameter is not satisfying.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">dbscan_tuned</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.029</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="c1"># DBSCAN with tuned/improved parameters</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbscan_tuned</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span> 
<span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span> <span class="c1"># cluster statistics</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># plot the assigned training data and K prototypes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups</span>
<span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">icluster</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Outliers'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Clusters'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'lower left'</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>                                              <span class="c1"># plot cluster histogram</span>
<span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_cluster</span><span class="p">,</span><span class="n">max_cluster</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)):</span>
    <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">lcmap</span><span class="p">((</span><span class="n">cluster_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)));</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Tuned DBSCAN Clusters'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Tuned DBSCAN Clustering Groups'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>   
<span class="n">current_labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">current_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Outliers'</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">current_labels</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">NullLocator</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e79ecd502b7cf3f722b4eb588a2a2182dee76fa2b9e98bc6368f38a943962e1b.png" src="../Images/0304f745d4f6039f44c8361d5016c294.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e79ecd502b7cf3f722b4eb588a2a2182dee76fa2b9e98bc6368f38a943962e1b.png"/>
</div>
</div>
</section>
<section id="comments">
<h2>Comments</h2>
<p>This was a basic treatment of density-based clustering with DBSCAN. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos’ descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
</section>
<section id="about-the-author">
<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael’s university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael’s work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
</section>
<section id="want-to-work-together">
<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I’d be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I’m always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
</section>
&#13;

<h2>Motivation for Density-based Cluster Analysis</h2>
<p>We need to learn and segment distinct populations to improve our prediction models,</p>
<ul class="simple">
<li><p>mixing distinct populations to train prediction models often reduces model accuracy</p></li>
<li><p>clustering is an inferential machine learning method to automate the segmentation of the dataset into separate groups, known as clusters and specified by an integer index</p></li>
<li><p>common methods for cluster analysis like k-means clustering are easy to apply but are quite inflexible; therefore, it is essential to add more flexible clustering methods, like density-based clustering, to our toolkit</p></li>
<li><p>always remember, the computer does not provide meaning nor description of the groups, that is our job!</p></li>
</ul>
<p>Here’s a simple workflow, demonstration of K-means, density- and spectral-based clustering (for automated category assignment) for subsurface modeling workflows. This should help you get started with inferential methods to find patterns in your subsurface data sets.</p>
&#13;

<h2>k-Means Clustering</h2>
<p>Let’s recall K-means clustering, a common clustering approach for clustering, group assignment to unlabeled data, where dissimilarity within clustered groups is mini minimized. The loss function that is minimized is,</p>
<div class="math notranslate nohighlight">
\[ 
J = \sum^k_{i=1} \sum_{\alpha \in C_i} || X_{\alpha} - \mu_i ||
\]</div>
<p>where <span class="math notranslate nohighlight">\(i\)</span> is the cluster index, <span class="math notranslate nohighlight">\(\alpha\)</span> is the data sample index, <span class="math notranslate nohighlight">\(X\)</span> is the data sample and <span class="math notranslate nohighlight">\(\mu_i\)</span> is the <span class="math notranslate nohighlight">\(i\)</span> cluster prototype, <span class="math notranslate nohighlight">\(k\)</span> is the total number of clusters, and <span class="math notranslate nohighlight">\(|| X_m - \mu_m ||\)</span> is the Euclidean distance from a sample to the cluster prototype in <span class="math notranslate nohighlight">\(M\)</span> dimensional space calculated as,</p>
<div class="math notranslate nohighlight">
\[
|| X_{m,\alpha} - \mu_i || =  \sqrt{ \sum_m^M \left( X_{m,\alpha} - \mu_{m,i} \right)^2 }
\]</div>
<p>Here is a summary of import aspects for k-means clustering:</p>
<ul class="simple">
<li><p><strong>Prototype Method</strong> - represents the training data with number of synthetic cases in the features space. For K-means clustering we assign and iteratively update <span class="math notranslate nohighlight">\(K\)</span> prototypes.</p></li>
<li><p><strong>Iterative Solution</strong> - the initial prototypes are assigned randomly in the feature space, the labels for each training sample are updated to the nearest prototype, then the prototypes are adjusted to the centroid of their assigned training data, repeat until there is no further update to the training data assignments.</p></li>
<li><p><strong>Unsupervised Learning</strong> - the training data are not labeled and are assigned <span class="math notranslate nohighlight">\(K\)</span> labels based on their proximity to the prototypes in the feature space. The idea is that similar things, proximity in feature space, should belong to the same cluster group.</p></li>
<li><p><strong>Feature Weighting</strong> - the procedure depends on the Euclidian distance between training samples and prototypes in feature space. Distance is treated as the ‘inverse’ of similarity. If the features have significantly different magnitudes, the feature(s) with the largest magnitudes and ranges will dominate the loss function and cluster groups will become anisotropic aligned orthogonal to the high range feature(s). While the common approach is to standardize / normalize the variables, by-feature weighting may be applied through unequal variances. Note, in this demonstration we normalize the features to range from 0.0 to 1.0.</p></li>
</ul>
&#13;

<h2>Assumptions of k-means Clustering</h2>
<p>These are the assumptions that result in significant reduction in flexibility of k-means clustering:</p>
<ol class="arabic simple">
<li><p>The clusters are spherical, convex, and isotropic within the predictor feature space.</p></li>
</ol>
<ul class="simple">
<li><p>This is due to the model loss based on minimizes difference within clusters, this is accomplished through this simple spherical geometry in the predictor feature space.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>There is equal variance for all features</p></li>
</ol>
<div class="math notranslate nohighlight">
\[
\sigma_{X_1}^2 = \sigma_{X_2}^2= \ldots = \sigma_{X_m}^2
\]</div>
<ul class="simple">
<li><p>this assumed with the between sample distance / dissimilarity calculation</p></li>
</ul>
<ol class="arabic simple" start="3">
<li><p>The clusters have similar sizes and frequency (number of samples in the clusters)</p></li>
</ol>
<ul class="simple">
<li><p>larger cluster are divided to minimize the overall squared difference within clusters</p></li>
<li><p>clusters with few samples in feature space are overwhelmed!</p></li>
</ul>
<p>The limitations are quite significant, it is useful to have a more flexible method for clustering.</p>
&#13;

<h2>DBSCAN for Density-based Clustering</h2>
<p>For dense, nonlinear, and potentially overlapping groups we can use a form of nature inspired computing for clustering.</p>
<ul class="simple">
<li><p>did you know that your brain has built-in cluster analysis, based on density?</p></li>
<li><p>I can prove this with a form of art know as pointillism.</p></li>
</ul>
<figure style="text-align: center;">
  <img src="../Images/09d143db8fd83558429e6fce57d02cd8.png" style="display: block; margin: 0 auto; width: 80%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/art.png"/>
  <figcaption style="text-align: center;"> “The banks of the Marne at dawn.”, by Albert Dubois-Pillet (1886), an example of pointillism. I removed the color to highlight the automated cluster analysis in our brains based on changes in point density.
</figcaption>
</figure>
<p>Did it work? You grouped the trees, the clouds, the vegetated river banks via local density.</p>
<ul class="simple">
<li><p>the only reason I know about pointillism is because my sister Susan Weckesser was an incredible artist and musician. Rest in peace, Suse.</p></li>
</ul>
<p>With density-based clustering the cluster groups are seeded or grown in feature space at locations with sufficient point density determined by hyperparameters,</p>
<figure style="text-align: center;">
  <img src="../Images/f25368b953ac38bbbfc103ec47b2d5d6.png" style="display: block; margin: 0 auto; width: 30%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/hyperparameters.png"/>
  <figcaption style="text-align: center;"> Density-based clustering hyperparameters require to check for sufficient local density to instantiate a cluster.
</figcaption>
</figure>
<p><span class="math notranslate nohighlight">\(\epsilon\)</span> – the radius of the local neighbourhood in the metric of normalized features. The is the scale / resolution of the clusters. If this values is set too small, too many samples are left as outliers and if set too large, all the clusters merge to one single cluster.</p>
<p><span class="math notranslate nohighlight">\(min_{Pts}\)</span> – the minimum number of points to assign a core point, where core points are applied to initialize or grow a cluster group.</p>
<p>as you can see above, density is quantified by number of samples over a volume, where the volume is based on a radius over all dimensions of feature space.</p>
<p>Automated or guided <span class="math notranslate nohighlight">\(\epsilon\)</span> parameter estimation is available by k-distance graph (in this case is k nearest neighbor),</p>
<figure style="text-align: center;">
  <img src="../Images/a43305c81354672317592744b885b78c.png" style="display: block; margin: 0 auto; width: 100%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/kdistance.png"/>
  <figcaption style="text-align: center;"> k-distance graph with elbow about 0.07 distance in predictor feature space.
</figcaption>
</figure>
<ol class="arabic simple">
<li><p>Calculate the nearest neighbor distance in normalized feature space for all the sample data (1,700 in this case).</p></li>
<li><p>Sort in ascending order and plot.</p></li>
<li><p>Select the distance that maximizes the positive curvature (the elbow).</p></li>
</ol>
<p>Here is a summary of the important aspects for DBSCAN clustering,</p>
<ul class="simple">
<li><p><strong>DBSCAN</strong> - stands for <a class="reference external" href="https://cdn.aaai.org/KDD/1996/KDD96-037.pdf">Density-Based Spatial Clustering of Applications with Noise</a> (Ester et al.,1996).</p></li>
<li><p><strong>Advantages</strong> - include minimum domain knowledge to estimate hyperparameters, the ability to represent any arbitrary shape of cluster groups and efficient to apply for large data sets</p></li>
<li><p><strong>Hierarchical Bottom-up / Agglomerative Clustering</strong> – all data samples start as their own group, called ‘unvisited’ but practically as outliers until assigned to a group, and then the cluster group grow iteratively.</p></li>
<li><p><strong>Mutually Exclusive</strong> – like k-means clustering, all samples may only belong to a single cluster group.</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
P(C_i \cap C_j | i \ne j) = 0.0
\]</div>
<ul class="simple">
<li><p><strong>Non-exhaustive</strong> – some samples may be left as unassigned and assumed as outliers for the cluster group assignment</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
P(C_1 \cup C_2 \cup \dots C_k) \le 1.0 
\]</div>
&#13;

<h2>DBSCAN Iterative Solution</h2>
<p>All data samples are initialized as unvisited and then the method proceeds through the dataset and assigns the samples as,</p>
<ul class="simple">
<li><p><strong>core</strong> point if there are <span class="math notranslate nohighlight">\(\ge\)</span> <strong>min_samples</strong> within <strong>eps</strong> distance from the sample, start of a new cluster</p></li>
<li><p><strong>border</strong> point if there are <span class="math notranslate nohighlight">\(lt\)</span> <strong>min_samples</strong> within <strong>eps</strong> distance from the sample, but the sample is within <strong>eps</strong> distance of a core point, potential growth of an existing cluster</p></li>
<li><p><strong>outlier</strong> point if there are <span class="math notranslate nohighlight">\(lt\)</span> <strong>min_samples</strong> within <strong>eps</strong> distance from the sample and the sample is not within <strong>eps</strong> distance of a core point</p></li>
</ul>
<p>If you would like to see DBSCAN in action, check out my <a class="reference external" href="https://github.com/GeostatsGuy/DataScienceInteractivePython/blob/main/Interactive_DBSCAN.ipynb">DBSCAN interactive Python dashboard</a>,</p>
<figure style="text-align: center;">
  <img src="../Images/02615bd47a459eefbeef250260c431ac.png" style="display: block; margin: 0 auto; width: 100%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/interactive_density.png"/>
  <figcaption style="text-align: center;"> My interactive Python dashboard for DBSCAN.
</figcaption>
</figure>
<p>Once the points are assigned these labels, all connected core points and their associate border points are assigned to an unique cluster.  Outlier points are left as outliers without an assigned cluster. To understand the cluster assignments we should explain the following forms of connection.</p>
<p><strong>directly density reachable</strong> - point X is directly density reachable from A, if A is a core point and X belongs to the neighborhood (distance <span class="math notranslate nohighlight">\(le\)</span> eps) from A.</p>
<p><strong>density-reachable</strong> - point Y is density reachable from A if Y belongs to a neighborhood of a core point that can reached from A. This would require a chain of core points each belonging the previous core points and the last core point including point Y.</p>
<figure style="text-align: center;">
  <img src="../Images/8dbca0ae43ddea0ec062c0109fc23a79.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/densityreachable.png"/>
  <figcaption style="text-align: center;"> Directly density reachable and density reachable.
</figcaption></figure>
<p><strong>density-connected</strong> - points A and B are density-connected if there is a point Z that is density-reachable from both points A and B.</p>
<figure style="text-align: center;">
  <img src="../Images/601d90b59a9fbb894776c62ebf7e5537.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/densityconnected.png"/>
  <figcaption style="text-align: center;"> Density connected.
</figcaption></figure>
<p><strong>density-based cluster</strong> - a nonempty set where all points are density-connected to each other.</p>
<figure style="text-align: center;">
  <img src="../Images/c1541a1e7a843de78416ea2d62714561.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/density_cluster/clusters.png"/>
  <figcaption style="text-align: center;"> Density-based clusters.
</figcaption></figure>
<p>Here’s a concise summary of these steps for solving DBSCAN,</p>
<ol class="arabic simple">
<li><p>all points are labeled as unvisited</p></li>
<li><p>randomly visit an unvisited sample</p></li>
<li><p>check if a core point (<span class="math notranslate nohighlight">\(\ge min_{Pts}\)</span> within <span class="math notranslate nohighlight">\(\epsilon\)</span> distance), if so label as core otherwise label as outlier</p></li>
<li><p>now visit all points within eps distance of the core point, determine if core, otherwise label as border point</p></li>
<li><p>recursive operation where all points within eps distance of new core points are checked</p></li>
<li><p>once this is exhausted then randomly visit an unvisited point</p></li>
</ol>
<p>This approach may be thought of as identify and grow/merge clusters guided by local point density.</p>
&#13;

<h2>Load the required libraries</h2>
<p>The following code loads the required libraries. These should have been installed with Anaconda 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">ignore_warnings</span> <span class="o">=</span> <span class="kc">True</span>                                        <span class="c1"># ignore warnings?</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>                                            <span class="c1"># ndarrays for gridded data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>                                           <span class="c1"># DataFrames for tabular data</span>
<span class="kn">import</span> <span class="nn">copy</span>                                                   <span class="c1"># for deep copies</span>
<span class="kn">import</span> <span class="nn">os</span>                                                     <span class="c1"># set working directory, run executables</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>                               <span class="c1"># for plotting</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>                  <span class="c1"># custom color maps</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MultipleLocator</span><span class="p">,</span><span class="n">AutoMinorLocator</span><span class="p">,</span><span class="n">NullLocator</span><span class="p">)</span> <span class="c1"># control of axes ticks</span>
<span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">mtick</span>                             <span class="c1"># control tick label formatting</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">NearestNeighbors</span>                <span class="c1"># nearest neighbours function to calculate eps hyperparameter</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>                <span class="c1"># min/max normalization</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>                            <span class="c1"># k-means clustering</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">DBSCAN</span>                            <span class="c1"># DBSCAN clustering</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">'axes'</span><span class="p">,</span> <span class="n">axisbelow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                <span class="c1"># plot all grids below the plot elements</span>
<span class="k">if</span> <span class="n">ignore_warnings</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>                                   
    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno</span>                                         <span class="c1"># color map</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>                                                     <span class="c1"># random number seed </span>
</pre></div>
</div>
</div>
</div>
<p>If you get a package import error, you may have to first install some of these packages. This can usually be accomplished by opening up a command window on Windows and then typing ‘python -m pip install [package-name]’. More assistance is available with the respective package docs.</p>
&#13;

<h2>Declare functions</h2>
<p>Convenience function to add major and minor gridlines to plots.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="k">def</span> <span class="nf">add_grid</span><span class="p">():</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span><span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">)</span> <span class="c1"># add y grids</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">7</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">());</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span> <span class="c1"># turn on minor ticks </span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Custom Colormap</h2>
<p>Custom colormap for DBSCAN for several groups and 0 set as an outlier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">paired</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">'Paired'</span><span class="p">)</span>                               <span class="c1"># build on categorical colormap</span>
<span class="n">paired_colors</span> <span class="o">=</span> <span class="n">paired</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">paired</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
<span class="n">paired_colors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>                               <span class="c1"># white in RGBA format for first value</span>
<span class="n">lcmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">paired_colors</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Set the working directory</h2>
<p>I always like to do this so I don’t lose files and to simplify subsequent read and writes (avoid including the full address each time).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="c1">#os.chdir("d:/PGE383")                                        # set the working directory with the input data file</span>
</pre></div>
</div>
</div>
</div>
&#13;

<h2>Loading Data</h2>
<p>Let’s load one of the provided multivariate, spatial datasets:</p>
<ul class="simple">
<li><p>you can select datasets 1-4 below.</p></li>
</ul>
<p>These are diverse multivariate datasets with:</p>
<ul class="simple">
<li><p>facies (integers)</p></li>
<li><p>porosity (fraction)</p></li>
<li><p>permeability (<span class="math notranslate nohighlight">\(mD\)</span>)</p></li>
</ul>
<p>Yes, cluster analysis is unsupervised, inferential machine learning and does not use labels. We have facies available so we can evaluate our cluster groups with respect to the facies assigned.</p>
<p>We load the selected dataset with the pandas ‘read_csv’ function into a data frame we called ‘df’ and then preview it to make sure it loaded correctly.</p>
<p><strong>Python Tip: using functions from a package</strong> just type the label for the package that we declared at the beginning:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
<p>so we can access the pandas function ‘read_csv’ with the command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">()</span>
</pre></div>
</div>
<p>but read_csv() has required input parameters. The essential one is the name of the file. For our circumstance all the other default parameters are fine. If you want to see all the possible parameters for this function, just go to the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html">docs</a>.</p>
<ul class="simple">
<li><p><strong>Tip</strong> - established Python packages like pandas have excellent documentation. They are an excellent first stop to learn new packages. I also find examples critical and this motivates all the workflow examples and codes in my courses!</p></li>
</ul>
<p>also, the program has an output, a pandas DataFrame loaded from the data file. So we have to specficy the name / variable representing this new DataFrame object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">"nonlinear_facies_v1.csv"</span><span class="p">)</span>  
</pre></div>
</div>
<p>You can switch the dataset from <span class="math notranslate nohighlight">\(1, \ldots, 4\)</span> to try out different clustering challenges.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">dataset</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Warning some of these datasets examples are quite difficult for clustering! I made a variety for you to test your skills!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">dataset</span> <span class="o">=</span> <span class="mi">2</span>                                                   <span class="c1"># select a dataset, 1 - 4</span>
<span class="n">reduce_the_data</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">retain_fraction</span> <span class="o">=</span> <span class="mf">0.3</span>                <span class="c1"># reduce the number of samples to improve visualization and run time </span>
<span class="n">yname</span> <span class="o">=</span> <span class="s1">'Facies'</span>                                              <span class="c1"># available group label for checking</span>

<span class="k">if</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Por'</span><span class="p">,</span><span class="s1">'Perm'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'%'</span><span class="p">,</span><span class="s1">'mD'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Porosity'</span><span class="p">,</span><span class="s1">'Brittleness'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">25.0</span><span class="p">,</span><span class="mf">1200.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/nonlinear_facies_v1.csv'</span><span class="p">)</span> <span class="c1"># load our data table   </span>
<span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">'$kg/m2*10^3$'</span><span class="p">,</span><span class="s1">'%'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Acoustic Impedance'</span><span class="p">,</span><span class="s1">'Porosity'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1200.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/nonlinear_facies_v2.csv'</span><span class="p">)</span> <span class="c1"># load our data table</span>
<span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">'$kg/m2*10^3$'</span><span class="p">,</span><span class="s1">'%'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Acoustic Impedance'</span><span class="p">,</span><span class="s1">'Porosity'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1200.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/nonlinear_facies_v3.csv'</span><span class="p">)</span> <span class="c1"># load our data table</span>
<span class="k">elif</span> <span class="n">dataset</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="n">Xname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'AI'</span><span class="p">,</span><span class="s1">'Por'</span><span class="p">];</span> <span class="n">Xunit</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s1">'$kg/m2*10^3$'</span><span class="p">,</span><span class="s1">'%'</span><span class="p">];</span> <span class="n">Xlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Acoustic Impedance'</span><span class="p">,</span><span class="s1">'Porosity'</span><span class="p">]</span> 
    <span class="n">Xlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">Xunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
    <span class="n">Xmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">Xmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">7000.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">]</span>                    <span class="c1"># set minimums and maximums for visualization </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">'https://raw.githubusercontent.com/GeostatsGuy/GeoDataSets/master/sample_data_Gaussian_mixture_v1.csv'</span><span class="p">)</span> <span class="c1"># load our data table</span>

<span class="n">nXname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'n'</span> <span class="o">+</span> <span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">Xname</span><span class="p">]</span>                 <span class="c1"># labels, units and ranges for normalized features</span>
<span class="n">nXunit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'norm['</span> <span class="o">+</span> <span class="n">unit</span> <span class="o">+</span> <span class="s1">']'</span> <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">Xunit</span><span class="p">]</span>
<span class="n">nXlabel</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Normalized '</span> <span class="o">+</span> <span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">Xlabel</span><span class="p">]</span>
<span class="n">nXlabelunit</span> <span class="o">=</span> <span class="p">[</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">nXunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">,</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' ('</span> <span class="o">+</span> <span class="n">nXunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">')'</span><span class="p">]</span>
<span class="n">nXmin</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">];</span> <span class="n">nXmax</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>    

<span class="k">if</span> <span class="n">reduce_the_data</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="n">retain_fraction</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">73073</span><span class="p">);</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span> <span class="c1"># extract a fraction of the data</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span> <span class="o">+</span> <span class="p">[</span><span class="n">yname</span><span class="p">]]</span>                                      <span class="c1"># make a new DataFrame with only the features of interest</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>AI</th>
      <th>Por</th>
      <th>Facies</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>381.296221</td>
      <td>8.980678</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>304.449932</td>
      <td>10.135657</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>193.607906</td>
      <td>16.150132</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>205.778123</td>
      <td>13.696509</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>290.854794</td>
      <td>13.132821</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
&#13;

<h2>Summary Statistics and Histograms for the Tabular Data</h2>
<p>The table includes porosity (fraction) and acoustic impedance (<span class="math notranslate nohighlight">\(\frac{kg}{m^3} \cdot \frac{m}{s} \cdot 10^3\)</span>) that we will work with in the demonstration below.</p>
<p>There are a lot of efficient methods to calculate summary statistics from tabular data in DataFrames. The describe command provides count, mean, minimum, maximum, and quartiles all in a nice data table. We use transpose just to flip the table so that features are on the rows and the statistics are on the columns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>                                     <span class="c1"># DataFrame summary statistics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AI</th>
      <td>1800.0</td>
      <td>625.522917</td>
      <td>247.547997</td>
      <td>10.0</td>
      <td>518.076017</td>
      <td>683.865824</td>
      <td>783.315226</td>
      <td>1200.0</td>
    </tr>
    <tr>
      <th>Por</th>
      <td>1800.0</td>
      <td>17.122778</td>
      <td>4.778704</td>
      <td>0.0</td>
      <td>14.663434</td>
      <td>17.674606</td>
      <td>20.361860</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>Facies</th>
      <td>1800.0</td>
      <td>1.666667</td>
      <td>0.816723</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s also check the proportion of facies.</p>
<ul class="simple">
<li><p>once again, we will not use facies, but facies indicates the proportion of samples natural cluster in the dataset</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># histogram feature 1</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>                                              <span class="c1"># histogram feature 2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># histogram truth label</span>
<span class="n">n</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">],</span><span class="n">label</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'Shale'</span><span class="p">,</span><span class="s1">'SandShale'</span><span class="p">,</span><span class="s1">'Sand'</span><span class="p">],</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span><span class="n">density</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Facies Proportions'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Facies'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Proportion"</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">));</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">),</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'minor'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">patches</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">patch</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">patch</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d433b8288a0a3df029306975e7de39b87ce67841a32778154ff039c43b6462c0.png" src="../Images/597839898a00cdf727aab95af331e2dc.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/d433b8288a0a3df029306975e7de39b87ce67841a32778154ff039c43b6462c0.png"/>
</div>
</div>
&#13;

<h2>Feature Normalization</h2>
<p>The two considered features are quite incompatible. They have dramatically different:</p>
<ul class="simple">
<li><p>magnitudes / averages</p></li>
<li><p>variances / ranges</p></li>
</ul>
<p>Since the difference in ranges between the features is arbitrary we need to remove this by transforming each of the features. We normalize each of the features to range from 0.0 (minimum) to 1.0 (maximum).</p>
<ul class="simple">
<li><p>Note, with normalization there is no distribution shape change so we would typically check for issues like outliers before the transformation, for brevity this step is not included here given there are no outliers in the provided datasets.</p></li>
</ul>
<p>Now we use these normalized feature values for the clustering workflows, e.g., for calculating the required distances distance between samples and prototypes in our workflow:</p>
<ul class="simple">
<li><p>note, for each data sample we have original feature and transformed feature values; therefore, it is very easy to go back and forth without the need for backtransformation.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">transform</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">();</span>                                   <span class="c1"># instantiate the normalization object</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'n'</span> <span class="o">+</span> <span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="s1">'n'</span> <span class="o">+</span> <span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">Xname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="c1"># normalize features</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>AI</th>
      <th>Por</th>
      <th>Facies</th>
      <th>nAI</th>
      <th>nPor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>381.296221</td>
      <td>8.980678</td>
      <td>3</td>
      <td>0.312014</td>
      <td>0.299356</td>
    </tr>
    <tr>
      <th>1</th>
      <td>304.449932</td>
      <td>10.135657</td>
      <td>3</td>
      <td>0.247437</td>
      <td>0.337855</td>
    </tr>
    <tr>
      <th>2</th>
      <td>193.607906</td>
      <td>16.150132</td>
      <td>3</td>
      <td>0.154292</td>
      <td>0.538338</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let’s confirm that our normalized porosity and acoustic impedance now range between 0 and 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>                                     <span class="c1"># check normalization via summary statistics</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th/>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>AI</th>
      <td>1800.0</td>
      <td>625.522917</td>
      <td>247.547997</td>
      <td>10.0</td>
      <td>518.076017</td>
      <td>683.865824</td>
      <td>783.315226</td>
      <td>1200.0</td>
    </tr>
    <tr>
      <th>Por</th>
      <td>1800.0</td>
      <td>17.122778</td>
      <td>4.778704</td>
      <td>0.0</td>
      <td>14.663434</td>
      <td>17.674606</td>
      <td>20.361860</td>
      <td>30.0</td>
    </tr>
    <tr>
      <th>Facies</th>
      <td>1800.0</td>
      <td>1.666667</td>
      <td>0.816723</td>
      <td>1.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>nAI</th>
      <td>1800.0</td>
      <td>0.517246</td>
      <td>0.208024</td>
      <td>0.0</td>
      <td>0.426955</td>
      <td>0.566274</td>
      <td>0.649845</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>nPor</th>
      <td>1800.0</td>
      <td>0.570759</td>
      <td>0.159290</td>
      <td>0.0</td>
      <td>0.488781</td>
      <td>0.589154</td>
      <td>0.678729</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>and let’s compare the original and transformed histograms for the features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># original histograms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># normalized histograms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">"darkorange"</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">20</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">"Frequency"</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/262590e49456fa3a3dfcfb8df4eedb2bc7e2381fde8f758cfb076cab46379e9f.png" src="../Images/6946eafd11051796db89f44d89a41b0a.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/262590e49456fa3a3dfcfb8df4eedb2bc7e2381fde8f758cfb076cab46379e9f.png"/>
</div>
</div>
&#13;

<h2>Quick Peek at Available Labels for Educational Purposes</h2>
<p>I know this is cheating, but to calibrate our eye’s and to check the natural clusters in our dataset, let’s cheat and look at the features scatter plotted colored by the facies labels.</p>
<ul class="simple">
<li><p>for this demonstration workflow this is our inaccessible truth model, we are using this as only a teaching tool</p></li>
<li><p>after this we will leave these labels out and attempt to automate their assignment with cluster analysis</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">facies_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">])</span>                            <span class="c1"># get the facies list from loaded data</span>
<span class="n">min_facies</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">facies_list</span><span class="p">);</span> <span class="n">max_facies</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">facies_list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ifacies</span> <span class="ow">in</span> <span class="n">facies_list</span><span class="p">:</span>                                   <span class="c1"># plot the labeled data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">]</span> <span class="o">==</span> <span class="n">ifacies</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">yname</span><span class="p">]</span> <span class="o">==</span> <span class="n">ifacies</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">((</span><span class="n">ifacies</span><span class="o">-</span><span class="n">min_facies</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_facies</span><span class="o">-</span><span class="n">min_facies</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_facies</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">max_facies</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ifacies</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Truth '</span> <span class="o">+</span> <span class="n">yname</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/652cda19b2c66a627a22fa17d9640e4e3745a8cf34e2a24347e8901aaf82fdc4.png" src="../Images/a385f8e325d6fef6ece0176c37991757.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/652cda19b2c66a627a22fa17d9640e4e3745a8cf34e2a24347e8901aaf82fdc4.png"/>
</div>
</div>
<p>For just a moment, look at the truth model. Does it look like this will be difficult to reproduce and automate with cluster analysis?</p>
<ul class="simple">
<li><p>are the natural groups separated - is there overlap?</p></li>
<li><p>what is the shape of the cluster groups - are the groups spherical?</p></li>
<li><p>what are the frequencies in each cluster group?</p></li>
</ul>
<p>This is instructive, since if the groups are not well separated, not spherical and have uneven frequencies within each natural group, then k-means clustering will not likely perform well.</p>
<p>Now, let’s ignore the truth facies categorical assignments and move forward with proper cluster analysis, unsupervised without labels.</p>
&#13;

<h2>Visualize the Unlabeled Data</h2>
<p>In this exercise, we want to use clustering for automated assignment of facies based on two features.</p>
<ul class="simple">
<li><p>I limit us two features for each of visualization</p></li>
<li><p>Let’s start by visualizing the unlabeled data</p></li>
<li><p>We look at the data in original units and normalized units through this entire exercise.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>                                              <span class="c1"># scatter plot our data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>                                              <span class="c1"># scatter plot our normalized data </span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span><span class="n">linewidths</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s2">"black"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">nXlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">nXlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">nXlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">nXmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">nXmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span> <span class="n">add_grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0dba4275f8b9d01f98df3f5f393358b936a2551c1053c568b18662686d49c08e.png" src="../Images/1beddf39d6d6aa601f72c6ced44757ef.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/0dba4275f8b9d01f98df3f5f393358b936a2551c1053c568b18662686d49c08e.png"/>
</div>
</div>
&#13;

<h2>k-Means Clustering</h2>
<p>First we start with k-means clustering. From our previous analysis we may know that this will not go well!</p>
<ul class="simple">
<li><p>I have an entire demonstration dedicated to <a class="reference external" href="https://github.com/GeostatsGuy/PythonNumericalDemos/blob/master/SubsurfaceDataAnalytics_Clustering.ipynb">k-means cluster</a>.</p></li>
<li><p>Here we use k-means Clustering to compare and contrast with the subsequent density-based method that we will attempt.</p></li>
</ul>
<p>Once again, let’s be mindful of the assumptions of k-means clustering:</p>
<ul class="simple">
<li><p>spherical variability over the features</p></li>
<li><p>same variability over each feature (after our min/max normalization)</p></li>
<li><p>prior probability of membership in all clusters, equal number of samples in each</p></li>
</ul>
<p>This dataset violates these assumptions with non-spherical shapes, unequal proportions of samples in each cluster (we know this because we have the truth facies and we did peak).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">3</span>                                                         <span class="c1"># number of prototypes</span>
<span class="n">ignore_warnings</span> <span class="o">=</span> <span class="kc">True</span>                                        <span class="c1"># ignore warnings?</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="n">K</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># plot the data unlabeled</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups</span>
<span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Clusters'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'upper right'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups histograms       </span>
<span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'kMeans'</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_cluster</span><span class="p">,</span><span class="n">max_cluster</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)):</span>
    <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr_r</span><span class="p">((</span><span class="n">cluster_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)));</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'k-Means Clusters'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'k-Means Clustering Groups'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>   
    
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da99a7400002db428b69cf03b1f80d110a90cd9da772d44ceb538fe35ad1df0b.png" src="../Images/b6800135b0332bade66709fafc2729e0.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/da99a7400002db428b69cf03b1f80d110a90cd9da772d44ceb538fe35ad1df0b.png"/>
</div>
</div>
<p>As expected there are issues:</p>
<ul class="simple">
<li><p>the non-convex, nonlinear shapes, and low-density representation of edges of clusters are not captured well</p></li>
</ul>
<p>As a results obvious connected geometries are broken up.</p>
&#13;

<h2>DBSCAN Clustering</h2>
<p>The DBSCAN approach that seeds and grows clusters groups based on high density is well suited to working with data with an arbitrary (even non-convex) shape and with noise.</p>
<p>Once again the two parameters include:</p>
<ul class="simple">
<li><p><strong>eps</strong> - maximum distance between to samples in features space for a sample to be included in the neighbourhood of the other sample. Too small a value will result in many clusters and outliers, and too large a value will result in one cluster with all the samples together.</p></li>
<li><p><strong>min_samples</strong> - minimum number of samples in a neighbourhood to spawn a new cluster. Use a larger value for noisy data to prevent identifying clusters due to a few grouped outliers.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">eps</span> <span class="o">=</span> <span class="mf">0.026</span><span class="p">;</span> <span class="n">min_samples</span> <span class="o">=</span> <span class="mi">10</span>                                 <span class="c1"># DBSCAN model parameters</span>

<span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.029</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># plot the assigned training data and K prototypes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups</span>
<span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">icluster</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Outliers'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Clusters'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'lower left'</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>                                              <span class="c1"># plot the cluster histogram</span>
<span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_cluster</span><span class="p">,</span><span class="n">max_cluster</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)):</span>
    <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">lcmap</span><span class="p">((</span><span class="n">cluster_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)));</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'DBSCAN Clusters'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'DBSCAN Clustering Groups'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>   
<span class="n">current_labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">current_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Outliers'</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">current_labels</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">NullLocator</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a6d400b449a860659a58145ad193c6f51de9b329465afd97fd7e2cbb3204f27f.png" src="../Images/6bb64696f44116faf7cea700a0f22200.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/a6d400b449a860659a58145ad193c6f51de9b329465afd97fd7e2cbb3204f27f.png"/>
</div>
</div>
<p>This result is very different than k-means clustering:</p>
<ul class="simple">
<li><p>the cluster groups are not symmetric or spherical</p></li>
<li><p>we also have outliers</p></li>
</ul>
<p>Let’s explore the sensitivity in the parameters, by looking at the results over a <span class="math notranslate nohighlight">\(3 \times 3\)</span> combinatorial of hyperparameters. Run this the first time as is and then try making changes the values in this code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">eps_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.026</span><span class="p">,</span><span class="mf">0.029</span><span class="p">,</span><span class="mf">0.032</span><span class="p">]</span> 
<span class="n">min_sample_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">eps_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.026</span><span class="p">,</span><span class="mf">0.029</span><span class="p">,</span><span class="mf">0.032</span><span class="p">]</span>                                 <span class="c1"># set parameters to explore - set for 3 cases of each</span>
<span class="n">min_sample_mat</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">eps</span> <span class="ow">in</span> <span class="n">eps_mat</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">min_sample</span> <span class="ow">in</span> <span class="n">min_sample_mat</span><span class="p">:</span>
        <span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_sample</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="c1"># perform DBSCAN</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span> <span class="c1"># cluster indexes</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>                                <span class="c1"># plot the cluster groups</span>
        <span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">icluster</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Outliers'</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' Clusters, eps: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">', $min_</span><span class="si">{sample}</span><span class="s1">$ '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">min_sample</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]]);</span> <span class="n">add_grid</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">3.50</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3a9018a2b915e0bf08f57be33b055aefbf0440860254662a0505d30738c82ef9.png" src="../Images/6026c92be73d1f48a2bf8b744cf3ab03.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/3a9018a2b915e0bf08f57be33b055aefbf0440860254662a0505d30738c82ef9.png"/>
</div>
</div>
&#13;

<h2>Calculating the DBSCAN Parameters</h2>
<p>Now let’s try to use a more repeatable method to calculate the DBSCAN hyperparameters.</p>
<ul class="simple">
<li><p><strong>min samples</strong> - we set with expert knowledge, there is a rule of thumb, <span class="math notranslate nohighlight">\(min_{sample} \ge D + 1\)</span> or <span class="math notranslate nohighlight">\(min_{sample} \ge 2 \times D + 1\)</span> for large, noisy datasets</p></li>
<li><p><strong>eps</strong> - we will use the nearest neighbour function to estimate it given the minimum number of samples</p></li>
</ul>
<p>Let’s calculate the nearest neighbour distance for each sample data to the min sample nearest neighbour in normalized feature space with the command:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">neigh</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">min_sample</span><span class="p">)</span>
<span class="n">nbrs</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">'nPor'</span><span class="p">,</span><span class="s1">'nPerm'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">'nPor'</span><span class="p">,</span><span class="s1">'nPerm'</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<p>We have a <span class="math notranslate nohighlight">\(n \times k\)</span> array with the distances and the sample data indices:</p>
<ul class="simple">
<li><p>for each <span class="math notranslate nohighlight">\(n\)</span> sample we have a row of nearest neighbour distances up to k nearest neighbours (closest to furthest in the columns), note the first neighbour is sample itself; therefore the first column is 0.</p></li>
<li><p>we will then sort the rows in ascending order and plot relative to the sample index, <span class="math notranslate nohighlight">\(i = 1,\ldots,n-1\)</span></p></li>
</ul>
<p>Then we will plot the distances vs. the sample index in the ascending order</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">min_sample</span> <span class="o">=</span> <span class="mi">15</span>                                               <span class="c1"># set the number of neighbours for k-nearest neighbour plot</span>

<span class="n">neigh</span> <span class="o">=</span> <span class="n">NearestNeighbors</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">min_sample</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mf">999.0</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="s1">'kd_tree'</span><span class="p">)</span>
<span class="n">nbrs</span> <span class="o">=</span> <span class="n">neigh</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">nbrs</span><span class="o">.</span><span class="n">kneighbors</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">distances</span><span class="p">[:,</span><span class="n">min_sample</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="s1">'red'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Sorted Ascending Data Index'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Intersample Distance in Feature Space'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))),</span><span class="n">distances</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">'red'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Nearest Neighbour Plot'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">distances</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">1.6</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/00f3b27f3c08d348670d975111110a79e3fd87b0b9515312a5f750c7be546819.png" src="../Images/d60288cd53277b9a6eb6b87f952c36fc.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/00f3b27f3c08d348670d975111110a79e3fd87b0b9515312a5f750c7be546819.png"/>
</div>
</div>
<p>Now we look for the nearest neighbour distance with the maximum positive curvature, known as the ‘elbow’ of the nearest neighbour plot</p>
<ul class="simple">
<li><p>this provides an indication of the cluster sizes</p></li>
<li><p>we would estimate eps as just above 0.03 - 0.04 in this case.</p></li>
</ul>
<p>Some observations from DBSCAN</p>
<ul class="simple">
<li><p>the results are quite sensitive to the selection of <strong>eps</strong> and <strong>min_samples</strong>.</p></li>
<li><p>in the sparse part of the ‘cluster’ many of the data are assigned to other groups are remain as outliers</p></li>
</ul>
<p>In this case, the result with this estimated eps hyperparameter is not satisfying.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span/><span class="n">dbscan_tuned</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mf">0.029</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">nXname</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="c1"># DBSCAN with tuned/improved parameters</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbscan_tuned</span><span class="o">.</span><span class="n">labels_</span> <span class="o">+</span> <span class="mi">1</span> 
<span class="n">cluster_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]);</span> <span class="n">min_cluster</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">max_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)</span> <span class="c1"># cluster statistics</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">)</span>                                              <span class="c1"># plot the assigned training data and K prototypes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">df</span><span class="p">[</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">c</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>                                              <span class="c1"># plot the cluster groups</span>
<span class="k">for</span> <span class="n">icluster</span> <span class="ow">in</span> <span class="n">cluster_list</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">icluster</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Outliers'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">]</span> <span class="o">==</span> <span class="n">icluster</span><span class="p">][</span><span class="n">Xname</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">lcmap</span><span class="p">((</span><span class="n">icluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)),</span><span class="n">edgecolor</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">min_cluster</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="n">max_cluster</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="s1">'Facies: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">icluster</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">Xlabelunit</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">Xlabel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' vs. '</span> <span class="o">+</span> <span class="n">Xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">' with Clusters'</span><span class="p">);</span> <span class="n">add_grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]]);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="n">Xmin</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Xmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">'lower left'</span><span class="p">,</span><span class="n">ncol</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>                                              <span class="c1"># plot cluster histogram</span>
<span class="n">N</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">patches</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">'DBSCAN_tuned'</span><span class="p">],</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span><span class="n">edgecolor</span><span class="o">=</span><span class="s2">"black"</span><span class="p">,</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">max_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span>
    <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">min_cluster</span><span class="p">,</span><span class="n">max_cluster</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">min_cluster</span><span class="o">-</span><span class="mf">0.5</span><span class="p">),</span><span class="n">density</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">)):</span>
    <span class="n">patches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">lcmap</span><span class="p">((</span><span class="n">cluster_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">max_cluster</span><span class="o">-</span><span class="n">min_cluster</span><span class="p">)));</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">();</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">cluster_list</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Tuned DBSCAN Clusters'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Frequency'</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Tuned DBSCAN Clustering Groups'</span><span class="p">)</span>
<span class="n">add_grid</span><span class="p">()</span>   
<span class="n">current_labels</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">current_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'Outliers'</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">current_labels</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">NullLocator</span><span class="p">())</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">2.1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e79ecd502b7cf3f722b4eb588a2a2182dee76fa2b9e98bc6368f38a943962e1b.png" src="../Images/0304f745d4f6039f44c8361d5016c294.png" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_images/e79ecd502b7cf3f722b4eb588a2a2182dee76fa2b9e98bc6368f38a943962e1b.png"/>
</div>
</div>
&#13;

<h2>Comments</h2>
<p>This was a basic treatment of density-based clustering with DBSCAN. Much more could be done and discussed, I have many more resources. Check out my <a class="reference external" href="https://michaelpyrcz.com/my-resources">shared resource inventory</a> and the YouTube lecture links at the start of this chapter with resource links in the videos’ descriptions.</p>
<p>I hope this is helpful,</p>
<p><em>Michael</em></p>
&#13;

<h2>About the Author</h2>
<figure style="text-align: center;">
  <img src="../Images/eb709b2c0a0c715da01ae0165efdf3b2.png" style="display: block; margin: 0 auto; width: 70%;" data-original-src="https://geostatsguy.github.io/MachineLearningDemos_Book/_static/intro/michael_pyrcz_officeshot_jacket.jpg"/>
  <figcaption style="text-align: center;"> Professor Michael Pyrcz in his office on the 40 acres, campus of The University of Texas at Austin.
</figcaption>
</figure>
<p>Michael Pyrcz is a professor in the <a class="reference external" href="https://cockrell.utexas.edu/faculty-directory/alphabetical/p">Cockrell School of Engineering</a>, and the <a class="reference external" href="https://www.jsg.utexas.edu/researcher/michael_pyrcz/">Jackson School of Geosciences</a>, at <a class="reference external" href="https://www.utexas.edu/">The University of Texas at Austin</a>, where he researches and teaches subsurface, spatial data analytics, geostatistics, and machine learning. Michael is also,</p>
<ul class="simple">
<li><p>the principal investigator of the <a class="reference external" href="https://fri.cns.utexas.edu/energy-analytics">Energy Analytics</a> freshmen research initiative and a core faculty in the Machine Learn Laboratory in the College of Natural Sciences, The University of Texas at Austin</p></li>
<li><p>an associate editor for <a class="reference external" href="https://www.sciencedirect.com/journal/computers-and-geosciences/about/editorial-board">Computers and Geosciences</a>, and a board member for <a class="reference external" href="https://link.springer.com/journal/11004/editorial-board">Mathematical Geosciences</a>, the International Association for Mathematical Geosciences.</p></li>
</ul>
<p>Michael has written over 70 <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en">peer-reviewed publications</a>, a <a class="reference external" href="https://pypi.org/project/geostatspy/">Python package</a> for spatial data analytics, co-authored a textbook on spatial data analytics, <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistical Reservoir Modeling</a> and author of two recently released e-books, <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostatistics in Python: a Hands-on Guide with GeostatsPy</a> and <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/intro.html">Applied Machine Learning in Python: a Hands-on Guide with Code</a>.</p>
<p>All of Michael’s university lectures are available on his <a class="reference external" href="https://www.youtube.com/@GeostatsGuyLectures">YouTube Channel</a> with links to 100s of Python interactive dashboards and well-documented workflows in over 40 repositories on his <a class="reference external" href="https://github.com/GeostatsGuy">GitHub account</a>, to support any interested students and working professionals with evergreen content. To find out more about Michael’s work and shared educational resources visit his <span class="xref myst">Website</span>.</p>
&#13;

<h2>Want to Work Together?</h2>
<p>I hope this content is helpful to those that want to learn more about subsurface modeling, data analytics and machine learning. Students and working professionals are welcome to participate.</p>
<ul class="simple">
<li><p>Want to invite me to visit your company for training, mentoring, project review, workflow design and / or consulting? I’d be happy to drop by and work with you!</p></li>
<li><p>Interested in partnering, supporting my graduate student research or my Subsurface Data Analytics and Machine Learning consortium (co-PI is Professor John Foster)? My research combines data analytics, stochastic modeling and machine learning theory with practice to develop novel methods and workflows to add value. We are solving challenging subsurface problems!</p></li>
<li><p>I can be reached at <a class="reference external" href="mailto:mpyrcz%40austin.utexas.edu">mpyrcz<span>@</span>austin<span>.</span>utexas<span>.</span>edu</a>.</p></li>
</ul>
<p>I’m always happy to discuss,</p>
<p><em>Michael</em></p>
<p>Michael Pyrcz, Ph.D., P.Eng. Professor, Cockrell School of Engineering and The Jackson School of Geosciences, The University of Texas at Austin</p>
<p>More Resources Available at: <a class="reference external" href="https://twitter.com/geostatsguy">Twitter</a> | <a class="reference external" href="https://github.com/GeostatsGuy">GitHub</a> | <a class="reference external" href="http://michaelpyrcz.com">Website</a> | <a class="reference external" href="https://scholar.google.com/citations?user=QVZ20eQAAAAJ&amp;hl=en&amp;oi=ao">GoogleScholar</a> | <a class="reference external" href="https://www.amazon.com/Geostatistical-Reservoir-Modeling-Michael-Pyrcz/dp/0199731446">Geostatistics Book</a> | <a class="reference external" href="https://www.youtube.com/channel/UCLqEr-xV-ceHdXXXrTId5ig">YouTube</a>  | <a class="reference external" href="https://geostatsguy.github.io/GeostatsPyDemos_Book/intro.html">Applied Geostats in Python e-book</a> | <a class="reference external" href="https://geostatsguy.github.io/MachineLearningDemos_Book/">Applied Machine Learning in Python e-book</a> | <a class="reference external" href="https://www.linkedin.com/in/michael-pyrcz-61a648a1">LinkedIn</a></p>
    
</body>
</html>