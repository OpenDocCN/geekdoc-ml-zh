- en: Error::source
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 原文：[https://rust-exercises.com/100-exercises/05_ticket_v2/14_source.html](https://rust-exercises.com/100-exercises/05_ticket_v2/14_source.html)
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'There''s one more thing we need to talk about to complete our coverage of the
    `Error` trait: the `source` method.'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The `source` method is a way to access the **error cause**, if any.
  prefs: []
  type: TYPE_NORMAL
- en: 'Errors are often chained, meaning that one error is the cause of another: you
    have a high-level error (e.g. cannot connect to the database) that is caused by
    a lower-level error (e.g. can''t resolve the database hostname). The `source`
    method allows you to "walk" the full chain of errors, often used when capturing
    error context in logs.'
  prefs: []
  type: TYPE_NORMAL
- en: '[Implementing `source`](#implementing-source)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `Error` trait provides a default implementation that always returns `None`
    (i.e. no underlying cause). That's why you didn't have to care about `source`
    in the previous exercises.
  prefs: []
  type: TYPE_NORMAL
- en: You can override this default implementation to provide a cause for your error
    type.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: In this example, `DatabaseError` wraps an `std::io::Error` as its source. We
    then override the `source` method to return this source when called.
  prefs: []
  type: TYPE_NORMAL
- en: '[`&(dyn Error + ''static)`](#dyn-error--static)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: What's this `&(dyn Error + 'static)` type?
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s unpack it:'
  prefs: []
  type: TYPE_NORMAL
- en: '`dyn Error` is a **trait object**. It''s a way to refer to any type that implements
    the `Error` trait.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`''static` is a special **lifetime specifier**. `''static` implies that the
    reference is valid for "as long as we need it", i.e. the entire program execution.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Combined: `&(dyn Error + ''static)` is a reference to a trait object that implements
    the `Error` trait and is valid for the entire program execution.'
  prefs: []
  type: TYPE_NORMAL
- en: Don't worry too much about either of these concepts for now. We'll cover them
    in more detail in future chapters.
  prefs: []
  type: TYPE_NORMAL
- en: '[Implementing `source` using `thiserror`](#implementing-source-using-thiserror)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '`thiserror` provides three ways to automatically implement `source` for your
    error types:'
  prefs: []
  type: TYPE_NORMAL
- en: A field named `source` will automatically be used as the source of the error.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: A field annotated with the `#[source]` attribute will automatically be used
    as the source of the error.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: A field annotated with the `#[from]` attribute will automatically be used as
    the source of the error **and** `thiserror` will automatically generate a `From`
    implementation to convert the annotated type into your error type.
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs:
  - PREF_IND
  type: TYPE_PRE
- en: '[The `?` operator](#the--operator)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The `?` operator is a shorthand for propagating errors.
  prefs: []
  type: TYPE_NORMAL
- en: When used in a function that returns a `Result`, it will return early with an
    error if the `Result` is `Err`.
  prefs: []
  type: TYPE_NORMAL
- en: 'For example:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: 'is equivalent to:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: You can use the `?` operator to shorten your error handling code significantly.
  prefs: []
  type: TYPE_NORMAL
- en: In particular, the `?` operator will automatically convert the error type of
    the fallible operation into the error type of the function, if a conversion is
    possible (i.e. if there is a suitable `From` implementation)
  prefs: []
  type: TYPE_NORMAL
- en: '[Exercise](#exercise)'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: The exercise for this section is located in [`05_ticket_v2/14_source`](https://github.com/mainmatter/100-exercises-to-learn-rust/tree/main/exercises/05_ticket_v2/14_source)
  prefs: []
  type: TYPE_NORMAL
