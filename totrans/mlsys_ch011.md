# AI 工作流程

*DALL·E 3 提示：创建一个代表 AI 工作流程/管道的矩形流程图。从左到右，按以下顺序描绘阶段：'数据收集'用数据库图标表示，'数据预处理'用过滤器图标表示，'模型设计'用大脑图标表示，'训练'用权重图标表示，'评估'用勾选标记表示，'部署'用火箭表示。用箭头连接每个阶段，引导观众水平通过 AI 流程，强调这些步骤的顺序性和相互关联性。*

![图片](img/file66.png)

## 目的

*什么系统框架指导着从初始开发到生产部署的机器学习系统的工程化？*

生产机器学习系统需要系统思维和结构化框架。工作流程将机器学习开发组织成标准化的阶段：数据收集、模型开发、验证和部署。这些结构化流程管理数据质量和一致性，协调模型训练和实验，自动化优化流程，并在不同环境中协调部署。这些系统方法将实验直觉转化为工程学科，为机器学习系统建立心理框架。这种纪律性的基础使系统开发可重复，维护质量标准，并在整个机器学习生命周期中做出明智的决策。

**学习目标**

+   将机器学习生命周期阶段与传统软件开发进行比较，并识别基本差异

+   分析六个核心机器学习生命周期阶段（从问题定义到维护）及其相互关联的反馈关系

+   应用系统思维原则，追踪约束传播如何影响多个生命周期阶段的决策

+   使用特定的定量指标评估模型性能与部署约束之间的权衡

+   设计考虑现实世界部署环境和操作要求的收集数据策略

+   实施监控框架，从生产机器学习系统中捕获多尺度反馈循环

+   评估问题定义决策对后续模型开发和部署选择的影响

+   构建在资源受限环境中平衡计算效率与性能要求的部署架构

## 机器学习开发系统框架

在第一部分的基础原则（系统特性、部署环境、数学框架和架构模式）的基础上，本章从组件级分析推进到系统级工程。从理论理解到操作实施的转变需要一个系统框架来规范生产机器学习系统的发展。

本章介绍了机器学习工作流程作为系统化机器学习系统开发的指导方法论。传统的软件工程通过确定性的需求到实现的路径进行，而机器学习系统开发表现出根本不同的特征。ML 系统通过迭代实验 1 进化，其中模型从数据中提取模式，性能指标经过统计验证，部署约束创建反馈机制，从而告知早期开发阶段。这种经验主义、以数据为中心的方法需要专门的流程方法，以适应不确定性，协调并行开发流，并建立持续改进机制。

这里提出的系统框架为理解第二部分的设计原则奠定了理论基础。这种工作流程视角阐明了专门数据工程管道（第六章）的合理性，软件框架在启用迭代方法（第七章）中的作用，以及模型训练在综合系统生命周期中的整合（第八章）。没有这种概念框架，后续的技术组件看起来像是分散的工具，而不是一个连贯的工程学科中的集成元素。

本章以糖尿病视网膜病变筛查系统开发作为教学案例研究，展示了工作流程原则如何连接实验室研究和临床部署。这个例子说明了数据获取策略、架构设计决策、部署约束管理和满足运营需求之间的复杂相互依赖关系，这些是生产规模机器学习系统的特征。这些系统模式不仅适用于医学应用，而且展示了在多个领域可靠地运行机器学习系统所需的工程学科。

## 理解机器学习生命周期

机器学习生命周期是一个结构化、迭代的流程，它指导机器学习系统的开发、评估和改进。这种方法在时间上整合了系统实验、评估和适应，建立在几十年的结构化开发方法(Chapman et al. 2000)2 的基础上，同时解决数据驱动系统的独特挑战。

理解这个生命周期需要一种系统思维 3 方法，认识到四种基本模式：约束传播（一个阶段的决策如何影响所有其他阶段）、多尺度反馈循环（系统如何适应不同的时间尺度）、涌现复杂性（系统级行为与组件行为的不同）和资源优化（权衡如何创造相互依赖）。这些模式在我们关于糖尿病视网膜病变的案例研究中得到探索，为我们提供了理解为什么机器学习系统需要集成工程方法而不是顺序组件优化的分析框架。

***机器学习生命周期*** 是一个迭代过程，通过反馈驱动的阶段来*开发*、*部署*和*优化*机器学习系统，强调对不断变化的数据和需求进行*持续改进*。

图 5.1 通过两个并行管道可视化这个完整的生命周期：数据管道（绿色，顶部行）通过收集、摄取、分析、标记、验证和准备将原始输入转换为机器学习准备好的数据集。模型开发管道（蓝色，底部行）将这些数据集通过训练、评估、验证和部署来创建生产系统。关键洞察在于它们的相互连接——曲线反馈箭头显示了部署洞察如何触发数据优化，从而创建区分机器学习与传统线性开发的持续改进循环。

![图 5.1](img/file67.svg)

图 5.1：**机器学习生命周期阶段**：突出的反馈箭头（以粗体颜色显示的粗曲线线）强调了机器学习开发的迭代性质，其中监控洞察力持续地告知数据优化，评估结果触发模型改进，部署经验重塑数据收集策略。这些视觉反馈循环代表了机器学习生命周期的主要驱动因素，将其与线性开发方法区分开来，在后者中，后期阶段很少影响早期阶段。

这个工作流程框架是后续技术章节的支架。这里展示的数据管道在第六章中得到了全面处理，该章节讨论了如何确保数据质量并在机器学习生命周期中管理数据。模型训练扩展到第八章，涵盖了如何高效地大规模训练模型。使这种迭代开发过程成为可能的软件框架在第七章（ch013.xhtml#sec-ai-frameworks）中详细描述。部署和持续运营扩展到第十三章，讨论了系统如何在生产中保持性能。本章建立了在深入探讨每个部分之前这些部分如何相互连接——理解整个系统使专门的组件变得有意义。

本章重点介绍机器学习生命周期的概念阶段——开发过程的“是什么”和“为什么”。通过自动化、工具和基础设施实现这一生命周期的操作实施——“如何”——是 MLOps 的领域，我们将在第十三章（ch019.xhtml#sec-ml-operations）中详细探讨。这种区别至关重要：生命周期提供了理解机器学习开发阶段的系统框架，而 MLOps 提供了实施这些阶段的操作实践。理解这一生命周期基础使得专门的 MLOps 工具和实践变得有意义，而不是看起来像是分散的操作关注点。

## 机器学习 vs 传统软件开发

机器学习需要专门的周期性方法，因为机器学习开发与传统软件开发在本质上存在差异。传统的周期性方法包括一系列连续的阶段：需求收集、系统设计、实现、测试和部署 (Royce 1987)4。每个阶段都会产生特定的工件，这些工件作为后续阶段的输入。在金融软件开发中，需求阶段会产生关于交易处理、安全协议和合规性的详细规范。这些规范通过显式编程直接转化为系统行为，与第一章中探讨的机器学习系统的概率性质形成鲜明对比。

机器学习系统需要一种根本不同的方法。传统软件的确定性，其中行为是明确编程的，与机器学习系统的概率性质形成对比。以金融交易处理为例：传统系统遵循预定的规则（如果账户余额大于交易金额，则允许交易），而基于机器学习的欺诈检测系统 5 则从历史交易数据中学习识别可疑模式。这种从显式编程到学习行为的转变重塑了开发周期，改变了我们对待系统可靠性和鲁棒性的方法，这在第十六章（ch022.xhtml#sec-robust-ai）中有详细说明。

这些在系统行为上的基本差异引入了新的动态，改变了生命周期阶段之间的相互作用。这些系统需要通过持续的反馈循环进行持续优化，这些反馈循环能够从部署阶段获得洞察力，从而影响早期开发阶段。机器学习系统本质上是动态的，必须通过持续的部署 6 实践来适应不断变化的数据分布和目标。

当我们考察开发生命周期维度之间的具体差异时，这些对比变得更加清晰。以下表 5.1 总结了关键的区别。这些差异反映了在系统设计中将数据作为一等公民处理的核心挑战，这是传统软件工程方法未设计来处理的 7。

表 5.1：**传统与 ML 开发**：由于机器学习的数据驱动和迭代特性，传统软件和机器学习系统在开发过程中存在差异。机器学习生命周期强调实验和演变目标，需要阶段之间的反馈循环，而传统软件遵循具有预定义规范的线性进展。

| **方面** | **传统软件生命周期** | **机器学习生命周期** |
| --- | --- | --- |
| **问题定义** | 预先定义精确的功能规范。 | 随着问题空间的探索，以性能为导向的目标会演变。 |
| **开发过程** | 功能实现的线性进展。 | 对数据、特性和模型进行迭代实验。 |
| **测试和** | 确定性、二进制通过/失败 | 统计验证和指标， |
| **验证** | 测试标准。 | 涉及不确定性。 |
| **部署** | 行为保持静态，直到明确更新。 | 由于数据分布的变化，性能可能会随时间变化。 |
| **维护** | 维护涉及修改代码以解决错误或添加功能。 | 持续监控、更新数据管道、重新训练模型以及适应新的数据分布。 |
| **反馈循环** | 最小化；后期阶段很少影响早期阶段。 | 频繁的；部署和监控的见解通常完善早期阶段，如数据准备和模型设计。 |

这六个维度揭示了一个基本模式：机器学习系统用概率优化替换确定性规范，用动态适应替换静态行为，用隔离开发替换持续反馈。这种转变解释了为什么传统的项目管理方法在没有修改的情况下应用于机器学习项目时会失败。

机器学习中的实验与传统软件中的测试在本质上存在差异。在 ML 中，实验构成了核心的开发过程本身，而不仅仅是错误检测。它涉及系统地测试关于数据源、特征工程方法、模型架构和超参数的假设，以产生最佳性能。这代表了一种发现过程的科学方法，而不仅仅是质量保证步骤。传统的软件测试根据预定的规范验证代码行为，而 ML 实验探索不确定的空间，以发现产生最佳经验结果的优化组合。

这些差异强调了需要强大的机器学习生命周期框架，以适应迭代开发、动态行为和数据驱动的决策。理解这些区别使得我们可以考察机器学习项目在其生命周期阶段中的展开情况，每个阶段都提出了传统软件方法无法充分解决的独特挑战。

这个基础使得我们可以探索构成机器学习生命周期的具体阶段以及它们如何应对这些独特的挑战。

## 六个核心生命周期阶段

人工智能系统需要专门的开发方法。构成机器学习生命周期的具体阶段提供了这种专门的框架。这些阶段作为一个综合框架运作，其中每个阶段都建立在先前的基础上，同时为后续阶段做准备。

从图 5.1 的详细管道视图转向，我们现在展示一个更高层次的概念视角。图 5.2 将这些详细管道整合为六个主要生命周期阶段，为理解机器学习系统开发的整体进展提供了一个简化的框架。这种抽象有助于我们思考更广泛的阶段，而不会迷失在管道特定细节中。虽然早期图强调了数据和模型的并行处理，但这个概念视角强调了通过主要开发阶段的顺序进展——尽管我们将探讨，这些阶段通过连续反馈保持相互关联。

图 5.2 说明了六个核心阶段，这些阶段定义了成功的 AI 系统开发：问题定义确立目标和约束，数据收集与准备涵盖了整个数据管道，模型开发与训练涵盖了模型创建，评估与验证确保质量，部署与集成将系统带入生产，监控与维护确保持续的有效性。这些阶段通过连续反馈循环运作，后期阶段的见解经常为早期阶段的改进提供信息。这种循环性质反映了将机器学习开发与传统软件工程区分开来的实验性和数据驱动特征。

![图片](img/file68.svg)

图 5.2：**机器学习系统生命周期**：连续反馈循环（通过从监控到数据收集的突出返回路径强调）驱动了定义成功机器学习系统的迭代开发。这个周期通过问题定义、数据准备、模型构建、评估、部署和持续监控进行，但大的反馈箭头说明了后期阶段的见解如何持续地告知和改进早期阶段，从而能够适应不断变化的需求和数据分布。

生命周期始于问题定义和需求收集，在这一阶段，团队明确界定要解决的问题，建立可衡量的性能目标，并识别关键约束。精确的问题定义确保了系统目标与期望结果之间的一致性，为所有后续工作奠定了基础。

在这个基础上，下一个阶段汇集实现这些目标所需的数据资源。数据收集和准备包括收集相关数据、对其进行清理，并为其模型训练做准备。这个过程涉及整理多样化的数据集，确保高质量标注，并开发预处理管道以解决数据中的变化。这一阶段的复杂性在第六章（ch012.xhtml#sec-data-engineering）中探讨。

在数据资源到位的情况下，开发过程创建能够从这些资源中学习的模型。模型开发和训练包括选择合适的算法、设计模型架构以及使用准备好的数据进行模型训练。成功取决于选择适合问题的技术，并对模型设计进行迭代以实现最佳性能。高级训练方法和分布式训练策略在第八章（ch014.xhtml#sec-ai-training）中详细说明，而底层架构在第四章（ch010.xhtml#sec-dnn-architectures）中介绍。

模型训练完成后，严格的评估确保它们在部署前满足性能要求。这一评估和验证阶段涉及对模型性能进行严格测试，以预定义的指标为基准，并验证其在不同场景中的行为，确保模型在实际条件下准确、可靠且稳健。

验证完成后，模型通过谨慎的部署流程从开发环境过渡到运营系统。部署和集成需要解决实际挑战，如系统兼容性、可扩展性和在不同部署环境中的运营约束，这些环境从云端到边缘环境不等，如第二章（ch008.xhtml#sec-ml-systems）所述。

最后一个阶段认识到部署的系统需要持续的监督以维持性能并适应变化条件。这一监控和维护阶段侧重于持续跟踪系统在现实环境中的性能，并在必要时进行更新。有效的监控确保系统随着时间的推移保持相关性和准确性，适应数据、需求或外部条件的变化。

### 案例研究：糖尿病视网膜病变筛查系统

为了将这些生命周期原则与现实相结合，我们考察了糖尿病视网膜病变（DR）筛查系统从最初的研究到广泛临床部署的发展过程（Gulshan 等人 2016）。在本章中，我们利用这一案例作为教学工具，展示生命周期阶段在实际中的相互联系，展示一个阶段的决策如何影响后续阶段。

*注意：虽然这个叙述借鉴了糖尿病视网膜病变筛查部署的记录经验，包括谷歌的工作，但我们已经调整和综合了细节，以说明在医疗人工智能系统中遇到的常见挑战。我们的目标是教育性的——通过一个现实案例展示生命周期原则——而不是提供任何特定项目的纪录片描述。所提出的技术选择、限制和解决方案代表了医疗人工智能开发中的典型模式，这些模式阐明了更广泛系统思维原则。*

#### 从研究成功到临床现实

DR 筛查挑战最初看起来很简单：开发一个能够分析视网膜图像并准确检测糖尿病视网膜病变迹象的人工智能系统，其准确度与专家眼科医生相当。最初的研究结果在受控的实验室条件下达到了专家级的表现。然而，从研究成功到临床影响的过程揭示了人工智能生命周期的复杂性，其中技术卓越必须与运营现实、监管要求和现实世界的部署限制相结合。

这个医疗挑战的规模解释了为什么人工智能辅助筛查成为医学上的必需品，而不仅仅是技术上的有趣。糖尿病视网膜病变影响全球超过 1 亿人，是导致可预防失明的首要原因 8。图 5.3 展示了临床挑战：区分健康视网膜和出现早期视网膜病变迹象的视网膜，如可见的暗红色出血点。虽然这似乎是一个简单的图像分类问题，但从实验室成功到临床部署的路径展示了人工智能生命周期复杂性的各个方面。

![图片](img/file69.png)

图 5.3：**视网膜出血**：糖尿病视网膜病变在视网膜图像中引起可见的出血，为医学图像分析中模型训练和评估提供了一个关键视觉指标。这些图像代表了用于开发自动检测和分类视网膜疾病的算法的输入数据，最终有助于早期诊断和治疗。来源：谷歌。

#### 系统工程教训

DR 系统开发展示了生命周期各阶段的基本人工智能系统原则。数据质量问题导致分布式数据验证的创新。农村诊所的基础设施限制推动了边缘计算 9 优化的突破。与临床工作流程的集成揭示了人机协作设计的重要性。这些经验表明，构建健壮的人工智能系统不仅需要准确模型；成功需要系统性的工程方法，这些方法解决现实世界的部署复杂性。

这场穿越现实世界部署挑战的全面旅程反映了医疗人工智能发展的更广泛模式。在整个生命周期阶段，DR 案例研究展示了早期阶段做出的决策如何影响后续阶段，反馈循环如何推动持续改进，以及如何需要整体解决方案来应对新兴的系统行为。这些部署挑战反映了医疗人工智能 10 中的更广泛问题，这些问题影响大多数现实世界的医学机器学习应用。

这条叙事线索展示了人工智能生命周期的集成性质从一开始就需要系统思维。DR 案例表明，可持续的人工智能系统源于对所有生命周期阶段之间复杂交互的理解和设计，而不是从优化独立的各个组件中产生。

在建立这个框架和案例研究之后，对每个生命周期阶段的考察从问题定义开始。

## 问题定义阶段

机器学习系统开发始于与传统软件开发不同的挑战：不仅要定义系统应该做什么，还要定义系统应该如何学习去做。传统的软件需求直接转化为实施规则，而机器学习系统需要团队考虑系统如何在现实世界的约束条件下从数据中学习 11。如图 5.2 图所示，这一阶段为机器学习生命周期中所有后续阶段奠定了基础。

DR 筛查示例说明了这种复杂性在实际中的体现。糖尿病视网膜病变筛查系统的问题定义揭示了看似简单的医学成像任务背后的复杂性。最初看似简单的计算机视觉实际上需要定义多个相互关联的目标，这些目标塑造了每个后续的生命周期阶段。

开发团队在这些系统中平衡相互冲突的约束：诊断准确性以确保患者安全、计算效率以适应农村诊所的硬件、工作流程集成以促进临床应用、符合监管要求以获得医疗设备批准，以及成本效益以实现可持续部署。每个约束都会影响其他约束，从而形成一个复杂的优化问题，传统软件开发方法无法解决。这种多维问题定义推动了数据收集策略、模型架构选择和部署基础设施决策在整个项目生命周期中的发展。

### 平衡相互冲突的约束

问题定义决策贯穿于系统设计。DR 筛查系统中的需求分析从最初关注诊断准确性指标，发展到包括部署环境约束和机遇。

实现检测可参考糖尿病视网膜病变的 90%以上的灵敏度可以防止视力丧失，同时保持 80%以上的特异性可以避免因假阳性而使转诊系统不堪重负。这些指标必须在多样化的患者群体、摄像头设备和资源有限环境中的典型图像质量条件下实现。

农村诊所部署施加了严格的约束，反映了来自第二章的边缘部署挑战：模型必须在计算能力有限的设备上运行，在断断续续的互联网连接下可靠运行，并在临床工作流程时间框架内产生结果。这些系统需要由接受过最少技术培训的医疗保健工作者操作。

医疗设备法规要求进行广泛的验证、审计跟踪和性能监控能力，这些都会影响数据收集、模型开发和部署策略。

这些相互关联的需求展示了在机器学习系统中进行问题定义需要理解系统将运行的完整生态系统。早期识别这些约束使团队能够做出对成功部署至关重要的架构决策，而不是在重大开发投资之后才发现限制。

### 协同问题定义流程

建立清晰且可操作的问题定义涉及一个系统性的工作流程，该流程连接了技术、运营和用户考虑因素。该过程从确定系统的核心目标开始：它必须执行的任务和必须满足的约束。团队与利益相关者合作，收集领域知识，概述需求，并预测在现实世界部署中可能出现的挑战。

在 DR 类型的项目中，这一阶段涉及与临床医生的紧密合作，以确定农村诊所的诊断需求。在此阶段，关键决策，如平衡模型复杂性与硬件限制，以及确保医疗提供者的可解释性，会浮现出来。此方法必须考虑到监管方面的考虑，例如患者隐私和符合医疗标准。这一合作过程确保了问题定义既与技术可行性相一致，也与临床相关性相符。

### 适应规模变化的定义

随着机器学习系统的规模扩大，其问题定义必须适应新的运营挑战 12。一个 DR 类型的系统最初可能专注于具有一致成像设置的有限数量的诊所。然而，当这样的系统扩展到包括具有不同设备、员工专业知识和患者人口统计的诊所 13 时，原始问题定义需要调整以适应这些变化。

规模化也引入了数据挑战。更大的数据集可能包括更多样化的边缘案例，这可能会暴露出初始模型设计中的弱点。将部署扩展到新地区会引入成像设备和患者群体的变化，这需要进一步调整系统。从一开始就定义一个能够适应这种多样性的问题，确保系统在未来扩展时无需进行全面重新设计。

在我们的 DR 示例中，问题定义过程塑造了数据收集策略。多人群验证的需求推动了多样化训练数据的需求，而边缘部署的限制影响了数据预处理方法。合规性需求决定了注释协议和质量保证标准。这些相互关联的需求展示了有效的问题定义如何预见在后续生命周期阶段中可能出现的问题，为集成系统开发奠定了基础，而不是顺序的、孤立的优化。

在明确的问题定义建立之后，开发过程转向组装实现这些目标所需的数据资源。

## 数据收集与准备阶段

数据收集和准备是机器学习生命周期中的第二个阶段（图 5.2），在这一阶段，原始数据被收集、处理并准备用于模型开发。这一阶段提出了超越收集足够训练示例 14 的独特挑战。这些挑战构成了第六章的核心关注点。对于像 DR 筛查这样的医疗人工智能系统，数据收集必须在统计严谨性和操作可行性之间取得平衡，同时满足诊断准确性的最高标准。

在 DR 示例中，问题定义决策塑造了数据需求。建立的多维成功标准（跨不同人群的准确性、硬件效率和法规遵从性）要求的数据收集策略超越了典型的计算机视觉数据集。

在这样一个系统中建立这个基础可能需要组装一个包含 128,000 张视网膜眼底照片的开发数据集，每张照片都由 54 位专家中的 3-7 位眼科专家审查 15。这种专家共识方法解决了医疗诊断中的固有主观性，同时建立了可以经受监管审查的地面真实标签。标注过程捕捉了与临床相关的特征，如微动脉瘤、出血和硬性渗出物，涵盖了疾病严重程度的全谱。

高分辨率视网膜扫描通常根据分辨率和压缩比生成 10-120 兆字节的文件，这创造了巨大的基础设施挑战。典型的诊所每天处理 50 名患者，每周生成的影像数据量为 5-15 GB，这取决于图像质量和压缩比，很快就会超过农村互联网连接的容量（通常限于 2-10 Mbps 的上传速度）。这种数据量限制迫使架构决策转向边缘计算解决方案，而不是基于云的处理。

### 桥接实验室和现实世界数据

从实验室质量训练数据过渡到现实世界部署时，当这样的系统转移到农村诊所环境时，会暴露出基本差距。

当部署开始在泰国和印度等地区的农村诊所开始时，现实世界数据与精心策划的训练集差异很大。图像来自各种相机设备，由不同专业水平的员工操作，通常在光照条件不佳和患者定位不一致的情况下进行。这些变化威胁到模型性能，并揭示了需要强大的预处理和质量保证系统。

这个数据量限制驱动了在第二章中讨论的部署范例之间的基本架构决策：边缘计算部署而不是基于云的推理。本地预处理将带宽需求减少了 95%（从每周 15 GB 减少到 750 MB 传输），但需要 10 倍更多的本地计算资源，这决定了模型优化策略和部署硬件需求，使用专门的边缘设备如 NVIDIA Jetson16。

典型的解决方案架构源于数据收集限制：NVIDIA Jetson 边缘设备（2-32GB RAM，64-2048 CUDA 核心，取决于模型）用于本地推理，诊所聚合服务器（8 核 CPU，32GB RAM）用于数据管理，以及使用 32-GPU 集群进行每周模型更新的云训练基础设施。这种分布式方法实现了低于 80 毫秒的推理延迟，并在覆盖 200 多个诊所位置的部署中实现了 94%的可用性。

患者隐私法规要求采用联邦学习架构，允许在不集中敏感患者数据的情况下进行模型训练。这种方法增加了数据收集工作流程和模型训练基础设施的复杂性，但对于获得监管批准和临床采用至关重要。

这些经验说明了我们之前建立的约束传播原则：数据收集的生命周期决策在系统开发过程中产生约束和机会，这些约束和机会会传播到整个系统，从基础设施设计到模型架构塑造一切。

### 分布式部署的数据基础设施

在大规模下，了解数据特性和部署限制如何驱动架构决策变得至关重要。每个视网膜图像都遵循复杂的旅程：在诊所摄像头中捕获，本地存储和初步处理，质量验证，安全传输到中央系统，以及与训练数据集的集成。

不同的数据访问模式需要不同的存储解决方案。团队通常实施分层方法，平衡成本、性能和可用性：频繁访问的训练数据需要高速存储以实现快速模型迭代，而历史数据集可以容忍较慢的访问时间，以换取成本效益。智能缓存系统根据使用模式优化数据访问，确保相关数据始终易于获取。

农村诊所部署面临重大的连接限制，需要灵活的数据传输策略。对于有可靠互联网的诊所，实时传输效果良好，而存储转发系统则允许在间歇性连接的地区进行操作。这种自适应方法确保了无论当地基础设施限制如何，系统都能保持一致运行。

基础设施设计必须能够预见从试点部署到数百个诊所的增长。该架构能够适应不同的数据量、不同的硬件配置以及多样化的运营需求，同时保持数据一致性和系统可靠性。当系统扩展到新区域时，这一可扩展性基础证明是至关重要的。

### 大规模数据管理

在扩展规模时应用系统思维，随着机器学习系统的扩展，数据收集挑战呈指数级增长。在我们的 DR 示例中，从初始诊所扩展到更广泛的网络引入了突现的复杂性：设备、工作流程和操作条件存在显著差异。每个诊所实际上成为一个独立的数据节点 17，但系统需要确保所有地点的性能一致。遵循之前建立的协作协调模式，团队实施专门的编排，共享工件存储库、版本化 API 和自动测试管道，从而能够高效地管理大型诊所网络。

将此类系统扩展到更多的诊所也会带来数据量的增加，因为更高分辨率的成像设备成为标准，生成更大、更详细的图像。这些进步放大了对存储和处理基础设施的需求，需要优化以保持效率而不影响质量。患者人口统计学、诊所工作流程和连接模式的不同进一步强调了需要稳健的设计来优雅地处理这些变化。

扩展挑战突出了在数据收集阶段做出的决策如何在整个生命周期中产生连锁反应，影响后续阶段，如模型开发、部署和监控。例如，在收集过程中容纳更高分辨率的直接影响了训练和推理的计算需求，强调了即使在早期阶段也需要考虑生命周期思维。

### 质量保证与验证

质量保证是数据收集过程的一个组成部分，确保数据满足下游阶段的要求。在我们的 DR 示例中，在收集点进行的自动检查会标记出诸如焦点不佳或构图不正确等问题，允许诊所工作人员立即解决问题。这些主动措施确保低质量数据不会在管道中传播。

验证系统通过验证图像质量、适当的标签、患者关联以及符合隐私法规来扩展这些努力。在本地和集中级别运行，这些系统确保数据可靠性和鲁棒性，保护整个机器学习管道的完整性。

在此类系统中的数据收集经验直接指导模型开发方法。在数据收集期间发现的架构限制（有限的带宽、多样化的硬件、间歇性的连接）为模型效率建立了要求，这些要求推动了架构决策。受隐私限制所需的分布式联邦学习方法影响了训练管道的设计。在不同临床环境中观察到的质量变化塑造了验证策略和鲁棒性要求。这种数据收集洞察与模型开发策略之间的耦合展示了如何通过综合的生命周期规划超越顺序阶段优化。

![图 5.4](img/ch011.xhtml#fig-ml-lifecycle-feedback)展示了这些关键的反馈循环，这些循环使得系统能够持续改进。在数据收集期间建立的基础既使可用的技术方法能够创建有效的模型，又对其施加了限制——这种动态在我们现在过渡到模型开发阶段时变得明显。

![图片](img/file70.svg)

图 5.4：**机器学习生命周期依赖性**：迭代反馈循环连接数据收集、准备、模型训练、评估和监控，强调每个阶段都在连续过程中影响和影响后续阶段。有效的机器学习系统开发需要承认这些依赖关系，以优化数据、重新训练模型并保持长期性能。

## 模型开发与训练阶段

模型开发和训练（图 5.2 中的第三阶段）是机器学习系统的核心，但这一阶段提出了超越选择算法和调整超参数的独特挑战 18。训练方法、基础设施要求和分布式训练策略在第八章中有所介绍。在医疗保健等高风险领域，每个设计决策都会影响临床结果，因此将技术性能与操作限制相结合至关重要。

在我们的 DR 示例中，早期生命周期决策通过模型开发层层递进。所建立的问题定义要求（专家级准确性与边缘设备兼容性）创建了一个优化挑战，这要求对模型架构和训练策略都采取创新方法。

**迁移学习**是将在大规模数据集上预训练的模型应用于新任务的技巧，通过利用学习到的表示，显著减少**训练时间**和**数据需求**。

通过使用从 ImageNet19 迁移学习并结合精心标注的 128,000 张图像的数据集，此类项目中的开发者实现了 0.91-0.95 的 F 分数 20，在受控环境中与眼科医生的表现相当或更好。这一结果验证了将大规模预训练与领域特定微调相结合的方法——一种利用第三章中的基于梯度的优化原则的训练策略，以适应第四章中预训练的卷积架构，用于医学成像。

实现高精度只是第一个挑战。关于边缘部署约束的数据收集见解对效率提出了严格的要求：模型必须在 98MB 以下运行，达到低于 50ms 的推理延迟，并在运行时消耗低于 400MB 的 RAM。最初的研究模型（一个 2.1GB 的集成 21，实现 95.2%的准确率）违反了所有部署约束，需要系统优化以达到最终 96MB 模型，同时保持 94.8%的准确率并满足所有操作要求。

这些约束推动了架构创新，包括用于尺寸缩减、推理加速和高效部署场景的模型优化技术——平衡第四章中提到的深度卷积网络的计算需求与第二章中详细说明的边缘设备资源限制。

按照建立的迭代开发框架，模型开发过程需要在精度优化和效率优化之间进行持续迭代。每个架构决策（从卷积层的数量到第三章中涵盖的激活函数选择，再到第四章中探索的整体网络深度）都必须通过测试集指标和数据收集期间确定的基础设施约束进行验证。这种多目标优化方法体现了相互依赖原则，即部署约束塑造开发决策。

### 平衡性能和部署约束

我们 DR 示例中的模型开发经验展示了临床有效性和部署可行性之间的基本权衡，这是现实世界 AI 系统的特征。

医疗应用需要特定的性能指标 22，这些指标与第三章中引入的标准分类指标有显著差异。DR 系统需要>90%的灵敏度（以防止因漏诊而导致的视力丧失）和>80%的特异性（以避免过度占用转诊系统）。这些指标必须在不同的患者群体和图像质量条件下得到保持。

仅优化临床性能是不够的。数据收集阶段边缘部署的约束施加了额外的要求：模型必须在资源有限的硬件上高效运行，同时保持与临床工作流程兼容的实时推理速度。这创造了一个多目标优化问题，其中某一维度的改进往往以牺牲其他维度为代价，这是模型容量（在第四章中探讨）和部署可行性（在第二章中讨论）之间的基本紧张关系。团队发现，一个原始的 2GB 模型，准确率达到 95.2%，可以通过系统应用量化、剪枝和知识蒸馏 23 技术优化到 96MB，准确率保持在 94.8%，同时满足部署要求并保持临床效用。

选择使用轻量级模型集合而不是单个大型模型，体现了模型开发决策如何通过系统生命周期传播。这个架构决策降低了单个模型的复杂性（使边缘部署成为可能），但增加了推理管道的复杂性（影响部署和监控策略）。团队必须为模型集合开发编排逻辑，并创建能够跟踪多个模型组件性能的监控系统。

这些模型开发经验强化了我们之前建立的生命周期集成原则。从选择用于空间特征提取的 CNN 架构(第四章)到配置训练超参数(第三章)的架构决策会影响数据预处理管道、训练基础设施需求以及部署策略。这表明，成功的模型开发需要预测后续生命周期阶段的约束，而不是孤立地优化模型，反映了我们的系统思维方法。

### 受约束的开发流程

实际约束从初始探索到最终优化的整个模型开发过程，要求系统性的实验方法。

开发始于数据科学家和领域专家（如医学成像中的眼科医生）之间的协作，以识别指示目标条件的特征。这种跨学科方法确保模型架构能够捕获临床相关特征，同时满足在数据收集期间确定的计算限制。

计算限制深刻地塑造了实验方法。生产级机器学习工作流程产生乘法成本：10 个模型变体 × 5 个超参数搜索（探索从 1e-4 到 1e-2 的学习率，从 16 到 128 的批量大小，以及从第三章中的优化算法）× 3 个预处理方法（原始图像，直方图均衡化，自适应滤波）= 150 次训练运行。根据硬件和持续时间的不同，每次训练运行的费用大约在$500-2000 之间，迭代成本可以达到每个实验周期$150K。这种经济现实推动了高效实验的创新：智能作业调度减少了 60%的空闲 GPU 时间，缓存中间结果节省了 30%的预处理时间，早期停止技术在完成 20%后终止无望的实验，以及自动资源优化实现了 2.3 倍的成本效率。

机器学习模型开发表现出涌现行为，使得结果本质上具有不确定性，需要科学方法论原则：通过固定的随机种子和环境版本进行变量控制，进行系统性的消融研究 24 以隔离组件贡献，通过混杂因素分析将架构效应与优化效应分开，以及使用 A/B 测试 25 框架在多次运行中进行统计显著性测试。这种方法对于区分真正的性能改进和统计噪声至关重要。

在整个开发过程中，团队将模型与早期生命周期阶段中确定的部署约束进行验证。每个架构创新都必须评估其准确性改进以及与边缘设备限制和临床工作流程要求兼容性。这种双重验证方法确保开发工作与部署目标保持一致，而不是优化实验室条件，这些条件无法转化为实际世界的性能。

### 从原型到生产规模开发

随着类似我们的 DR 示例项目从原型发展到生产系统，团队在多个维度上遇到涌现的复杂性：更大的数据集、更复杂的模型、并发实验和分布式训练基础设施。这些扩展挑战展示了适用于大型规模 AI 系统开发的系统思维原则。

从单机训练转向分布式系统引入了协调需求，这要求在提高训练速度和增加系统复杂性之间进行平衡。这导致实施容错机制和自动故障恢复系统。编排框架允许基于组件的管道构建，具有可重用阶段、自动资源扩展和对分布式组件的监控。

随着实验生成包括模型检查点、训练日志和性能指标等工件 26，系统跟踪变得至关重要。如果没有结构化的组织，团队可能会从他们的实验努力中失去机构知识。解决这个问题需要实施系统性的实验识别、自动工件版本控制和通过性能特征和配置参数查询实验的能力。

大规模模型开发需要在训练计算和支撑基础设施之间进行资源分配。虽然有效的实验管理需要计算开销，但这种投资通过系统性的性能分析和优化加速了开发周期并提高了模型质量。

模型开发过程既建立了能力，也建立了直接影响下一生命周期阶段的限制。边缘优化的集成架构使得诊所部署成为可能，但需要复杂的服务基础设施。规定验证要求塑造了部署验证协议。这些相互关联的需求展示了开发决策如何为部署方法奠定基础并设定限制。

这些模型开发成就最终为部署阶段带来了新的挑战。一个满足边缘设备约束的优化集成架构仍然需要复杂的服务基础设施。能够实现快速迭代的分布式训练方法需要模型版本控制和诊所部署的同步。指导模型开发的规定验证要求也指导了部署验证和监控策略。这些相互关联展示了成功的模型开发必须预见部署挑战，确保技术创新可以转化为能够创造价值的运营系统。

## 部署与集成阶段

在部署和集成阶段（图 5.2 中的第五阶段），训练好的模型被集成到生产系统和流程中。部署需要解决实际挑战，如系统兼容性、可扩展性和运营限制。成功的集成确保模型在现实世界环境中的预测是准确且可执行的，在这些环境中，资源限制和工作流程中断可能构成障碍。部署和维护的操作方面在第十三章中有详细说明。

在我们的灾难恢复（DR）示例中，部署策略是由我们之前确定的多样化环境所塑造的。边缘部署允许在具有间歇性连接的农村诊所中本地处理视网膜图像，而自动质量检查则会标记出低质量的图像以便重新捕获，确保预测的可靠性。这些措施展示了部署必须将技术复杂性与技术可用性和临床环境中的可扩展性相结合。

### 技术和运营需求

部署需求既源于模型的技术规范，也源于其预期环境的运营限制。在我们的 DR 类型系统中，模型必须在具有有限计算资源和间歇性互联网连接的农村诊所中运行。它必须适应现有的临床工作流程，需要快速、可解释的结果来协助医疗保健提供者，而不会造成干扰。

这些要求影响了部署策略。虽然基于云的部署在技术上更简单，但由于许多诊所的连接不可靠，可能不可行。相反，团队通常选择边缘部署，其中模型在诊所硬件上本地运行。这种方法需要模型优化以满足特定的硬件约束：目标指标可能包括小于 98MB 的模型大小、低于 50ms 的推理延迟以及在边缘设备上低于 400MB 的 RAM 使用。实现这些目标需要系统地应用优化技术，以减少模型大小和计算需求，同时平衡准确性的权衡。

与现有系统的集成带来了额外的挑战。机器学习系统必须与医院信息系统（HIS）接口，以访问患者记录并存储结果。隐私法规要求在每一步都进行安全的数据处理，这影响着部署决策。这些考虑确保系统遵守临床和法律标准，同时保持日常使用的实用性。

### 分阶段推广和集成流程

在我们的 DR 示例中，部署和集成工作流程突出了模型功能、基础设施和用户体验之间的复杂相互作用。该过程从在模拟环境中进行彻底测试开始，这些模拟环境复制了目标诊所的技术约束和工作流程。这些模拟有助于早期识别潜在的瓶颈和不兼容性，使团队能够在全面推广之前完善部署策略。

一旦部署策略确定，团队通常会实施分阶段推广。初始部署仅限于几个试点站点，允许在真实世界条件下进行受控测试。这种方法提供了来自临床医生和技术人员的宝贵反馈，有助于识别在模拟中未出现的問題。

集成工作侧重于确保机器学习系统与现有工具之间无缝交互。例如，这样的 DR 系统必须从 HIS 中提取患者信息，处理连接的摄像头中的视网膜图像，并以临床医生易于解释的格式返回结果。这些任务需要开发健壮的 API、实时数据处理管道和针对医疗保健提供者需求的用户友好界面。

### 多地点部署挑战

在多个诊所地点部署我们的 DR 类型系统揭示了将 AI 系统扩展到受控实验室环境之外的基本挑战。每个诊所都提出了独特的约束：不同的成像设备、不同的网络可靠性、不同的操作员专业知识水平以及不同的工作流程模式。

从开发到部署的转变暴露了显著的性能挑战。成像设备和操作员技能的差异性导致数据质量不一致，这使得模型难以处理。基础设施限制可能迫使进行紧急模型优化，展示了部署现实如何反向传播到开发过程，影响预处理策略、架构决策和验证方法。

团队发现部署架构决策在整个系统中产生级联效应。边缘部署最小化了实时临床工作流程的延迟，但对模型复杂性施加了严格的限制。云部署使模型具有灵活性，但可能引入对时间敏感的医疗应用不可接受的延迟。

成功的部署需要不仅仅是技术优化。临床医生反馈通常表明，初始系统界面需要重大重新设计才能实现广泛采用。团队必须在技术复杂性和临床可用性之间取得平衡，认识到用户信任和熟练程度与算法性能一样关键。

管理分布式部署的改进需要复杂的协调机制。集中式版本控制系统和自动更新管道确保性能改进到达所有部署站点，同时最大限度地减少对临床运营的干扰。如图图 5.4 所示，部署挑战创造了多个反馈路径，推动系统持续改进。

### 确保临床级可靠性

在临床环境中，可靠性至关重要。DR 型系统需要在各种条件下无缝运行，从高患者数量到次优成像设置。为确保稳健性，团队实施安全措施，以检测和处理常见问题，例如不完整或质量较差的数据。这些机制包括自动图像质量检查和系统遇到错误时的回退工作流程。

测试在确保可靠性方面发挥着核心作用。团队进行广泛的压力测试，以模拟峰值使用场景，验证系统在高吞吐量下不会性能下降。关键组件中内置冗余，以最小化停机风险，并且所有与外部系统（如 HIS）的交互都经过严格的兼容性和安全性测试。

在此类系统中的部署经验揭示了这一阶段如何从以开发为中心的活动过渡到以运营为中心的关注点。现实世界的部署反馈（从临床医生可用性关注到硬件性能问题）产生了见解，这些见解为最终的生命周期阶段提供了信息：持续的监控和维护策略。分布式边缘部署架构为系统级监控和协调更新创造了新的要求。与医院信息系统集成的挑战确立了管理系统进化的协议，而不会干扰临床工作流程。

成功的部署为有效的监控和维护奠定了基础，创建了使持续改进成为可能的运营基础设施和反馈机制。部署经验表明，这一阶段不是终点，而是过渡到持续运营阶段，这一阶段体现了我们的系统思维方法。

## 监控与维护阶段

一旦人工智能系统从部署过渡到生产运营，它们将进入与传统软件系统截然不同的运营阶段。如图 5.2 图所示，反馈循环从最终阶段返回到数据收集，监控和维护创建了一个持续循环，使系统可靠地运行。传统应用程序保持静态行为，直到明确更新，而机器学习系统必须考虑不断变化的数据分布、使用模式的改变和模型性能漂移。

监控和维护是确保部署的机器学习系统持续有效性和可靠性的持续、关键过程。传统的软件维护静态行为，而机器学习系统必须考虑数据分布的变化 27、使用模式的改变以及不断发展的运营需求 28。监控提供了适应这些挑战所需的反馈，而维护确保系统不断进化以满足新的需求。这些运营实践构成了第十三章的基础。

正如我们在图 5.4 图中看到的，监控作为系统改进的中心枢纽，产生了三个关键的反馈循环：“性能见解”返回到数据收集以解决差距，“数据质量问题”触发数据准备的改进，以及“模型更新”在性能漂移时启动重新训练。在我们的 DR 示例中，这些反馈循环使系统持续改进：识别代表性不足的患者人口统计学（触发新的数据收集）、检测图像质量问题（改进预处理）以及解决模型漂移（启动重新训练）。

对于 DR 筛查系统，持续监控跟踪不同诊所的系统性能，检测可能影响准确性的问题，如患者人口统计学的变化或新的成像技术。主动维护包括计划纳入 3D 成像模式，如 OCT，扩大系统的诊断能力，以诊断更广泛的疾病。这证明了设计能够适应未来挑战的系统的重要性，同时保持符合严格的医疗保健法规和第十七章中探讨的负责任 AI 原则。

### 动态系统的生产监控

监控和维护的需求既来自技术需求，也来自运营现实。在我们的 DR 示例中，从技术角度进行监控需要持续跟踪模型性能、数据质量和系统资源使用情况。然而，运营限制增加了复杂性：监控系统必须与临床工作流程相一致，检测患者人口统计学的变化，并向技术团队和医疗保健提供者提供可操作的见解。

初始部署通常突出显示几个系统未能满足现实需求的地方，例如，5 年以上的设备在诊所中准确性降低 15-25%，或分辨率低于 1024x1024 像素的图像。监控系统检测到特定子组的性能下降：增殖性糖尿病视网膜病变（影响 2%的筛查人群）的患者准确性降低 18%，以及有显著白内障的图像（影响 65 岁以上老年人的 12%）的敏感性损失 22%。这些盲点在实验室验证期间可能看不见，但在临床实践中至关重要 29，这些信息指导了维护策略，包括针对性的数据收集（添加 15,000 张受白内障影响的照片）和架构改进（使用专门的病理检测器的集成模型）。

这些需求对系统设计产生了重大影响。这些系统的关键性质要求实时监控能力，而不是定期的离线评估。团队通常建立明确的定量性能阈值和行动触发器：P95 延迟超过基线的 2 倍将生成立即警报，并具有 5 分钟响应 SLA，模型准确性下降超过 5%将触发每日警报，并具有自动重新训练工作流程，数据漂移人口稳定性指数（PSI）30 得分高于 0.2 将启动每周警报，并通知数据团队，资源利用率超过 80%将激活自动扩展机制和成本监控。

监控需求也会影响模型设计，因为团队会整合细粒度性能跟踪和异常检测的机制。甚至系统的用户界面也会受到影响，需要以清晰、可操作的方式向临床和技术人员展示监控数据。

### 通过反馈循环实现持续改进

我们 DR 示例中的监控和维护工作流程揭示了自动化系统、人类专业知识和不断发展的医疗实践之间错综复杂的相互作用。此工作流程从定义完整的监控框架开始，建立关键绩效指标（KPIs），并实施仪表板和警报系统。此框架必须在监控深度与系统性能和隐私考虑之间取得平衡，收集足够的数据以检测问题，而不会过度负担系统或违反患者隐私。

随着系统的成熟，维护成为一个越来越动态的过程。由新的医学知识或性能改进驱动的模型更新需要仔细验证和受控的发布。团队采用 A/B 测试框架来评估实际条件下的更新，并在问题出现时实施回滚机制 31 以快速解决问题。与处理代码更改的传统软件不同，机器学习系统必须考虑数据演变 33 对模型行为的影响，这是传统 CI/CD 管道未设计用来处理的方式。

监控和维护构成一个迭代周期，而不是离散的阶段。监控的见解为维护活动提供信息，而维护工作往往需要更新监控策略。团队开发工作流程，以便无缝地从问题检测过渡到解决，涉及技术和临床领域的跨领域协作。

### 分布式系统大规模监控

如我们的 DR 示例所示，从 5 个试点站点扩展到 200 多个诊所部署，监控和维护的复杂性呈指数增长。每个额外的诊所每周产生 2-5 GB 的操作日志（包括推理时间、图像质量指标、错误率和使用模式），每周在系统范围内产生 400-1000 GB 的数据量，需要自动分析。每个诊所还引入了环境变量：15+种不同的摄像头型号（从 200 万像素的移动设备到 1200 万像素的专业系统）、不同的操作技能水平（从受过培训的技术人员到社区健康工作者），以及多样的人口统计模式（城市与农村，平均年龄差异 20+年）。

需要监控全局性能指标和特定站点行为的需求需要复杂的基础设施。监控系统跟踪阶段级指标，包括分布式工作流程中的处理时间、错误率和资源利用率，维护完整的数据血缘 34 跟踪，包括从源到预测的审计跟踪以符合监管要求，将生产问题与特定的训练实验相关联以实现快速根本原因分析，并为跨团队和项目的资源使用提供成本归因跟踪。

持续适应增加了额外的复杂性。现实世界的使用使系统暴露于不断扩大的场景范围。从这些场景中捕捉洞察力并使用它们来驱动系统更新，需要将新数据集成到训练管道中并部署改进模型，而不破坏临床工作流程的有效机制。

### 预测和防止系统退化

仅靠反应性维护对于动态运营环境来说是不够的。主动策略变得至关重要，以预测和防止问题在影响临床运营之前发生。

预测性维护模型根据运营数据中的模式识别潜在问题。持续学习管道允许系统根据新数据进行重新训练和适应，确保其与临床实践或患者人口统计学的演变保持相关性。这些能力需要仔细平衡，以确保安全性和可靠性，同时保持系统性能。

评估适应性和弹性的指标与准确性一样重要，反映了系统与其运营环境一起演变的能力。主动维护确保系统能够处理未来的挑战，而不会牺牲可靠性。

这些监控和维护经验使我们的生命周期之旅圆满结束，展示了图 5.1 中所示的持续反馈循环。生产洞察力为精炼的问题定义、数据质量改进、架构增强和后续迭代的基础设施规划提供信息——关闭了区分 ML 系统与传统线性开发的循环。

这种持续的反馈和改进周期体现了将 AI 系统与传统软件开发区分开来的系统思维方法。成功不是来自孤立地完善各个生命周期阶段，而是来自构建通过理解所有组件如何相互连接来学习、适应和改进的系统。

## 集成系统思维原则

通过我们的糖尿病视网膜病变案例研究检查 AI 生命周期的每个阶段，系统级模式浮现出来，这些模式区分了成功的 AI 项目与那些在集成挑战中挣扎的项目。DR 示例表明，构建有效的机器学习系统不仅需要技术卓越，还需要理解技术决策如何创建在整个开发和部署过程中级联的相互依赖关系。

从我们的分析中出现了四个基本的系统思维模式：约束传播、多尺度反馈、涌现的复杂性和资源优化。这些模式为理解后续技术章节如何相互关联提供了分析框架，展示了为什么专门的数据工程、框架、培训和运营方法共同实现了个体优化无法实现的集成系统。

### 决策如何通过系统级联

约束传播代表了机器学习开发中最关键的系统思维模式：早期的决策会产生级联效应，塑造每一个后续阶段。我们的 DR 示例清楚地说明了这一模式：>90%的敏感性要求推动数据收集策略（需要专家共识标签），这影响了模型架构的选择（需要高容量网络），这决定了部署约束（需要边缘优化），这塑造了监控方法（需要分布式性能跟踪）。

这种传播是双向的，它创建的是动态约束网络而不是线性依赖。当乡村诊所部署揭示带宽限制（平均 2-10 Mbps）时，团队必须重新设计数据预处理管道以实现 95%的压缩比率，这需要针对压缩输入优化的模型架构，这影响了考虑数据退化的训练策略。理解这些级联关系使团队能够做出适应系统约束而不是与之对抗的架构决策。

### 在多个时间尺度上协调反馈

机器学习系统通过在多个时间尺度上协调反馈循环而成功，每个循环服务于不同的系统优化目的。我们的 DR 部署体现了这一模式：分钟级循环（实时质量检查，自动图像验证），日循环（200 多个诊所的模型性能监控），周循环（汇总精度分析，漂移检测），月循环（人口统计数据偏差评估，硬件性能审查），以及季度循环（架构评估，为新地区进行容量规划）。

这些反馈循环的时间结构反映了机器学习系统的内在动态。快速循环能够快速纠正操作问题——一个诊所配置错误的摄像头可以在几分钟内被检测并纠正。较慢的循环能够实现战略适应——认识到人口统计数据的变化需要扩展训练数据，需要数月的监控来可靠地检测。这种多尺度方法防止了反应性变化（过度响应日常波动）和缓慢适应（对有意义趋势反应不足）。

### 理解系统级行为

复杂系统表现出在分析单个组件时不可见的涌现行为，但在系统尺度上变得明显。我们的 DR 部署揭示了这一模式：单个诊所可能显示出稳定的 94%准确率，但系统级分析检测到影响特定人口群体的微妙性能退化——这些模式在单一站点监控中不可见，但对于公平的医疗保健提供至关重要。

机器学习系统中的涌现复杂性在表现上与传统软件不同。虽然传统的分布式系统通过确定性级联（服务器崩溃、网络分区）失败，但机器学习系统通过数据漂移、模型偏差放大和跨异构环境的微妙性能侵蚀表现出概率性退化。管理这种复杂性需要分析框架，这些框架可以检测分布式部署中的统计模式，在系统级问题显现之前进行主动干预。

### 多维度资源权衡

机器学习系统中的资源优化涉及多维度权衡，这些权衡在传统软件开发中不存在，产生了复杂的相互依赖关系。我们的 DR 案例说明了这些权衡：将模型精度从 94.8%提高到 95.2%，需要将模型大小从 96MB 扩展到 180MB，这迫使部署从边缘设备（每个 200-600 美元）转移到更强大的硬件（每个 800-2000 美元），在 200 多个诊所中乘以——这导致基础设施成本增加了 16 万美元，而精度仅提高了 0.4%。

这些资源权衡表现出非线性关系，难以用简单的优化方法解决。训练时间与数据大小呈二次方关系，但模型精度改进的回报递减。边缘部署将推理延迟减少了 85%，但将模型复杂性限制了 90%。云部署允许无限的模型复杂性，但引入了 200ms 以上的延迟，违反了临床工作流程要求。理解这些权衡关系使团队能够做出战略性的架构决策，而不是试图孤立地优化单个组件。

### 机器学习系统工程学科

这四种系统思维模式——约束传播、多尺度反馈、涌现复杂性和资源优化——汇聚在一起，定义了一种工程机器学习系统的基本不同的方法。与可以独立优化的传统软件不同，机器学习系统需要同时考虑跨组件依赖关系、时间动态和资源约束的集成优化。

DR 案例研究证明了这种集成方法产生的系统比通过逐个阶段顺序优化开发的系统更稳健、更适应性强、更有效。当团队设计出能够预见部署限制的数据收集策略，创建能够适应运营现实情况的设计架构，并实施能够推动持续改进的监控系统时，他们能够达到孤立优化方法无法达到的性能水平。这种系统的集成代表了将机器学习从实验技术转变为可靠系统工程实践的核心工程学科。

## 谬误和陷阱

机器学习的发展引入了与传统软件开发不同的独特复杂性，然而许多团队在未认识到这些差异的情况下，试图应用熟悉的开发模式。机器学习的实验性质、数据质量的核心作用以及模型的概率行为，都创造了传统方法无法解决的问题的工作流程挑战。

**谬误：** *机器学习开发可以遵循传统的软件开发工作流程而不做修改。*

这种误解导致团队直接将传统的软件开发实践应用于机器学习项目。正如我们在传统与 AI 生命周期比较中确立的，ML 系统通过数据可变性、算法随机性和不断发展的模型性能引入了基本的不确定性，这是传统的确定性方法无法处理的。将 ML 项目强制纳入僵化的瀑布或标准敏捷方法，通常会导致错过截止日期、模型验证不足和部署失败。成功的 ML 工作流程需要专门的数据验证阶段(第六章)、实验跟踪阶段(第七章)和迭代模型细化阶段(第八章)。

**陷阱：** *将数据准备视为一次性预处理步骤。*

许多从业者将数据收集和预处理视为初始工作流程阶段，一旦完成，在整个项目生命周期中保持静态。这种方法未能考虑到现实世界数据的动态性，其中分布变化、质量变化和新数据源持续出现。生产系统需要持续的数据验证、漂移监控和适应性预处理管道，如第六章中详细所述。将数据准备视为已完成里程碑的团队，在部署系统遇到与训练条件不同的数据时，往往会遇到意外的模型退化，这突显了第十六章中探讨的鲁棒性挑战。

**谬误：** *开发环境中的模型性能准确预测生产性能。*

这种信念假设在开发期间实现良好的指标可以确保成功的部署。开发环境通常使用干净、精心整理的数据集和受控的计算资源，创造出很少与生产现实相匹配的人工条件。生产系统面临数据质量问题、延迟限制、资源限制和开发期间不存在的不利输入。在开发中表现优异的模型可能会因为这些环境差异而在生产中失败，需要专门设计的工作流程阶段，通过第十三章中涵盖的鲁棒部署实践和第二章中的系统设计原则来弥合这一差距。

**陷阱：** *跳过系统验证阶段以加速开发时间表。*

在快速交付的压力下，团队通常会绕过验证、测试和文档阶段。这种方法将验证视为额外负担，而不是基本工程学科。不充分的验证会导致具有隐藏偏差、泛化能力差或仅在生产中出现的意外故障模式的模型。在部署后修复这些问题所需的成本超过了系统验证所需的时间投资。健壮的工作流程将验证嵌入到整个开发过程中，而不是将其视为最终检查点，并纳入第十二章中详细说明的基准测试和评估原则。

## 摘要

本章将机器学习生命周期确立为工程机器学习系统的系统性框架，这是一条思维路线图，它组织了数据、模型和部署基础设施在整个开发过程中的相互联系。图 5.1 通过两个并行管道可视化了这个框架：数据管道通过收集、摄取、分析、标记、验证和准备将原始输入转换为机器学习准备好的数据集，而模型开发管道将这些数据集通过训练、评估、验证和部署创建生产系统。关键洞察在于它们的相互联系：反馈箭头显示了部署洞察如何触发数据优化，从而创建区分机器学习与传统线性开发的持续改进循环。

理解这个框架可以解释为什么机器学习系统需要与传统的软件截然不同的专门方法。机器学习工作流程用概率优化取代了确定性规范，用动态适应取代了静态行为，用连续反馈循环取代了孤立开发。这种系统性的视角认识到，成功并非来自孤立地完善各个阶段，而是来自理解数据质量如何影响模型性能，部署限制如何塑造训练策略，以及生产洞察如何指导每个后续的开发迭代。

**关键要点**

+   机器学习生命周期为理解后续技术章节之间的相互联系提供了框架——数据工程、框架、训练和操作各自处理这个完整系统中的特定组件。

+   两个并行管道定义了机器学习开发的特点：数据处理（收集→准备）和模型开发（训练→部署），它们通过连续反馈循环统一。

+   机器学习工作流程通过迭代实验、数据驱动适应和反馈机制与传统的软件截然不同，这些机制使系统能够持续改进。

+   系统思维模式——约束传播、多尺度反馈、涌现复杂性和资源优化——涵盖了后续章节中探讨的所有技术实现。

这里建立的工作流程框架为第二部分的技术章节提供了组织结构。数据工程（第六章）扩展了我们探讨的数据管道阶段，讨论了如何确保数据在整个生命周期中的质量和数据管理。框架（第七章）考察了支持这种迭代开发过程的软件工具。训练（第八章）详细说明了如何高效地大规模训练模型。运营（第十三章）探讨了系统如何通过图 5.1 中展示的反馈循环在生产中维持性能。每一章后续章节都假设你理解其特定技术如何适应这个完整的流程，并在此基础上构建系统性的视角。

* * *
